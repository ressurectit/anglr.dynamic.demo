"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[5842],{50267:(t,e,n)=>{n.d(e,{O:()=>j});var o=n(27052),i=n(46480),a=n(23199),r=n(57466),s=n(13691);class c{transform(t){return{metadata:{id:"",displayName:"",package:t.itemSource.package,name:t.itemSource.name,options:(0,r.l7)(!0,{},t.metadata.metaInfo?.defaultOptions)},parentId:null,index:null}}}c.ɵfac=function(t){return new(t||c)},c.ɵpipe=s.Yj({name:"toLayoutDragData",type:c,pure:!0,standalone:!0});var p=n(71785),l=n(10219),d=n(80827),h=n(41853),u=n(6845),g=n(66794),m=n(6427),f=n(84773),_=n(72891),b=n(43870),y=n(65589),C=n(15686),v=n(73301),x=n(4477),D=n(79440),P=n(68961),w=n(82568),M=n(17505),I=n(85902),O=n(12311),k=n(21651),S=n(32434),T=n(74445),E=n(4905),F=n(88364),L=n(48759),Y=n(98906),N=n(52053);class Z{constructor(t,e,n,o,i){this.dnd=t,this.paletteItemElement=e,this.draggingSvc=n,this.bus=o,this.zone=i,this.initSubscriptions=new a.w0,this.drag=this.dnd.dragSource("METADATA",{beginDrag:()=>{this.draggingSvc.setDragging(!0);const t=(0,r.l7)(!0,{},this.dragData);if(t.metadata){const e=`${t.metadata.name}-${(0,r.Ox)(16)}`;t.metadata.id=e,t.metadata.displayName=e}return{dragData:t}},endDrag:t=>{if(t.didDrop()){const e=t.getItem(),n=t.getDropResult();if(!e)return;e.dragData.index=n.index,this.bus.setDropData({data:e.dragData,id:n.id}),this.itemDrop.emit()}this.bus.setDropPlaceholderPreview(null),this.draggingSvc.setDragging(!1)}},this.initSubscriptions),this.itemDrop=new T.v,this.connectDragToItem()}ngOnInit(){if(!this.dragData)throw new Error("DndCoreDesignerDirective: missing drag data!")}ngOnDestroy(){this.initSubscriptions.unsubscribe(),this.itemConnection?.unsubscribe(),this.itemConnection=null}connectDragToItem(){this.zone.runOutsideAngular((()=>{this.itemConnection?.unsubscribe(),this.itemConnection=this.drag.connectDragSource(this.paletteItemElement.nativeElement,{dropEffect:"copy"})}))}}function q(t,e,n,o,i,a,r){try{var s=t[a](r),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(o,i)}function A(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function r(t){q(a,o,i,r,s,"next",t)}function s(t){q(a,o,i,r,s,"throw",t)}r(void 0)}))}}function Q(t,e){if(1&t&&(d.Tg(0,"div",8),h._(1),d.qZ()),2&t){const t=u.o().$implicit;g.x(1),m.Oq(null==t.metadata.metaInfo?null:t.metadata.metaInfo.description)}}function z(t,e){if(1&t){const t=f.E();d.Tg(0,"div",4)(1,"div",5),_.N("itemDrop",(function(){b.CH(t);const e=u.o(2);return b.Kt(e.refreshPipe=!e.refreshPipe)})),y.AL(2,"toLayoutDragData"),d.Tg(3,"div",6),h._(4),d.qZ(),C.Y(5,Q,2,1,"div",7),d.qZ()()}if(2&t){const t=e.$implicit;let n;g.x(1),v.Q("dndCorePaletteItem",y.lc(2,3,t)),g.x(3),m.Oq(null!==(n=null==t.metadata.metaInfo?null:t.metadata.metaInfo.name)&&void 0!==n?n:t.itemSource.name),g.x(1),v.Q("ngIf",null==t.metadata.metaInfo?null:t.metadata.metaInfo.description)}}function R(t,e){if(1&t&&(x.yn(0),d.Tg(1,"div",2),h._(2),d.qZ(),C.Y(3,z,6,5,"div",3),x.BQ()),2&t){const t=e.$implicit;g.x(2),m.hi("",t.key," "),g.x(1),v.Q("ngForOf",t.value)}}Z.ɵfac=function(t){return new(t||Z)(D.Y(L.f),D.Y(E.SB),D.Y(Y.z),D.Y(N.E),D.Y(F.R))},Z.ɵdir=s.lG({type:Z,selectors:[["","dndCorePaletteItem",""]],inputs:{dragData:["dndCorePaletteItem","dragData"]},outputs:{itemDrop:"itemDrop"}});class j{constructor(t,e,n,o,i,r){this.moduleTypesLoader=t,this.changeDetector=e,this.packageManager=n,this.metadataExtractor=o,this._refreshObservables=i,this.logger=r,this.initSubscriptions=new a.w0,this.allItems=[],this.groupedItems={},this.refreshPipe=!1}ngOnInit(){var t=this;return A((function*(){if(t.initSubscriptions.add(t.packageManager.usedPackagesChange.subscribe((()=>t.initItems()))),t._refreshObservables&&Array.isArray(t._refreshObservables))for(const e of t._refreshObservables)t.initSubscriptions.add(e.subscribe((()=>t.initItems())));yield t.initItems()}))()}ngOnDestroy(){this.initSubscriptions.unsubscribe()}initItems(){var t=this;return A((function*(){var e;t.groupedItems={},t.allItems=[];for(const e of t.packageManager.usedPackages){const n=(yield t.moduleTypesLoader.loadItem({package:e,name:"types"}))?.data??[];for(const o of n){const n={package:e,name:o},i=yield t.metadataExtractor.extractMetadata(n);i?t.allItems.push({itemSource:n,metadata:i}):t.logger?.warn("ComponentsPaletteSAComponent: Failed to obtain layout editor metadata {@source}",n)}}t.groupedItems[""]=[];for(const n of t.allItems){const o=n.metadata.metaInfo?.group??"";(e=t.groupedItems)[o]??(e[o]=[]),t.groupedItems[o].push(n)}t.changeDetector.detectChanges()}))()}}j.ɵfac=function(t){return new(t||j)(D.Y(p.QT),D.Y(P.s),D.Y(M.L),D.Y(I.T),D.Y(p.dK,8),D.Y(i.bZ,8))},j.ɵcmp=s.Xp({type:j,selectors:[["components-palette"]],standalone:!0,features:[w.j],decls:3,vars:3,consts:[[1,"flex-column"],[4,"ngFor","ngForOf"],[1,"text-spread","text-small-caps","margin-left-extra-small","margin-horizontal-small","bold"],["class","palette-droplist",4,"ngFor","ngForOf"],[1,"palette-droplist"],[1,"editor-component","mat-elevation-z2",3,"dndCorePaletteItem","itemDrop"],[1,"editor-component-name"],["class","editor-component-description",4,"ngIf"],[1,"editor-component-description"]],template:function(t,e){1&t&&(d.Tg(0,"div",0),C.Y(1,R,4,2,"ng-container",1),y.AL(2,"keyvalue"),d.qZ()),2&t&&(g.x(1),v.Q("ngForOf",y.lc(2,1,e.groupedItems)))},dependencies:[o.e,O.s,k.O,S.N,l.N,Z,c],styles:[".editor-component[_ngcontent-%COMP%]\n{\n    margin: 2px 10px;\n    padding: 4px 8px;\n\n    border-radius: 6px;\n    border: 1px solid #F0F0F0;\n    background-color: #FAFAFA;\n}\n\n.editor-component-name[_ngcontent-%COMP%]\n{\n    font-weight: 500;\n}\n\n.editor-component-description[_ngcontent-%COMP%]\n{\n    margin-left: 4px;\n    margin-top: 2px;\n    font-size: .8em;\n}\n\n.palette-droplist[_ngcontent-%COMP%]   layout-editor-drag-placeholder[_ngcontent-%COMP%]\n{\n    display: none;\n}"],changeDetection:0})},50486:(t,e,n)=>{n.d(e,{D:()=>Q});var o=n(27052),i=n(63789),a=n(989),r=n(23199),s=n(30822),c=n(79440),p=n(13691),l=n(99055),d=n(83434);class h{constructor(t,e){this._cdkDropList=t,this._manager=e,this._initSubscriptions=new r.w0,this._connectDropListsPrefix=""}set connectDropListsPrefix(t){this._connectDropListsPrefix=t,this._setConnectedTo()}get connectDropListsPrefix(){return this._connectDropListsPrefix??""}ngOnInit(){this._initSubscriptions.add(this._manager.layoutChange.pipe((0,s.b)(12)).subscribe((()=>this._setConnectedTo()))),this._setConnectedTo()}ngOnDestroy(){this._initSubscriptions.unsubscribe()}_setConnectedTo(){const t=this._manager.flatTree.filter((t=>t.component.canDropFn())).map((t=>this.connectDropListsPrefix+t.component.id)).reverse().filter((t=>t!=this._cdkDropList.id));this._cdkDropList.connectedTo=t}}h.ɵfac=function(t){return new(t||h)(c.Y(l.W),c.Y(d.t))},h.ɵdir=p.lG({type:h,selectors:[["","cdkDropList","","connectDropLists",""]],inputs:{connectDropListsPrefix:"connectDropListsPrefix"},exportAs:["connectDropLists"],standalone:!0});var u=n(80827),g=n(6845),m=n(73301),f=n(94727),_=n(66794),b=n(15686),y=n(85320),C=n(68961),v=n(55436),x=n(72891),D=n(82568),P=n(41853),w=n(86357),M=n(6427),I=n(43649),O=n(12311),k=n(21651),S=n(41623),T=n(74419);function E(t,e){if(1&t&&u._U(0,"span",5),2&t){const t=g.o();m.Q("ngClass",t.open?"fa-chevron-down":"fa-chevron-right")}}const F=function(t,e){return{metadata:t,parentId:e}};function L(t,e){if(1&t&&(u.Tg(0,"div",8),u._U(1,"components-tree-item",9),u.qZ()),2&t){const t=e.$implicit;m.Q("cdkDragData",f.WL(3,F,null==t.component.options?null:t.component.options.typeMetadata,null==t.parent||null==t.parent.component?null:t.parent.component.id))("cdkDragDisabled",t.component.dragDisabled),_.x(1),m.Q("data",t)}}function Y(t,e){if(1&t&&(u.Tg(0,"div",6),b.Y(1,L,2,6,"div",7),u.qZ()),2&t){const t=g.o();y.ek("hidden",!t.open),m.Q("cdkDropListEnterPredicate",t._canDrop)("id","component-tree-"+(null==t.data||null==t.data.component||null==t.data.component.options||null==t.data.component.options.typeMetadata?null:t.data.component.options.typeMetadata.id)),_.x(1),m.Q("ngForOf",null==t.data?null:t.data.children)}}class N{constructor(t,e){this._manager=t,this._changeDetector=e,this._initSubscriptions=new r.w0,this.open=!0,this._canDrop=()=>this.data?.component?.canDropFn()??!1}get hasChildren(){return!!this.data?.children&&this.data?.children.length>0}ngOnInit(){this._initSubscriptions.add(this._manager.layoutChange.subscribe((()=>{this._changeDetector.detectChanges()}))),this._initSubscriptions.add(this._manager.selectedChange.subscribe((()=>{this._changeDetector.detectChanges()}))),this._initSubscriptions.add(this._manager.highlightedChange.subscribe((()=>this._changeDetector.detectChanges()))),this._initSubscriptions.add(this._manager.displayNameChange.subscribe((()=>this._changeDetector.detectChanges())))}ngOnDestroy(){this._initSubscriptions.unsubscribe()}toggle(){this.open=!this.open}expand(t){if(!t)return this.open=!0,!0;if(this.data?.component?.options?.typeMetadata?.id===t)return!0;if(this.hasChildren)for(const e of this._childrenNodes?.toArray())if(e.expand(t))return this.expand(),!0;return!1}expandAll(){this._childrenNodes?.forEach((t=>t.expandAll())),this.expand(),this._changeDetector.detectChanges()}collapse(){this.open=!1}collapseAll(){this._childrenNodes?.forEach((t=>t.collapseAll())),this.collapse(),this._changeDetector.detectChanges()}highlight(t,e){t.preventDefault(),t.stopPropagation(),this._manager.highlightComponent(e)}_cancelHighlight(t){t.preventDefault(),t.stopPropagation(),this._manager.cancelHighlightedComponent()}}N.ɵfac=function(t){return new(t||N)(c.Y(d.t),c.Y(C.s))},N.ɵcmp=p.Xp({type:N,selectors:[["components-tree-item"]],viewQuery:function(t,e){if(1&t&&v.Gf(N,5),2&t){let t;v.iG(t=v.CR())&&(e._childrenNodes=t)}},hostBindings:function(t,e){1&t&&x.N("mouseleave",(function(t){return e._cancelHighlight(t)}))},inputs:{data:"data",open:"open"},exportAs:["componentsTreeItem"],standalone:!0,features:[D.j],decls:6,vars:10,consts:[[1,"flex","align-items-center",3,"ngClass"],["type","button","mat-icon-button","",3,"disabled","click"],["class","fa",3,"ngClass",4,"ngIf"],[3,"mouseover","click"],["class","node-children","cdkDropList","","connectDropLists","","connectDropListsPrefix","component-tree-",3,"cdkDropListEnterPredicate","id","hidden",4,"ngIf"],[1,"fa",3,"ngClass"],["cdkDropList","","connectDropLists","","connectDropListsPrefix","component-tree-",1,"node-children",3,"cdkDropListEnterPredicate","id"],["cdkDrag","","class","node-child",3,"cdkDragData","cdkDragDisabled",4,"ngFor","ngForOf"],["cdkDrag","",1,"node-child",3,"cdkDragData","cdkDragDisabled"],[3,"data"]],template:function(t,e){1&t&&(u.Tg(0,"div",0)(1,"button",1),x.N("click",(function(){return e.toggle()})),b.Y(2,E,1,1,"span",2),u.qZ(),u.Tg(3,"div",3),x.N("mouseover",(function(t){return e.highlight(t,null==e.data||null==e.data.component||null==e.data.component.options||null==e.data.component.options.typeMetadata?null:e.data.component.options.typeMetadata.id)}))("click",(function(){return e._manager.selectComponent(null==e.data||null==e.data.component||null==e.data.component.options||null==e.data.component.options.typeMetadata?null:e.data.component.options.typeMetadata.id)})),P._(4),u.qZ()(),b.Y(5,Y,2,5,"div",4)),2&t&&(m.Q("ngClass",e.hasChildren?"nested-node-tree":"node-tree"),_.x(1),m.Q("disabled",!e.hasChildren),w.u("aria-label","Toggle"),_.x(1),m.Q("ngIf",e.hasChildren),_.x(1),y.ek("selected",(null==e.data||null==e.data.component||null==e.data.component.options||null==e.data.component.options.typeMetadata?null:e.data.component.options.typeMetadata.id)===e._manager.selectedComponent)("highlighted",(null==e.data||null==e.data.component||null==e.data.component.options||null==e.data.component.options.typeMetadata?null:e.data.component.options.typeMetadata.id)===e._manager.highlightedComponent),_.x(1),M.Oq((null==e.data||null==e.data.component||null==e.data.component.options||null==e.data.component.options.typeMetadata?null:e.data.component.options.typeMetadata.displayName)||(null==e.data||null==e.data.component||null==e.data.component.options||null==e.data.component.options.typeMetadata?null:e.data.component.options.typeMetadata.id)),_.x(1),m.Q("ngIf",e.hasChildren||e._canDrop()))},dependencies:[N,o.e,I.m,O.s,k.O,i.o,S.l,a._,l.W,T.Z,h],styles:["[_nghost-%COMP%]\n{\n    display: block;\n}\n\n.highlighted[_ngcontent-%COMP%]\n{\n    text-shadow: 0 0 2px #666;\n}\n\n.selected[_ngcontent-%COMP%]\n{\n    text-shadow: 0 0 2px #009cd7;\n}\n\n.node-tree[_ngcontent-%COMP%], .nested-node-tree[_ngcontent-%COMP%]\n{\n    min-height: 48px;\n}\n\n.node-children[_ngcontent-%COMP%] \n{\n  padding-left: 40px;\n  min-height: 10px;\n}"],changeDetection:0});var Z=n(84773),q=n(43870);function A(t,e){if(1&t){const t=Z.E();u.Tg(0,"div",1)(1,"button",2),x.N("click",(function(){q.CH(t);const e=g.o();return q.Kt(null==e.rootTreeItem?null:e.rootTreeItem.collapseAll())})),u._U(2,"span",3),u.qZ(),u.Tg(3,"button",4),x.N("click",(function(){q.CH(t);const e=g.o();return q.Kt(null==e.rootTreeItem?null:e.rootTreeItem.expandAll())})),u._U(4,"span",5),u.qZ(),u._U(5,"components-tree-item",6),u.qZ()}if(2&t){const t=g.o();_.x(5),m.Q("data",t.root)}}class Q{constructor(t,e){this._manager=t,this._changeDetector=e,this._initSubscriptions=new r.w0}ngOnInit(){this._initSubscriptions.add(this._manager.layoutChange.subscribe((()=>{this.root=this._manager.root,this._changeDetector.detectChanges()}))),this._initSubscriptions.add(this._manager.selectedChange.subscribe((()=>{this.rootTreeItem?.expand(this._manager.selectedComponent),this._changeDetector.detectChanges()}))),this._initSubscriptions.add(this._manager.highlightedChange.subscribe((()=>this._changeDetector.detectChanges()))),this._initSubscriptions.add(this._manager.displayNameChange.subscribe((()=>this._changeDetector.detectChanges()))),this.root=this._manager.root}ngOnDestroy(){this._initSubscriptions.unsubscribe()}hasChild(t){return!!t.children&&t.children.length>0}}Q.ɵfac=function(t){return new(t||Q)(c.Y(d.t),c.Y(C.s))},Q.ɵcmp=p.Xp({type:Q,selectors:[["components-tree"]],viewQuery:function(t,e){if(1&t&&v.Gf(N,5),2&t){let t;v.iG(t=v.CR())&&(e.rootTreeItem=t.first)}},standalone:!0,features:[D.j],decls:1,vars:1,consts:[["class","component-tree",4,"ngIf"],[1,"component-tree"],["type","button","mat-icon-button","","aria-label","Collapse all",3,"click"],[1,"fa","fa-minus-square"],["type","button","mat-icon-button","","aria-label","Expand all",3,"click"],[1,"fa","fa-plus-square"],[3,"data"]],template:function(t,e){1&t&&b.Y(0,A,6,1,"div",0),2&t&&m.Q("ngIf",e.root)},dependencies:[o.e,k.O,i.o,S.l,a._,N],styles:["[_nghost-%COMP%]\n{\n    display: block;\n    background-color: #fafafa;\n    border-right: 1px solid #ccc;\n}"],changeDetection:0})},5574:(t,e,n)=>{n.d(e,{M:()=>pt});var o=n(2032),i=n(27052),a=n(70625),r=n(68624),s=n(46480),c=n(71791),p=n(14389),l=n(43939),d=n(57466),h=n(45069),u=n(23199),g=n(39163),m=n(5348),f=n(77880),_=n(59951),b=n(13691),y=n(38327);class C{}C.ɵfac=function(t){return new(t||C)},C.ɵmod=b.oA({type:C}),C.ɵinj=y.cJ({imports:[i.e,g.z,_.i,f.j,m.A]});var v=n(71785),x=n(74445),D=n(48936),P=n(27049),w=n(79440),M=n(88364),I=n(72891);class O{constructor(t,e){this.document=t,this.ngZone=e,this.lastXCoordinate=null,this.size=new x.v}dragStart(t){this.ngZone.runOutsideAngular((()=>{this.document.addEventListener("mousemove",this.drag),this.document.addEventListener("mouseup",this.dragEnd)})),t.stopImmediatePropagation(),t.preventDefault(),this.lastXCoordinate=t.clientX}drag(t){(0,l.fp)(this.lastXCoordinate)||(this.size.emit(t.clientX-this.lastXCoordinate),t.stopImmediatePropagation(),t.preventDefault(),this.lastXCoordinate=t.clientX)}dragEnd(t){this.ngZone.runOutsideAngular((()=>{this.document.removeEventListener("mousemove",this.drag),this.document.removeEventListener("mouseup",this.dragEnd)})),t.stopImmediatePropagation(),t.preventDefault(),this.lastXCoordinate=null}}O.ɵfac=function(t){return new(t||O)(w.Y(D.K),w.Y(M.R))},O.ɵdir=b.lG({type:O,selectors:[["","widthResizer",""]],hostBindings:function(t,e){1&t&&I.N("mousedown",(function(t){return e.dragStart(t)}))},outputs:{size:"size"},standalone:!0}),(0,o.gn)([P.r,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[MouseEvent]),(0,o.w6)("design:returntype",void 0)],O.prototype,"drag",null),(0,o.gn)([P.r,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[MouseEvent]),(0,o.w6)("design:returntype",void 0)],O.prototype,"dragEnd",null);var k=n(84773),S=n(80827),T=n(43870),E=n(6845),F=n(41853),L=n(4477),Y=n(66794),N=n(73301),Z=n(15686),q=n(6427),A=n(85320),Q=n(68961),z=n(73379),R=n(82568),j=n(83434),X=n(85902),U=n(43671),$=n(12311),B=n(21651),H=n(49280),G=n(77470),K=n(27635),J=n(15783),V=n(36973);function W(t,e,n,o,i,a,r){try{var s=t[a](r),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(o,i)}class tt{constructor(t,e){this._viewContainerRef=t,this._logger=e,this._componentRef=null,this.propertiesMetadata=null}ngOnChanges(){var t,e=this;return(t=function*(){if(e._logger?.debug("PropertiesControlRendererDirective: rendering properties control {@type}",{type:e.type?.name}),e.ngOnDestroy(),e._viewContainerRef.clear(),e.type){const t=e._viewContainerRef.injector;if(e._componentRef=e._viewContainerRef.createComponent(e.type,{injector:t}),e._componentRef){const t=e._componentRef.instance;t.propertiesMetadata=e.propertiesMetadata,t.form=e.form,yield t.initialize(),t.invalidateVisuals()}}},function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function r(t){W(a,o,i,r,s,"next",t)}function s(t){W(a,o,i,r,s,"throw",t)}r(void 0)}))})()}ngOnDestroy(){this._componentRef&&(this._logger?.debug("PropertiesControlRendererDirective: destroying properties control {@type}",{type:this.type?.name}),this._componentRef?.destroy(),this._componentRef=null)}}function et(t,e,n,o,i,a,r){try{var s=t[a](r),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(o,i)}function nt(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function r(t){et(a,o,i,r,s,"next",t)}function s(t){et(a,o,i,r,s,"throw",t)}r(void 0)}))}}function ot(t,e){if(1&t){const t=k.E();S.Tg(0,"div",2)(1,"button",3),I.N("click",(function(){T.CH(t);const e=E.o();return T.Kt(e.toggleCollapsed())})),S.Tg(2,"span",4),F._(3,"properties"),S.qZ()()()}}function it(t,e){if(1&t&&(L.yn(0),L.Gk(1,18),L.BQ()),2&t){const t=e.$implicit,n=E.o().$implicit;Y.x(1),N.Q("propertiesControl",t)("form",n.form)("propertiesMetadata",n.metadata)}}function at(t,e){if(1&t&&(L.yn(0),Z.Y(1,it,2,3,"ng-container",17),L.BQ()),2&t){const t=e.$implicit;Y.x(1),N.Q("ngForOf",t.controls)}}function rt(t,e){if(1&t&&(L.yn(0),S.Tg(1,"div",11)(2,"div",12)(3,"label",13),F._(4,"type"),S.qZ(),S.Tg(5,"div",14),F._(6),S.qZ(),S.Tg(7,"label",13),F._(8,"id"),S.qZ(),S.Tg(9,"div",14),F._(10),S.qZ(),S.Tg(11,"label",13),F._(12,"display name"),S.qZ(),S._U(13,"input",15),S.qZ()(),S.Tg(14,"div",16),Z.Y(15,at,2,1,"ng-container",17),S.qZ(),L.BQ()),2&t){const t=E.o(2);let e;Y.x(6),q.Oq(null!==(e=null==t.metadata||null==t.metadata.metaInfo?null:t.metadata.metaInfo.name)&&void 0!==e?e:null==t.component.options||null==t.component.options.typeMetadata?null:t.component.options.typeMetadata.name),Y.x(4),q.Oq(null==t.component.options||null==t.component.options.typeMetadata?null:t.component.options.typeMetadata.id),Y.x(3),N.Q("formControl",t.displayName),Y.x(2),N.Q("ngForOf",t.propertiesData)}}function st(t,e){if(1&t){const t=k.E();L.yn(0),S.Tg(1,"div",5)(2,"div",6)(3,"div",7),F._(4,"properties"),S.qZ(),S.Tg(5,"button",8),I.N("click",(function(){T.CH(t);const e=E.o();return T.Kt(e.toggleCollapsed())})),S._U(6,"span",9),S.qZ()(),Z.Y(7,rt,16,4,"ng-container",1),S.qZ(),S.Tg(8,"div",10),I.N("size",(function(e){T.CH(t);const n=E.o();return T.Kt(n.updateSize(e))})),S.qZ(),L.BQ()}if(2&t){const t=E.o();Y.x(1),A.Ud("width",t.state.width,"px"),Y.x(6),N.Q("ngIf",t.component)}}tt.ɵfac=function(t){return new(t||tt)(w.Y(J.s_),w.Y(s.bZ,8))},tt.ɵdir=b.lG({type:tt,selectors:[["","propertiesControl",""]],inputs:{form:"form",propertiesMetadata:"propertiesMetadata",type:["propertiesControl","type"]},features:[V.T]});const ct="PROPERTIES_EDITOR_STATE";class pt{constructor(t,e,n,o,i,r,s,c){this.manager=t,this.metadataExtractor=e,this.propertyExtractor=n,this.formModelBuilder=o,this.changeDetector=i,this.storage=r,this.history=s,this.logger=c,this.initSubscriptions=new u.w0,this.optionsFormSubscription=null,this.syncPromise=Promise.resolve(),this.lastComponentId=null,this.lastComponent=null,this.component=null,this.metadata=null,this.displayName=new a.NI(null),this.propertiesData=[],this.state={opened:!1,width:350}}ngOnInit(){var t=this;return nt((function*(){const e=t.storage.get(ct);e&&(t.state=e),t.initSubscriptions.add(t.manager.layoutChange.subscribe((()=>t.initProperties()))),t.initSubscriptions.add(t.manager.selectedChange.subscribe((()=>t.initProperties()))),t.displayName.valueChanges.subscribe(function(){var e=nt((function*(e){if(t.component?.options?.typeMetadata&&(0,l.EN)(e)){t.component.options.typeMetadata.displayName=e;const n={};(0,p.mv)(n,"options",t.component.options,t.component.options),t.component.options=t.component.options,yield t.component.ngOnChanges?.(n),t.manager.displayNameUpdated(),t.history.getNewState()}}));return function(t){return e.apply(this,arguments)}}()),yield t.initProperties()}))()}ngOnDestroy(){this.initSubscriptions.unsubscribe(),this.optionsFormSubscription?.unsubscribe(),this.optionsFormSubscription=null}toggleCollapsed(){this.state.opened=!this.state.opened,this.storage.set(ct,this.state)}updateSize(t){this.state.width-=t,this.storage.set(ct,this.state),this.changeDetector.detectChanges()}initProperties(){var t=this;return nt((function*(){let e;if(yield t.syncPromise,t.syncPromise=new Promise((t=>e=t)),(0,l.EN)(t.manager.selectedComponent)){const n=t.manager.getComponent(t.manager.selectedComponent);if(t.lastComponent==n&&t.lastComponentId==t.manager.selectedComponent)return void e?.();t.lastComponent=n,t.lastComponentId=t.manager.selectedComponent,n?(t.component=n,yield t.getMetadata()):t.hide()}else t.hide();e?.()}))()}getMetadata(){var t=this;return nt((function*(){if(t.optionsFormSubscription?.unsubscribe(),t.optionsFormSubscription=new u.w0,t.propertiesData=[],t.component?.options?.typeMetadata){if(t.displayName.setValue(t.component.options.typeMetadata.displayName||t.component.options.typeMetadata.id,{emitEvent:!1}),t.metadata=yield t.metadataExtractor.extractMetadata(t.component.options?.typeMetadata),t.metadata||(t.logger?.error("PropertiesEditorSAComponent: unable to get metadata {@source}",{package:t.component.options?.typeMetadata.package,name:t.component.options?.typeMetadata.name}),t.hide()),t.metadata?.metaInfo?.optionsMetadata?.propertiesMetadata?.length)for(const e of t.metadata?.metaInfo?.optionsMetadata?.propertiesMetadata)t.initDynamicProperty(e);if(t.component){const e=t.manager.getParent(t.component.id);if(e?.options?.typeMetadata){const n=yield t.metadataExtractor.extractMetadata(e.options?.typeMetadata);if(n?.metaInfo?.optionsMetadata?.childPropertiesMetadata?.length)for(const e of n?.metaInfo?.optionsMetadata?.childPropertiesMetadata)t.initDynamicProperty(e)}}}else t.hide();t.changeDetector.detectChanges()}))()}hide(){this.lastComponent=null,this.lastComponentId=null,this.component=null,this.metadata=null,this.propertiesData=[],this.optionsFormSubscription?.unsubscribe(),this.optionsFormSubscription=null,this.changeDetector.detectChanges()}initDynamicProperty(t){var e=this;const n=this.formModelBuilder.build(new t.modelType(this.component?.options?.typeMetadata.options)),o=this.propertyExtractor.extract(t.modelType);this.optionsFormSubscription&&(this.optionsFormSubscription.add(n.valueChanges.subscribe(function(){var t=nt((function*(t){if(e.component?.options?.typeMetadata){(0,d.l7)(!0,e.component.options.typeMetadata.options,t);const n={};(0,p.mv)(n,"options",e.component.options,e.component.options),e.component.options=e.component.options,yield e.component.ngOnChanges?.(n),e.component.invalidateVisuals(),e.history.getNewState()}}));return function(e){return t.apply(this,arguments)}}())),this.propertiesData.push({form:n,metadata:o,controls:t.propertiesControls}))}}pt.ɵfac=function(t){return new(t||pt)(w.Y(j.t),w.Y(X.T),w.Y(U.L),w.Y(c.p),w.Y(Q.s),w.Y(s.T0),w.Y(v.dB),w.Y(s.bZ,8))},pt.ɵcmp=b.Xp({type:pt,selectors:[["properties-editor"]],standalone:!0,features:[z._([c.p]),R.j],decls:2,vars:2,consts:[["class","properties-toolbar",4,"ngIf"],[4,"ngIf"],[1,"properties-toolbar"],["type","button",1,"btn-icon","props-buttons",3,"click"],[1,"text-vertical"],[1,"properties-main"],[1,"header"],[1,"header-title"],["type","button",1,"btn-icon",3,"click"],[1,"fas","fa-times"],["widthResizer","",1,"properties-resizer",3,"size"],[1,"static-properties"],[1,"properties-form-group"],[1,"properties-control-label"],[1,"properties-form-static"],["type","text",1,"properties-form-control",3,"formControl"],[1,"thin-scrollbar","properties-controls"],[4,"ngFor","ngForOf"],[3,"propertiesControl","form","propertiesMetadata"]],template:function(t,e){1&t&&(Z.Y(0,ot,4,0,"div",0),Z.Y(1,st,9,3,"ng-container",1)),2&t&&(N.Q("ngIf",!e.state.opened),Y.x(1),N.Q("ngIf",e.state.opened))},dependencies:[i.e,$.s,B.O,r.U,H.Fj,G.JJ,K.oH,C,tt,O],styles:["[_nghost-%COMP%]\n{\n    display: grid;\n    grid-template-columns: 2px 2px auto;\n    grid-template-rows: auto;\n    position: relative;\n}\n\n.props-buttons[_ngcontent-%COMP%]\n{\n    width: 16px;\n}\n\n.properties-main[_ngcontent-%COMP%]\n{\n    display: flex;\n    flex-direction: column;\n    flex: 1;\n    min-height: 0;\n    border: 1px solid #bbb;\n    background-color: #F5F5F5;\n    grid-row: 1 / 2;\n    grid-column: 2 / 4;\n}\n\n.properties-resizer[_ngcontent-%COMP%]\n{\n    grid-row: 1 / 2;\n    grid-column: 1 / 3;\n    cursor: ew-resize;\n}\n\n.properties-resizer[_ngcontent-%COMP%]:hover\n{\n    transition: background-color 400ms 300ms;\n    background-color: #00a2ddc0;\n}\n\n.header[_ngcontent-%COMP%]\n{\n    display: flex;\n    flex-direction: row;\n    padding: 2px 8px;\n    background-color: #bbb;\n}\n\n.header-title[_ngcontent-%COMP%]\n{\n    flex: 1;\n    min-width: 0;\n    min-height: 0;\n}\n\n.header-title[_ngcontent-%COMP%]::first-letter\n{\n    text-transform: uppercase;\n    line-height: 0em;\n}\n\n.static-properties[_ngcontent-%COMP%]\n{\n    padding: 4px 10px;\n}\n\n.properties-controls[_ngcontent-%COMP%]\n{\n    padding: 4px 3px 4px 10px;\n}\n\n.properties-controls[_ngcontent-%COMP%]\n{\n    overflow-y: scroll;\n    overflow-x: hidden;\n}\n\n.properties-toolbar[_ngcontent-%COMP%]\n{\n    background-color: #ddd;\n    padding: 6px 4px;\n    transform: translateX(calc(-1em - 4px));\n    position: absolute;\n}\n\n.properties-toolbar[_ngcontent-%COMP%] > button[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]\n{\n    font-weight: 600;\n}"],changeDetection:0}),(0,o.gn)([(0,h.C)(10),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[]),(0,o.w6)("design:returntype",Promise)],pt.prototype,"initProperties",null)},10219:(t,e,n)=>{n.d(e,{N:()=>a});var o=n(13691),i=n(38327);class a{}a.ɵfac=function(t){return new(t||a)},a.ɵmod=o.oA({type:a}),a.ɵinj=i.cJ({})},52053:(t,e,n)=>{n.d(e,{E:()=>a});var o=n(86463),i=n(38327);class a{constructor(){this.dropDataChangeSubject=new o.x,this.dropPlaceholderPreview=null,this.newDropPlaceholderPreviewSubject=new o.x,this.oldDropPlaceholderPreviewSubject=new o.x}get dropDataChange(){return this.dropDataChangeSubject.asObservable()}get newDropPlaceholderPreviewChange(){return this.newDropPlaceholderPreviewSubject.asObservable()}get oldDropPlaceholderPreviewChange(){return this.oldDropPlaceholderPreviewSubject.asObservable()}get dropPlaceholderPreviewIndex(){return this.dropPlaceholderPreview?.index??null}setDropData(t){this.dropDataChangeSubject.next(t)}setDropPlaceholderPreview(t){t?.index===this.dropPlaceholderPreview?.index&&t?.parentId===this.dropPlaceholderPreview?.parentId||(this.dropPlaceholderPreview&&this.oldDropPlaceholderPreviewSubject.next(this.dropPlaceholderPreview),this.dropPlaceholderPreview=t,this.dropPlaceholderPreview&&this.newDropPlaceholderPreviewSubject.next(this.dropPlaceholderPreview))}}a.ɵfac=function(t){return new(t||a)},a.ɵprov=i.Yz({token:a,factory:a.ɵfac})},59951:(t,e,n)=>{n.d(e,{i:()=>p});var o=n(27052),i=n(68624),a=n(5348),r=n(25626),s=n(13691),c=n(38327);class p{}p.ɵfac=function(t){return new(t||p)},p.ɵmod=s.oA({type:p}),p.ɵinj=c.cJ({imports:[o.e,i.U,a.A,r.F]})},98906:(t,e,n)=>{n.d(e,{z:()=>a});var o=n(86463),i=n(38327);class a{constructor(){this._dragging=!1,this._draggingChange=new o.x}get dragging(){return this._dragging}get draggingChange(){return this._draggingChange.asObservable()}setDragging(t){this._dragging!=t&&(this._dragging=t,this._draggingChange.next())}}a.ɵfac=function(t){return new(t||a)},a.ɵprov=i.Yz({token:a,factory:a.ɵfac})},85902:(t,e,n)=>{n.d(e,{T:()=>c});var o=n(8477),i=n(46480),a=n(11776),r=n(38327);function s(t,e,n,o,i,a,r){try{var s=t[a](r),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(o,i)}class c{constructor(t,e){this._loader=t,this._logger=e,this._cache={}}extractMetadata(t){var e,n=this;return(e=function*(){const e=`${t.package}-${t.name}`;if(n._cache[e])return n._cache[e];const o=yield n._loader.loadItem(t);if(!o)return null;const i=o.data;if(!i.layoutEditorMetadata)return n._logger?.warn("LayoutEditorMetadataExtractor: Missing metadata! ",{package:t.package,name:t.name}),null;n._logger?.debug("LayoutEditorMetadataExtractor: Reading metadata! ",{package:t.package,name:t.name});const a=yield i.layoutEditorMetadata;return Object.freeze(a),n._cache[e]=a,a},function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function r(t){s(a,o,i,r,c,"next",t)}function c(t){s(a,o,i,r,c,"throw",t)}r(void 0)}))})()}}c.ɵfac=function(t){return new(t||c)(a.LF(o.Vl),a.LF(i.bZ,8))},c.ɵprov=r.Yz({token:c,factory:c.ɵfac})},83434:(t,e,n)=>{n.d(e,{t:()=>c});var o=n(46480),i=n(43939),a=n(86463),r=n(11776),s=n(38327);class c{constructor(t){this._logger=t,this._components={},this._rootComponentId=null,this._selectedComponent=null,this._highlightedComponent=null,this._layoutChange=new a.x,this._selectedChange=new a.x,this._highlightedChange=new a.x,this._displayNameChanges=new a.x,this._flatTree=null}get selectedComponent(){return this._selectedComponent}get highlightedComponent(){return this._highlightedComponent}get root(){return(0,i.fp)(this._rootComponentId)?null:this._components[this._rootComponentId]}get layoutChange(){return this._layoutChange.asObservable()}get selectedChange(){return this._selectedChange.asObservable()}get highlightedChange(){return this._highlightedChange.asObservable()}get displayNameChange(){return this._displayNameChanges.asObservable()}get flatTree(){return this._flatTree??(this._flatTree=this._buildFlatTree())}selectComponent(t){this._selectedComponent=t??null,this._selectedChange.next()}unselectComponent(){this._selectedComponent=null,this._selectedChange.next()}highlightComponent(t){this._highlightedComponent=t??null,this._highlightedChange.next()}cancelHighlightedComponent(){this._highlightedComponent=null,this._highlightedChange.next()}registerLayoutDesignerComponent(t,e,n){if((0,i.fp)(n)&&(this._rootComponentId=e),this._components[e])return this._logger?.error(`LayoutEditorMetadataManager: Component with id ${e} is already registered!`),!1;const o=n?this._components[n]:null,a={component:t,parent:o,children:[]};return this._components[e]=a,o&&o.children.push(a),this._flatTree=null,this._layoutChange.next(),this._logger?.debug("LayoutEditorMetadataManager: Registering component {@id}",e),!0}getComponent(t){return this._components[t]?.component??null}getParent(t){return this._components[t]?.parent?.component??null}getIndex(t){const e=this._components[t];return e&&e.parent?e.parent.children.indexOf(e):null}getComponentDef(t){return this._components[t]??null}unregisterLayoutDesignerComponent(t){const e=this._components[t];if(delete this._components[t],e?.parent){const t=e.parent.children.indexOf(e);e.parent.children.splice(t,1)}t===this._rootComponentId&&(this._rootComponentId=null),this._flatTree=null,this._layoutChange.next(),this._logger?.debug("LayoutEditorMetadataManager: Unregistering component {@id}",t)}displayNameUpdated(){this._displayNameChanges.next()}getMetadata(){return(0,i.fp)(this._rootComponentId)||!this._components[this._rootComponentId]?null:this._components[this._rootComponentId].component.options?.typeMetadata??null}_buildFlatTree(){if((0,i.fp)(this._rootComponentId))return[];const t=this._components[this._rootComponentId];return t?this._buildFlatTreeForComponent(t):[]}_buildFlatTreeForComponent(t){let e=[t];for(const n of t.children)e=e.concat(this._buildFlatTreeForComponent(n));return e}}c.ɵfac=function(t){return new(t||c)(r.LF(o.bZ,8))},c.ɵprov=s.Yz({token:c,factory:c.ɵfac})},43671:(t,e,n)=>{n.d(e,{L:()=>c});var o=n(46480),i=n(57466),a=n(71785),r=n(11776),s=n(38327);class c{constructor(t,e){this._layoutPropertiesSymbols=t,this._logger=e}extract(t){if(!t)return null;this._logger?.debug(`LayoutEditorPropertyMetadataExtractor: Trying to extract properties metadata '${t.name}'`);const e={};for(const n of this._layoutPropertiesSymbols){const o=Reflect.get(t.prototype,n);(0,i.l7)(!0,e,o)}return e}}c.ɵfac=function(t){return new(t||c)(r.LF(a.RI),r.LF(o.bZ,8))},c.ɵprov=s.Yz({token:c,factory:c.ɵfac})}}]);
//# sourceMappingURL=5842.chunk.d61dfd6ca0e24caf1e41.js.map