{"version":3,"file":"789.chunk.e354dc20a679a2ae8b2b.js","mappings":"qSAUA,IAAaA,EAAb,MAaIC,YAAYC,GAHL,KAAAC,KAA8B,KAMjCC,EAAAA,GAAAA,KAAqBC,KAArBD,CAA2BF,MAN/BI,EAAAA,EAAAA,IAAAA,EAHCC,EAAAA,EAAAA,GAAmB,SACnBC,EAAAA,EAAAA,GAA0B,uCAC1BC,EAAAA,EAAAA,GAA8C,gBAC/C,0DAVST,GAAc,UAD1BU,EAAAA,EAAAA,GAAmBC,EAAAA,EAAuB,CAACC,EAAAA,EAAwBC,EAAAA,KACzC,uCAAdb,GCFP,MAAOc,EAgCTb,cAzBO,KAAAc,SACP,CACIC,KAAM,aACNC,YAAa,gBACbC,gBACA,CACIC,mBACA,CACI,CACIC,UAAWpB,EACXqB,mBACA,CACIC,EAAAA,GACAC,EAAAA,EAAAA,GAA4B,CAAC,aAK7CC,eACA,CACIrB,KAAM,sBAOVsB,OAAOC,OAAOrB,S,gOC9BhB,MAAOsB,EAUT1B,YAA6D2B,EACCC,EACIC,EAChBC,GAHW,KAAAH,WAAAA,EACC,KAAAC,YAAAA,EACI,KAAAC,sBAAAA,EAChB,KAAAC,QAAAA,EANxC,KAAAC,oBAAgE,GASlEC,MAAMC,QAAQ7B,KAAKuB,cAEnBvB,KAAK0B,SAASI,MAAM,yCAEpB9B,KAAKuB,WAAa,IAIlBK,MAAMC,QAAQ7B,KAAKwB,eAEnBxB,KAAK0B,SAASI,MAAM,0CAEpB9B,KAAKwB,YAAc,IAInBI,MAAMC,QAAQ7B,KAAKyB,yBAEnBzB,KAAK0B,SAASI,MAAM,qDAEpB9B,KAAKyB,sBAAwB,IAUxBM,SAA0CC,GAAyB,I,EAAA,c,EAAA,YAE5E,IAAIC,EAAoC,KACxC,MAAMC,EAAU,GAAGF,EAAOG,WAAWH,EAAOrB,OAG5C,GAAG,EAAKgB,oBAAoBO,GAIxB,OAFA,EAAKR,SAASU,QAAQ,kDAAmD,CAACzB,KAAMqB,EAAOrB,KAAMwB,QAASH,EAAOG,UAEtG,EAAKR,oBAAoBO,GAIpC,IAAI,MAAMG,KAAY,EAAKd,WAC3B,CACI,MAAMe,EAAqBD,EAASE,SAASP,GAW7C,GAPIC,EAFDK,QAEuBE,EAAAA,EAAAA,GAAiBF,GAIvB,KAGjBL,EAEC,MAKR,IAAIA,EAIA,OAFA,EAAKP,SAASe,MAAM,4DAA6D,CAAC9B,KAAMqB,EAAOrB,KAAMwB,QAASH,EAAOG,UAE9G,KAGX,IAAIO,EAAsC,KAG1C,IAAI,MAAMC,KAAa,EAAKnB,YAC5B,CACI,MAAMoB,EAAkBD,EAAUE,aAAaZ,GAE/C,GAAGW,IAAmBE,EAAAA,EAAAA,IAAOF,GAC7B,CACI,EAAKjB,oBAAoBO,GAAWQ,EACpC,CACIK,KAAMH,GAGV,OAIR,IAAIF,EAIA,OAFA,EAAKhB,SAASe,MAAM,8DAA+D,CAAC9B,KAAMqB,EAAOrB,KAAMwB,QAASH,EAAOG,UAEhH,KAIX,IAAI,MAAMQ,KAAa,EAAKlB,sBAC5B,CACI,MAAMuB,EAAaL,EAAUE,aAAaZ,GAE1C,GAAGe,EACH,CACIN,EAAOM,WAAaA,EAAWA,WAC/BN,EAAOO,gBAAkBD,EAAWC,gBAEpC,OAIR,OAAOP,G,mNA9HFpB,GAAiB4B,EAAAA,GAUNC,EAAAA,IAA6BD,EAAAA,GAC7BE,EAAAA,IAA8BF,EAAAA,GAC9BG,EAAAA,IAAkCH,EAAAA,GAClCI,EAAAA,GAAM,K,oBAbjBhC,EAAiBiC,QAAjBjC,EAAiB,KAAAkC,WADL,U,4UCLlB,SAAehB,EAAtB,kC,yBAAO,UAAyC3C,GAE5C,OAAGA,aAAiB4D,cAEH5D,EAGVA,M","sources":["webpack://ng-universal-demo/../basic-components/src/textBlock/metadata/textBlock.model.ts","webpack://ng-universal-demo/../basic-components/src/textBlock/metadata/textBlock.layoutMetadata.ts","webpack://ng-universal-demo/../src/services/dynamicItemLoader/dynamicItemLoader.service.ts","webpack://ng-universal-demo/../../../src/utils/async.ts"],"sourcesContent":["import {ComponentStylingModel, DefaultKnownPropertyTypes, FORM_MODEL_CONTROLS_METADATA_PROPERTY, LayoutPropertyDescription, LayoutPropertyMetadata, LayoutPropertyName, LayoutPropertyType} from '@anglr/dynamic/layout-editor';\nimport {MetadataClassMixin} from '@anglr/dynamic';\nimport {mapValuesToThis} from '@jscrpt/common';\n\nimport {TextBlockComponentOptions} from '../textBlock.options';\n\n/**\n * Text block model for properties editor\n */\n@MetadataClassMixin(ComponentStylingModel, [LayoutPropertyMetadata, FORM_MODEL_CONTROLS_METADATA_PROPERTY])\nexport class TextBlockModel implements TextBlockComponentOptions\n{\n    //######################### public properties #########################\n\n    /**\n     * @inheritdoc\n     */\n    @LayoutPropertyName('Text')\n    @LayoutPropertyDescription('Text to be displayed in text block')\n    @LayoutPropertyType<DefaultKnownPropertyTypes>('inputString')\n    public text: string|undefined|null = null;\n    \n    //######################### constructor #########################\n    constructor(value: TextBlockComponentOptions|undefined|null)\n    {\n        //TODO: remove ! when fixed in common\n        mapValuesToThis.bind(this)(value!);\n    }\n}","import {ComponentStylingPropertiesControlComponent, genericPropertiesControlFor, LayoutEditorMetadataDescriptor, LayoutEditorMetadataInfo} from '@anglr/dynamic/layout-editor';\n\nimport {TextBlockComponentOptions} from '../textBlock.options';\nimport {TextBlockModel} from './textBlock.model';\n\n/**\n * Text block layout metadata\n */\nexport class TextBlockLayoutEditorMetadata implements LayoutEditorMetadataDescriptor<TextBlockComponentOptions>\n{\n    //######################### public properties - implementation of LayoutEditorMetadataDescriptor #########################\n\n    /**\n     * @inheritdoc\n     */\n    public metaInfo?: LayoutEditorMetadataInfo<TextBlockComponentOptions> =\n    {\n        name: 'Text block',\n        description: 'Displays text',\n        optionsMetadata:\n        {\n            propertiesMetadata:\n            [\n                {\n                    modelType: TextBlockModel,\n                    propertiesControls: \n                    [\n                        ComponentStylingPropertiesControlComponent,\n                        genericPropertiesControlFor(['text'])\n                    ],\n                },\n            ],\n        },\n        defaultOptions:\n        {\n            text: 'This is your text'\n        }\n    };\n\n    //######################### constructor #########################\n    constructor()\n    {\n        Object.freeze(this);\n    }\n}","import {Inject, Injectable, Optional, Type} from '@angular/core';\nimport {Logger, LOGGER} from '@anglr/common';\nimport {Dictionary, isType, resolvePromiseOr} from '@jscrpt/common';\n\nimport {DYNAMIC_MODULE_DATA_EXTRACTORS, DYNAMIC_ITEM_LOADER_PROVIDERS, DYNAMIC_ITEM_EXTENSIONS_EXTRACTORS} from '../../misc/tokens';\nimport {DynamicItemExtensionsExtractor, DynamicItemLoaderProvider} from './dynamicItemLoader.interface';\nimport {DynamicItem, DynamicModule, DynamicItemSource, DynamicItemType, DynamicModuleDataExtractor} from '../../interfaces';\n\n/**\n * Service used for loading dynamic items\n */\n@Injectable({providedIn: 'root'})\nexport class DynamicItemLoader\n{\n    //######################### protected cache #########################\n\n    /**\n     * Cached dynamic items\n     */\n    protected _cachedDynamicItems: Dictionary<DynamicItemType<DynamicItem>> = {};\n\n    //######################### constructors #########################\n    constructor(@Inject(DYNAMIC_ITEM_LOADER_PROVIDERS) protected _providers: DynamicItemLoaderProvider[],\n                @Inject(DYNAMIC_MODULE_DATA_EXTRACTORS) protected _extractors: DynamicModuleDataExtractor<Type<DynamicItem>>[],\n                @Inject(DYNAMIC_ITEM_EXTENSIONS_EXTRACTORS) protected _extensionsExtractors: DynamicItemExtensionsExtractor[],\n                @Inject(LOGGER) @Optional() protected _logger?: Logger,)\n    {\n        //providers is not an array\n        if(!Array.isArray(this._providers))\n        {\n            this._logger?.error('DynamicItemLoader: missing providers!');\n\n            this._providers = [];\n        }\n\n        //extractors is not an array\n        if(!Array.isArray(this._extractors))\n        {\n            this._logger?.error('DynamicItemLoader: missing extractors!');\n\n            this._extractors = [];\n        }\n\n        //extensions extractors is not an array\n        if(!Array.isArray(this._extensionsExtractors))\n        {\n            this._logger?.error('DynamicItemLoader: missing extensions extractors!');\n\n            this._extensionsExtractors = [];\n        }\n    }\n\n    //######################### public methods #########################\n\n    /**\n     * Loads dynamic item type, or null if not found\n     * @param source - Definition of source for dynamic item\n     */\n    public async loadItem<TType extends DynamicItem = any>(source: DynamicItemSource): Promise<DynamicItemType<TType>|null>\n    {\n        let dynamicModule: DynamicModule|null = null;\n        const cacheId = `${source.package}-${source.name}`;\n\n        //try to get from cache\n        if(this._cachedDynamicItems[cacheId])\n        {\n            this._logger?.verbose('DynamicItemLoader: Loading from cache {@source}', {name: source.name, package: source.package});\n\n            return this._cachedDynamicItems[cacheId] as DynamicItemType<TType>;\n        }\n\n        //loops all providers, return result from first that returns non null value\n        for(const provider of this._providers)\n        {\n            const asyncDynamicModule = provider.tryToGet(source);\n\n            if(asyncDynamicModule)\n            {\n                dynamicModule = await resolvePromiseOr(asyncDynamicModule);\n            }\n            else\n            {\n                dynamicModule = null;\n            }\n\n            if(dynamicModule)\n            {\n                break;\n            }\n        }\n\n        //no module found\n        if(!dynamicModule)\n        {\n            this._logger?.debug('DynamicItemLoader: Failed to get dynamic module {@source}', {name: source.name, package: source.package});\n\n            return null;\n        }\n\n        let result: DynamicItemType<TType>|null = null;\n\n        //loops all extractors, return result from first that returns non null value\n        for(const extractor of this._extractors)\n        {\n            const dynamicItemType = extractor.tryToExtract(dynamicModule);\n\n            if(dynamicItemType && isType(dynamicItemType))\n            {\n                this._cachedDynamicItems[cacheId] = result = \n                {\n                    type: dynamicItemType as Type<TType>\n                };\n\n                break;\n            }\n        }\n\n        if(!result)\n        {\n            this._logger?.debug('DynamicItemLoader: Failed to extract dynamic type {@source}', {name: source.name, package: source.package});\n\n            return null;\n        }\n\n        //loops all extensions extractors, return result from first that returns non null value\n        for(const extractor of this._extensionsExtractors)\n        {\n            const extensions = extractor.tryToExtract(dynamicModule);\n\n            if(extensions)\n            {\n                result.extensions = extensions.extensions;\n                result.childExtensions = extensions.childExtensions;\n\n                break;\n            }\n        }\n\n        return result;\n    }\n}","import {PromiseOr} from '../types/async';\n\n/**\n * Resolves `PromiseOr` value\n * @param value - Value to be solved\n */\nexport async function resolvePromiseOr<TResult>(value: PromiseOr<TResult>): Promise<TResult>\n{\n    if(value instanceof Promise)\n    {\n        return await value;\n    }\n\n    return value;\n}\n"],"names":["TextBlockModel","constructor","value","text","mapValuesToThis","this","__decorate","LayoutPropertyName","LayoutPropertyDescription","LayoutPropertyType","MetadataClassMixin","ComponentStylingModel","LayoutPropertyMetadata","FORM_MODEL_CONTROLS_METADATA_PROPERTY","TextBlockLayoutEditorMetadata","metaInfo","name","description","optionsMetadata","propertiesMetadata","modelType","propertiesControls","ComponentStylingPropertiesControlComponent","genericPropertiesControlFor","defaultOptions","Object","freeze","DynamicItemLoader","_providers","_extractors","_extensionsExtractors","_logger","_cachedDynamicItems","Array","isArray","error","loadItem","source","dynamicModule","cacheId","package","verbose","provider","asyncDynamicModule","tryToGet","resolvePromiseOr","debug","result","extractor","dynamicItemType","tryToExtract","isType","type","extensions","childExtensions","i0","DYNAMIC_ITEM_LOADER_PROVIDERS","DYNAMIC_MODULE_DATA_EXTRACTORS","DYNAMIC_ITEM_EXTENSIONS_EXTRACTORS","LOGGER","factory","providedIn","Promise"],"sourceRoot":""}