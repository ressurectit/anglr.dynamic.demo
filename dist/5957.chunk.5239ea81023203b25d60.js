"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[5957],{75957:(t,e,n)=>{n.d(e,{F:()=>F});var o=n(4905),i=n(27052),a=n(9360),s=n(53682),r=n(40362);class u{constructor(t,e,n,o){this._parentGroup=t,this._relationManager=e,this.start=n,this.end=o,this._destroyingSubject=new s.xQ,this.output=null,this.input=null,this._path=this._parentGroup.append("path").attr("fill","transparent").attr("stroke","#48B8B8").attr("stroke-width","3px"),this._lineGenerator=(0,a.jvg)().curve(a.tFB.beta(.75))}get destroying(){return this._destroyingSubject.asObservable()}destroy(){this._path?.remove(),this._destroyingSubject.next()}invalidateVisuals(t){if(t==r.r){const t=this._relationManager.getActiveInput();this._relationManager.setActiveInput(null),t&&t.addRelation(this)?(this.end=t.getCoordinates(),this.input=t):(this.destroy(),this.start=null,this.end=null,this.input=null,this.output=null)}if(!this.start||!this.end)return;let e;if(this.end.x<=this.start.x){let t=this.start.x-this.end.x;const n=(this.end.y-this.start.y)/2;t<12&&(t=12),t*=1.3,e=[[this.start.x,this.start.y],[this.start.x+t,this.start.y+n],[this.end.x-t,this.start.y+n],[this.end.x,this.end.y]]}else{const t=(this.end.x-this.start.x)/3;e=[[this.start.x,this.start.y],[this.start.x+t,this.start.y],[this.end.x-t,this.end.y],[this.end.x,this.end.y]]}this._path.attr("d",this._lineGenerator(e))}}var l=n(26220),c=n(6230),d=n(74445),p=n(46480),h=n(49891),f=n(43939),g=n(91861),m=n(79440),_=n(15783),v=n(13691),y=n(36973),w=n(48397);function R(t,e,n,o,i,a,s){try{var r=t[a](s),u=r.value}catch(t){return void n(t)}r.done?e(u):Promise.resolve(u).then(o,i)}class x{constructor(t,e,n,o){this._viewContainerRef=t,this._relationsNodeManager=e,this._loader=n,this._logger=o,this._componentRef=null,this.componentMetadata=null,this.zoomLevel=1,this.create=new d.v,this.destroy=new d.v}get component(){return this._componentRef?this._componentRef.instance:null}ngOnChanges(t){var e,n=this;return(e=function*(){if((0,h.$)("zoomLevel")in t&&(0,f.EN)(n.zoomLevel)&&!((0,h.$)("componentMetadata")in t)){const e=n.component;if(e){const o=t[(0,h.$)("zoomLevel")];e.zoomLevel=n.zoomLevel;const i={currentValue:o.currentValue,firstChange:!1,previousValue:o.previousValue,isFirstChange:()=>!1},a={};a[(0,h.$)("zoomLevel")]=i,e.ngOnChanges(a),e.invalidateVisuals()}}else if(n._logger?.debug("RelationsNodeRendererSADirective: rendering node {@id}",{id:n.componentMetadata?.id}),n.ngOnDestroy(),n._viewContainerRef.clear(),(0,h.$)("componentMetadata")in t&&n.componentMetadata){const t=yield n._loader.loadItem(n.componentMetadata);if(!t)return void n._logger?.warn("RelationsNodeRendererSADirective: Unable to find relations node type {@type}",{name:n.componentMetadata.name,package:n.componentMetadata.package});if(n._componentRef=n._viewContainerRef.createComponent(t.data,{injector:n._viewContainerRef.injector}),n._logger?.debug("RelationsNodeRendererSADirective: node rendered {@id}",{id:n.componentMetadata?.id}),n.component){const t=n.component;n._logger?.debug("RelationsNodeRendererSADirective: initializing node with metadata {@id}",{id:n.componentMetadata?.id}),t.metadata=n.componentMetadata,t.zoomLevel=n.zoomLevel;const e={};e[(0,h.$)("metadata")]={currentValue:n.componentMetadata,previousValue:null,firstChange:!0,isFirstChange:()=>!0},e[(0,h.$)("zoomLevel")]={currentValue:n.zoomLevel,previousValue:null,firstChange:!0,isFirstChange:()=>!0},t.ngOnChanges(e),n._logger?.debug("RelationsNodeRendererSADirective: invalidating node visuals {@id}",{id:n.componentMetadata?.id}),t.invalidateVisuals(),n._componentRef.changeDetectorRef.markForCheck(),n._relationsNodeManager.registerNode(n.component),n.create.next(t)}}},function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function s(t){R(a,o,i,s,r,"next",t)}function r(t){R(a,o,i,s,r,"throw",t)}s(void 0)}))})()}ngOnDestroy(){this._componentRef&&(this._logger?.debug("RelationsNodeRendererSADirective: destroying node {@id}",{id:this.componentMetadata?.id}),this.component&&(this.destroy.next(this.component),this._relationsNodeManager.unregisterNode(this.component)),this._componentRef?.destroy(),this._componentRef=null)}}x.ɵfac=function(t){return new(t||x)(m.Y(_.s_),m.Y(w.J),m.Y(g.fI),m.Y(p.bZ,8))},x.ɵdir=v.lG({type:x,selectors:[["","relationsNodeRenderer",""]],inputs:{componentMetadata:["relationsNodeRenderer","componentMetadata"],zoomLevel:"zoomLevel"},outputs:{create:"create",destroy:"destroy"},exportAs:["relationsNodeRenderer"],standalone:!0,features:[y.T]});var M=n(43870),P=n(4477),b=n(6845),D=n(66794),N=n(73301),k=n(55436),L=n(72891),O=n(47083),S=n(85320),E=n(82568),z=n(80827),I=n(15686),T=n(12311);const A=["relationsGroup"];function C(t,e){if(1&t&&(M.O4(),M.kc(),P.yn(0),P.Gk(1,4),P.BQ()),2&t){const t=e.$implicit,n=b.o();D.x(1),N.Q("relationsNodeRenderer",t)("zoomLevel",n._zoomLevel)}}class F{constructor(t){this._relationManager=t,this._backgroundSize=16,this._lastMouseDownPosition={x:0,y:0},this._lastMouseUpPosition={x:0,y:0},this._canvasPosition={x:0,y:0},this._zoomLevel=1,this._isDragging=!1,this.nodeDefinitions=[]}get _backgroundSizeStyle(){return`${this._backgroundSize}px ${this._backgroundSize}px`}get _backgroundPositionStyle(){return`${this._canvasPosition.x%this._backgroundSize}px ${this._canvasPosition.y%this._backgroundSize}px`}createRelation(){return new u((0,a.Ys)(this._relationsGroup?.nativeElement),this._relationManager,null,null)}_onMouseDown(t){t.buttons==l.t.LEFT&&(this._lastMouseDownPosition={x:t.clientX,y:t.clientY},this._isDragging=!0)}_onMouseMove(t){this._isDragging&&(this._canvasPosition={x:this._lastMouseUpPosition.x+t.clientX-this._lastMouseDownPosition.x,y:this._lastMouseUpPosition.y+t.clientY-this._lastMouseDownPosition.y})}_onMouseUp(t){this._isDragging&&(this._isDragging=!1,this._lastMouseUpPosition={x:this._lastMouseUpPosition.x+t.clientX-this._lastMouseDownPosition.x,y:this._lastMouseUpPosition.y+t.clientY-this._lastMouseDownPosition.y})}_onWheel(t){if(t.deltaY){const e=(0,c.uZ)(this._zoomLevel+.05*(t.deltaY>1?-1:1),.2,2);this._canvasPosition={x:this._canvasPosition.x/this._zoomLevel*e,y:this._canvasPosition.y/this._zoomLevel*e},this._zoomLevel=e,this._lastMouseUpPosition={x:this._canvasPosition.x,y:this._canvasPosition.y},this._backgroundSize=16*this._zoomLevel}t.preventDefault(),t.stopImmediatePropagation()}}F.ɵfac=function(t){return new(t||F)(m.Y(w.J))},F.ɵcmp=v.Xp({type:F,selectors:[["relations-canvas"]],viewQuery:function(t,e){if(1&t&&k.Gf(A,5,o.SB),2&t){let t;k.iG(t=k.CR())&&(e._relationsGroup=t.first)}},hostVars:4,hostBindings:function(t,e){1&t&&L.N("mousedown",(function(t){return e._onMouseDown(t)}))("mousemove",(function(t){return e._onMouseMove(t)}))("mouseup",(function(t){return e._onMouseUp(t)}),!1,O.Jf)("wheel",(function(t){return e._onWheel(t)})),2&t&&S.Ud("background-size",e._backgroundSizeStyle)("background-position",e._backgroundPositionStyle)},inputs:{nodeDefinitions:"nodeDefinitions"},standalone:!0,features:[E.j],decls:5,vars:3,consts:[[1,"flow-area"],[1,"relations-wrapper"],["relationsGroup",""],[4,"ngFor","ngForOf"],[3,"relationsNodeRenderer","zoomLevel"]],template:function(t,e){1&t&&(z.Tg(0,"div",0),M.O4(),z.Tg(1,"svg",1),z._U(2,"g",null,2),z.qZ(),I.Y(4,C,2,2,"ng-container",3),z.qZ()),2&t&&(S.Ud("transform","translate("+e._canvasPosition.x+"px, "+e._canvasPosition.y+"px) scale("+e._zoomLevel+")"),D.x(4),N.Q("ngForOf",e.nodeDefinitions))},dependencies:[i.e,T.s,x],styles:["[_nghost-%COMP%]\n{\n    background-color: #e5e5f7;\n    opacity: 0.6;\n    background-image: radial-gradient(#444cf7 0.8px, #e5e5f7 0.8px);\n    overflow: hidden;\n}\n\n.relations-wrapper[_ngcontent-%COMP%]\n{\n    width: 100%;\n    height: 100%;\n    overflow: visible;\n}"],changeDetection:0})},40362:(t,e,n)=>{n.d(e,{r:()=>o});const o="drop"},26220:(t,e,n)=>{var o;n.d(e,{t:()=>o}),function(t){t[t.LEFT=1]="LEFT"}(o||(o={}))},91861:(t,e,n)=>{n.d(e,{Bj:()=>s,DZ:()=>i,GP:()=>a,fI:()=>l,n7:()=>u,yh:()=>r});var o=n(40296);const i=new o.O("RELATIONS_MODULE_TYPES_DATA_EXTRACTORS"),a=new o.O("RELATIONS_MODULE_TYPES_PROVIDERS"),s=new o.O("RELATIONS_MODULE_TYPES_LOADER"),r=new o.O("RELATIONS_NODES_DATA_EXTRACTORS"),u=new o.O("RELATIONS_NODES_PROVIDERS"),l=new o.O("RELATIONS_NODES_LOADER")},6230:(t,e,n)=>{n.d(e,{uZ:()=>I,CQ:()=>T,Zl:()=>A,TN:()=>C,hE:()=>F});var o=n(43939),i=n(60640),a=n(11776),s=n(51509),r=n(65569),u=n(44677),l=n(12193),c=n(46480),d=n(91861),p=n(10439),h=n(87606);function f(t,e,n,o,i,a,s){try{var r=t[a](s),u=r.value}catch(t){return void n(t)}r.done?e(u):Promise.resolve(u).then(o,i)}const g=function(){var t,e=(t=function*(t,e){const n=yield(0,h.K)((0,p.j)(t,e));if(e?.debug("relationsNodeExtractor: trying to extract dynamic node"),!n)return null;const o=n.data;if(!o)return null;const i=yield o.relationsEditorMetadata;return i?{data:i.nodeDefinition,metaInfo:i.metaInfo}:null},function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function s(t){f(a,o,i,s,r,"next",t)}function r(t){f(a,o,i,s,r,"throw",t)}s(void 0)}))});return function(t,n){return e.apply(this,arguments)}}();function m(t,e,n,o,i,a,s){try{var r=t[a](s),u=r.value}catch(t){return void n(t)}r.done?e(u):Promise.resolve(u).then(o,i)}const _=function(){var t,e=(t=function*(t,e){const n=t;if(e?.debug("componentRelationsNodeExtractor: trying to extract dynamic node"),!n)return null;const o=n.default;if(!o)return null;const i=yield o.relationsEditorMetadata;return i?{data:i.nodeDefinition,metaInfo:i.metaInfo,singleton:!0}:null},function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function s(t){m(a,o,i,s,r,"next",t)}function r(t){m(a,o,i,s,r,"throw",t)}s(void 0)}))});return function(t,n){return e.apply(this,arguments)}}();var v=n(38327),y=n(54870);class w{constructor(t,e){this._componentsRegister=t,this._logger=e}tryToGet(t){if("static-components"!=t.package)return null;this._logger?.debug("StaticComponentsRelationsNodesProvider: trying to get node {@item}",{name:t.name,package:t.package});const e=this._componentsRegister.getType(t.name);return e?{default:e}:null}}function R(t,e,n,o,i,a,s){try{var r=t[a](s),u=r.value}catch(t){return void n(t)}r.done?e(u):Promise.resolve(u).then(o,i)}w.ɵfac=function(t){return new(t||w)(a.LF(y.w),a.LF(c.bZ,8))},w.ɵprov=v.Yz({token:w,factory:w.ɵfac});class x{constructor(t){this._logger=t}tryToGet(t){var e,o=this;return(e=function*(){try{switch(o._logger?.debug("DefaultDynamicModuleRelationsProvider: trying to get relations types for module {@module}",{moduleName:t.package}),t.package){case"basic-components":return yield n.e(4041).then(n.bind(n,94041));case"material-components":return yield n.e(5342).then(n.bind(n,85342));default:return null}}catch(e){o._logger?.debug("DefaultDynamicModuleRelationsProvider: module {@module} was not found, reason: "+e,{moduleName:t.package})}return null},function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function s(t){R(a,o,i,s,r,"next",t)}function r(t){R(a,o,i,s,r,"throw",t)}s(void 0)}))})()}}x.ɵfac=function(t){return new(t||x)(a.LF(c.bZ,8))},x.ɵprov=v.Yz({token:x,factory:x.ɵfac});class M{constructor(t,e){this._componentsRegister=t,this._logger=e}tryToGet(t){if("static-components"!=t.package)return null;this._logger?.debug("StaticComponentsRelationsTypesProvider: trying to get relations types {@item}",{name:t.name,package:t.package});const e=this._componentsRegister.types;return e?{default:e}:null}}M.ɵfac=function(t){return new(t||M)(a.LF(y.w),a.LF(c.bZ,8))},M.ɵprov=v.Yz({token:M,factory:M.ɵfac});const P={provide:d.n7,useClass:s.c,multi:!0},b={provide:d.n7,useClass:w,multi:!0},D={provide:d.GP,useClass:x,multi:!0},N={provide:d.GP,useClass:M,multi:!0},k={provide:d.yh,useFactory:t=>new r.$([g],t),deps:[[new i.Fi,c.bZ]],multi:!0},L={provide:d.yh,useFactory:t=>new r.$([_],t),deps:[[new i.Fi,c.bZ]],multi:!0},O={provide:d.DZ,useFactory:t=>new r.$([u.L],t),deps:[[new i.Fi,c.bZ]],multi:!0},S={provide:d.Bj,useFactory:()=>new l.S((0,a.f3)(d.GP),(0,a.f3)(d.DZ),T,(0,a.f3)(c.bZ,{optional:!0})??void 0)},E={provide:d.fI,useFactory:()=>new l.S((0,a.f3)(d.n7),(0,a.f3)(d.yh),A,(0,a.f3)(c.bZ,{optional:!0})??void 0)};var z=n(48397);function I(t,e,n){return Math.min(Math.max(t,e),n)}const T=function(t){return!((0,o.fp)(t?.data)||!Array.isArray(t.data))},A=function(t){return!((0,o.fp)(t?.data)||!(0,o.P9)(t.data)||(0,o.EN)(t.singleton)&&!(0,o.jn)(t.singleton)||(0,o.EN)(t?.metaInfo)&&!(0,o.wV)(t.metaInfo))};function C(){return[P,D,k,L,O,S,E,z.J]}function F(t){return[...C(),b,N,{provide:y.w,useClass:t}]}},48397:(t,e,n)=>{n.d(e,{J:()=>i});var o=n(38327);class i{constructor(){this._nodes={},this._waitingInputRelations={}}setActiveInput(t){this._activeInput=t}getActiveInput(){return this._activeInput}registerNode(t){var e,n;if(this._nodes[t.id]=t,t.metadata?.outputs&&Array.isArray(t.metadata?.outputs))for(const o of t.metadata?.outputs){if(!o.inputs||!Array.isArray(o.inputs))continue;const i=t.outputs[o.outputName];if(i)for(const t of o.inputs){const o=this._nodes[t.id],a=i.startRelation();if(!o){(e=this._waitingInputRelations)[n=t.id]??(e[n]=[]),this._waitingInputRelations[t.id].push({inputName:t.inputName,relation:a});continue}const s=o.inputs[t.inputName];s&&s.endRelation(a)}}if(this._waitingInputRelations[t.id]){const e=this._waitingInputRelations[t.id],n=this._nodes[t.id];if(!n)return;for(const o of e){const e=n.inputs[o.inputName];e&&(e.endRelation(o.relation),delete this._waitingInputRelations[t.id])}}}unregisterNode(t){delete this._nodes[t.id]}getMetadata(){const t=[],e=Object.keys(this._nodes);for(const n of e){const e=this._nodes[n];if(!e.metadata)continue;const o={id:n,name:e.metadata.name,package:e.metadata.package,displayName:e.metadata.displayName,relationsOptions:e.metadata.relationsOptions,nodeMetadata:e.metadata.nodeMetadata,outputs:[]};if(e.allOutputs){for(const t of e.allOutputs){if(!t.relations)continue;if(!t.name)continue;const e={outputName:t.name,inputs:[]};for(const n of t.relations)n.input?.name&&e.inputs.push({id:n.input.parentId,inputName:n.input.name});o.outputs?.push(e)}t.push(o)}}return t}}i.ɵfac=function(t){return new(t||i)},i.ɵprov=o.Yz({token:i,factory:i.ɵfac})},54870:(t,e,n)=>{n.d(e,{w:()=>i});var o=n(38327);class i{constructor(){this._definedTypes=this.getDefinedTypes()}get types(){return Object.keys(this._definedTypes)}getType(t){return this._definedTypes[t]??null}}i.ɵfac=function(t){return new(t||i)},i.ɵprov=o.Yz({token:i,factory:i.ɵfac})},10439:(t,e,n)=>{n.d(e,{j:()=>a});var o=n(43939),i=n(89402);const a=(t,e)=>{const n=t;return e?.debug("relationsExportExtractor: trying to extract dynamic relations"),(0,o.EN)(n.relations)&&(0,o.P9)(n.relations)&&(0,i.O)(n.relations)?{data:n.relations}:(0,o.EN)(n.default)&&(0,o.P9)(n.default)&&(0,i.O)(n.default)?{data:n.default}:null}},44677:(t,e,n)=>{n.d(e,{L:()=>i});var o=n(43939);const i=(t,e)=>{const n=t;return e?.debug("defaultExportExtractor: trying to extract default dynamic data"),(0,o.EN)(n.default)?{data:n.default}:null}}}]);
//# sourceMappingURL=5957.chunk.5239ea81023203b25d60.js.map