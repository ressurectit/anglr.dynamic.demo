"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[3002],{20560:(e,t,a)=>{a.d(t,{d:()=>n});var s=a(5290),i=a(85086);class n extends s.L{constructor(){super("RELATIONS_PACKAGES_STORE")}}n.ɵfac=function(e){return new(e||n)},n.ɵprov=i.Yz({token:n,factory:n.ɵfac})},33108:(e,t,a)=>{a.d(t,{Y:()=>H});var s=a(31046),i=a(26843),n=a(73943),o=a(25689),c=a(97881),r=a(58853),d=a(95127),u=a(65206),l=a(66201),g=a(32779),p=a(85410);class h{constructor(){this.defaultsOverride=(0,g.f3)(l.fs,{optional:!0})}transform(e,t,a,s){return{metadata:{id:a?e.itemSource.name:`${e.itemSource.name}-${t}`,displayName:a?this.defaultsOverride?.getDisplayName(e.itemSource.package,e.itemSource.name,e.metadata.displayName)||e.metadata.displayName||e.itemSource.name:void 0,package:e.itemSource.package,name:e.itemSource.name,scope:s,relationsOptions:(0,n.l7)(!0,{},this.defaultsOverride?.getOptions(e.itemSource.package,e.itemSource.name,e.metadata.metaInfo?.defaultOptions)??e.metadata.metaInfo?.defaultOptions),outputs:[],nodeMetadata:{scopeConfigurable:!a??!1,coordinates:{x:0,y:0},options:null}}}}}h.ɵfac=function(e){return new(e||h)},h.ɵpipe=p.Yj({name:"toRelationsDragData",type:h,pure:!0,standalone:!0});var m=a(88809),f=a(13315),k=a(95741),b=a(67942),v=a(57284),y=a(13757),w=a(80033),L=a(49276),P=a(43335),D=a(96189),S=a(78190),_=a(46430),x=a(10065),O=a(5290),I=a(52539),C=a(99118),N=a(22517);function Y(e,t,a,s,i,n,o){try{var c=e[n](o),r=c.value}catch(e){return void a(e)}c.done?t(r):Promise.resolve(r).then(s,i)}function T(e,t){if(1&e&&(m.Tg(0,"div",2),f._(1),k.AL(2,"firstUppercaseLocalize"),m.qZ()),2&e){const e=b.o();v.x(1),y.Oq(k.lc(2,1,null==e.data.metadata.metaInfo?null:e.data.metadata.metaInfo.description))}}class M{constructor(e,t,a,s,i){this._changeDetector=e,this.packageManager=t,this._metadataManager=a,this._cdkDrag=s,this._logger=i,this.initSubscriptions=new o.w0,this.used=!1}ngOnInit(){var e,t=this;return(e=function*(){for(const e in t._metadataManager.nodes)if(t.data?.itemSource?.name===e){t._setUsed(!0);break}t.initSubscriptions.add(t._metadataManager.nodeRegisterChange.subscribe((e=>{e.id===t.data?.itemSource?.name&&t._setUsed(!0)}))),t.initSubscriptions.add(t._metadataManager.nodeUnregisterChange.subscribe((e=>{e.id===t.data?.itemSource?.name&&t._setUsed(!1)})))},function(){var t=this,a=arguments;return new Promise((function(s,i){var n=e.apply(t,a);function o(e){Y(n,s,i,o,c,"next",e)}function c(e){Y(n,s,i,o,c,"throw",e)}o(void 0)}))})()}ngOnDestroy(){this.initSubscriptions.unsubscribe()}_setUsed(e){this.used=e,this._cdkDrag&&(this._cdkDrag.disabled=e),this._changeDetector.markForCheck()}focusNode(){this.used&&this.data?.metadata?.singleton&&this._metadataManager.setActiveNode(this.data?.itemSource?.name)}}M.ɵfac=function(e){return new(e||M)(w.Y(L.s),w.Y(O.L),w.Y(I.J),w.Y(C.Z,8),w.Y(d.bZ,8))},M.ɵcmp=p.Xp({type:M,selectors:[["nodes-palette-item"]],hostVars:2,hostBindings:function(e,t){1&e&&P.N("dblclick",(function(){return t.focusNode()})),2&e&&D.ek("used",t.used)},inputs:{data:"data"},standalone:!0,features:[S.j],decls:4,vars:4,consts:[[1,"editor-component-name"],["class","editor-component-description",4,"ngIf"],[1,"editor-component-description"]],template:function(e,t){if(1&e&&(m.Tg(0,"div",0),f._(1),k.AL(2,"firstUppercaseLocalize"),m.qZ(),_.Y(3,T,3,3,"div",1)),2&e){let e;v.x(1),y.Oq(k.lc(2,2,t.data.metadata.singleton?t.data.metadata.displayName||t.data.itemSource.name:null!==(e=null==t.data.metadata.metaInfo?null:t.data.metadata.metaInfo.name)&&void 0!==e?e:t.data.itemSource.name)),v.x(2),x.Q("ngIf",null==t.data.metadata.metaInfo?null:t.data.metadata.metaInfo.description)}},dependencies:[r.e,N.O,u.R],encapsulation:2,changeDetection:0});var A=a(88731),q=a(32603),F=a(52622),Z=a(56949),U=a(4539),j=a(62708),Q=a(78907);function $(e,t,a,s,i,n,o){try{var c=e[n](o),r=c.value}catch(e){return void a(e)}c.done?t(r):Promise.resolve(r).then(s,i)}function R(e){return function(){var t=this,a=arguments;return new Promise((function(s,i){var n=e.apply(t,a);function o(e){$(n,s,i,o,c,"next",e)}function c(e){$(n,s,i,o,c,"throw",e)}o(void 0)}))}}function z(e,t){if(1&e){const e=A.E();m.Tg(0,"div",4)(1,"nodes-palette-item",5),P.N("cdkDragDropped",(function(){q.CH(e);const t=b.o(2);return q.Kt(t.generateNewId())})),k.AL(2,"toRelationsDragData"),m.qZ()()}if(2&e){const e=t.$implicit,a=b.o(2);x.Q("cdkDropListConnectedTo",a.canvasDropList),v.x(1),x.Q("data",e)("cdkDragData",k.tD(2,3,e,a.newCompnentId,e.metadata.singleton,e.metadata.scope))}}function E(e,t){if(1&e&&(F.yn(0),m.Tg(1,"div",2),f._(2),k.AL(3,"firstUppercaseLocalize"),m.qZ(),_.Y(4,z,3,8,"div",3),F.BQ()),2&e){const e=t.$implicit;v.x(2),y.hi("",k.lc(3,2,e.key)," "),v.x(2),x.Q("ngForOf",e.value)}}class V{get usedPackages(){return this.packages??this.packageManager.usedPackages}constructor(e,t,a,s,i,c,r){this._moduleTypesLoader=e,this._nodesLoader=t,this._changeDetector=a,this.packageManager=s,this._metadataManager=i,this._refreshObservables=c,this._logger=r,this.initSubscriptions=new o.w0,this.allItems=[],this.groupedItems={},this.newCompnentId=(0,n.Ox)(16),this.isDragOverPalette=!1,this.whiteListedPackages=[]}ngOnInit(){var e=this;return R((function*(){if(e._refreshObservables&&Array.isArray(e._refreshObservables))for(const t of e._refreshObservables)e.initSubscriptions.add(t.subscribe((()=>e.loadNodes())));e.initSubscriptions.add(e.packageManager.usedPackagesChange.subscribe((()=>e.loadNodes()))),yield e.loadNodes()}))()}ngOnChanges(e){var t=this;return R((function*(){if((0,n.$0)("whiteList")in e&&(t.whiteListedPackages=[],Array.isArray(t.whiteList)))for(const e of t.whiteList)t.whiteListedPackages.find((t=>t==e.package))||t.whiteListedPackages.push(e.package);((0,n.$0)("whiteList")in e||(0,n.$0)("blackList")in e||(0,n.$0)("packages")in e)&&(yield t.loadNodes())}))()}ngOnDestroy(){this.initSubscriptions.unsubscribe()}loadNodes(){var e=this;return R((function*(){var t;e.allItems=[],e.groupedItems={};for(const t of e.usedPackages){const a=(yield e._moduleTypesLoader.loadItem({package:t,name:"types"}))?.data??[];for(const s of a){if(e.whiteListedPackages.find((e=>t==e))){if(!e.whiteList?.find((e=>e.package==t&&e.name==s)))continue}else if(e.blackList?.find((e=>e.package==t&&e.name==s)))continue;const a={package:t,name:s},i=yield e._nodesLoader.loadItem(a);i?e.allItems.push({itemSource:a,metadata:i}):e._logger?.warn("NodesPaletteSAComponent: Failed to obtain layout editor metadata {{@source}}",{source:a})}}e.groupedItems[""]=[];for(const a of e.allItems){const s=a.metadata.metaInfo?.group??"";(t=e.groupedItems)[s]??(t[s]=[]),e.groupedItems[s].push(a)}e._changeDetector.detectChanges()}))()}generateNewId(){this.newCompnentId=(0,n.Ox)(16)}}V.ɵfac=function(e){return new(e||V)(w.Y(l.Bj),w.Y(l.fI),w.Y(L.s),w.Y(O.L),w.Y(I.J),w.Y(l.dK,8),w.Y(d.bZ,8))},V.ɵcmp=p.Xp({type:V,selectors:[["nodes-palette"]],inputs:{canvasDropList:"canvasDropList",packages:"packages",whiteList:"whiteList",blackList:"blackList"},standalone:!0,features:[Z.T,S.j],decls:3,vars:3,consts:[[1,"dynamic-flex-column"],[4,"ngFor","ngForOf"],[1,"dynamic-text-spread","dynamic-text-small-caps","dynamic-margin-left-extra-small","dynamic-margin-horizontal-small","dynamic-bold"],["cdkDropList","","cdkDropListSortingDisabled","","class","palette-droplist",3,"cdkDropListConnectedTo",4,"ngFor","ngForOf"],["cdkDropList","","cdkDropListSortingDisabled","",1,"palette-droplist",3,"cdkDropListConnectedTo"],["cdkDrag","",1,"editor-component","mat-elevation-z2",3,"data","cdkDragData","cdkDragDropped"]],template:function(e,t){1&e&&(m.Tg(0,"div",0),_.Y(1,E,5,4,"ng-container",1),k.AL(2,"keyvalue"),m.qZ()),2&e&&(v.x(1),x.Q("ngForOf",k.lc(2,1,t.groupedItems)))},dependencies:[r.e,U.sg,j.N,s._,Q.W,C.Z,h,M,u.R],encapsulation:2,changeDetection:0}),(0,c.gn)([(0,n.CY)(10),(0,n.Sw)(),(0,c.w6)("design:type",Function),(0,c.w6)("design:paramtypes",[]),(0,c.w6)("design:returntype",Promise)],V.prototype,"loadNodes",null);var K=a(45666),X=a(77217),B=a(26116),G=a(35891),J=a(15712);class H{constructor(e,t,a){this.history=e,this.changeDetector=t,this.hotkeys=a,this.initSubscriptions=new o.w0,this.metadata=[],a?.init()}ngOnInit(){this.initSubscriptions.add(this.history.pop.subscribe((e=>{this.metadata=e,this.changeDetector.detectChanges()}))),this.hotkeys&&(this.initSubscriptions.add(this.hotkeys.undo.subscribe((()=>this.history.undo()))),this.initSubscriptions.add(this.hotkeys.redo.subscribe((()=>this.history.redo()))))}ngOnChanges(e){(0,n.$0)("metadata")in e&&(this.history.clean(),this.metadata&&this.history.setInitialState(this.metadata))}ngOnDestroy(){this.initSubscriptions.unsubscribe(),this.hotkeys?.destroy()}addNode(e){if(e.item.data.metadata.nodeMetadata?.coordinates){const t=this.relationCanvas?.getPositionInCanvas(e.dropPoint);t&&(e.item.data.metadata.nodeMetadata.coordinates.x=t.x,e.item.data.metadata.nodeMetadata.coordinates.y=t.y)}this.metadata=[...this.metadata,e.item.data.metadata],this.history.getNewState()}}H.ɵfac=function(e){return new(e||H)(w.Y(l.nR),w.Y(L.s),w.Y(G.z,8))},H.ɵcmp=p.Xp({type:H,selectors:[["relations-editor"]],viewQuery:function(e,t){if(1&e&&X.Gf(K.F,5),2&e){let e;X.iG(e=X.CR())&&(t.relationCanvas=e.first)}},inputs:{metadata:"metadata",packages:"packages",whiteList:"whiteList",blackList:"blackList"},standalone:!0,features:[Z.T,S.j],decls:6,vars:5,consts:[[1,"dynamic-flex-row","dynamic-flex-1"],[1,"overflow-vertical-scroll","dynamic-thin-scrollbar"],[2,"width","250px",3,"canvasDropList","packages","whiteList","blackList"],["cdkDropList","",1,"dynamic-flex-1",3,"nodeDefinitions","cdkDropListDropped"],["dropList","cdkDropList"]],template:function(e,t){if(1&e&&(m.Tg(0,"div",0)(1,"div",1),m._U(2,"package-manager")(3,"nodes-palette",2),m.qZ(),m.Tg(4,"relations-canvas",3,4),P.N("cdkDropListDropped",(function(e){return t.addNode(e)})),m.qZ()()),2&e){const e=B.M(5);v.x(3),x.Q("canvasDropList",e)("packages",t.packages)("whiteList",t.whiteList)("blackList",t.blackList),v.x(1),x.Q("nodeDefinitions",t.metadata)}},dependencies:[V,K.F,s._,Q.W,i.F,J.X],styles:["[_nghost-%COMP%]{display: flex;}"],changeDetection:0})},49198:(e,t,a)=>{a.d(t,{Y:()=>c});var s=a(33108),i=a(58329),n=a(85410),o=a(85086);class c{static withProviders(){return{ngModule:c,providers:[(0,i.TN)()]}}static withStaticComponents(e){return{ngModule:c,providers:[(0,i.hE)(e)]}}}c.ɵfac=function(e){return new(e||c)},c.ɵmod=n.oA({type:c}),c.ɵinj=o.cJ({imports:[s.Y]})},15712:(e,t,a)=>{a.d(t,{X:()=>S});var s=a(88809),i=a(13315),n=a(10065),o=a(57284),c=a(13757),r=a(88731),d=a(43335),u=a(32603),l=a(67942),g=a(46430),p=a(26116),h=a(80033),m=a(85410),f=a(96189),k=a(5290),b=a(4539),v=a(22517),y=a(35332),w=a(43371);function L(e,t){if(1&e&&(s.Tg(0,"option",11),i._(1),s.qZ()),2&e){const e=t.$implicit;n.Q("value",e),o.x(1),c.Oq(e)}}function P(e,t){if(1&e){const e=r.E();s.Tg(0,"div",12)(1,"div",13),i._(2),s.qZ(),s.Tg(3,"button",8),d.N("click",(function(){const t=u.CH(e).$implicit,a=l.o(2);return u.Kt(a.removePackage(t))})),s._U(4,"span",14),s.qZ()()}if(2&e){const e=t.$implicit;o.x(2),c.Oq(e)}}function D(e,t){if(1&e){const e=r.E();s.Tg(0,"div")(1,"div",0)(2,"select",5,6),g.Y(4,L,2,2,"option",7),s.qZ(),s.Tg(5,"button",8),d.N("click",(function(){u.CH(e);const t=p.M(3),a=l.o();return u.Kt(a.addPackage(a.availablePackages[t.selectedIndex]))})),s._U(6,"span",9),s.qZ()(),g.Y(7,P,5,1,"div",10),s.qZ()}if(2&e){const e=l.o();o.x(4),n.Q("ngForOf",e.availablePackages),o.x(3),n.Q("ngForOf",e.usedPackages)}}class S{constructor(e){this.packageManager=e,this.detailVisible=!1,this.usedPackages=[],this.availablePackages=[]}ngOnInit(){this.usedPackages=this.packageManager.usedPackages,this.updatedAvailablePackages()}addPackage(e){e&&(this.usedPackages=[...this.usedPackages,e],this.updatedAvailablePackages(),this.packageManager.setUsedPackages(this.usedPackages))}removePackage(e){this.usedPackages=this.usedPackages.filter((t=>t!=e)),this.updatedAvailablePackages(),this.packageManager.setUsedPackages(this.usedPackages)}updatedAvailablePackages(){this.availablePackages=this.packageManager.packages.filter((e=>!this.usedPackages.find((t=>t==e))))}}S.ɵfac=function(e){return new(e||S)(h.Y(k.L))},S.ɵcmp=m.Xp({type:S,selectors:[["package-manager"]],decls:6,vars:5,consts:[[1,"dynamic-flex-row"],["type","button",1,"dynamic-btn-icon","dynamic-margin-right-extra-small",3,"click"],[1,"fas"],[1,"pm-header"],[4,"ngIf"],[1,"dynamic-form-control","dynamic-flex-1"],["avPkgs",""],[3,"value",4,"ngFor","ngForOf"],["type","button",1,"dynamic-btn-icon","dynamic-margin-left-extra-small",3,"click"],[1,"fas","fa-plus"],["class","dynamic-flex-row dynamic-align-items-center dynamic-margin-top-small",4,"ngFor","ngForOf"],[3,"value"],[1,"dynamic-flex-row","dynamic-align-items-center","dynamic-margin-top-small"],[1,"dynamic-flex-1"],[1,"fas","fa-times"]],template:function(e,t){1&e&&(s.Tg(0,"div",0)(1,"button",1),d.N("click",(function(){return t.detailVisible=!t.detailVisible})),s._U(2,"span",2),s.qZ(),s.Tg(3,"div",3),i._(4,"packages"),s.qZ()(),g.Y(5,D,8,2,"div",4)),2&e&&(o.x(2),f.ek("fa-plus",!t.detailVisible)("fa-minus",t.detailVisible),o.x(3),n.Q("ngIf",t.detailVisible))},dependencies:[b.sg,v.O,y.Y,w.Kr],encapsulation:2,changeDetection:0})},26843:(e,t,a)=>{a.d(t,{F:()=>c});var s=a(58853),i=a(14829),n=a(85410),o=a(85086);class c{}c.ɵfac=function(e){return new(e||c)},c.ɵmod=n.oA({type:c}),c.ɵinj=o.cJ({imports:[s.e,i.U]})},5290:(e,t,a)=>{a.d(t,{L:()=>r});var s=a(32779),i=a(95127),n=a(25689),o=a(15045),c=a(19630);class r{get packagesChange(){return this.packagesChangeSubject.asObservable()}get packages(){const e=[];for(const t of this.packageSources)e.push(...t.packages);return e}get usedPackages(){return this._usedPackages}set usedPackages(e){this._usedPackages=e}get usedPackagesChange(){return this.usedPackagesSubject.asObservable()}constructor(e){this.storageName=e,this._usedPackages=[],this.initSubscriptions=new n.w0,this.usedPackagesSubject=new o.x,this.packagesChangeSubject=new o.x,this.store=(0,s.f3)(i.T0),this.packageSources=(0,s.f3)(c.BG),this.usedPackages=this.store.get(e)??[];for(const e of this.packageSources)this.initSubscriptions.add(e.packagesChange.subscribe((()=>this.packagesChangeSubject.next())))}setUsedPackages(e){this._usedPackages!=e&&(this._usedPackages=e,this.store.set(this.storageName,e),this.usedPackagesSubject.next())}refresh(){for(const e of this.packageSources)e.refresh()}destroy(){this.initSubscriptions.unsubscribe()}}}}]);
//# sourceMappingURL=3002.chunk.90299a527e3409adecd7.js.map