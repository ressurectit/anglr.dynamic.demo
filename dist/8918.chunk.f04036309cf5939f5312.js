/*! For license information please see 8918.chunk.f04036309cf5939f5312.js.LICENSE.txt */
"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[8918],{31166:(e,t,a)=>{a.d(t,{d:()=>i});var s=a(17505),n=a(38327);class i extends s.L{constructor(){super("RELATIONS_PACKAGES_STORE")}}i.ɵfac=function(e){return new(e||i)},i.ɵprov=n.Yz({token:i,factory:i.ɵfac})},71674:(e,t,a)=>{a.d(t,{Y:()=>ae});var s=a(65252),n=a(94499),i=a(77842),o=a(38327);class r{}r.ɵfac=function(e){return new(e||r)},r.ɵmod=i.oA({type:r}),r.ɵinj=o.cJ({providers:[n.v],imports:[s.Z]});var c=a(44155),d=a(49891),u=a(23199),l=a(2032),g=a(27052),p=a(46480),m=a(57466),h=a(45069),f=a(49414),k=a(91861);class v{transform(e,t,a,s){return{metadata:{id:a?e.itemSource.name:`${e.itemSource.name}-${t}`,displayName:a?e.metadata.displayName||e.itemSource.name:void 0,package:e.itemSource.package,name:e.itemSource.name,scope:s,relationsOptions:(0,m.l7)(!0,{},e.metadata.metaInfo?.defaultOptions),outputs:[],nodeMetadata:{scopeConfigurable:!a??!1,coordinates:{x:0,y:0},options:null}}}}}v.ɵfac=function(e){return new(e||v)},v.ɵpipe=i.Yj({name:"toRelationsDragData",type:v,pure:!0,standalone:!0});var b=a(80827),y=a(41853),_=a(6845),D=a(66794),P=a(6427),S=a(79440),w=a(68961),x=a(72891),I=a(85320),O=a(82568),C=a(15686),L=a(73301),N=a(17505),Y=a(48397),M=a(74419),T=a(21651);function Z(e,t,a,s,n,i,o){try{var r=e[i](o),c=r.value}catch(e){return void a(e)}r.done?t(c):Promise.resolve(c).then(s,n)}function q(e,t){if(1&e&&(b.Tg(0,"div",2),y._(1),b.qZ()),2&e){const e=_.o();D.x(1),P.Oq(null==e.data.metadata.metaInfo?null:e.data.metadata.metaInfo.description)}}class F{constructor(e,t,a,s,n){this._changeDetector=e,this.packageManager=t,this._metadataManager=a,this._cdkDrag=s,this._logger=n,this.initSubscriptions=new u.w0,this.used=!1}ngOnInit(){var e,t=this;return(e=function*(){for(const e in t._metadataManager.nodes)if(t.data?.itemSource?.name===e){t._setUsed(!0);break}t.initSubscriptions.add(t._metadataManager.nodeRegisterChange.subscribe((e=>{e.id===t.data?.itemSource?.name&&t._setUsed(!0)}))),t.initSubscriptions.add(t._metadataManager.nodeUnregisterChange.subscribe((e=>{e.id===t.data?.itemSource?.name&&t._setUsed(!1)})))},function(){var t=this,a=arguments;return new Promise((function(s,n){var i=e.apply(t,a);function o(e){Z(i,s,n,o,r,"next",e)}function r(e){Z(i,s,n,o,r,"throw",e)}o(void 0)}))})()}ngOnDestroy(){this.initSubscriptions.unsubscribe()}_setUsed(e){this.used=e,this._cdkDrag&&(this._cdkDrag.disabled=e),this._changeDetector.markForCheck()}focusNode(){this.used&&this.data?.metadata?.singleton&&this._metadataManager.setActiveNode(this.data?.itemSource?.name)}}F.ɵfac=function(e){return new(e||F)(S.Y(w.s),S.Y(N.L),S.Y(Y.J),S.Y(M.Z,8),S.Y(p.bZ,8))},F.ɵcmp=i.Xp({type:F,selectors:[["nodes-palette-item"]],hostVars:2,hostBindings:function(e,t){1&e&&x.N("dblclick",(function(){return t.focusNode()})),2&e&&I.ek("used",t.used)},inputs:{data:"data"},standalone:!0,features:[O.j],decls:3,vars:2,consts:[[1,"editor-component-name"],["class","editor-component-description",4,"ngIf"],[1,"editor-component-description"]],template:function(e,t){if(1&e&&(b.Tg(0,"div",0),y._(1),b.qZ(),C.Y(2,q,2,1,"div",1)),2&e){let e;D.x(1),P.Oq(t.data.metadata.singleton?t.data.metadata.displayName||t.data.itemSource.name:null!==(e=null==t.data.metadata.metaInfo?null:t.data.metadata.metaInfo.name)&&void 0!==e?e:t.data.itemSource.name),D.x(1),L.Q("ngIf",null==t.data.metadata.metaInfo?null:t.data.metadata.metaInfo.description)}},dependencies:[g.e,T.O],encapsulation:2,changeDetection:0});var A=a(84773),j=a(43870),Q=a(65589),U=a(4477),R=a(12311),$=a(32434),E=a(99055);function V(e,t,a,s,n,i,o){try{var r=e[i](o),c=r.value}catch(e){return void a(e)}r.done?t(c):Promise.resolve(c).then(s,n)}function K(e){return function(){var t=this,a=arguments;return new Promise((function(s,n){var i=e.apply(t,a);function o(e){V(i,s,n,o,r,"next",e)}function r(e){V(i,s,n,o,r,"throw",e)}o(void 0)}))}}function X(e,t){if(1&e){const e=A.E();b.Tg(0,"div",4)(1,"nodes-palette-item",5),x.N("cdkDragDropped",(function(){j.CH(e);const t=_.o(2);return j.Kt(t.generateNewId())})),Q.AL(2,"toRelationsDragData"),b.qZ()()}if(2&e){const e=t.$implicit,a=_.o(2);L.Q("cdkDropListConnectedTo",a.canvasDropList),D.x(1),L.Q("data",e)("cdkDragData",Q.tD(2,3,e,a.newCompnentId,e.metadata.singleton,e.metadata.scope))}}function J(e,t){if(1&e&&(U.yn(0),b.Tg(1,"div",2),y._(2),b.qZ(),C.Y(3,X,3,8,"div",3),U.BQ()),2&e){const e=t.$implicit;D.x(2),P.hi("",e.key," "),D.x(1),L.Q("ngForOf",e.value)}}class z{constructor(e,t,a,s,n,i,o){this._moduleTypesLoader=e,this._nodesLoader=t,this._changeDetector=a,this.packageManager=s,this._metadataManager=n,this._refreshObservables=i,this._logger=o,this.initSubscriptions=new u.w0,this.allItems=[],this.groupedItems={},this.newCompnentId=(0,m.Ox)(16),this.isDragOverPalette=!1}ngOnInit(){var e=this;return K((function*(){if(e._refreshObservables&&Array.isArray(e._refreshObservables))for(const t of e._refreshObservables)e.initSubscriptions.add(t.subscribe((()=>e.loadNodes())));e.initSubscriptions.add(e.packageManager.usedPackagesChange.subscribe((()=>e.loadNodes()))),yield e.loadNodes()}))()}ngOnDestroy(){this.initSubscriptions.unsubscribe()}loadNodes(){var e=this;return K((function*(){var t;e.allItems=[],e.groupedItems={};for(const t of e.packageManager.usedPackages){const a=(yield e._moduleTypesLoader.loadItem({package:t,name:"types"}))?.data??[];for(const s of a){const a={package:t,name:s},n=yield e._nodesLoader.loadItem(a);n?e.allItems.push({itemSource:a,metadata:n}):e._logger?.warn("NodesPaletteSAComponent: Failed to obtain layout editor metadata {@source}",a)}}e.groupedItems[""]=[];for(const a of e.allItems){const s=a.metadata.metaInfo?.group??"";(t=e.groupedItems)[s]??(t[s]=[]),e.groupedItems[s].push(a)}e._changeDetector.detectChanges()}))()}generateNewId(){this.newCompnentId=(0,m.Ox)(16)}}z.ɵfac=function(e){return new(e||z)(S.Y(k.Bj),S.Y(k.fI),S.Y(w.s),S.Y(N.L),S.Y(Y.J),S.Y(k.dK,8),S.Y(p.bZ,8))},z.ɵcmp=i.Xp({type:z,selectors:[["nodes-palette"]],inputs:{canvasDropList:"canvasDropList"},standalone:!0,features:[O.j],decls:3,vars:3,consts:[[1,"dynamic-flex-column"],[4,"ngFor","ngForOf"],[1,"dynamic-text-spread","dynamic-text-small-caps","dynamic-margin-left-extra-small","dynamic-margin-horizontal-small","dynamic-bold"],["cdkDropList","","cdkDropListSortingDisabled","","class","palette-droplist",3,"cdkDropListConnectedTo",4,"ngFor","ngForOf"],["cdkDropList","","cdkDropListSortingDisabled","",1,"palette-droplist",3,"cdkDropListConnectedTo"],["cdkDrag","",1,"editor-component","mat-elevation-z2",3,"data","cdkDragData","cdkDragDropped"]],template:function(e,t){1&e&&(b.Tg(0,"div",0),C.Y(1,J,4,2,"ng-container",1),Q.AL(2,"keyvalue"),b.qZ()),2&e&&(D.x(1),L.Q("ngForOf",Q.lc(2,1,t.groupedItems)))},dependencies:[g.e,R.s,$.N,r,E.W,M.Z,v,F],encapsulation:2,changeDetection:0}),(0,l.gn)([(0,h.C)(10),(0,f.S)(),(0,l.w6)("design:type",Function),(0,l.w6)("design:paramtypes",[]),(0,l.w6)("design:returntype",Promise)],z.prototype,"loadNodes",null);var B=a(18745),G=a(55436),H=a(36973),W=a(11282),ee=a(56454),te=a(6535);class ae{constructor(e,t,a){this.history=e,this.changeDetector=t,this.hotkeys=a,this.initSubscriptions=new u.w0,this.metadata=[],a?.init()}ngOnInit(){this.initSubscriptions.add(this.history.pop.subscribe((e=>{this.metadata=e,this.changeDetector.detectChanges()}))),this.hotkeys&&(this.initSubscriptions.add(this.hotkeys.undo.subscribe((()=>this.history.undo()))),this.initSubscriptions.add(this.hotkeys.redo.subscribe((()=>this.history.redo()))))}ngOnChanges(e){(0,d.$)("metadata")in e&&(this.history.clean(),this.metadata&&this.history.setInitialState(this.metadata))}ngOnDestroy(){this.initSubscriptions.unsubscribe(),this.hotkeys?.destroy()}addNode(e){if(e.item.data.metadata.nodeMetadata?.coordinates){const t=this.relationCanvas?.getPositionInCanvas(e.dropPoint);t&&(e.item.data.metadata.nodeMetadata.coordinates.x=t.x,e.item.data.metadata.nodeMetadata.coordinates.y=t.y)}this.metadata=[...this.metadata,e.item.data.metadata],this.history.getNewState()}}ae.ɵfac=function(e){return new(e||ae)(S.Y(k.nR),S.Y(w.s),S.Y(ee.z,8))},ae.ɵcmp=i.Xp({type:ae,selectors:[["relations-editor"]],viewQuery:function(e,t){if(1&e&&G.Gf(B.F,5),2&e){let e;G.iG(e=G.CR())&&(t.relationCanvas=e.first)}},inputs:{metadata:"metadata"},standalone:!0,features:[H.T,O.j],decls:6,vars:2,consts:[[1,"dynamic-flex-row","dynamic-flex-1"],[1,"overflow-vertical-scroll","dynamic-thin-scrollbar"],[2,"width","250px",3,"canvasDropList"],["cdkDropList","",1,"dynamic-flex-1",3,"nodeDefinitions","cdkDropListDropped"],["dropList","cdkDropList"]],template:function(e,t){if(1&e&&(b.Tg(0,"div",0)(1,"div",1),b._U(2,"package-manager")(3,"nodes-palette",2),b.qZ(),b.Tg(4,"relations-canvas",3,4),x.N("cdkDropListDropped",(function(e){return t.addNode(e)})),b.qZ()()),2&e){const e=W.M(5);D.x(3),L.Q("canvasDropList",e),D.x(1),L.Q("nodeDefinitions",t.metadata)}},dependencies:[z,B.F,r,E.W,c.F,te.X],styles:["[_nghost-%COMP%]{display: flex;}"],changeDetection:0})},22654:(e,t,a)=>{a.d(t,{Y:()=>r});var s=a(71674),n=a(47432),i=a(77842),o=a(38327);class r{static withProviders(){return{ngModule:r,providers:[(0,n.TN)()]}}static withStaticComponents(e){return{ngModule:r,providers:[(0,n.hE)(e)]}}}r.ɵfac=function(e){return new(e||r)},r.ɵmod=i.oA({type:r}),r.ɵinj=o.cJ({imports:[s.Y]})},89402:(e,t,a)=>{function s(e){return!!e.__ɵɵRelationsComponent}function n(){return function(e){return e.__ɵɵRelationsComponent=!0,e}}a.d(t,{H:()=>n,O:()=>s})},6535:(e,t,a)=>{a.d(t,{X:()=>w});var s=a(80827),n=a(41853),i=a(73301),o=a(66794),r=a(6427),c=a(84773),d=a(72891),u=a(43870),l=a(6845),g=a(15686),p=a(11282),m=a(79440),h=a(77842),f=a(85320),k=a(17505),v=a(12311),b=a(21651),y=a(24881),_=a(17790);function D(e,t){if(1&e&&(s.Tg(0,"option",11),n._(1),s.qZ()),2&e){const e=t.$implicit;i.Q("value",e),o.x(1),r.Oq(e)}}function P(e,t){if(1&e){const e=c.E();s.Tg(0,"div",12)(1,"div",13),n._(2),s.qZ(),s.Tg(3,"button",8),d.N("click",(function(){const t=u.CH(e).$implicit,a=l.o(2);return u.Kt(a.removePackage(t))})),s._U(4,"span",14),s.qZ()()}if(2&e){const e=t.$implicit;o.x(2),r.Oq(e)}}function S(e,t){if(1&e){const e=c.E();s.Tg(0,"div")(1,"div",0)(2,"select",5,6),g.Y(4,D,2,2,"option",7),s.qZ(),s.Tg(5,"button",8),d.N("click",(function(){u.CH(e);const t=p.M(3),a=l.o();return u.Kt(a.addPackage(a.availablePackages[t.selectedIndex]))})),s._U(6,"span",9),s.qZ()(),g.Y(7,P,5,1,"div",10),s.qZ()}if(2&e){const e=l.o();o.x(4),i.Q("ngForOf",e.availablePackages),o.x(3),i.Q("ngForOf",e.usedPackages)}}class w{constructor(e){this.packageManager=e,this.detailVisible=!1,this.usedPackages=[],this.availablePackages=[]}ngOnInit(){this.usedPackages=this.packageManager.usedPackages,this.updatedAvailablePackages()}addPackage(e){e&&(this.usedPackages=[...this.usedPackages,e],this.updatedAvailablePackages(),this.packageManager.setUsedPackages(this.usedPackages))}removePackage(e){this.usedPackages=this.usedPackages.filter((t=>t!=e)),this.updatedAvailablePackages(),this.packageManager.setUsedPackages(this.usedPackages)}updatedAvailablePackages(){this.availablePackages=this.packageManager.packages.filter((e=>!this.usedPackages.find((t=>t==e))))}}w.ɵfac=function(e){return new(e||w)(m.Y(k.L))},w.ɵcmp=h.Xp({type:w,selectors:[["package-manager"]],decls:6,vars:5,consts:[[1,"dynamic-flex-row"],["type","button",1,"dynamic-btn-icon","dynamic-margin-right-extra-small",3,"click"],[1,"fas"],[1,"pm-header"],[4,"ngIf"],[1,"dynamic-form-control","dynamic-flex-1"],["avPkgs",""],[3,"value",4,"ngFor","ngForOf"],["type","button",1,"dynamic-btn-icon","dynamic-margin-left-extra-small",3,"click"],[1,"fas","fa-plus"],["class","dynamic-flex-row dynamic-align-items-center dynamic-margin-top-small",4,"ngFor","ngForOf"],[3,"value"],[1,"dynamic-flex-row","dynamic-align-items-center","dynamic-margin-top-small"],[1,"dynamic-flex-1"],[1,"fas","fa-times"]],template:function(e,t){1&e&&(s.Tg(0,"div",0)(1,"button",1),d.N("click",(function(){return t.detailVisible=!t.detailVisible})),s._U(2,"span",2),s.qZ(),s.Tg(3,"div",3),n._(4,"packages"),s.qZ()(),g.Y(5,S,8,2,"div",4)),2&e&&(o.x(2),f.ek("fa-plus",!t.detailVisible)("fa-minus",t.detailVisible),o.x(3),i.Q("ngIf",t.detailVisible))},dependencies:[v.s,b.O,y.YN,_.Kr],encapsulation:2,changeDetection:0})},44155:(e,t,a)=>{a.d(t,{F:()=>r});var s=a(27052),n=a(48659),i=a(77842),o=a(38327);class r{}r.ɵfac=function(e){return new(e||r)},r.ɵmod=i.oA({type:r}),r.ɵinj=o.cJ({imports:[s.e,n.U]})},17505:(e,t,a)=>{a.d(t,{L:()=>c});var s=a(11776),n=a(46480),i=a(23199),o=a(86463),r=a(13457);class c{constructor(e){this.storageName=e,this._usedPackages=[],this.initSubscriptions=new i.w0,this.usedPackagesSubject=new o.x,this.packagesChangeSubject=new o.x,this.store=(0,s.f3)(n.T0),this.packageSources=(0,s.f3)(r.BG),this.usedPackages=this.store.get(e)??[];for(const e of this.packageSources)this.initSubscriptions.add(e.packagesChange.subscribe((()=>this.packagesChangeSubject.next())))}get packagesChange(){return this.packagesChangeSubject.asObservable()}get packages(){const e=[];for(const t of this.packageSources)e.push(...t.packages);return e}get usedPackages(){return this._usedPackages}set usedPackages(e){this._usedPackages=e}get usedPackagesChange(){return this.usedPackagesSubject.asObservable()}setUsedPackages(e){this._usedPackages!=e&&(this._usedPackages=e,this.store.set(this.storageName,e),this.usedPackagesSubject.next())}refresh(){for(const e of this.packageSources)e.refresh()}destroy(){this.initSubscriptions.unsubscribe()}}}}]);
//# sourceMappingURL=8918.chunk.f04036309cf5939f5312.js.map