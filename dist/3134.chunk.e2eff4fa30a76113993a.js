"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[3134],{50267:(t,e,n)=>{n.d(e,{O:()=>Q});var i=n(27052),o=n(46480),r=n(23199),a=n(57466),s=n(77842);class d{transform(t){return{metadata:{id:"",displayName:"",package:t.itemSource.package,name:t.itemSource.name,options:(0,a.l7)(!0,{},t.metadata.metaInfo?.defaultOptions)},parentId:null,index:null}}}d.ɵfac=function(t){return new(t||d)},d.ɵpipe=s.Yj({name:"toLayoutDragData",type:d,pure:!0,standalone:!0});var c=n(71785),l=n(10219),p=n(80827),h=n(41853),g=n(6845),u=n(66794),m=n(6427),f=n(84773),v=n(72891),C=n(43870),b=n(65589),_=n(15686),y=n(73301),D=n(4477),x=n(79440),w=n(68961),P=n(82568),I=n(17505),O=n(85902),E=n(12311),M=n(21651),S=n(32434),T=n(74445),F=n(4905),Y=n(88364),k=n(48759),z=n(98906),N=n(52053);class A{constructor(t,e,n,i,o){this.dnd=t,this.paletteItemElement=e,this.draggingSvc=n,this.bus=i,this.zone=o,this.initSubscriptions=new r.w0,this.drag=this.dnd.dragSource("METADATA",{beginDrag:()=>{this.draggingSvc.setDragging(!0);const t=(0,a.l7)(!0,{},this.dragData);if(t.metadata){const e=`${t.metadata.name}-${(0,a.Ox)(16)}`;t.metadata.id=e,t.metadata.displayName=e}return{dragData:t}},endDrag:t=>{if(t.didDrop()){const e=t.getItem(),n=t.getDropResult();if(!e)return;e.dragData.index=n.index,this.bus.setDropData({data:e.dragData,id:n.id}),this.itemDrop.emit()}this.bus.setDropPlaceholderPreview(null),this.draggingSvc.setDragging(!1)}},this.initSubscriptions),this.itemDrop=new T.v,this.connectDragToItem()}ngOnInit(){if(!this.dragData)throw new Error("DndCoreDesignerDirective: missing drag data!")}ngOnDestroy(){this.initSubscriptions.unsubscribe(),this.itemConnection?.unsubscribe(),this.itemConnection=null}connectDragToItem(){this.zone.runOutsideAngular((()=>{this.itemConnection?.unsubscribe(),this.itemConnection=this.drag.connectDragSource(this.paletteItemElement.nativeElement,{dropEffect:"copy"})}))}}function R(t,e,n,i,o,r,a){try{var s=t[r](a),d=s.value}catch(t){return void n(t)}s.done?e(d):Promise.resolve(d).then(i,o)}function Z(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var r=t.apply(e,n);function a(t){R(r,i,o,a,s,"next",t)}function s(t){R(r,i,o,a,s,"throw",t)}a(void 0)}))}}function L(t,e){if(1&t&&(p.Tg(0,"div",8),h._(1),p.qZ()),2&t){const t=g.o().$implicit;u.x(1),m.Oq(null==t.metadata.metaInfo?null:t.metadata.metaInfo.description)}}function q(t,e){if(1&t){const t=f.E();p.Tg(0,"div",4)(1,"div",5),v.N("itemDrop",(function(){C.CH(t);const e=g.o(2);return C.Kt(e.refreshPipe=!e.refreshPipe)})),b.AL(2,"toLayoutDragData"),p.Tg(3,"div",6),h._(4),p.qZ(),_.Y(5,L,2,1,"div",7),p.qZ()()}if(2&t){const t=e.$implicit;let n;u.x(1),y.Q("dndCorePaletteItem",b.lc(2,3,t)),u.x(3),m.Oq(null!==(n=null==t.metadata.metaInfo?null:t.metadata.metaInfo.name)&&void 0!==n?n:t.itemSource.name),u.x(1),y.Q("ngIf",null==t.metadata.metaInfo?null:t.metadata.metaInfo.description)}}function j(t,e){if(1&t&&(D.yn(0),p.Tg(1,"div",2),h._(2),p.qZ(),_.Y(3,q,6,5,"div",3),D.BQ()),2&t){const t=e.$implicit;u.x(2),m.hi("",t.key," "),u.x(1),y.Q("ngForOf",t.value)}}A.ɵfac=function(t){return new(t||A)(x.Y(k.f),x.Y(F.SB),x.Y(z.z),x.Y(N.E),x.Y(Y.R))},A.ɵdir=s.lG({type:A,selectors:[["","dndCorePaletteItem",""]],inputs:{dragData:["dndCorePaletteItem","dragData"]},outputs:{itemDrop:"itemDrop"}});class Q{constructor(t,e,n,i,o,a){this.moduleTypesLoader=t,this.changeDetector=e,this.packageManager=n,this.metadataExtractor=i,this._refreshObservables=o,this.logger=a,this.initSubscriptions=new r.w0,this.allItems=[],this.groupedItems={},this.refreshPipe=!1}ngOnInit(){var t=this;return Z((function*(){if(t.initSubscriptions.add(t.packageManager.usedPackagesChange.subscribe((()=>t.initItems()))),t._refreshObservables&&Array.isArray(t._refreshObservables))for(const e of t._refreshObservables)t.initSubscriptions.add(e.subscribe((()=>t.initItems())));yield t.initItems()}))()}ngOnDestroy(){this.initSubscriptions.unsubscribe()}initItems(){var t=this;return Z((function*(){var e;t.groupedItems={},t.allItems=[];for(const e of t.packageManager.usedPackages){const n=(yield t.moduleTypesLoader.loadItem({package:e,name:"types"}))?.data??[];for(const i of n){const n={package:e,name:i},o=yield t.metadataExtractor.extractMetadata(n);o?t.allItems.push({itemSource:n,metadata:o}):t.logger?.warn("ComponentsPaletteSAComponent: Failed to obtain layout editor metadata {@source}",n)}}t.groupedItems[""]=[];for(const n of t.allItems){const i=n.metadata.metaInfo?.group??"";(e=t.groupedItems)[i]??(e[i]=[]),t.groupedItems[i].push(n)}t.changeDetector.detectChanges()}))()}}Q.ɵfac=function(t){return new(t||Q)(x.Y(c.QT),x.Y(w.s),x.Y(I.L),x.Y(O.T),x.Y(c.dK,8),x.Y(o.bZ,8))},Q.ɵcmp=s.Xp({type:Q,selectors:[["components-palette"]],standalone:!0,features:[P.j],decls:3,vars:3,consts:[[1,"flex-column"],[4,"ngFor","ngForOf"],[1,"text-spread","text-small-caps","margin-left-extra-small","margin-horizontal-small","bold"],["class","palette-droplist",4,"ngFor","ngForOf"],[1,"palette-droplist"],[1,"editor-component","mat-elevation-z2",3,"dndCorePaletteItem","itemDrop"],[1,"editor-component-name"],["class","editor-component-description",4,"ngIf"],[1,"editor-component-description"]],template:function(t,e){1&t&&(p.Tg(0,"div",0),_.Y(1,j,4,2,"ng-container",1),b.AL(2,"keyvalue"),p.qZ()),2&t&&(u.x(1),y.Q("ngForOf",b.lc(2,1,e.groupedItems)))},dependencies:[i.e,E.s,M.O,S.N,l.N,A,d],styles:[".editor-component[_ngcontent-%COMP%]\n{\n    margin: 2px 10px;\n    padding: 4px 8px;\n\n    border-radius: 6px;\n    border: 1px solid #F0F0F0;\n    background-color: #FAFAFA;\n}\n\n.editor-component-name[_ngcontent-%COMP%]\n{\n    font-weight: 500;\n}\n\n.editor-component-description[_ngcontent-%COMP%]\n{\n    margin-left: 4px;\n    margin-top: 2px;\n    font-size: .8em;\n}\n\n.palette-droplist[_ngcontent-%COMP%]   layout-editor-drag-placeholder[_ngcontent-%COMP%]\n{\n    display: none;\n}"],changeDetection:0})},57862:(t,e,n)=>{n.d(e,{D:()=>st});var i=n(27052),o=n(63789),r=n(23199),a=n(98906),s=n(2032),d=n(45069),c=n(49414),l=n(17868),p=n(98246),h=n(10219),g=n(27173),u=n(80827),m=n(6845),f=n(73301),v=n(66794),C=n(79440),b=n(68961),_=n(77842),y=n(55436),D=n(72891),x=n(82568),w=n(15686),P=n(41853),I=n(11282),O=n(94727),E=n(86357),M=n(85320),S=n(6427),T=n(83434),F=n(26938),Y=n(43649),k=n(12311),z=n(21651),N=n(41623),A=n(44214),R=n(74445),Z=n(65508),L=n(48936),q=n(43939),j=n(27049),Q=n(16114),B=n(63685),$=n(4905),X=n(88364),G=n(95176),U=n(73379),H=n(48759),K=n(52053);class V{constructor(t,e,n,i,o,a,s,d,c){this.dnd=t,this.designerElement=e,this.draggingSvc=n,this.manager=i,this.bus=o,this.zone=a,this.injector=s,this._manager=d,this.document=c,this.initSubscriptions=new r.w0,this.placeholderDrop=this.dnd.dropTarget(["TREE_COMPONENT"],{canDrop:()=>!0,drop:t=>{const e=t.getItem();let n=this.bus.dropPlaceholderPreviewIndex;return e&&(0,q.EN)(e.dragData.index)&&(0,q.EN)(n)&&n>e.dragData.index&&n--,{index:n,id:this.metadata?.id}}},this.initSubscriptions),this.containerDrop=this.dnd.dropTarget(["TREE_COMPONENT"],{canDrop:t=>this.canDropAncestors(this.metadata.id,t.getItem()?.dragData.metadata?.id)[0]&&t.isOver({shallow:!0}),drop:t=>{const[e,n]=this.getFixedDropCoordinates(t,!1);return{index:e,id:n}},hover:t=>{if(t.isOver({shallow:!0})){const[e,n]=this.getDropCoordinates(t,!1);if((0,q.fp)(e)||(0,q.fp)(n))return;this.bus.setDropPlaceholderPreview({index:e,parentId:n,placeholder:{height:0,width:0}})}}},this.initSubscriptions),this.drag=this.dnd.dragSource("TREE_COMPONENT",{beginDrag:()=>(this.draggingSvc.setDragging(!0),this.designerElement.nativeElement.classList.add("is-dragged"),{dragData:this.dragData}),canDrag:()=>!this.dragDisabled,endDrag:t=>{if(this.designerElement.nativeElement.classList.remove("is-dragged"),t.didDrop()){const e=t.getItem(),n=t.getDropResult();if(!e)return;e.dragData.index=n.index,this.bus.setDropData({data:e.dragData,id:n.id})}this.bus.setDropPlaceholderPreview(null),this.draggingSvc.setDragging(!1)}},this.initSubscriptions),this.dropzone=this.dnd.dropTarget(["TREE_COMPONENT"],{canDrop:t=>(this.canDrop&&!this.hasAncestor(this.metadata.id,t.getItem()?.dragData.metadata?.id)||this.canDropAncestors(this.metadata.id,t.getItem()?.dragData.metadata?.id)[0])&&t.isOver({shallow:!0}),drop:t=>{const[e,n]=this.getFixedDropCoordinates(t,this.canDrop);return{index:e,id:n}},hover:t=>{if(t.isOver({shallow:!0})&&(this._manager.dragOverComponent(this.metadata.id),t.canDrop())){const[e,n]=this.getDropCoordinates(t,this.canDrop);if((0,q.fp)(e)||(0,q.fp)(n))return;this.bus.setDropPlaceholderPreview({index:e,parentId:n,placeholder:{height:0,width:0}})}}},this.initSubscriptions),this.dragDisabled=!1,this.dropMetadata=new R.v,this.connectDropToContainer()}get metadata(){if(!this.dragData.metadata)throw new Error("DndCoreTreeItemDirective: invalid drag data without metadata!");return this.dragData.metadata}get canDrop(){return this.manager.getComponent(this.metadata.id)?.canDrop??!1}ngOnInit(){if(!this.dropzoneElement)throw new Error("DndCoreDesignerDirective: missing dropzone element!");if(!this.containerElement)throw new Error("DndCoreDesignerDirective: missing container element!");if(!this.dragData)throw new Error("DndCoreDesignerDirective: missing drag data!");this.initSubscriptions.add(this.bus.dropDataChange.pipe((0,Q.h)((t=>t.id===this.metadata.id))).subscribe((t=>this.dropMetadata.emit(t.data)))),this.initSubscriptions.add(this.bus.oldDropPlaceholderPreviewChange.pipe((0,Q.h)((t=>t.parentId===this.metadata.id))).subscribe((()=>{this.placeholderPreviewElement?.remove(),this.placeholderPreviewElement=null}))),this.initSubscriptions.add(this.bus.newDropPlaceholderPreviewChange.pipe((0,Q.h)((t=>t.parentId===this.metadata.id))).subscribe(this.showPlaceholderPreview))}ngOnDestroy(){this.initSubscriptions.unsubscribe(),this.placeholderConnection?.unsubscribe(),this.placeholderConnection=null,this.containerConnection?.unsubscribe(),this.containerConnection=null}registerPreviewElement(t){return this.drag.connectDragPreview(t,{offsetX:0,offsetY:0})}getDropCoordinates(t,e){if(e)return this.getDropCoordinatesForChildren(t);const[n,i,o]=this.canDropAncestors(this.metadata.id,t.getItem()?.dragData.metadata?.id);if(!n||(0,q.fp)(i))return[null,null];const r=this.manager.getComponent(i),a=this.manager.getComponent(o)?.index??0,s=t.getItem();return s&&(0,q.EN)(s.dragData.index)&&s.dragData.metadata?.id===this.metadata.id?[s.dragData.index,s.dragData.parentId??""]:r?[a+this.getIndexIncrement(t),i]:[null,null]}getDropCoordinatesForChildren(t){const e=t=>{const e=t.children[0]?.getBoundingClientRect(),n=e?.y;return n+e?.height/2};if(!this.containerElement)return[null,null];let n=0;const i=t.getClientOffset();if(!i)return[null,null];const o=i.y;for(let t=0;t<this.containerElement.children.length;t++){const i=this.containerElement.children[t];if(!i.classList.contains("drag-placeholder")){if(o<=e(i))return[n,this.metadata.id];n++}}return[n,this.metadata.id]}getFixedDropCoordinates(t,e){const[n,i]=this.getDropCoordinates(t,e);let o=n;const r=t.getItem();return r&&(0,q.EN)(o)&&(0,q.EN)(r.dragData.index)&&i===r.dragData.parentId&&o>r.dragData.index&&o--,[o,i]}getIndexIncrement(t){const e=this.dropzoneElement.getBoundingClientRect(),n=t.getClientOffset();return n?n.y-e.y<=e.height/2?0:1:0}showPlaceholderPreview(t){this.containerElement&&(this.placeholderPreviewElement??(this.placeholderPreviewElement=this.document.createElement("div")),this.placeholderPreviewElement.classList.add("drag-placeholder"),this.placeholderPreviewElement.remove(),this.connectDropToPlaceholder(),this.containerElement.insertBefore(this.placeholderPreviewElement,this.containerElement.children[t.index]))}connectDropToPlaceholder(){this.zone.runOutsideAngular((()=>{this.placeholderConnection?.unsubscribe(),this.placeholderPreviewElement&&(this.placeholderConnection=this.placeholderDrop.connectDropTarget(this.placeholderPreviewElement))}))}connectDropToContainer(){this.zone.runOutsideAngular((()=>{this.containerConnection?.unsubscribe(),this.containerConnection=this.containerDrop.connectDropTarget(this.designerElement.nativeElement)}))}canDropAncestors(t,e){(0,q.fp)(t)&&(t=this.metadata.id);const n=this.manager.getComponentDef(t);return!n?.parent||(0,q.EN)(e)&&this.hasAncestor(n.component.id,e)?[!1,null,t]:n.parent.component.canDrop?[!0,n.parent.component.id,t]:this.canDropAncestors(n.parent.component.id,e)}hasAncestor(t,e){if(!e)return!1;const n=this.manager.getComponentDef(t);return n?.component?.id===e||!!n?.parent&&this.hasAncestor(n.parent.component?.id,e)}}function J(t,e,n,i,o,r,a){try{var s=t[r](a),d=s.value}catch(t){return void n(t)}s.done?e(d):Promise.resolve(d).then(i,o)}function W(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then((function(t){return{value:t,done:e}}))}return W=function(t){this.s=t,this.n=t.next},W.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return void 0===n?Promise.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return void 0===n?Promise.reject(t):e(n.apply(this.s,arguments))}},new W(t)}function tt(t,e){if(1&t&&u._U(0,"span",10),2&t){const t=m.o();f.Q("ngClass",t.open?"fa-chevron-down":"fa-chevron-right")}}function et(t,e){if(1&t&&(u.Tg(0,"div",11),u._U(1,"components-tree-item",12),u.qZ()),2&t){const t=e.$implicit,n=e.index,i=m.o();v.x(1),f.Q("data",t)("parentId",null==i.data?null:i.data.id)("index",n)}}V.ɵfac=function(t){return new(t||V)(C.Y(H.f),C.Y($.SB),C.Y(a.z),C.Y(T.t),C.Y(K.E),C.Y(X.R),C.Y(G.z),C.Y(T.t),C.Y(L.K))},V.ɵdir=_.lG({type:V,selectors:[["","dndCoreTreeItem",""]],inputs:{dropzoneElement:"dropzoneElement",containerElement:"containerElement",dragData:["dndCoreTreeItem","dragData"],dragDisabled:"dragDisabled"},outputs:{dropMetadata:"dropMetadata"},exportAs:["dndCoreTreeItem"],features:[U._([{provide:B.E,useExisting:(0,Z.Gp)((()=>V))}])]}),(0,s.gn)([j.r,(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[Object]),(0,s.w6)("design:returntype",void 0)],V.prototype,"showPlaceholderPreview",null);const nt=function(t,e,n){return{metadata:t,parentId:e,index:n}};class it{constructor(t,e,n,i){this._manager=t,this._changeDetector=e,this._draggingSvc=n,this.iteratorSvc=i,this._initSubscriptions=new r.w0,this.children=[],this.index=0,this.open=!0}get hasChildren(){return!!this.children&&this.children.length>0}get dragDisabled(){return!this.parentId||!this.data||!0===this._manager.getComponent(this.data.id)?.dragDisabled}ngOnInit(){this._initSubscriptions.add(this._manager.layoutChange.subscribe((()=>{this.initChildren()}))),this._initSubscriptions.add(this._manager.selectedChange.subscribe((()=>{this._changeDetector.detectChanges()}))),this._initSubscriptions.add(this._manager.highlightedChange.subscribe((()=>this._changeDetector.detectChanges()))),this._initSubscriptions.add(this._manager.displayNameChange.subscribe((()=>this._changeDetector.detectChanges()))),this._initSubscriptions.add(this._manager.draggedOverComponentChange.subscribe((()=>this._handleDragOver()))),this.initChildren()}ngOnDestroy(){this._initSubscriptions.unsubscribe()}toggle(){this.open=!this.open}expand(t){if(!t)return this.open=!0,!0;if(this.data?.id===t)return!0;if(this.hasChildren)for(const e of this._childrenNodes?.toArray())if(e.expand(t))return this.expand(),!0;return!1}addDescendant(t){this.data&&this._manager.getComponent(this.data.id)?.addDescendant(t)}expandAll(){this._childrenNodes?.forEach((t=>t.expandAll())),this.expand(),this._changeDetector.detectChanges()}collapse(){this.open=!1}collapseAll(){this._childrenNodes?.forEach((t=>t.collapseAll())),this.collapse(),this._changeDetector.detectChanges()}initChildren(){var t,e=this;return(t=function*(){if(e.children=[],e.data){var t,n=!1,i=!1;try{for(var o,r=function(t){var e,n,i,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,i=Symbol.iterator);o--;){if(n&&null!=(e=t[n]))return e.call(t);if(i&&null!=(e=t[i]))return new W(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}(e.iteratorSvc.getChildrenIteratorFor(e.data));n=!(o=yield r.next()).done;n=!1){const t=o.value;e.children.push(t.metadata)}}catch(e){i=!0,t=e}finally{try{n&&null!=r.return&&(yield r.return())}finally{if(i)throw t}}}e._changeDetector.detectChanges()},function(){var e=this,n=arguments;return new Promise((function(i,o){var r=t.apply(e,n);function a(t){J(r,i,o,a,s,"next",t)}function s(t){J(r,i,o,a,s,"throw",t)}a(void 0)}))})()}highlight(t,e){t.preventDefault(),t.stopPropagation(),this._manager.highlightComponent(e)}_handleDragOver(){if(this._manager.draggedOverComponent!=this.data?.id)return this.dragOverSubscription?.unsubscribe(),void(this.dragOverSubscription=null);this.open||(this.dragOverSubscription=(0,p.H)(500).subscribe((()=>{this.expand(),this._changeDetector.detectChanges()})))}_cancelHighlight(t){t.preventDefault(),t.stopPropagation(),this._manager.cancelHighlightedComponent()}}it.ɵfac=function(t){return new(t||it)(C.Y(T.t),C.Y(b.s),C.Y(a.z),C.Y(F.$))},it.ɵcmp=_.Xp({type:it,selectors:[["components-tree-item"]],viewQuery:function(t,e){if(1&t&&y.Gf(it,5),2&t){let t;y.iG(t=y.CR())&&(e._childrenNodes=t)}},hostBindings:function(t,e){1&t&&D.N("mouseleave",(function(t){return e._cancelHighlight(t)}))},inputs:{data:"data",index:"index",parentId:"parentId",open:"open"},exportAs:["componentsTreeItem"],standalone:!0,features:[x.j],decls:12,vars:22,consts:[[3,"dndCoreTreeItem","dropzoneElement","containerElement","dragDisabled","dragSource","dropMetadata"],["dndCoreTree","dndCoreTreeItem","dropzone",""],[1,"designer-dropzone",3,"dropTarget"],[1,"flex","align-items-center",3,"ngClass"],["type","button","mat-icon-button","",3,"disabled","click"],["class","fa",3,"ngClass",4,"ngIf"],[3,"mouseover","click"],[1,"node-children"],["childrenContainer",""],["class","node-child",4,"ngFor","ngForOf"],[1,"fa",3,"ngClass"],[1,"node-child"],[3,"data","parentId","index"]],template:function(t,e){if(1&t&&(u.Tg(0,"div",0,1),D.N("dropMetadata",(function(t){return e.addDescendant(t)})),u.Tg(3,"div",2)(4,"div",3)(5,"button",4),D.N("click",(function(){return e.toggle()})),w.Y(6,tt,1,1,"span",5),u.qZ(),u.Tg(7,"div",6),D.N("mouseover",(function(t){return e.highlight(t,null==e.data?null:e.data.id)}))("click",(function(){return e._manager.selectComponent(null==e.data?null:e.data.id)})),P._(8),u.qZ()(),u.Tg(9,"div",7,8),w.Y(11,et,2,3,"div",9),u.qZ()()()),2&t){const t=I.M(1),n=I.M(2),i=I.M(10);f.Q("dndCoreTreeItem",O.kE(18,nt,e.data,e.parentId,e.index))("dropzoneElement",n)("containerElement",i)("dragDisabled",e.dragDisabled)("dragSource",t.drag),v.x(3),f.Q("dropTarget",t.dropzone),v.x(1),f.Q("ngClass",e.hasChildren?"nested-node-tree":"node-tree"),v.x(1),f.Q("disabled",!e.hasChildren),E.u("aria-label","Toggle"),v.x(1),f.Q("ngIf",e.hasChildren),v.x(1),M.ek("selected",(null==e.data?null:e.data.id)===e._manager.selectedComponent)("highlighted",(null==e.data?null:e.data.id)===e._manager.highlightedComponent),v.x(1),S.Oq((null==e.data?null:e.data.displayName)||(null==e.data?null:e.data.id)),v.x(1),M.ek("hidden",!e.open),v.x(2),f.Q("ngForOf",e.children)}},dependencies:[it,i.e,Y.m,k.s,z.O,o.o,N.l,l.c8,A.$d,A.Li,h.N,V,g.c],styles:["[_nghost-%COMP%]\n{\n    display: block;\n}\n\n.highlighted[_ngcontent-%COMP%]\n{\n    text-shadow: 0 0 2px #666;\n}\n\n.selected[_ngcontent-%COMP%]\n{\n    text-shadow: 0 0 2px #009cd7;\n}\n\n.node-tree[_ngcontent-%COMP%], .nested-node-tree[_ngcontent-%COMP%]\n{\n    min-height: 48px;\n}\n\n.node-children[_ngcontent-%COMP%] \n{\n  padding-left: 40px;\n  min-height: 10px;\n}"],changeDetection:0}),(0,s.gn)([(0,d.C)(10),(0,c.S)(),(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[]),(0,s.w6)("design:returntype",Promise)],it.prototype,"initChildren",null);var ot=n(84773),rt=n(43870);function at(t,e){if(1&t){const t=ot.E();u.Tg(0,"div",1)(1,"button",2),D.N("click",(function(){rt.CH(t);const e=m.o();return rt.Kt(null==e.rootTreeItem?null:e.rootTreeItem.collapseAll())})),u._U(2,"span",3),u.qZ(),u.Tg(3,"button",4),D.N("click",(function(){rt.CH(t);const e=m.o();return rt.Kt(null==e.rootTreeItem?null:e.rootTreeItem.expandAll())})),u._U(4,"span",5),u.qZ(),u._U(5,"components-tree-item",6),u.qZ()}if(2&t){const t=m.o();v.x(5),f.Q("data",t.root)}}class st{constructor(t,e){this._manager=t,this._changeDetector=e,this._initSubscriptions=new r.w0}ngOnInit(){this._initSubscriptions.add(this._manager.layoutChange.subscribe((()=>{this.root=this._manager.getMetadata(),this._changeDetector.detectChanges()}))),this._initSubscriptions.add(this._manager.selectedChange.subscribe((()=>{this.rootTreeItem?.expand(this._manager.selectedComponent),this._changeDetector.detectChanges()}))),this._initSubscriptions.add(this._manager.highlightedChange.subscribe((()=>this._changeDetector.detectChanges()))),this._initSubscriptions.add(this._manager.displayNameChange.subscribe((()=>this._changeDetector.detectChanges()))),this.root=this._manager.getMetadata()}ngOnDestroy(){this._initSubscriptions.unsubscribe()}}st.ɵfac=function(t){return new(t||st)(C.Y(T.t),C.Y(b.s))},st.ɵcmp=_.Xp({type:st,selectors:[["components-tree"]],viewQuery:function(t,e){if(1&t&&y.Gf(it,5),2&t){let t;y.iG(t=y.CR())&&(e.rootTreeItem=t.first)}},standalone:!0,features:[U._([a.z,K.E]),x.j],decls:1,vars:1,consts:[["class","component-tree",4,"ngIf"],[1,"component-tree"],["type","button","mat-icon-button","","aria-label","Collapse all",3,"click"],[1,"fa","fa-minus-square"],["type","button","mat-icon-button","","aria-label","Expand all",3,"click"],[1,"fa","fa-plus-square"],[3,"data"]],template:function(t,e){1&t&&w.Y(0,at,6,1,"div",0),2&t&&f.Q("ngIf",e.root)},dependencies:[i.e,z.O,o.o,N.l,it],styles:["[_nghost-%COMP%]\n{\n    display: block;\n    background-color: #fafafa;\n    border-right: 1px solid #ccc;\n}"],changeDetection:0})},5574:(t,e,n)=>{n.d(e,{M:()=>lt});var i=n(2032),o=n(27052),r=n(70625),a=n(36910),s=n(46480),d=n(71791),c=n(14389),l=n(43939),p=n(57466),h=n(45069),g=n(49414),u=n(23199),m=n(39163),f=n(5348),v=n(77880),C=n(59951),b=n(77842),_=n(38327);class y{}y.ɵfac=function(t){return new(t||y)},y.ɵmod=b.oA({type:y}),y.ɵinj=_.cJ({imports:[o.e,m.z,C.i,v.j,f.A]});var D=n(71785),x=n(74445),w=n(48936),P=n(27049),I=n(79440),O=n(88364),E=n(72891);class M{constructor(t,e){this.document=t,this.ngZone=e,this.lastXCoordinate=null,this.size=new x.v}dragStart(t){this.ngZone.runOutsideAngular((()=>{this.document.addEventListener("mousemove",this.drag),this.document.addEventListener("mouseup",this.dragEnd)})),t.stopImmediatePropagation(),t.preventDefault(),this.lastXCoordinate=t.clientX}drag(t){(0,l.fp)(this.lastXCoordinate)||(this.size.emit(t.clientX-this.lastXCoordinate),t.stopImmediatePropagation(),t.preventDefault(),this.lastXCoordinate=t.clientX)}dragEnd(t){this.ngZone.runOutsideAngular((()=>{this.document.removeEventListener("mousemove",this.drag),this.document.removeEventListener("mouseup",this.dragEnd)})),t.stopImmediatePropagation(),t.preventDefault(),this.lastXCoordinate=null}}M.ɵfac=function(t){return new(t||M)(I.Y(w.K),I.Y(O.R))},M.ɵdir=b.lG({type:M,selectors:[["","widthResizer",""]],hostBindings:function(t,e){1&t&&E.N("mousedown",(function(t){return e.dragStart(t)}))},outputs:{size:"size"},standalone:!0}),(0,i.gn)([P.r,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[MouseEvent]),(0,i.w6)("design:returntype",void 0)],M.prototype,"drag",null),(0,i.gn)([P.r,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[MouseEvent]),(0,i.w6)("design:returntype",void 0)],M.prototype,"dragEnd",null);var S=n(84773),T=n(80827),F=n(43870),Y=n(6845),k=n(41853),z=n(4477),N=n(66794),A=n(73301),R=n(15686),Z=n(6427),L=n(85320),q=n(68961),j=n(73379),Q=n(82568),B=n(83434),$=n(85902),X=n(43671),G=n(12311),U=n(21651),H=n(49280),K=n(77470),V=n(27635),J=n(8215),W=n(36973);function tt(t,e,n,i,o,r,a){try{var s=t[r](a),d=s.value}catch(t){return void n(t)}s.done?e(d):Promise.resolve(d).then(i,o)}class et{constructor(t,e){this._viewContainerRef=t,this._logger=e,this._componentRef=null,this.propertiesMetadata=null}ngOnChanges(){var t,e=this;return(t=function*(){if(e._logger?.debug("PropertiesControlRendererDirective: rendering properties control {@type}",{type:e.type?.name}),e.ngOnDestroy(),e._viewContainerRef.clear(),e.type){const t=e._viewContainerRef.injector;if(e._componentRef=e._viewContainerRef.createComponent(e.type,{injector:t}),e._componentRef){const t=e._componentRef.instance;t.propertiesMetadata=e.propertiesMetadata,t.form=e.form,yield t.initialize(),t.invalidateVisuals()}}},function(){var e=this,n=arguments;return new Promise((function(i,o){var r=t.apply(e,n);function a(t){tt(r,i,o,a,s,"next",t)}function s(t){tt(r,i,o,a,s,"throw",t)}a(void 0)}))})()}ngOnDestroy(){this._componentRef&&(this._logger?.debug("PropertiesControlRendererDirective: destroying properties control {@type}",{type:this.type?.name}),this._componentRef?.destroy(),this._componentRef=null)}}function nt(t,e,n,i,o,r,a){try{var s=t[r](a),d=s.value}catch(t){return void n(t)}s.done?e(d):Promise.resolve(d).then(i,o)}function it(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var r=t.apply(e,n);function a(t){nt(r,i,o,a,s,"next",t)}function s(t){nt(r,i,o,a,s,"throw",t)}a(void 0)}))}}function ot(t,e){if(1&t){const t=S.E();T.Tg(0,"div",2)(1,"button",3),E.N("click",(function(){F.CH(t);const e=Y.o();return F.Kt(e.toggleCollapsed())})),T.Tg(2,"span",4),k._(3,"properties"),T.qZ()()()}}function rt(t,e){if(1&t&&(z.yn(0),z.Gk(1,18),z.BQ()),2&t){const t=e.$implicit,n=Y.o().$implicit;N.x(1),A.Q("propertiesControl",t)("form",n.form)("propertiesMetadata",n.metadata)}}function at(t,e){if(1&t&&(z.yn(0),R.Y(1,rt,2,3,"ng-container",17),z.BQ()),2&t){const t=e.$implicit;N.x(1),A.Q("ngForOf",t.controls)}}function st(t,e){if(1&t&&(z.yn(0),T.Tg(1,"div",11)(2,"div",12)(3,"label",13),k._(4,"type"),T.qZ(),T.Tg(5,"div",14),k._(6),T.qZ(),T.Tg(7,"label",13),k._(8,"id"),T.qZ(),T.Tg(9,"div",14),k._(10),T.qZ(),T.Tg(11,"label",13),k._(12,"display name"),T.qZ(),T._U(13,"input",15),T.qZ()(),T.Tg(14,"div",16),R.Y(15,at,2,1,"ng-container",17),T.qZ(),z.BQ()),2&t){const t=Y.o(2);let e;N.x(6),Z.Oq(null!==(e=null==t.metadata||null==t.metadata.metaInfo?null:t.metadata.metaInfo.name)&&void 0!==e?e:null==t.component.options||null==t.component.options.typeMetadata?null:t.component.options.typeMetadata.name),N.x(4),Z.Oq(null==t.component.options||null==t.component.options.typeMetadata?null:t.component.options.typeMetadata.id),N.x(3),A.Q("formControl",t.displayName),N.x(2),A.Q("ngForOf",t.propertiesData)}}function dt(t,e){if(1&t){const t=S.E();z.yn(0),T.Tg(1,"div",5)(2,"div",6)(3,"div",7),k._(4,"properties"),T.qZ(),T.Tg(5,"button",8),E.N("click",(function(){F.CH(t);const e=Y.o();return F.Kt(e.toggleCollapsed())})),T._U(6,"span",9),T.qZ()(),R.Y(7,st,16,4,"ng-container",1),T.qZ(),T.Tg(8,"div",10),E.N("size",(function(e){F.CH(t);const n=Y.o();return F.Kt(n.updateSize(e))})),T.qZ(),z.BQ()}if(2&t){const t=Y.o();N.x(1),L.Ud("width",t.state.width,"px"),N.x(6),A.Q("ngIf",t.component)}}et.ɵfac=function(t){return new(t||et)(I.Y(J.s_),I.Y(s.bZ,8))},et.ɵdir=b.lG({type:et,selectors:[["","propertiesControl",""]],inputs:{form:"form",propertiesMetadata:"propertiesMetadata",type:["propertiesControl","type"]},features:[W.T]});const ct="PROPERTIES_EDITOR_STATE";class lt{constructor(t,e,n,i,o,a,s,d){this.manager=t,this.metadataExtractor=e,this.propertyExtractor=n,this.formModelBuilder=i,this.changeDetector=o,this.storage=a,this.history=s,this.logger=d,this.initSubscriptions=new u.w0,this.optionsFormSubscription=null,this.lastComponentId=null,this.lastComponent=null,this.component=null,this.metadata=null,this.displayName=new r.NI(null),this.propertiesData=[],this.state={opened:!1,width:350}}ngOnInit(){var t=this;return it((function*(){const e=t.storage.get(ct);e&&(t.state=e),t.initSubscriptions.add(t.manager.layoutChange.subscribe((()=>t.initProperties()))),t.initSubscriptions.add(t.manager.selectedChange.subscribe((()=>t.initProperties()))),t.displayName.valueChanges.subscribe(function(){var e=it((function*(e){if(t.component?.options?.typeMetadata&&(0,l.EN)(e)){t.component.options.typeMetadata.displayName=e;const n={};(0,c.mv)(n,"options",t.component.options,t.component.options),t.component.options=t.component.options,yield t.component.ngOnChanges?.(n),t.manager.displayNameUpdated(),t.history.getNewState()}}));return function(t){return e.apply(this,arguments)}}()),yield t.initProperties()}))()}ngOnDestroy(){this.initSubscriptions.unsubscribe(),this.optionsFormSubscription?.unsubscribe(),this.optionsFormSubscription=null}toggleCollapsed(){this.state.opened=!this.state.opened,this.storage.set(ct,this.state)}updateSize(t){this.state.width-=t,this.storage.set(ct,this.state),this.changeDetector.detectChanges()}initProperties(){var t=this;return it((function*(){if((0,l.EN)(t.manager.selectedComponent)){const e=t.manager.getComponent(t.manager.selectedComponent);if(t.lastComponent==e&&t.lastComponentId==t.manager.selectedComponent)return;t.lastComponent=e,t.lastComponentId=t.manager.selectedComponent,e?(t.component=e,yield t.getMetadata()):t.hide()}else t.hide()}))()}getMetadata(){var t=this;return it((function*(){if(t.optionsFormSubscription?.unsubscribe(),t.optionsFormSubscription=new u.w0,t.propertiesData=[],t.component?.options?.typeMetadata){if(t.displayName.setValue(t.component.options.typeMetadata.displayName||t.component.options.typeMetadata.id,{emitEvent:!1}),t.metadata=yield t.metadataExtractor.extractMetadata(t.component.options?.typeMetadata),t.metadata||(t.logger?.error("PropertiesEditorSAComponent: unable to get metadata {@source}",{package:t.component.options?.typeMetadata.package,name:t.component.options?.typeMetadata.name}),t.hide()),t.metadata?.metaInfo?.optionsMetadata?.propertiesMetadata?.length)for(const e of t.metadata?.metaInfo?.optionsMetadata?.propertiesMetadata)t.initDynamicProperty(e);if(t.component){const e=t.manager.getParent(t.component.id);if(e?.options?.typeMetadata){const n=yield t.metadataExtractor.extractMetadata(e.options?.typeMetadata);if(n?.metaInfo?.optionsMetadata?.childPropertiesMetadata?.length)for(const e of n?.metaInfo?.optionsMetadata?.childPropertiesMetadata)t.initDynamicProperty(e)}}}else t.hide();t.changeDetector.detectChanges()}))()}hide(){this.lastComponent=null,this.lastComponentId=null,this.component=null,this.metadata=null,this.propertiesData=[],this.optionsFormSubscription?.unsubscribe(),this.optionsFormSubscription=null,this.changeDetector.detectChanges()}initDynamicProperty(t){var e=this;const n=this.formModelBuilder.build(new t.modelType(this.component?.options?.typeMetadata.options)),i=this.propertyExtractor.extract(t.modelType);this.optionsFormSubscription&&(this.optionsFormSubscription.add(n.valueChanges.subscribe(function(){var t=it((function*(t){if(e.component?.options?.typeMetadata){(0,p.l7)(!0,e.component.options.typeMetadata.options,t);const n={};(0,c.mv)(n,"options",e.component.options,e.component.options),e.component.options=e.component.options,yield e.component.ngOnChanges?.(n),e.component.invalidateVisuals(),e.history.getNewState()}}));return function(e){return t.apply(this,arguments)}}())),this.propertiesData.push({form:n,metadata:i,controls:t.propertiesControls}))}}lt.ɵfac=function(t){return new(t||lt)(I.Y(B.t),I.Y($.T),I.Y(X.L),I.Y(d.p),I.Y(q.s),I.Y(s.T0),I.Y(D.dB),I.Y(s.bZ,8))},lt.ɵcmp=b.Xp({type:lt,selectors:[["properties-editor"]],standalone:!0,features:[j._([d.p]),Q.j],decls:2,vars:2,consts:[["class","properties-toolbar",4,"ngIf"],[4,"ngIf"],[1,"properties-toolbar"],["type","button",1,"btn-icon","props-buttons",3,"click"],[1,"text-vertical"],[1,"properties-main"],[1,"header"],[1,"header-title"],["type","button",1,"btn-icon",3,"click"],[1,"fas","fa-times"],["widthResizer","",1,"properties-resizer",3,"size"],[1,"static-properties"],[1,"properties-form-group"],[1,"properties-control-label"],[1,"properties-form-static"],["type","text",1,"properties-form-control",3,"formControl"],[1,"thin-scrollbar","properties-controls"],[4,"ngFor","ngForOf"],[3,"propertiesControl","form","propertiesMetadata"]],template:function(t,e){1&t&&(R.Y(0,ot,4,0,"div",0),R.Y(1,dt,9,3,"ng-container",1)),2&t&&(A.Q("ngIf",!e.state.opened),N.x(1),A.Q("ngIf",e.state.opened))},dependencies:[o.e,G.s,U.O,a.U,H.Fj,K.JJ,V.oH,y,et,M],styles:["[_nghost-%COMP%]\n{\n    display: grid;\n    grid-template-columns: 2px 2px auto;\n    grid-template-rows: auto;\n    position: relative;\n}\n\n.props-buttons[_ngcontent-%COMP%]\n{\n    width: 16px;\n}\n\n.properties-main[_ngcontent-%COMP%]\n{\n    display: flex;\n    flex-direction: column;\n    flex: 1;\n    min-height: 0;\n    border: 1px solid #bbb;\n    background-color: #F5F5F5;\n    grid-row: 1 / 2;\n    grid-column: 2 / 4;\n}\n\n.properties-resizer[_ngcontent-%COMP%]\n{\n    grid-row: 1 / 2;\n    grid-column: 1 / 3;\n    cursor: ew-resize;\n}\n\n.properties-resizer[_ngcontent-%COMP%]:hover\n{\n    transition: background-color 400ms 300ms;\n    background-color: #00a2ddc0;\n}\n\n.header[_ngcontent-%COMP%]\n{\n    display: flex;\n    flex-direction: row;\n    padding: 2px 8px;\n    background-color: #bbb;\n}\n\n.header-title[_ngcontent-%COMP%]\n{\n    flex: 1;\n    min-width: 0;\n    min-height: 0;\n}\n\n.header-title[_ngcontent-%COMP%]::first-letter\n{\n    text-transform: uppercase;\n    line-height: 0em;\n}\n\n.static-properties[_ngcontent-%COMP%]\n{\n    padding: 4px 10px;\n}\n\n.properties-controls[_ngcontent-%COMP%]\n{\n    padding: 4px 3px 4px 10px;\n}\n\n.properties-controls[_ngcontent-%COMP%]\n{\n    overflow-y: scroll;\n    overflow-x: hidden;\n}\n\n.properties-toolbar[_ngcontent-%COMP%]\n{\n    background-color: #ddd;\n    padding: 6px 4px;\n    transform: translateX(calc(-1em - 4px));\n    position: absolute;\n}\n\n.properties-toolbar[_ngcontent-%COMP%] > button[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]\n{\n    font-weight: 600;\n}"],changeDetection:0}),(0,i.gn)([(0,h.C)(10),(0,g.S)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[]),(0,i.w6)("design:returntype",Promise)],lt.prototype,"initProperties",null)},27173:(t,e,n)=>{n.d(e,{c:()=>d});var i=n(23199),o=n(79440),r=n(4905),a=n(77842),s=n(98906);class d{constructor(t,e){this.draggingSvc=t,this.element=e,this.initSubscriptions=new i.w0,this.isDropZone=!1}ngOnInit(){this.initSubscriptions.add(this.draggingSvc.draggingChange.subscribe((()=>this.processDragValue())))}ngOnDestroy(){this.initSubscriptions.unsubscribe()}processDragValue(){setTimeout((()=>{this.draggingSvc.dragging&&this.isDropZone?this.element.nativeElement.classList.add("drag-active"):this.element.nativeElement.classList.remove("drag-active")}))}}d.ɵfac=function(t){return new(t||d)(o.Y(s.z),o.Y(r.SB))},d.ɵdir=a.lG({type:d,selectors:[["",8,"designer-dropzone"]],inputs:{isDropZone:"isDropZone"},standalone:!0})},63685:(t,e,n)=>{n.d(e,{E:()=>i});const i=new(n(40296).O)("DRAG_PREVIEW_REGISTRATOR")},10219:(t,e,n)=>{n.d(e,{N:()=>r});var i=n(77842),o=n(38327);class r{}r.ɵfac=function(t){return new(t||r)},r.ɵmod=i.oA({type:r}),r.ɵinj=o.cJ({})},52053:(t,e,n)=>{n.d(e,{E:()=>r});var i=n(86463),o=n(38327);class r{constructor(){this.dropDataChangeSubject=new i.x,this.dropPlaceholderPreview=null,this.newDropPlaceholderPreviewSubject=new i.x,this.oldDropPlaceholderPreviewSubject=new i.x}get dropDataChange(){return this.dropDataChangeSubject.asObservable()}get newDropPlaceholderPreviewChange(){return this.newDropPlaceholderPreviewSubject.asObservable()}get oldDropPlaceholderPreviewChange(){return this.oldDropPlaceholderPreviewSubject.asObservable()}get dropPlaceholderPreviewIndex(){return this.dropPlaceholderPreview?.index??null}setDropData(t){this.dropDataChangeSubject.next(t)}setDropPlaceholderPreview(t){t?.index===this.dropPlaceholderPreview?.index&&t?.parentId===this.dropPlaceholderPreview?.parentId||(this.dropPlaceholderPreview&&this.oldDropPlaceholderPreviewSubject.next(this.dropPlaceholderPreview),this.dropPlaceholderPreview=t,this.dropPlaceholderPreview&&this.newDropPlaceholderPreviewSubject.next(this.dropPlaceholderPreview))}}r.ɵfac=function(t){return new(t||r)},r.ɵprov=o.Yz({token:r,factory:r.ɵfac})},59951:(t,e,n)=>{n.d(e,{i:()=>c});var i=n(27052),o=n(36910),r=n(5348),a=n(25626),s=n(77842),d=n(38327);class c{}c.ɵfac=function(t){return new(t||c)},c.ɵmod=s.oA({type:c}),c.ɵinj=d.cJ({imports:[i.e,o.U,r.A,a.F]})},98906:(t,e,n)=>{n.d(e,{z:()=>r});var i=n(86463),o=n(38327);class r{constructor(){this._dragging=!1,this._draggingChange=new i.x}get dragging(){return this._dragging}get draggingChange(){return this._draggingChange.asObservable()}setDragging(t){this._dragging!=t&&(this._dragging=t,this._draggingChange.next())}}r.ɵfac=function(t){return new(t||r)},r.ɵprov=o.Yz({token:r,factory:r.ɵfac})},26938:(t,e,n)=>{n.d(e,{$:()=>g});var i=n(46480);function o(t,e,n,i,o,r,a){try{var s=t[r](a),d=s.value}catch(t){return void n(t)}s.done?e(d):Promise.resolve(d).then(i,o)}function r(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var a=t.apply(e,n);function s(t){o(a,i,r,s,d,"next",t)}function d(t){o(a,i,r,s,d,"throw",t)}s(void 0)}))}}class a{constructor(t,e,n){this._layoutMetadata=t,this._extractor=e,this._logger=n,this._items=[],this._initialized=!1,this._initPromise=null}[Symbol.asyncIterator](){let t=0;const e=this._initPromise??(this._initPromise=this._getInitPromise()),n=this._items;return{next:()=>r((function*(){return yield e,t<n.length?{value:n[t++],done:!1}:{value:n[t-1],done:!0}}))()}}forEach(t){var e=this;return r((function*(){yield e._initPromise??(e._initPromise=e._getInitPromise());for(const n of e._items)t(n.metadata,n.parent,n.levelIndex,n.level)}))()}_getComponents(){var t=this;return r((function*(){yield t._getComponent(t._layoutMetadata,null,0,0)}))()}_getComponent(t,e,n,i){var o=this;return r((function*(){const r={metadata:t,parent:e,levelIndex:n,level:i};o._items.push(r);const a=yield o._extractor.extractMetadata(t);if(!a)return void o._logger?.debug("LayoutComponentsIterator: failed to get metadata for iterator! {@data}",{package:t.package,name:t.name});if(!a.getDescendants)return;const s=a.getDescendants(t.options);for(let t=0;t<s.length;t++)yield o._getComponent(s[t],r,t,i+1)}))()}_getInitPromise(){var t=this;return r((function*(){t._initialized||(t._initialized=!0,yield t._getComponents())}))()}}function s(t,e,n,i,o,r,a){try{var s=t[r](a),d=s.value}catch(t){return void n(t)}s.done?e(d):Promise.resolve(d).then(i,o)}function d(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var r=t.apply(e,n);function a(t){s(r,i,o,a,d,"next",t)}function d(t){s(r,i,o,a,d,"throw",t)}a(void 0)}))}}class c{constructor(t,e,n){this.layoutMetadata=t,this.extractor=e,this.logger=n,this.items=[],this.initialized=!1,this.initPromise=null}[Symbol.asyncIterator](){let t=0;const e=this.initPromise??(this.initPromise=this.getInitPromise()),n=this.items;return{next:()=>d((function*(){return yield e,t<n.length?{value:n[t++],done:!1}:{value:n[t-1],done:!0}}))()}}getChildren(){var t=this;return d((function*(){yield t.getComponent(t.layoutMetadata)}))()}getComponent(t){var e=this;return d((function*(){const n=yield e.extractor.extractMetadata(t);if(!n)return void e.logger?.debug("LayoutComponentsChildrenIterator: failed to get metadata for children iterator! {@data}",{package:t.package,name:t.name});if(!n.getDescendants)return;const i=n.getDescendants(t.options);for(let t=0;t<i.length;t++)e.items.push({index:t,metadata:i[t]})}))()}getInitPromise(){var t=this;return d((function*(){t.initialized||(t.initialized=!0,yield t.getChildren())}))()}}var l=n(11776),p=n(38327),h=n(85902);class g{constructor(t,e){this.extractor=t,this.logger=e}getIteratorFor(t){return new a(t,this.extractor,this.logger)}getChildrenIteratorFor(t){return new c(t,this.extractor,this.logger)}}g.ɵfac=function(t){return new(t||g)(l.LF(h.T),l.LF(i.bZ,8))},g.ɵprov=p.Yz({token:g,factory:g.ɵfac})},85902:(t,e,n)=>{n.d(e,{T:()=>d});var i=n(8477),o=n(46480),r=n(11776),a=n(38327);function s(t,e,n,i,o,r,a){try{var s=t[r](a),d=s.value}catch(t){return void n(t)}s.done?e(d):Promise.resolve(d).then(i,o)}class d{constructor(t,e){this._loader=t,this._logger=e,this._cache={}}extractMetadata(t){var e,n=this;return(e=function*(){const e=`${t.package}-${t.name}`;if(n._cache[e])return n._cache[e];const i=yield n._loader.loadItem(t);if(!i)return null;const o=i.data;if(!o.layoutEditorMetadata)return n._logger?.warn("LayoutEditorMetadataExtractor: Missing metadata! ",{package:t.package,name:t.name}),null;n._logger?.debug("LayoutEditorMetadataExtractor: Reading metadata! ",{package:t.package,name:t.name});const r=yield o.layoutEditorMetadata;return Object.freeze(r),n._cache[e]=r,r},function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function a(t){s(r,i,o,a,d,"next",t)}function d(t){s(r,i,o,a,d,"throw",t)}a(void 0)}))})()}}d.ɵfac=function(t){return new(t||d)(r.LF(i.Vl),r.LF(o.bZ,8))},d.ɵprov=a.Yz({token:d,factory:d.ɵfac})},83434:(t,e,n)=>{n.d(e,{t:()=>d});var i=n(46480),o=n(43939),r=n(86463),a=n(11776),s=n(38327);class d{constructor(t){this._logger=t,this._components={},this._rootComponentId=null,this._selectedComponent=null,this._highlightedComponent=null,this._layoutChange=new r.x,this._selectedChange=new r.x,this._highlightedChange=new r.x,this._displayNameChanges=new r.x,this._flatTree=null,this._draggedOverComponent=null,this._draggedOverComponentChange=new r.x}get selectedComponent(){return this._selectedComponent}get highlightedComponent(){return this._highlightedComponent}get draggedOverComponent(){return this._draggedOverComponent}get root(){return(0,o.fp)(this._rootComponentId)?null:this._components[this._rootComponentId]}get layoutChange(){return this._layoutChange.asObservable()}get selectedChange(){return this._selectedChange.asObservable()}get highlightedChange(){return this._highlightedChange.asObservable()}get displayNameChange(){return this._displayNameChanges.asObservable()}get draggedOverComponentChange(){return this._draggedOverComponentChange.asObservable()}get flatTree(){return this._flatTree??(this._flatTree=this._buildFlatTree())}selectComponent(t){this._selectedComponent=t??null,this._selectedChange.next()}unselectComponent(){this._selectedComponent=null,this._selectedChange.next()}highlightComponent(t){this._highlightedComponent=t??null,this._highlightedChange.next()}cancelHighlightedComponent(){this._highlightedComponent=null,this._highlightedChange.next()}dragOverComponent(t){t!==this._draggedOverComponent&&(this._draggedOverComponent=t??null,this._draggedOverComponentChange.next())}cancelDragOverComponent(){this._draggedOverComponent=null,this._draggedOverComponentChange.next()}registerLayoutDesignerComponent(t,e,n){if((0,o.fp)(n)&&(this._rootComponentId=e),this._components[e])return this._logger?.error(`LayoutEditorMetadataManager: Component with id ${e} is already registered!`),!1;const i=n?this._components[n]:null,r={component:t,parent:i,children:[]};return this._components[e]=r,i&&i.children.push(r),this._flatTree=null,this._layoutChange.next(),this._logger?.debug("LayoutEditorMetadataManager: Registering component {@id}",e),!0}getComponent(t){return this._components[t]?.component??null}getParent(t){return this._components[t]?.parent?.component??null}getIndex(t){const e=this._components[t];return e&&e.parent?e.parent.children.indexOf(e):null}getComponentDef(t){return this._components[t]??null}unregisterLayoutDesignerComponent(t){const e=this._components[t];if(delete this._components[t],e?.parent){const t=e.parent.children.indexOf(e);e.parent.children.splice(t,1)}t===this._rootComponentId&&(this._rootComponentId=null),this._flatTree=null,this._layoutChange.next(),this._logger?.debug("LayoutEditorMetadataManager: Unregistering component {@id}",t)}displayNameUpdated(){this._displayNameChanges.next()}getMetadata(){return(0,o.fp)(this._rootComponentId)||!this._components[this._rootComponentId]?null:this._components[this._rootComponentId].component.options?.typeMetadata??null}_buildFlatTree(){if((0,o.fp)(this._rootComponentId))return[];const t=this._components[this._rootComponentId];return t?this._buildFlatTreeForComponent(t):[]}_buildFlatTreeForComponent(t){let e=[t];for(const n of t.children)e=e.concat(this._buildFlatTreeForComponent(n));return e}}d.ɵfac=function(t){return new(t||d)(a.LF(i.bZ,8))},d.ɵprov=s.Yz({token:d,factory:d.ɵfac})},43671:(t,e,n)=>{n.d(e,{L:()=>d});var i=n(46480),o=n(57466),r=n(71785),a=n(11776),s=n(38327);class d{constructor(t,e){this._layoutPropertiesSymbols=t,this._logger=e}extract(t){if(!t)return null;this._logger?.debug(`LayoutEditorPropertyMetadataExtractor: Trying to extract properties metadata '${t.name}'`);const e={};for(const n of this._layoutPropertiesSymbols){const i=Reflect.get(t.prototype,n);(0,o.l7)(!0,e,i)}return e}}d.ɵfac=function(t){return new(t||d)(a.LF(r.RI),a.LF(i.bZ,8))},d.ɵprov=s.Yz({token:d,factory:d.ɵfac})}}]);
//# sourceMappingURL=3134.chunk.e2eff4fa30a76113993a.js.map