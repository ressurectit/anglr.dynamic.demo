"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[9678],{93551:(t,e,n)=>{n.d(e,{M:()=>y});var i=n(80056),s=n(7199),o=n(86463),a=n(85478),r=n(60901),l=n(91861),u=n(18745),c=n(15554),h=n(86870),p=n(8530),d=n(5549),g=n(11845),m=n(45473),f=n(75151),v=n(28539);class y{get id(){return this.metadata?.id??""}get allOutputs(){return this.ɵAllOutputs}get inputs(){return this.ɵInputs}get outputs(){return this.ɵOutputs}get destroy(){return this.destroySubject.asObservable()}get boundingBox(){return this.element.nativeElement.getBoundingClientRect()}constructor(t,e){this.changeDetector=t,this.element=e,this.canvas=(0,i.f3)(u.F),this.canvasPositionChangeSubscription=null,this.history=(0,i.f3)(l.nR),this.initialized=!1,this.isDragging=!1,this.moved=!1,this.lastMouseMovePosition={x:0,y:0},this.lastMouseDownOffset={x:0,y:0},this.nodePosition={x:0,y:0},this.ɵAllOutputs=[],this.ɵInputs={},this.ɵOutputs={},this.destroySubject=new o.x,this.zoomLevel=1,this.element.nativeElement.classList.add("relations-node"),this.updatePosition(),this.observer=new ResizeObserver((()=>this.updateRelations())),this.observer.observe(this.element.nativeElement)}ngOnChanges(t){(0,s.$0)("metadata")in t&&this.metadata&&(this.metadata.nodeMetadata?.coordinates&&(this.nodePosition=this.metadata.nodeMetadata.coordinates,this.updatePosition()),this.metadataSet())}ngOnDestroy(){this.observer?.disconnect(),this.canvasPositionChangeSubscription?.unsubscribe(),this.canvasPositionChangeSubscription=null}invalidateVisuals(){this.changeDetector.detectChanges(),this.initialized||(this.initialized=!0,this.initEndpoints())}initialize(){}onMouseDown(t){this.moved=!1,this.isDragging=!0,this.lastMouseDownOffset={x:t.clientX-this.boundingBox.left,y:t.clientY-this.boundingBox.top},this.canvasPositionChangeSubscription=this.canvas.convasPositionChanged.subscribe((()=>{this.nodePosition=this.canvas.getPositionInCanvas({x:this.lastMouseMovePosition.x-this.lastMouseDownOffset.x,y:this.lastMouseMovePosition.y-this.lastMouseDownOffset.y}),this.invalidateVisuals(),this.updatePosition(),this.updateRelations()})),t.stopImmediatePropagation()}onMouseMove(t){this.isDragging&&(this.moved=!0,this.lastMouseMovePosition={x:t.clientX,y:t.clientY},this.nodePosition=this.canvas.getPositionInCanvas({x:this.lastMouseMovePosition.x-this.lastMouseDownOffset.x,y:this.lastMouseMovePosition.y-this.lastMouseDownOffset.y}),this.updatePosition(),t.stopImmediatePropagation(),t.preventDefault(),this.updateRelations())}onMouseUp(t){this.isDragging&&(this.moved&&this.history.getNewState(),this.isDragging=!1,this.canvasPositionChangeSubscription?.unsubscribe(),this.canvasPositionChangeSubscription=null,t.stopImmediatePropagation(),t.preventDefault())}initEndpoints(){const t=()=>{this.ɵInputs={},this.inputsChildren?.forEach((t=>{t.name&&(this.ɵInputs[t.name]=t)})),Object.freeze(this.ɵInputs)},e=()=>{this.ɵAllOutputs=this.outputsChildren.toArray(),this.ɵOutputs={},this.outputsChildren?.forEach((t=>{t.name&&(this.ɵOutputs[t.name]=t)})),Object.freeze(this.ɵOutputs)};this.inputsChildren?.changes.subscribe((()=>t())),this.outputsChildren?.changes.subscribe((()=>e())),t(),e()}updateRelations(){this.inputsChildren.forEach((t=>{t.updateRelation()})),this.outputsChildren.forEach((t=>{t.updateRelation()}))}updatePosition(){this.element.nativeElement.style.left=`${this.nodePosition.x}px`,this.element.nativeElement.style.top=`${this.nodePosition.y}px`,this.metadata?.nodeMetadata?.coordinates&&(this.metadata.nodeMetadata.coordinates.x=this.nodePosition.x,this.metadata.nodeMetadata.coordinates.y=this.nodePosition.y)}metadataSet(){}}y.ɵfac=function(t){return new(t||y)(c.Y(h.s),c.Y(p.SB))},y.ɵdir=d.lG({type:y,viewQuery:function(t,e){if(1&t&&(g.Gf(r.P,5),g.Gf(a.n,5)),2&t){let t;g.iG(t=g.CR())&&(e.inputsChildren=t),g.iG(t=g.CR())&&(e.outputsChildren=t)}},hostBindings:function(t,e){1&t&&m.N("mousedown",(function(t){return e.onMouseDown(t)}))("mousemove",(function(t){return e.onMouseMove(t)}),!1,f.Jf)("mouseup",(function(t){return e.onMouseUp(t)}),!1,f.Jf)},features:[v.T]})},2198:(t,e,n)=>{n.d(e,{S:()=>u});var i=n(15554),s=n(8530),o=n(5549),a=n(12931),r=n(48397),l=n(18745);class u{get parentId(){return this.parent?.id??""}constructor(t,e,n){this.element=t,this.relationManager=e,this.canvas=n,this.canvasPositionChangeSubscription=null,this.isDragging=!1,this.isHighlighted=!1,this.lastMouseMovePosition={x:0,y:0},this.zoomLevel=1,this.parentCoordiantes={x:0,y:0}}ngOnInit(){if(!this.parent)throw new Error("Every input or output endpoint must have parent specified")}getCoordinates(){return{x:this.parentCoordiantes.x+this.element.nativeElement.offsetLeft+this.element.nativeElement.offsetWidth/2,y:this.parentCoordiantes.y+this.element.nativeElement.offsetTop+this.element.nativeElement.offsetHeight/2}}highlight(){this.isHighlighted=!0}cancelHighlight(){this.isHighlighted=!1}}u.ɵfac=function(t){return new(t||u)(i.Y(s.SB),i.Y(r.J),i.Y(l.F))},u.ɵdir=o.lG({type:u,hostVars:2,hostBindings:function(t,e){2&t&&a.ek("highlighted",e.isHighlighted)},inputs:{name:"name",zoomLevel:"zoomLevel",parentCoordiantes:"parentCoordiantes",parent:"parent"}})},52580:(t,e,n)=>{n.d(e,{e:()=>K});var i=n(94060),s=n(62414),o=n(64297),a=n(47260),r=n(34558),l=n(63375),u=n(16311),c=n(8945),h=n(7199);class p{constructor(t){this.displayName=null,this.scope=null,h.Rl.bind(this)(t)}}var d=n(94353),g=n(31246),m=n(78581),f=n(55640),v=n(23527),y=n(41820),b=n(84746),M=n(15554),P=n(5549),C=n(61980),x=n(83052),D=n(21179),_=n(60054),w=n(88195),O=n(58328),R=n(68751),I=n(78002),S=n(68742),E=n(95381),L=n(15528),Y=n(42938);function q(t,e){1&t&&d._U(0,"input",8),2&t&&g.Q("readonly",!0)}function N(t,e){if(1&t&&(d.Tg(0,"option",12),m._(1),d.qZ()),2&t){const t=e.$implicit;g.Q("value",t),f.x(1),v.Oq(t)}}function z(t,e){if(1&t&&(d.Tg(0,"select",9)(1,"option",10),m._(2,"---"),d.qZ(),y.Y(3,N,2,2,"option",11),d.qZ()),2&t){const t=b.o();f.x(3),g.Q("ngForOf",t.scopes)}}class U{constructor(t,e){this.data=t,this.scopes=[],this.form=e.build(new p(t.properties)),this.scopes=t.scopeRegister.scopes}}U.ɵfac=function(t){return new(t||U)(M.Y(u.m),M.Y(c.p))},U.ɵcmp=P.Xp({type:U,selectors:[["relations-node-properties-editor"]],standalone:!0,features:[C._([c.p]),x.j],decls:19,vars:17,consts:[[1,"dynamic-form-group",3,"formGroup"],[1,"dynamic-control-label"],["type","text","formControlName","displayName",1,"dynamic-form-control"],["class","dynamic-form-control","type","text","formControlName","scope",3,"readonly",4,"ngIf"],["class","dynamic-form-control","formControlName","scope",4,"ngIf"],[1,"dynamic-flex-row","dynamic-flex-end","dynamic-action-buttons"],["type","button",1,"dynamic-btn","dynamic-btn-info","dynamic-margin-right-extra-small",3,"mat-dialog-close"],["type","button",1,"dynamic-btn","dynamic-btn-primary",3,"mat-dialog-close"],["type","text","formControlName","scope",1,"dynamic-form-control",3,"readonly"],["formControlName","scope",1,"dynamic-form-control"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(d.Tg(0,"div",0)(1,"label",1),m._(2),D.AL(3,"firstUppercaseLocalize"),d.qZ(),d._U(4,"input",2),d.Tg(5,"label",1),m._(6),D.AL(7,"firstUppercaseLocalize"),d.qZ(),y.Y(8,q,1,1,"input",3)(9,z,4,1,"select",4),d.qZ(),d.Tg(10,"div",5)(11,"button",6)(12,"span"),m._(13),D.AL(14,"firstUppercaseLocalize"),d.qZ()(),d.Tg(15,"button",7)(16,"span"),m._(17),D.AL(18,"firstUppercaseLocalize"),d.qZ()()()),2&t&&(g.Q("formGroup",e.form),f.x(2),v.Oq(D.lc(3,9,"display name")),f.x(4),v.Oq(D.lc(7,11,"scope")),f.x(2),g.Q("ngIf",!e.data.scopeConfigurable),f.x(1),g.Q("ngIf",e.data.scopeConfigurable),f.x(2),g.Q("mat-dialog-close",null),f.x(2),v.Oq(D.lc(14,13,"cancel")),f.x(2),g.Q("mat-dialog-close",e.form.value),f.x(2),v.Oq(D.lc(18,15,"ok")))},dependencies:[i.e,_.sg,w.O,r.I,O.ZT,a.U,R.Y,I.Kr,S.Fj,R.E,E.JJ,E.JL,L.s,Y.u,l.R],encapsulation:2,changeDetection:0});var T=n(47432);class j{transform(t){return t?(0,T.Wg)(t):null}}j.ɵfac=function(t){return new(t||j)},j.ɵpipe=P.Yj({name:"toColor",type:j,pure:!0,standalone:!0});var Z=n(91861),Q=n(12931),k=n(97710),A=n(45473),J=n(71325),V=n(86870),B=n(34984),H=n(77291),F=n(38132);function G(t,e,n,i,s,o,a){try{var r=t[o](a),l=r.value}catch(t){return void n(t)}r.done?e(l):Promise.resolve(l).then(i,s)}function X(t,e){if(1&t&&(d.Tg(0,"span",5),D.AL(1,"toColor"),m._(2,"{}"),d.qZ()),2&t){const t=b.o();Q.Ud("color",D.lc(1,3,null==t.parent||null==t.parent.metadata?null:t.parent.metadata.scope)),g.Q("tooltip",null==t.parent||null==t.parent.metadata?null:t.parent.metadata.scope)}}function $(t,e){if(1&t){const t=k.E();d.Tg(0,"button",6),A.N("click",(function(){J.CH(t);const e=b.o();return J.Kt(e.destroySubject.next())})),d._U(1,"span",7),d.qZ()}}class K{constructor(t,e,n,i){this.dialog=t,this.changeDetector=e,this.scopeRegister=n,this.history=i}editProperties(){var t,e=this;return(t=function*(){const t=yield(0,o.n)(e.dialog.open(U,{title:"edit properties",width:"30vw",data:{properties:{displayName:e.parent?.metadata?.displayName||e.name||e.parent?.metadata?.id||"",scope:e.parent?.metadata?.scope??""},scopeConfigurable:e.parent?.metadata?.nodeMetadata?.scopeConfigurable??!1,scopeRegister:e.scopeRegister}}).afterClosed());t&&e.parent?.metadata&&(e.parent.metadata.displayName=t.displayName??void 0,e.parent.metadata.scope=t.scope??void 0,e.history.getNewState(),e.changeDetector.detectChanges())},function(){var e=this,n=arguments;return new Promise((function(i,s){var o=t.apply(e,n);function a(t){G(o,i,s,a,r,"next",t)}function r(t){G(o,i,s,a,r,"throw",t)}a(void 0)}))})()}}K.ɵfac=function(t){return new(t||K)(M.Y(B.J),M.Y(V.s),M.Y(H.a),M.Y(Z.nR))},K.ɵcmp=P.Xp({type:K,selectors:[["relations-node-header"]],inputs:{parent:"parent",destroySubject:"destroySubject",name:"name"},standalone:!0,features:[x.j],decls:6,vars:3,consts:[[1,"header-content"],["class","dynamic-margin-horizontal-extra-small dynamic-bold",3,"tooltip","color",4,"ngIf"],["type","button",1,"dynamic-btn-icon","edit-icon",3,"click"],[1,"fas","fa-pen"],["type","button","class","dynamic-btn-icon destroy-icon",3,"click",4,"ngIf"],[1,"dynamic-margin-horizontal-extra-small","dynamic-bold",3,"tooltip"],["type","button",1,"dynamic-btn-icon","destroy-icon",3,"click"],[1,"fas","fa-times"]],template:function(t,e){1&t&&(d.Tg(0,"div",0),m._(1),d.qZ(),y.Y(2,X,3,5,"span",1),d.Tg(3,"button",2),A.N("click",(function(){return e.editProperties()})),d._U(4,"span",3),d.qZ(),y.Y(5,$,2,0,"button",4)),2&t&&(f.x(1),v.Oq((null==e.parent||null==e.parent.metadata?null:e.parent.metadata.displayName)||e.name||(null==e.parent||null==e.parent.metadata?null:e.parent.metadata.id)),f.x(1),g.Q("ngIf",null==e.parent||null==e.parent.metadata?null:e.parent.metadata.scope),f.x(3),g.Q("ngIf",e.destroySubject))},dependencies:[i.e,w.O,s.z,F.i,j],encapsulation:2,changeDetection:0})},60901:(t,e,n)=>{n.d(e,{P:()=>p});var i=n(2198),s=n(26220),o=n(40362),a=n(90378),r=n(5549),l=n(45473),u=n(75151),c=n(91513),h=n(83052);class p extends i.S{ngOnDestroy(){this.relation&&this.relation.destroy(),this.canvasPositionChangeSubscription?.unsubscribe(),this.canvasPositionChangeSubscription=null}addRelation(t){if(this.relation){if(this.relation.start?.x===t.start?.x&&this.relation.start?.y===t.start?.y)return!1;this.relation.destroy()}return this.relation=t,!0}endRelation(t){this.addRelation(t)&&this.updateRelation()}updateRelation(){this.relation&&(this.relation.end=this.getCoordinates(),this.relation.input=this,this.relation.invalidateVisuals())}_onMouseEnter(t){t.buttons===s.t.LEFT&&this.relationManager.setActiveInput(this),this.relation?.highlight()}_onMouseLeave(t){t.buttons===s.t.LEFT&&this.relationManager.setActiveInput(null),this.relation?.cancelHighlight()}_onMouseDown(t){t.stopImmediatePropagation(),t.preventDefault(),this._tempRelation=this.relation,this.relation=null,this.isDragging=!0,this.canvasPositionChangeSubscription=this.canvas?.convasPositionChanged.subscribe((()=>{this._tempRelation&&(this._tempRelation.end=this.canvas.getPositionInCanvas({x:this.lastMouseMovePosition.x,y:this.lastMouseMovePosition.y}),this._tempRelation.invalidateVisuals())}))}_onMouseMove(t){this.isDragging&&(t.stopImmediatePropagation(),t.preventDefault(),this.lastMouseMovePosition={x:t.clientX,y:t.clientY},this._tempRelation&&(this._tempRelation.end=this.canvas.getPositionInCanvas({x:this.lastMouseMovePosition.x,y:this.lastMouseMovePosition.y}),this._tempRelation.invalidateVisuals()))}_onMouseUp(t){this.isDragging&&(this.isDragging=!1,this.canvasPositionChangeSubscription?.unsubscribe(),this.canvasPositionChangeSubscription=null,t.stopImmediatePropagation(),t.preventDefault(),this._tempRelation?.invalidateVisuals(o.r))}}p.ɵfac=(()=>{let t;return function(e){return(t||(t=a.n5(p)))(e||p)}})(),p.ɵcmp=r.Xp({type:p,selectors:[["relation-node-input"]],hostBindings:function(t,e){1&t&&l.N("mouseenter",(function(t){return e._onMouseEnter(t)}))("mouseleave",(function(t){return e._onMouseLeave(t)}))("mousedown",(function(t){return e._onMouseDown(t)}))("mousemove",(function(t){return e._onMouseMove(t)}),!1,u.Jf)("mouseup",(function(t){return e._onMouseUp(t)}),!1,u.Jf)},standalone:!0,features:[c.q,h.j],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0})},85478:(t,e,n)=>{n.d(e,{n:()=>h});var i=n(2198),s=n(40362),o=n(90378),a=n(5549),r=n(45473),l=n(75151),u=n(91513),c=n(83052);class h extends i.S{constructor(){super(...arguments),this.ɵrelations=[]}get relations(){return this.ɵrelations}ngOnDestroy(){if(this.ɵrelations){const t=[...this.ɵrelations];for(const e of t)e.destroy()}this.canvasPositionChangeSubscription?.unsubscribe(),this.canvasPositionChangeSubscription=null}startRelation(){const t=this.canvas.createRelation();return t.start=this.getCoordinates(),t.output=this,t.destroying.subscribe((()=>{const e=this.ɵrelations.indexOf(t);e>=0&&this.ɵrelations.splice(e,1)})),this.ɵrelations.push(t),t}updateRelation(){if(this.ɵrelations)for(const t of this.ɵrelations)t.start=this.getCoordinates(),t.invalidateVisuals()}_onMouseDown(t){t.stopImmediatePropagation(),t.preventDefault(),this.isDragging=!0,this.canvasPositionChangeSubscription=this.canvas?.convasPositionChanged.subscribe((()=>{this.relation&&(this.relation.end=this.canvas.getPositionInCanvas({x:this.lastMouseMovePosition.x,y:this.lastMouseMovePosition.y}),this.relation.invalidateVisuals())})),this.relation=this.startRelation()}_onMouseEnter(t){this.ɵrelations?.forEach((t=>t?.highlight()))}_onMouseLeave(t){this.ɵrelations?.forEach((t=>t?.cancelHighlight()))}_onMouseMove(t){this.isDragging&&(t.stopImmediatePropagation(),t.preventDefault(),this.lastMouseMovePosition={x:t.clientX,y:t.clientY},this.relation&&(this.relation.end=this.canvas.getPositionInCanvas({x:this.lastMouseMovePosition.x,y:this.lastMouseMovePosition.y}),this.relation.invalidateVisuals()))}_onMouseUp(t){this.isDragging&&(this.isDragging=!1,this.canvasPositionChangeSubscription?.unsubscribe(),this.canvasPositionChangeSubscription=null,t.stopImmediatePropagation(),t.preventDefault(),this.relation?.invalidateVisuals(s.r))}}h.ɵfac=(()=>{let t;return function(e){return(t||(t=o.n5(h)))(e||h)}})(),h.ɵcmp=a.Xp({type:h,selectors:[["relation-node-output"]],hostBindings:function(t,e){1&t&&r.N("mousedown",(function(t){return e._onMouseDown(t)}))("mouseenter",(function(t){return e._onMouseEnter(t)}))("mouseleave",(function(t){return e._onMouseLeave(t)}))("mousemove",(function(t){return e._onMouseMove(t)}),!1,l.Jf)("mouseup",(function(t){return e._onMouseUp(t)}),!1,l.Jf)},standalone:!0,features:[u.q,c.j],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0})}}]);
//# sourceMappingURL=9678.chunk.182ab7c668635c5d67e4.js.map