"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[4023],{93551:(t,e,n)=>{n.d(e,{M:()=>_});var i=n(11776),s=n(49891),o=n(86463),a=n(85478),r=n(60901),l=n(91861),u=n(79440),d=n(68961),h=n(4905),c=n(13691),p=n(55436),m=n(72891),g=n(47083),f=n(36973);class _{constructor(t,e){this.changeDetector=t,this.element=e,this.history=(0,i.f3)(l.nR),this.initialized=!1,this.isDragging=!1,this.lastMouseDownPosition={x:0,y:0},this.lastMouseDownNodePosition={x:0,y:0},this.nodePosition={x:0,y:0},this.ɵAllOutputs=[],this.ɵInputs={},this.ɵOutputs={},this.destroySubject=new o.x,this.zoomLevel=1,this.element.nativeElement.classList.add("relations-node"),this.updatePosition(),this.observer=new ResizeObserver((()=>this.updateRelations())),this.observer.observe(this.element.nativeElement)}get id(){return this.metadata?.id??""}get allOutputs(){return this.ɵAllOutputs}get inputs(){return this.ɵInputs}get outputs(){return this.ɵOutputs}get destroy(){return this.destroySubject.asObservable()}ngOnChanges(t){(0,s.$)("metadata")in t&&this.metadata&&(this.metadata.nodeMetadata?.coordinates&&(this.nodePosition=this.metadata.nodeMetadata.coordinates,this.updatePosition()),this.metadataSet())}ngOnDestroy(){this.observer?.disconnect()}invalidateVisuals(){this.changeDetector.detectChanges(),this.initialized||(this.initialized=!0,this.initEndpoints())}onMouseDown(t){this.isDragging=!0,this.lastMouseDownPosition={x:t.clientX,y:t.clientY},this.lastMouseDownNodePosition={x:this.nodePosition.x,y:this.nodePosition.y},t.stopImmediatePropagation()}onMouseMove(t){this.isDragging&&(this.nodePosition={x:this.lastMouseDownNodePosition.x+1*(t.clientX-this.lastMouseDownPosition.x)/this.zoomLevel,y:this.lastMouseDownNodePosition.y+1*(t.clientY-this.lastMouseDownPosition.y)/this.zoomLevel},this.updatePosition(),t.stopImmediatePropagation(),t.preventDefault(),this.updateRelations())}onMouseUp(t){this.isDragging&&(this.history.getNewState(),this.isDragging=!1,t.stopImmediatePropagation(),t.preventDefault())}initEndpoints(){const t=()=>{this.ɵInputs={},this.inputsChildren?.forEach((t=>{t.name&&(this.ɵInputs[t.name]=t)})),Object.freeze(this.ɵInputs)},e=()=>{this.ɵAllOutputs=this.outputsChildren.toArray(),this.ɵOutputs={},this.outputsChildren?.forEach((t=>{t.name&&(this.ɵOutputs[t.name]=t)})),Object.freeze(this.ɵOutputs)};this.inputsChildren?.changes.subscribe((()=>t())),this.outputsChildren?.changes.subscribe((()=>e())),t(),e()}updateRelations(){this.inputsChildren.forEach((t=>{t.updateRelation()})),this.outputsChildren.forEach((t=>{t.updateRelation()}))}updatePosition(){this.element.nativeElement.style.left=`${this.nodePosition.x}px`,this.element.nativeElement.style.top=`${this.nodePosition.y}px`,this.metadata?.nodeMetadata?.coordinates&&(this.metadata.nodeMetadata.coordinates.x=this.nodePosition.x,this.metadata.nodeMetadata.coordinates.y=this.nodePosition.y)}metadataSet(){}}_.ɵfac=function(t){return new(t||_)(u.Y(d.s),u.Y(h.SB))},_.ɵdir=c.lG({type:_,viewQuery:function(t,e){if(1&t&&(p.Gf(r.P,5),p.Gf(a.n,5)),2&t){let t;p.iG(t=p.CR())&&(e.inputsChildren=t),p.iG(t=p.CR())&&(e.outputsChildren=t)}},hostBindings:function(t,e){1&t&&m.N("mousedown",(function(t){return e.onMouseDown(t)}))("mousemove",(function(t){return e.onMouseMove(t)}),!1,g.Jf)("mouseup",(function(t){return e.onMouseUp(t)}),!1,g.Jf)},features:[f.T]})},2198:(t,e,n)=>{n.d(e,{S:()=>l});var i=n(79440),s=n(4905),o=n(13691),a=n(48397),r=n(75957);class l{constructor(t,e,n){this._element=t,this._relationManager=e,this._canvas=n,this._isDragging=!1,this._lastMouseDownPosition={x:0,y:0},this.zoomLevel=1,this.parentCoordiantes={x:0,y:0}}get parentId(){return this.parent?.id??""}ngOnInit(){if(!this.parent)throw new Error("Every input or output endpoint must have parent specified")}getCoordinates(){return{x:this.parentCoordiantes.x+this._element.nativeElement.offsetLeft+this._element.nativeElement.offsetWidth/2,y:this.parentCoordiantes.y+this._element.nativeElement.offsetTop+this._element.nativeElement.offsetHeight/2}}}l.ɵfac=function(t){return new(t||l)(i.Y(s.SB),i.Y(a.J),i.Y(r.F))},l.ɵdir=o.lG({type:l,inputs:{name:"name",zoomLevel:"zoomLevel",parentCoordiantes:"parentCoordiantes",parent:"parent"}})},88735:(t,e,n)=>{n.d(e,{e:()=>N});var i=n(27052),s=n(64297),o=n(11776),a=n(70625),r=n(68624),l=n(30621),u=n(9249),d=n(13691),h=n(82568),c=n(80827),p=n(41853),m=n(66794),g=n(73301),f=n(80943),_=n(49280),v=n(77470),y=n(27635);class D{constructor(){this.control=new a.NI((0,o.f3)(u.m))}}D.ɵfac=function(t){return new(t||D)},D.ɵcmp=d.Xp({type:D,selectors:[["relations-node-header-display-name-editor"]],standalone:!0,features:[h.j],decls:10,vars:3,consts:[[1,"form-group"],[1,"control-label"],["type","text",1,"form-control",3,"formControl"],[1,"flex-row","flex-end","margin-top-small"],["type","button",1,"btn","btn-info","margin-right-extra-small",3,"mat-dialog-close"],["type","button",1,"btn","btn-primary",3,"mat-dialog-close"]],template:function(t,e){1&t&&(c.Tg(0,"div",0),c._U(1,"label",1)(2,"input",2),c.qZ(),c.Tg(3,"div",3)(4,"button",4)(5,"span"),p._(6,"cancel"),c.qZ()(),c.Tg(7,"button",5)(8,"span"),p._(9,"ok"),c.qZ()()()),2&t&&(m.x(2),g.Q("formControl",e.control),m.x(2),g.Q("mat-dialog-close",null),m.x(3),g.Q("mat-dialog-close",e.control.value))},dependencies:[l.I,f.ZT,r.U,_.Fj,v.JJ,y.oH],encapsulation:2,changeDetection:0});var b=n(84773),M=n(72891),w=n(43870),x=n(6845),P=n(79440),C=n(68961),O=n(15686),R=n(6427),I=n(47826),E=n(21651);function z(t,e,n,i,s,o,a){try{var r=t[o](a),l=r.value}catch(t){return void n(t)}r.done?e(l):Promise.resolve(l).then(i,s)}function L(t,e){if(1&t){const t=b.E();c.Tg(0,"button",4),M.N("click",(function(){w.CH(t);const e=x.o();return w.Kt(e.destroySubject.next())})),c._U(1,"span",5),c.qZ()}}class N{constructor(t,e){this.dialog=t,this.changeDetector=e}editDisplayName(){var t,e=this;return(t=function*(){const t=yield(0,s.n)(e.dialog.open(D,{title:"edit display name",width:"30vw",data:e.parent?.metadata?.displayName||e.name||e.parent?.metadata?.id||""}).afterClosed());t&&e.parent?.metadata&&(e.parent.metadata.displayName=t,e.changeDetector.detectChanges())},function(){var e=this,n=arguments;return new Promise((function(i,s){var o=t.apply(e,n);function a(t){z(o,i,s,a,r,"next",t)}function r(t){z(o,i,s,a,r,"throw",t)}a(void 0)}))})()}}N.ɵfac=function(t){return new(t||N)(P.Y(I.J),P.Y(C.s))},N.ɵcmp=d.Xp({type:N,selectors:[["relations-node-header"]],inputs:{parent:"parent",destroySubject:"destroySubject",name:"name"},standalone:!0,features:[h.j],decls:5,vars:2,consts:[[1,"header-content"],["type","butotn",1,"btn-icon","edit-icon",3,"click"],[1,"fas","fa-pen"],["type","button","class","btn-icon destroy-icon",3,"click",4,"ngIf"],["type","button",1,"btn-icon","destroy-icon",3,"click"],[1,"fas","fa-times"]],template:function(t,e){1&t&&(c.Tg(0,"div",0),p._(1),c.qZ(),c.Tg(2,"button",1),M.N("click",(function(){return e.editDisplayName()})),c._U(3,"span",2),c.qZ(),O.Y(4,L,2,0,"button",3)),2&t&&(m.x(1),R.Oq((null==e.parent||null==e.parent.metadata?null:e.parent.metadata.displayName)||e.name||(null==e.parent||null==e.parent.metadata?null:e.parent.metadata.id)),m.x(3),g.Q("ngIf",e.destroySubject))},dependencies:[i.e,E.O],encapsulation:2,changeDetection:0})},60901:(t,e,n)=>{n.d(e,{P:()=>p});var i=n(27052),s=n(2198),o=n(26220),a=n(40362),r=n(43801),l=n(13691),u=n(72891),d=n(47083),h=n(47098),c=n(82568);class p extends s.S{ngOnDestroy(){this._relation&&this._relation.destroy()}addRelation(t){if(this._relation){if(this._relation.start?.x===t.start?.x&&this._relation.start?.y===t.start?.y)return!1;this._relation.destroy()}return this._relation=t,!0}endRelation(t){this.addRelation(t)&&this.updateRelation()}updateRelation(){this._relation&&(this._relation.end=this.getCoordinates(),this._relation.input=this,this._relation.invalidateVisuals())}_onMouseEnter(t){t.buttons===o.t.LEFT&&this._relationManager.setActiveInput(this)}_onMouseLeave(t){t.buttons===o.t.LEFT&&this._relationManager.setActiveInput(null)}_onMouseDown(t){t.stopImmediatePropagation(),t.preventDefault(),this._lastMouseDownPosition={x:t.clientX,y:t.clientY},this._tempRelation=this._relation,this._relation=null,this._isDragging=!0}_onMouseMove(t){this._isDragging&&(t.stopImmediatePropagation(),t.preventDefault(),this._tempRelation&&(this._tempRelation.end={x:this.getCoordinates().x+1*(t.clientX-this._lastMouseDownPosition?.x)/this.zoomLevel,y:this.getCoordinates().y+1*(t.clientY-this._lastMouseDownPosition?.y)/this.zoomLevel},this._tempRelation.invalidateVisuals()))}_onMouseUp(t){this._isDragging&&(this._isDragging=!1,t.stopImmediatePropagation(),t.preventDefault(),this._tempRelation?.invalidateVisuals(a.r))}}p.ɵfac=function(){let t;return function(e){return(t||(t=r.n5(p)))(e||p)}}(),p.ɵcmp=l.Xp({type:p,selectors:[["relation-node-input"]],hostBindings:function(t,e){1&t&&u.N("mouseenter",(function(t){return e._onMouseEnter(t)}))("mouseleave",(function(t){return e._onMouseLeave(t)}))("mousedown",(function(t){return e._onMouseDown(t)}))("mousemove",(function(t){return e._onMouseMove(t)}),!1,d.Jf)("mouseup",(function(t){return e._onMouseUp(t)}),!1,d.Jf)},standalone:!0,features:[h.q,c.j],decls:0,vars:0,template:function(t,e){},dependencies:[i.e],styles:["[_nghost-%COMP%]\n{\n    display: block;\n    width: 1.45em;\n    height: 1.45em;\n    border-width: .5em;\n    border-style: solid;\n    border-radius: 50%;\n    background-color: white;\n    cursor: crosshair;\n}"],changeDetection:0})},85478:(t,e,n)=>{n.d(e,{n:()=>c});var i=n(27052),s=n(2198),o=n(40362),a=n(43801),r=n(13691),l=n(72891),u=n(47083),d=n(47098),h=n(82568);class c extends s.S{constructor(){super(...arguments),this._relations=[]}get relations(){return this._relations}ngOnDestroy(){if(this._relations){const t=[...this._relations];for(const e of t)e.destroy()}}startRelation(){const t=this._canvas.createRelation();return t.start=this.getCoordinates(),t.output=this,t.destroying.subscribe((()=>{const e=this._relations.indexOf(t);e>=0&&this._relations.splice(e,1)})),this._relations.push(t),t}updateRelation(){if(this._relations)for(const t of this._relations)t.start=this.getCoordinates(),t.invalidateVisuals()}_onMouseDown(t){t.stopImmediatePropagation(),t.preventDefault(),this._isDragging=!0,this._lastMouseDownPosition={x:t.clientX,y:t.clientY},this._relation=this.startRelation()}_onMouseMove(t){this._isDragging&&(t.stopImmediatePropagation(),t.preventDefault(),this._relation&&(this._relation.end={x:this.getCoordinates().x+1*(t.clientX-this._lastMouseDownPosition.x)/this.zoomLevel,y:this.getCoordinates().y+1*(t.clientY-this._lastMouseDownPosition.y)/this.zoomLevel},this._relation.invalidateVisuals()))}_onMouseUp(t){this._isDragging&&(this._isDragging=!1,t.stopImmediatePropagation(),t.preventDefault(),this._relation?.invalidateVisuals(o.r))}}c.ɵfac=function(){let t;return function(e){return(t||(t=a.n5(c)))(e||c)}}(),c.ɵcmp=r.Xp({type:c,selectors:[["relation-node-output"]],hostBindings:function(t,e){1&t&&l.N("mousedown",(function(t){return e._onMouseDown(t)}))("mousemove",(function(t){return e._onMouseMove(t)}),!1,u.Jf)("mouseup",(function(t){return e._onMouseUp(t)}),!1,u.Jf)},standalone:!0,features:[d.q,h.j],decls:0,vars:0,template:function(t,e){},dependencies:[i.e],styles:["[_nghost-%COMP%]\n{\n    display: block;\n    width: 1.45em;\n    height: 1.45em;\n    border-width: .5em;\n    border-style: solid;\n    border-radius: 50%;\n    background-color: white;\n    cursor: crosshair;\n}"],changeDetection:0})}}]);
//# sourceMappingURL=4023.chunk.37879ab9003493067d48.js.map