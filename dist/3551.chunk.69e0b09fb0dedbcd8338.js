"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[3551],{75957:(t,e,n)=>{n.d(e,{F:()=>V});var i=n(4905),o=n(27052),s=n(9360),a=n(53682),r=n(40362);class u{constructor(t,e,n,i){this._parentGroup=t,this._relationManager=e,this.start=n,this.end=i,this._destroyingSubject=new a.xQ,this.output=null,this.input=null,this._path=this._parentGroup.append("path").attr("fill","transparent").attr("stroke","#48B8B8").attr("stroke-width","3px"),this._lineGenerator=(0,s.jvg)().curve(s.tFB.beta(.75))}get destroying(){return this._destroyingSubject.asObservable()}destroy(){this._path?.remove(),this._destroyingSubject.next()}invalidateVisuals(t){if(t==r.r){const t=this._relationManager.getActiveInput();this._relationManager.setActiveInput(null),t&&t.addRelation(this)?(this.end=t.getCoordinates(),this.input=t):(this.destroy(),this.start=null,this.end=null,this.input=null,this.output=null)}if(!this.start||!this.end)return;let e;if(this.end.x<=this.start.x){let t=this.start.x-this.end.x;const n=(this.end.y-this.start.y)/2;t<12&&(t=12),t*=1.3,e=[[this.start.x,this.start.y],[this.start.x+t,this.start.y+n],[this.end.x-t,this.start.y+n],[this.end.x,this.end.y]]}else{const t=(this.end.x-this.start.x)/3;e=[[this.start.x,this.start.y],[this.start.x+t,this.start.y],[this.end.x-t,this.end.y],[this.end.x,this.end.y]]}this._path.attr("d",this._lineGenerator(e))}}var l=n(26220),d=n(41338),h=n(74445),c=n(46480),p=n(49891),_=n(43939),g=n(5402),m=n(79440),f=n(15783),v=n(13691),y=n(36973),M=n(48397);function x(t,e,n,i,o,s,a){try{var r=t[s](a),u=r.value}catch(t){return void n(t)}r.done?e(u):Promise.resolve(u).then(i,o)}class w{constructor(t,e,n,i){this._viewContainerRef=t,this._relationsNodeManager=e,this._loader=n,this._logger=i,this._componentRef=null,this.componentMetadata=null,this.zoomLevel=1,this.create=new h.v,this.destroy=new h.v}get component(){return this._componentRef?this._componentRef.instance:null}ngOnChanges(t){var e,n=this;return(e=function*(){if((0,p.$)("zoomLevel")in t&&(0,_.EN)(n.zoomLevel)&&!((0,p.$)("componentMetadata")in t)){const e=n.component;if(e){const i=t[(0,p.$)("zoomLevel")];e.zoomLevel=n.zoomLevel;const o={currentValue:i.currentValue,firstChange:!1,previousValue:i.previousValue,isFirstChange:()=>!1},s={};s[(0,p.$)("zoomLevel")]=o,e.ngOnChanges(s),e.invalidateVisuals()}}else if(n._logger?.debug("RelationsNodeRendererSADirective: rendering node {@id}",{id:n.componentMetadata?.id}),n.ngOnDestroy(),n._viewContainerRef.clear(),(0,p.$)("componentMetadata")in t&&n.componentMetadata){const t=yield n._loader.loadItem(n.componentMetadata);if(!t)return void n._logger?.warn("RelationsNodeRendererSADirective: Unable to find relations node type {@type}",{name:n.componentMetadata.name,package:n.componentMetadata.package});if(n._componentRef=n._viewContainerRef.createComponent(t.data,{injector:n._viewContainerRef.injector}),n._logger?.debug("RelationsNodeRendererSADirective: node rendered {@id}",{id:n.componentMetadata?.id}),n.component){const t=n.component;n._logger?.debug("RelationsNodeRendererSADirective: initializing node with metadata {@id}",{id:n.componentMetadata?.id}),t.metadata=n.componentMetadata,t.zoomLevel=n.zoomLevel;const e={};e[(0,p.$)("metadata")]={currentValue:n.componentMetadata,previousValue:null,firstChange:!0,isFirstChange:()=>!0},e[(0,p.$)("zoomLevel")]={currentValue:n.zoomLevel,previousValue:null,firstChange:!0,isFirstChange:()=>!0},t.ngOnChanges(e),n._logger?.debug("RelationsNodeRendererSADirective: invalidating node visuals {@id}",{id:n.componentMetadata?.id}),t.invalidateVisuals(),n._relationsNodeManager.registerNode(n.component),n.create.next(t)}}},function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function a(t){x(s,i,o,a,r,"next",t)}function r(t){x(s,i,o,a,r,"throw",t)}a(void 0)}))})()}ngOnDestroy(){this._componentRef&&(this._logger?.debug("RelationsNodeRendererSADirective: destroying node {@id}",{id:this.componentMetadata?.id}),this.component&&(this.destroy.next(this.component),this._relationsNodeManager.unregisterNode(this.component)),this._componentRef?.destroy(),this._componentRef=null)}}w.ɵfac=function(t){return new(t||w)(m.Y(f.s_),m.Y(M.J),m.Y(g.fI),m.Y(c.bZ,8))},w.ɵdir=v.lG({type:w,selectors:[["","relationsNodeRenderer",""]],inputs:{componentMetadata:["relationsNodeRenderer","componentMetadata"],zoomLevel:"zoomLevel"},outputs:{create:"create",destroy:"destroy"},exportAs:["relationsNodeRenderer"],standalone:!0,features:[y.T]});var D=n(43870),P=n(4477),R=n(6845),b=n(66794),z=n(73301),C=n(55436),L=n(72891),N=n(47083),k=n(85320),I=n(82568),O=n(80827),S=n(15686),Y=n(12311);const E=["relationsGroup"];function U(t,e){if(1&t&&(D.O4(),D.kc(),P.yn(0),P.Gk(1,4),P.BQ()),2&t){const t=e.$implicit,n=R.o();b.x(1),z.Q("relationsNodeRenderer",t)("zoomLevel",n._zoomLevel)}}class V{constructor(t){this._relationManager=t,this._backgroundSize=16,this._lastMouseDownPosition={x:0,y:0},this._lastMouseUpPosition={x:0,y:0},this._canvasPosition={x:0,y:0},this._zoomLevel=1,this._isDragging=!1,this.nodeDefinitions=[]}get _backgroundSizeStyle(){return`${this._backgroundSize}px ${this._backgroundSize}px`}get _backgroundPositionStyle(){return`${this._canvasPosition.x%this._backgroundSize}px ${this._canvasPosition.y%this._backgroundSize}px`}createRelation(){return new u((0,s.Ys)(this._relationsGroup?.nativeElement),this._relationManager,null,null)}_onMouseDown(t){t.buttons==l.t.LEFT&&(this._lastMouseDownPosition={x:t.clientX,y:t.clientY},this._isDragging=!0)}_onMouseMove(t){this._isDragging&&(this._canvasPosition={x:this._lastMouseUpPosition.x+t.clientX-this._lastMouseDownPosition.x,y:this._lastMouseUpPosition.y+t.clientY-this._lastMouseDownPosition.y})}_onMouseUp(t){this._isDragging&&(this._isDragging=!1,this._lastMouseUpPosition={x:this._lastMouseUpPosition.x+t.clientX-this._lastMouseDownPosition.x,y:this._lastMouseUpPosition.y+t.clientY-this._lastMouseDownPosition.y})}_onWheel(t){if(t.deltaY){const e=(0,d.uZ)(this._zoomLevel+.05*(t.deltaY>1?-1:1),.2,2);this._canvasPosition={x:this._canvasPosition.x/this._zoomLevel*e,y:this._canvasPosition.y/this._zoomLevel*e},this._zoomLevel=e,this._lastMouseUpPosition={x:this._canvasPosition.x,y:this._canvasPosition.y},this._backgroundSize=16*this._zoomLevel}t.preventDefault(),t.stopImmediatePropagation()}}V.ɵfac=function(t){return new(t||V)(m.Y(M.J))},V.ɵcmp=v.Xp({type:V,selectors:[["relations-canvas"]],viewQuery:function(t,e){if(1&t&&C.Gf(E,5,i.SB),2&t){let t;C.iG(t=C.CR())&&(e._relationsGroup=t.first)}},hostVars:4,hostBindings:function(t,e){1&t&&L.N("mousedown",(function(t){return e._onMouseDown(t)}))("mousemove",(function(t){return e._onMouseMove(t)}))("mouseup",(function(t){return e._onMouseUp(t)}),!1,N.Jf)("wheel",(function(t){return e._onWheel(t)})),2&t&&k.Ud("background-size",e._backgroundSizeStyle)("background-position",e._backgroundPositionStyle)},inputs:{nodeDefinitions:"nodeDefinitions"},standalone:!0,features:[I.j],decls:5,vars:3,consts:[[1,"flow-area"],[1,"relations-wrapper"],["relationsGroup",""],[4,"ngFor","ngForOf"],[3,"relationsNodeRenderer","zoomLevel"]],template:function(t,e){1&t&&(O.Tg(0,"div",0),D.O4(),O.Tg(1,"svg",1),O._U(2,"g",null,2),O.qZ(),S.Y(4,U,2,2,"ng-container",3),O.qZ()),2&t&&(k.Ud("transform","translate("+e._canvasPosition.x+"px, "+e._canvasPosition.y+"px) scale("+e._zoomLevel+")"),b.x(4),z.Q("ngForOf",e.nodeDefinitions))},dependencies:[o.e,Y.s,w],styles:["[_nghost-%COMP%]\n{\n    background-color: #e5e5f7;\n    opacity: 0.6;\n    background-image: radial-gradient(#444cf7 0.8px, #e5e5f7 0.8px);\n    overflow: hidden;\n}\n\n.relations-wrapper[_ngcontent-%COMP%]\n{\n    width: 100%;\n    height: 100%;\n    overflow: visible;\n}"],changeDetection:0})},93551:(t,e,n)=>{n.d(e,{M:()=>_});var i=n(49891),o=n(85478),s=n(60901),a=n(79440),r=n(68961),u=n(4905),l=n(13691),d=n(55436),h=n(72891),c=n(47083),p=n(36973);class _{constructor(t,e){this._changeDetector=t,this._element=e,this._initialized=!1,this._isDragging=!1,this._lastMouseDownPosition={x:0,y:0},this._lastMouseDownNodePosition={x:0,y:0},this._nodePosition={x:0,y:0},this._allOutputs=[],this._inputs={},this._outputs={},this.zoomLevel=1,this._updatePosition()}get id(){return this.metadata?.id??""}get allOutputs(){return this._allOutputs}get inputs(){return this._inputs}get outputs(){return this._outputs}ngOnChanges(t){(0,i.$)("metadata")in t&&this.metadata&&(this.metadata.nodeMetadata?.coordinates&&(this._nodePosition=this.metadata.nodeMetadata.coordinates,this._updatePosition()),this.metadataSet())}invalidateVisuals(){this._changeDetector.detectChanges(),this._initialized||(this._initialized=!0,this._initEndpoints())}_onMouseDown(t){this._isDragging=!0,this._lastMouseDownPosition={x:t.clientX,y:t.clientY},this._lastMouseDownNodePosition={x:this._nodePosition.x,y:this._nodePosition.y},t.stopImmediatePropagation()}_onMouseMove(t){this._isDragging&&(this._nodePosition={x:this._lastMouseDownNodePosition.x+1*(t.clientX-this._lastMouseDownPosition.x)/this.zoomLevel,y:this._lastMouseDownNodePosition.y+1*(t.clientY-this._lastMouseDownPosition.y)/this.zoomLevel},this._updatePosition(),t.stopImmediatePropagation(),t.preventDefault(),this._updateRelations())}_onMouseUp(t){this._isDragging&&(this._isDragging=!1,t.stopImmediatePropagation(),t.preventDefault())}_initEndpoints(){const t=()=>{this._inputs={},this._inputsChildren?.forEach((t=>{t.name&&(this._inputs[t.name]=t)})),Object.freeze(this._inputs)},e=()=>{this._allOutputs=this._outputsChildren.toArray(),this._outputs={},this._outputsChildren?.forEach((t=>{t.name&&(this._outputs[t.name]=t)})),Object.freeze(this._outputs)};this._inputsChildren?.changes.subscribe((()=>t())),this._outputsChildren?.changes.subscribe((()=>e())),t(),e()}_updateRelations(){this._inputsChildren.forEach((t=>{t.updateRelation()})),this._outputsChildren.forEach((t=>{t.updateRelation()}))}_updatePosition(){this._element.nativeElement.style.left=`${this._nodePosition.x}px`,this._element.nativeElement.style.top=`${this._nodePosition.y}px`,this.metadata?.nodeMetadata?.coordinates&&(this.metadata.nodeMetadata.coordinates.x=this._nodePosition.x,this.metadata.nodeMetadata.coordinates.y=this._nodePosition.y)}}_.ɵfac=function(t){return new(t||_)(a.Y(r.s),a.Y(u.SB))},_.ɵdir=l.lG({type:_,viewQuery:function(t,e){if(1&t&&(d.Gf(s.P,5),d.Gf(o.n,5)),2&t){let t;d.iG(t=d.CR())&&(e._inputsChildren=t),d.iG(t=d.CR())&&(e._outputsChildren=t)}},hostBindings:function(t,e){1&t&&h.N("mousedown",(function(t){return e._onMouseDown(t)}))("mousemove",(function(t){return e._onMouseMove(t)}),!1,c.Jf)("mouseup",(function(t){return e._onMouseUp(t)}),!1,c.Jf)},features:[p.T]})},2198:(t,e,n)=>{n.d(e,{S:()=>u});var i=n(79440),o=n(4905),s=n(13691),a=n(48397),r=n(75957);class u{constructor(t,e,n){this._element=t,this._relationManager=e,this._canvas=n,this._isDragging=!1,this._lastMouseDownPosition={x:0,y:0},this.zoomLevel=1,this.parentCoordiantes={x:0,y:0}}get parentId(){return this.parent?.id??""}ngOnInit(){if(!this.parent)throw new Error("Every input or output endpoint must have parent specified")}getCoordinates(){return{x:this.parentCoordiantes.x+this._element.nativeElement.offsetLeft+this._element.nativeElement.offsetWidth/2,y:this.parentCoordiantes.y+this._element.nativeElement.offsetTop+this._element.nativeElement.offsetHeight/2}}}u.ɵfac=function(t){return new(t||u)(i.Y(o.SB),i.Y(a.J),i.Y(r.F))},u.ɵdir=s.lG({type:u,inputs:{name:"name",zoomLevel:"zoomLevel",parentCoordiantes:"parentCoordiantes",parent:"parent"}})},60901:(t,e,n)=>{n.d(e,{P:()=>p});var i=n(27052),o=n(2198),s=n(26220),a=n(40362),r=n(43801),u=n(13691),l=n(72891),d=n(47083),h=n(47098),c=n(82568);class p extends o.S{addRelation(t){if(this._relation){if(this._relation.start?.x===t.start?.x&&this._relation.start?.y===t.start?.y)return!1;this._relation.destroy()}return this._relation=t,!0}endRelation(t){this.addRelation(t)&&this.updateRelation()}updateRelation(){this._relation&&(this._relation.end=this.getCoordinates(),this._relation.input=this,this._relation.invalidateVisuals())}_onMouseEnter(t){t.buttons===s.t.LEFT&&this._relationManager.setActiveInput(this)}_onMouseLeave(t){t.buttons===s.t.LEFT&&this._relationManager.setActiveInput(null)}_onMouseDown(t){t.stopImmediatePropagation(),t.preventDefault(),this._lastMouseDownPosition={x:t.clientX,y:t.clientY},this._tempRelation=this._relation,this._relation=null,this._isDragging=!0}_onMouseMove(t){this._isDragging&&(t.stopImmediatePropagation(),t.preventDefault(),this._tempRelation&&(this._tempRelation.end={x:this.getCoordinates().x+1*(t.clientX-this._lastMouseDownPosition?.x)/this.zoomLevel,y:this.getCoordinates().y+1*(t.clientY-this._lastMouseDownPosition?.y)/this.zoomLevel},this._tempRelation.invalidateVisuals()))}_onMouseUp(t){this._isDragging&&(this._isDragging=!1,t.stopImmediatePropagation(),t.preventDefault(),this._tempRelation?.invalidateVisuals(a.r))}}p.ɵfac=function(){let t;return function(e){return(t||(t=r.n5(p)))(e||p)}}(),p.ɵcmp=u.Xp({type:p,selectors:[["relation-node-input"]],hostBindings:function(t,e){1&t&&l.N("mouseenter",(function(t){return e._onMouseEnter(t)}))("mouseleave",(function(t){return e._onMouseLeave(t)}))("mousedown",(function(t){return e._onMouseDown(t)}))("mousemove",(function(t){return e._onMouseMove(t)}),!1,d.Jf)("mouseup",(function(t){return e._onMouseUp(t)}),!1,d.Jf)},standalone:!0,features:[h.q,c.j],decls:0,vars:0,template:function(t,e){},dependencies:[i.e],styles:["[_nghost-%COMP%]\n{\n    display: block;\n    width: 1.45em;\n    height: 1.45em;\n    border-width: .5em;\n    border-style: solid;\n    border-radius: 50%;\n    background-color: white;\n    cursor: crosshair;\n}"],changeDetection:0})},85478:(t,e,n)=>{n.d(e,{n:()=>c});var i=n(27052),o=n(2198),s=n(40362),a=n(43801),r=n(13691),u=n(72891),l=n(47083),d=n(47098),h=n(82568);class c extends o.S{constructor(){super(...arguments),this._relations=[]}get relations(){return this._relations}startRelation(){const t=this._canvas.createRelation();return t.start=this.getCoordinates(),t.output=this,t.destroying.subscribe((()=>{const e=this._relations.indexOf(t);e>=0&&this._relations.splice(e,1)})),this._relations.push(t),t}updateRelation(){if(this._relations)for(const t of this._relations)t.start=this.getCoordinates(),t.invalidateVisuals()}_onMouseDown(t){t.stopImmediatePropagation(),t.preventDefault(),this._isDragging=!0,this._lastMouseDownPosition={x:t.clientX,y:t.clientY},this._relation=this.startRelation()}_onMouseMove(t){this._isDragging&&(t.stopImmediatePropagation(),t.preventDefault(),this._relation&&(this._relation.end={x:this.getCoordinates().x+1*(t.clientX-this._lastMouseDownPosition.x)/this.zoomLevel,y:this.getCoordinates().y+1*(t.clientY-this._lastMouseDownPosition.y)/this.zoomLevel},this._relation.invalidateVisuals()))}_onMouseUp(t){this._isDragging&&(this._isDragging=!1,t.stopImmediatePropagation(),t.preventDefault(),this._relation?.invalidateVisuals(s.r))}}c.ɵfac=function(){let t;return function(e){return(t||(t=a.n5(c)))(e||c)}}(),c.ɵcmp=r.Xp({type:c,selectors:[["relation-node-output"]],hostBindings:function(t,e){1&t&&u.N("mousedown",(function(t){return e._onMouseDown(t)}))("mousemove",(function(t){return e._onMouseMove(t)}),!1,l.Jf)("mouseup",(function(t){return e._onMouseUp(t)}),!1,l.Jf)},standalone:!0,features:[d.q,h.j],decls:0,vars:0,template:function(t,e){},dependencies:[i.e],styles:["[_nghost-%COMP%]\n{\n    display: block;\n    width: 1.45em;\n    height: 1.45em;\n    border-width: .5em;\n    border-style: solid;\n    border-radius: 50%;\n    background-color: white;\n    cursor: crosshair;\n}"],changeDetection:0})},40362:(t,e,n)=>{n.d(e,{r:()=>i});const i="drop"},26220:(t,e,n)=>{var i;n.d(e,{t:()=>i}),function(t){t[t.LEFT=1]="LEFT"}(i||(i={}))},48397:(t,e,n)=>{n.d(e,{J:()=>o});var i=n(38327);class o{constructor(){this._nodes={},this._waitingInputRelations={}}setActiveInput(t){this._activeInput=t}getActiveInput(){return this._activeInput}registerNode(t){var e,n;if(this._nodes[t.id]=t,t.metadata?.outputs&&Array.isArray(t.metadata?.outputs))for(const i of t.metadata?.outputs){if(!i.inputs||!Array.isArray(i.inputs))continue;const o=t.outputs[i.outputName];if(o)for(const t of i.inputs){const i=this._nodes[t.id],s=o.startRelation();if(!i){(e=this._waitingInputRelations)[n=t.id]??(e[n]=[]),this._waitingInputRelations[t.id].push({inputName:t.inputName,relation:s});continue}const a=i.inputs[t.inputName];a&&a.endRelation(s)}}if(this._waitingInputRelations[t.id]){const e=this._waitingInputRelations[t.id],n=this._nodes[t.id];if(!n)return;for(const t of e){const e=n.inputs[t.inputName];e&&e.endRelation(t.relation)}}}unregisterNode(t){delete this._nodes[t.id]}getMetadata(){const t=[],e=Object.keys(this._nodes);for(const n of e){const e=this._nodes[n];if(!e.metadata)continue;const i={id:n,name:e.metadata.name,package:e.metadata.package,displayName:e.metadata.displayName,relationsOptions:e.metadata.relationsOptions,nodeMetadata:e.metadata.nodeMetadata,outputs:[]};if(e.allOutputs){for(const t of e.allOutputs){if(!t.relations)continue;if(!t.name)continue;const e={outputName:t.name,inputs:[]};for(const n of t.relations)n.input?.name&&e.inputs.push({id:n.input.parentId,inputName:n.input.name});i.outputs?.push(e)}t.push(i)}}return t}}o.ɵfac=function(t){return new(t||o)},o.ɵprov=i.Yz({token:o,factory:o.ɵfac})}}]);
//# sourceMappingURL=3551.chunk.69e0b09fb0dedbcd8338.js.map