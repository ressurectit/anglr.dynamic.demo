"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[5957],{75957:(t,e,n)=>{n.d(e,{F:()=>E});var i=n(4905),o=n(27052),s=n(9360),a=n(53682),r=n(40362);class u{constructor(t,e,n,i,o){this._parentGroup=t,this._relationManager=e,this.history=n,this.start=i,this.end=o,this._destroyingSubject=new a.xQ,this.output=null,this.input=null,this._path=this._parentGroup.append("path").attr("fill","transparent").attr("stroke","#48B8B8").attr("stroke-width","3px"),this._lineGenerator=(0,s.jvg)().curve(s.tFB.beta(.75))}get destroying(){return this._destroyingSubject.asObservable()}destroy(){this._path?.remove(),this._destroyingSubject.next()}invalidateVisuals(t){if(t==r.r){const t=this._relationManager.getActiveInput();this._relationManager.setActiveInput(null),t?t.addRelation(this)?(this.end=t.getCoordinates(),this.input=t,this.history.getNewState()):(this.destroy(),this.start=null,this.end=null,this.input=null,this.output=null,this.history.getNewState()):(this.destroy(),this.start=null,this.end=null,this.input=null,this.output=null)}if(!this.start||!this.end)return;let e;if(this.end.x<=this.start.x){let t=this.start.x-this.end.x;const n=(this.end.y-this.start.y)/2;t<12&&(t=12),t*=1.3,e=[[this.start.x,this.start.y],[this.start.x+t,this.start.y+n],[this.end.x-t,this.start.y+n],[this.end.x,this.end.y]]}else{const t=(this.end.x-this.start.x)/3;e=[[this.start.x,this.start.y],[this.start.x+t,this.start.y],[this.end.x-t,this.end.y],[this.end.x,this.end.y]]}this._path.attr("d",this._lineGenerator(e))}}var d=n(26220),c=n(47432),l=n(74445),h=n(46480),p=n(14389),f=n(49891),g=n(43939),v=n(91861),m=n(79440),y=n(15783),x=n(13691),b=n(36973),w=n(48397);function M(t,e,n,i,o,s,a){try{var r=t[s](a),u=r.value}catch(t){return void n(t)}r.done?e(u):Promise.resolve(u).then(i,o)}class _{constructor(t,e,n,i){this.viewContainerRef=t,this.relationsNodeManager=e,this.loader=n,this.logger=i,this.destroySubscription=null,this.componentRef=null,this.componentMetadata=null,this.zoomLevel=1,this.create=new l.v,this.destroy=new l.v}get component(){return this.componentRef?this.componentRef.instance:null}ngOnChanges(t){var e,n=this;return(e=function*(){if((0,f.$)("zoomLevel")in t&&(0,g.EN)(n.zoomLevel)&&!((0,f.$)("componentMetadata")in t)){const e=n.component;if(e){const i=t[(0,f.$)("zoomLevel")];e.zoomLevel=n.zoomLevel;const o={};(0,p.m)(o,"zoomLevel",i,i.previousValue),e.ngOnChanges(o),e.invalidateVisuals()}}else if(n.logger?.debug("RelationsNodeRendererSADirective: rendering node {@id}",{id:n.componentMetadata?.id}),n.ngOnDestroy(),n.viewContainerRef.clear(),(0,f.$)("componentMetadata")in t&&n.componentMetadata){const t=yield n.loader.loadItem(n.componentMetadata);if(!t)return void n.logger?.warn("RelationsNodeRendererSADirective: Unable to find relations node type {@type}",{name:n.componentMetadata.name,package:n.componentMetadata.package});if(n.componentRef=n.viewContainerRef.createComponent(t.data,{injector:n.viewContainerRef.injector}),n.logger?.debug("RelationsNodeRendererSADirective: node rendered {@id}",{id:n.componentMetadata?.id}),n.component){const t=n.component;n.destroySubscription=t.destroy.subscribe((()=>n.ngOnDestroy())),n.logger?.debug("RelationsNodeRendererSADirective: initializing node with metadata {@id}",{id:n.componentMetadata?.id}),t.metadata=n.componentMetadata,t.zoomLevel=n.zoomLevel;const e={};(0,p.m)(e,"metadata",n.componentMetadata,null,!0),(0,p.m)(e,"zoomLevel",n.zoomLevel,null,!0),t.ngOnChanges(e),n.logger?.debug("RelationsNodeRendererSADirective: invalidating node visuals {@id}",{id:n.componentMetadata?.id}),t.invalidateVisuals(),n.componentRef.changeDetectorRef.markForCheck(),n.relationsNodeManager.registerNode(n.component),n.create.next(t)}}},function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function a(t){M(s,i,o,a,r,"next",t)}function r(t){M(s,i,o,a,r,"throw",t)}a(void 0)}))})()}ngOnDestroy(){this.destroySubscription?.unsubscribe(),this.destroySubscription=null,this.componentRef&&(this.logger?.debug("RelationsNodeRendererSADirective: destroying node {@id}",{id:this.componentMetadata?.id}),this.component&&(this.componentMetadata&&this.destroy.next(this.componentMetadata),this.relationsNodeManager.unregisterNode(this.component)),this.componentRef?.destroy(),this.componentRef=null)}}_.ɵfac=function(t){return new(t||_)(m.Y(y.s_),m.Y(w.J),m.Y(v.fI),m.Y(h.bZ,8))},_.ɵdir=x.lG({type:_,selectors:[["","relationsNodeRenderer",""]],inputs:{componentMetadata:["relationsNodeRenderer","componentMetadata"],zoomLevel:"zoomLevel"},outputs:{create:"create",destroy:"destroy"},exportAs:["relationsNodeRenderer"],standalone:!0,features:[b.T]});var N=n(84773),R=n(43870),I=n(4477),P=n(72891),S=n(6845),k=n(66794),D=n(73301),z=n(55436),L=n(47083),C=n(85320),O=n(82568),F=n(80827),Y=n(15686),U=n(12311);const j=["relationsGroup"];function A(t,e){if(1&t){const t=N.E();R.O4(),R.kc(),I.yn(0)(1,4),P.N("destroy",(function(e){R.CH(t);const n=S.o();return R.Kt(n.destroyNode(e))})),I.BQ()()}if(2&t){const t=e.$implicit,n=S.o();k.x(1),D.Q("relationsNodeRenderer",t)("zoomLevel",n.zoomLevel)}}class E{constructor(t,e){this.relationManager=t,this.history=e,this.backgroundSize=16,this.lastMouseDownPosition={x:0,y:0},this.lastMouseUpPosition={x:0,y:0},this.canvasPosition={x:0,y:0},this.zoomLevel=1,this.isDragging=!1,this.nodeDefinitions=[]}get backgroundSizeStyle(){return`${this.backgroundSize}px ${this.backgroundSize}px`}get _backgroundPositionStyle(){return`${this.canvasPosition.x%this.backgroundSize}px ${this.canvasPosition.y%this.backgroundSize}px`}createRelation(){return new u((0,s.Ys)(this.relationsGroup?.nativeElement),this.relationManager,this.history,null,null)}onMouseDown(t){t.buttons==d.t.LEFT&&(this.lastMouseDownPosition={x:t.clientX,y:t.clientY},this.isDragging=!0)}onMouseMove(t){this.isDragging&&(this.canvasPosition={x:this.lastMouseUpPosition.x+t.clientX-this.lastMouseDownPosition.x,y:this.lastMouseUpPosition.y+t.clientY-this.lastMouseDownPosition.y})}onMouseUp(t){this.isDragging&&(this.isDragging=!1,this.lastMouseUpPosition={x:this.lastMouseUpPosition.x+t.clientX-this.lastMouseDownPosition.x,y:this.lastMouseUpPosition.y+t.clientY-this.lastMouseDownPosition.y})}onWheel(t){if(t.deltaY){const e=(0,c.uZ)(this.zoomLevel+.05*(t.deltaY>1?-1:1),.2,2);this.canvasPosition={x:this.canvasPosition.x/this.zoomLevel*e,y:this.canvasPosition.y/this.zoomLevel*e},this.zoomLevel=e,this.lastMouseUpPosition={x:this.canvasPosition.x,y:this.canvasPosition.y},this.backgroundSize=16*this.zoomLevel}t.preventDefault(),t.stopImmediatePropagation()}destroyNode(t){const e=this.nodeDefinitions.indexOf(t);e<0||(this.nodeDefinitions.splice(e,1),this.history.getNewState())}}E.ɵfac=function(t){return new(t||E)(m.Y(w.J),m.Y(v.nR))},E.ɵcmp=x.Xp({type:E,selectors:[["relations-canvas"]],viewQuery:function(t,e){if(1&t&&z.Gf(j,5,i.SB),2&t){let t;z.iG(t=z.CR())&&(e.relationsGroup=t.first)}},hostVars:4,hostBindings:function(t,e){1&t&&P.N("mousedown",(function(t){return e.onMouseDown(t)}))("mousemove",(function(t){return e.onMouseMove(t)}))("mouseup",(function(t){return e.onMouseUp(t)}),!1,L.Jf)("wheel",(function(t){return e.onWheel(t)})),2&t&&C.Ud("background-size",e.backgroundSizeStyle)("background-position",e._backgroundPositionStyle)},inputs:{nodeDefinitions:"nodeDefinitions"},standalone:!0,features:[O.j],decls:5,vars:3,consts:[[1,"flow-area"],[1,"relations-wrapper"],["relationsGroup",""],[4,"ngFor","ngForOf"],[3,"relationsNodeRenderer","zoomLevel","destroy"]],template:function(t,e){1&t&&(F.Tg(0,"div",0),R.O4(),F.Tg(1,"svg",1),F._U(2,"g",null,2),F.qZ(),Y.Y(4,A,2,2,"ng-container",3),F.qZ()),2&t&&(C.Ud("transform","translate("+e.canvasPosition.x+"px, "+e.canvasPosition.y+"px) scale("+e.zoomLevel+")"),k.x(4),D.Q("ngForOf",e.nodeDefinitions))},dependencies:[o.e,U.s,_],styles:["[_nghost-%COMP%]\n{\n    background-color: #e5e5f7;\n    opacity: 0.6;\n    background-image: radial-gradient(#444cf7 0.8px, #e5e5f7 0.8px);\n    overflow: hidden;\n}\n\n.relations-wrapper[_ngcontent-%COMP%]\n{\n    width: 100%;\n    height: 100%;\n    overflow: visible;\n}"],changeDetection:0})},40362:(t,e,n)=>{n.d(e,{r:()=>i});const i="drop"},26220:(t,e,n)=>{var i;n.d(e,{t:()=>i}),function(t){t[t.LEFT=1]="LEFT"}(i||(i={}))},53971:(t,e,n)=>{n.d(e,{AL:()=>L,aU:()=>C,md:()=>z,bv:()=>P,YK:()=>k,Ub:()=>U,P_:()=>Y,xt:()=>O,Oq:()=>F,UB:()=>D,I_:()=>S});var i=n(60640),o=n(11776),s=n(86707),a=n(65569),r=n(44677),u=n(12193),d=n(13457),c=n(44055),l=n(46480),h=n(91861),p=n(10439),f=n(87606);function g(t,e,n,i,o,s,a){try{var r=t[s](a),u=r.value}catch(t){return void n(t)}r.done?e(u):Promise.resolve(u).then(i,o)}const v=function(){var t,e=(t=function*(t,e){const n=yield(0,f.K)((0,p.j)(t,e));if(e?.debug("relationsNodeExtractor: trying to extract dynamic node"),!n)return null;const i=n.data;if(!i)return null;const o=yield i.relationsEditorMetadata;return o?{data:o.nodeDefinition,metaInfo:o.metaInfo}:null},function(){var e=this,n=arguments;return new Promise((function(i,o){var s=t.apply(e,n);function a(t){g(s,i,o,a,r,"next",t)}function r(t){g(s,i,o,a,r,"throw",t)}a(void 0)}))});return function(t,n){return e.apply(this,arguments)}}();function m(t,e,n,i,o,s,a){try{var r=t[s](a),u=r.value}catch(t){return void n(t)}r.done?e(u):Promise.resolve(u).then(i,o)}const y=function(){var t,e=(t=function*(t,e){const n=t;if(e?.debug("componentRelationsNodeExtractor: trying to extract dynamic node"),!n)return null;const i=n.default;if(!i)return null;const o=yield i.relationsEditorMetadata;return o?{data:o.nodeDefinition,metaInfo:o.metaInfo,singleton:!0,displayName:n.displayName}:null},function(){var e=this,n=arguments;return new Promise((function(i,o){var s=t.apply(e,n);function a(t){m(s,i,o,a,r,"next",t)}function r(t){m(s,i,o,a,r,"throw",t)}a(void 0)}))});return function(t,n){return e.apply(this,arguments)}}();var x=n(38327),b=n(54870);class w{constructor(t,e){this._componentsRegister=t,this._logger=e}tryToGet(t){if("static-components"!=t.package)return null;this._logger?.debug("StaticComponentsRelationsNodesProvider: trying to get node {@item}",{name:t.name,package:t.package});const e=this._componentsRegister.getType(t.name);return e?{default:e}:null}}function M(t,e,n,i,o,s,a){try{var r=t[s](a),u=r.value}catch(t){return void n(t)}r.done?e(u):Promise.resolve(u).then(i,o)}w.ɵfac=function(t){return new(t||w)(o.LF(b.w),o.LF(l.bZ,8))},w.ɵprov=x.Yz({token:w,factory:w.ɵfac});class _{constructor(t){this._logger=t}tryToGet(t){var e,i=this;return(e=function*(){try{switch(i._logger?.debug("DefaultDynamicModuleRelationsProvider: trying to get relations types for module {@module}",{moduleName:t.package}),t.package){case"basic-components":return yield n.e(4041).then(n.bind(n,94041));case"material-components":return yield n.e(5342).then(n.bind(n,85342));default:return null}}catch(e){i._logger?.debug("DefaultDynamicModuleRelationsProvider: module {@module} was not found, reason: "+e,{moduleName:t.package})}return null},function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function a(t){M(s,i,o,a,r,"next",t)}function r(t){M(s,i,o,a,r,"throw",t)}a(void 0)}))})()}}_.ɵfac=function(t){return new(t||_)(o.LF(l.bZ,8))},_.ɵprov=x.Yz({token:_,factory:_.ɵfac});class N{constructor(t,e){this._componentsRegister=t,this._logger=e}tryToGet(t){if("static-components"!=t.package)return null;this._logger?.debug("StaticComponentsRelationsTypesProvider: trying to get relations types {@item}",{name:t.name,package:t.package});const e=this._componentsRegister.types;return e?{default:e}:null}}N.ɵfac=function(t){return new(t||N)(o.LF(b.w),o.LF(l.bZ,8))},N.ɵprov=x.Yz({token:N,factory:N.ɵfac});var R=n(48397),I=n(47432);const P={provide:h.n7,useClass:s.o,multi:!0},S={provide:h.n7,useClass:w,multi:!0},k={provide:h.GP,useClass:_,multi:!0},D={provide:h.GP,useClass:N,multi:!0},z={provide:h.yh,useFactory:t=>new a.$([v],t),deps:[[new i.Fi,l.bZ]],multi:!0},L={provide:h.yh,useFactory:t=>new a.$([y],t),deps:[[new i.Fi,l.bZ]],multi:!0},C={provide:h.DZ,useFactory:t=>new a.$([r.L],t),deps:[[new i.Fi,l.bZ]],multi:!0},O={provide:h.Bj,useFactory:()=>new u.S((0,o.f3)(h.GP),(0,o.f3)(h.DZ),I.CQ,(0,o.f3)(l.bZ,{optional:!0})??void 0,!0)},F={provide:h.fI,useFactory:()=>new u.S((0,o.f3)(h.n7),(0,o.f3)(h.yh),I.Zl,(0,o.f3)(l.bZ,{optional:!0})??void 0)},Y={provide:d.Q,useExisting:R.J},U={provide:h.nR,useClass:c.Y}},47432:(t,e,n)=>{n.d(e,{CQ:()=>d,TN:()=>l,Zl:()=>c,hE:()=>h,uZ:()=>u});var i=n(14389),o=n(43939),s=n(53971),a=n(48397),r=n(54870);function u(t,e,n){return Math.min(Math.max(t,e),n)}const d=function(t){return!((0,o.fp)(t?.data)||!Array.isArray(t.data))},c=function(t){return!((0,o.fp)(t?.data)||!(0,o.P9)(t.data)||(0,o.EN)(t.singleton)&&!(0,o.jn)(t.singleton)||(0,o.EN)(t.displayName)&&!(0,o.HD)(t.displayName)||(0,o.EN)(t?.metaInfo)&&!(0,o.wV)(t.metaInfo))};function l(t=["basic-components","material-components"]){return[s.bv,s.YK,s.md,s.AL,s.aU,s.xt,s.Oq,a.J,s.P_,s.Ub,...t.map((t=>(0,i.X)(t)))]}function h(t,e){return[...l(e),s.I_,s.UB,{provide:r.w,useClass:t},(0,i.X)("static-components")]}},48397:(t,e,n)=>{n.d(e,{J:()=>o});var i=n(38327);class o{constructor(){this._nodes={},this._waitingInputRelations={}}setActiveInput(t){this._activeInput=t}getActiveInput(){return this._activeInput}registerNode(t){var e,n;if(this._nodes[t.id]=t,t.metadata?.outputs&&Array.isArray(t.metadata?.outputs))for(const i of t.metadata?.outputs){if(!i.inputs||!Array.isArray(i.inputs))continue;const o=t.outputs[i.outputName];if(o)for(const t of i.inputs){const i=this._nodes[t.id],s=o.startRelation();if(!i){(e=this._waitingInputRelations)[n=t.id]??(e[n]=[]),this._waitingInputRelations[t.id].push({inputName:t.inputName,relation:s});continue}const a=i.inputs[t.inputName];a&&a.endRelation(s)}}if(this._waitingInputRelations[t.id]){const e=this._waitingInputRelations[t.id],n=this._nodes[t.id];if(!n)return;for(const i of e){const e=n.inputs[i.inputName];e&&(e.endRelation(i.relation),delete this._waitingInputRelations[t.id])}}}unregisterNode(t){delete this._nodes[t.id]}getMetadata(){const t=[],e=Object.keys(this._nodes);for(const n of e){const e=this._nodes[n];if(!e.metadata)continue;const i={id:n,name:e.metadata.name,package:e.metadata.package,displayName:e.metadata.displayName,relationsOptions:e.metadata.relationsOptions,nodeMetadata:e.metadata.nodeMetadata,outputs:[]};if(e.allOutputs){for(const t of e.allOutputs){if(!t.relations)continue;if(!t.name)continue;const e={outputName:t.name,inputs:[]};for(const n of t.relations)n.input?.name&&e.inputs.push({id:n.input.parentId,inputName:n.input.name});i.outputs?.push(e)}t.push(i)}}return t}}o.ɵfac=function(t){return new(t||o)},o.ɵprov=i.Yz({token:o,factory:o.ɵfac})},54870:(t,e,n)=>{n.d(e,{w:()=>o});var i=n(38327);class o{constructor(){this._definedTypes=this.getDefinedTypes()}get types(){return Object.keys(this._definedTypes)}getType(t){return this._definedTypes[t]??null}}o.ɵfac=function(t){return new(t||o)},o.ɵprov=i.Yz({token:o,factory:o.ɵfac})},10439:(t,e,n)=>{n.d(e,{j:()=>s});var i=n(43939),o=n(89402);const s=(t,e)=>{const n=t;return e?.debug("relationsExportExtractor: trying to extract dynamic relations"),(0,i.EN)(n.relations)&&(0,i.P9)(n.relations)&&(0,o.O)(n.relations)?{data:n.relations}:(0,i.EN)(n.default)&&(0,i.P9)(n.default)&&(0,o.O)(n.default)?{data:n.default}:null}},44055:(t,e,n)=>{n.d(e,{Y:()=>u});var i=n(43939),o=n(53682),s=n(13457),a=n(11776),r=n(38327);class u{constructor(t){this.metadataState=t,this.activeIndex=null,this.saveIndex=null,this.states=[],this.enabled=!0,this.popSubject=new o.xQ,this.historyChangeSubject=new o.xQ}get canUndo(){return!(0,i.fp)(this.activeIndex)&&this.activeIndex>0}get canRedo(){return!(0,i.fp)(this.activeIndex)&&this.activeIndex+1<this.states.length}get saved(){return this.activeIndex===this.saveIndex}get pop(){return this.popSubject.asObservable()}get historyChange(){return this.historyChangeSubject.asObservable()}get state(){return(0,i.fp)(this.activeIndex)?null:this.states[this.activeIndex]}undo(){this.canUndo&&this.activeIndex&&(this.activeIndex--,this.popSubject.next(this.states[this.activeIndex]))}redo(){this.canRedo&&this.activeIndex&&(this.activeIndex++,this.popSubject.next(this.states[this.activeIndex]))}getNewState(){if(!this.enabled)return;this.states.length>=100&&this.states.shift(),this.activeIndex&&this.activeIndex+1<this.states.length&&this.states.splice(this.activeIndex+1,this.states.length-(this.activeIndex+1));const t=this.metadataState.getMetadata();t&&(this.states.push(JSON.parse(JSON.stringify(t))),this.activeIndex=this.states.length-1,this.historyChangeSubject.next())}save(){this.saveIndex=this.activeIndex}setInitialState(t){this.states.push(JSON.parse(JSON.stringify(t))),this.activeIndex=this.states.length-1,this.save()}clean(){this.activeIndex=null,this.saveIndex=null,this.states=[]}enable(){this.enabled=!0}disable(){this.enabled=!1}}u.ɵfac=function(t){return new(t||u)(a.LF(s.Q))},u.ɵprov=r.Yz({token:u,factory:u.ɵfac})}}]);
//# sourceMappingURL=5957.chunk.05ed8f9847a62b5bbaa3.js.map