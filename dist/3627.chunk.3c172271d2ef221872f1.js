"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[3627],{63627:(t,e,n)=>{n.r(e),n.d(e,{DataTemplateRelationsEditorMetadata:()=>x});var o=n(93551),i=n(53971),s=n(36942),a=n(60901),r=n(85478),l=n(68490),d=n(69784),u=n(43939),c=n(79440),h=n(68961),p=n(4905),g=n(13691),m=n(73379),v=n(47098),f=n(82568),_=n(80827),y=n(41853),M=n(72891),C=n(66794),w=n(73301),D=n(47826);function b(t,e,n,o,i,s,a){try{var r=t[s](a),l=r.value}catch(t){return void n(t)}r.done?e(l):Promise.resolve(l).then(o,i)}class P extends o.M{constructor(t,e,n){super(t,e),this.dialog=n}showCodeEditor(){var t,e=this;return(t=function*(){const t=yield e.dialog.open(l.M,{title:"Code editor",width:"75vw",height:"75vh",data:{content:e.metadata?.relationsOptions?.template??"",languageModel:d.d}}).afterClosed().toPromise();(0,u.EN)(t)&&e.metadata?.relationsOptions&&(e.metadata.relationsOptions.template=t)},function(){var e=this,n=arguments;return new Promise((function(o,i){var s=t.apply(e,n);function a(t){b(s,o,i,a,r,"next",t)}function r(t){b(s,o,i,a,r,"throw",t)}a(void 0)}))})()}}P.ɵfac=function(t){return new(t||P)(c.Y(h.s),c.Y(p.SB),c.Y(D.J))},P.ɵcmp=g.Xp({type:P,selectors:[["data-template-node"]],standalone:!0,features:[m._([i.Vh]),v.q,f.j],decls:21,vars:9,consts:[[1,"node-content"],[1,"inputs-outputs"],[1,"inputs"],[1,"input"],["name","template",3,"parentCoordiantes","zoomLevel","parent"],["name","data",3,"parentCoordiantes","zoomLevel","parent"],[1,"outputs"],[1,"output"],["name","output",3,"parentCoordiantes","zoomLevel","parent"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(t,e){1&t&&(_.Tg(0,"relations-node-header"),y._(1,"data template"),_.qZ(),_.Tg(2,"div",0)(3,"div",1)(4,"div",2)(5,"div",3),_._U(6,"relation-node-input",4),_.Tg(7,"div"),y._(8,"template"),_.qZ()(),_.Tg(9,"div",3),_._U(10,"relation-node-input",5),_.Tg(11,"div"),y._(12,"data"),_.qZ()()(),_.Tg(13,"div",6)(14,"div",7)(15,"div"),y._(16,"output"),_.qZ(),_._U(17,"relation-node-output",8),_.qZ()()(),_.Tg(18,"button",9),M.N("click",(function(){return e.showCodeEditor()})),_.Tg(19,"span"),y._(20,"template"),_.qZ()()()),2&t&&(C.x(6),w.Q("parentCoordiantes",e.nodePosition)("zoomLevel",e.zoomLevel)("parent",e),C.x(4),w.Q("parentCoordiantes",e.nodePosition)("zoomLevel",e.zoomLevel)("parent",e),C.x(7),w.Q("parentCoordiantes",e.nodePosition)("zoomLevel",e.zoomLevel)("parent",e))},dependencies:[s.e,a.P,r.n],encapsulation:2,changeDetection:0});class x{constructor(){this.metaInfo={name:"Data template",description:"Renders data into template",group:"Data"},this.nodeDefinition=P,Object.freeze(this)}}},68490:(t,e,n)=>{n.d(e,{M:()=>j});var o=n(30621),i=n(13691),s=n(38327);class a{}a.ɵfac=function(t){return new(t||a)},a.ɵmod=i.oA({type:a}),a.ɵinj=s.cJ({});var r=n(9249),l=n(79440),d=n(82568),u=n(84773),c=n(80827),h=n(72891),p=n(41853),g=n(43870),m=n(11282),v=n(73301),f=n(66794),_=n(31750),y=n(80943),M=n(74445),C=n(49891),w=n(43939),D=n(58654);self.MonacoEnvironment={getWorkerUrl:function(t,e){return"json"===e?"dist/json.worker.js":"css"===e||"scss"===e||"less"===e?"dist/css.worker.js":"html"===e||"handlebars"==e?"dist/html.worker.js":"typescript"===e||"javascript"===e?"dist/ts.worker.js":"dist/editor.worker.js"}};const b={target:D.Mj.typescript.ScriptTarget.ES2020,module:D.Mj.typescript.ModuleKind.CommonJS,moduleResolution:D.Mj.typescript.ModuleResolutionKind.NodeJs,allowNonTsExtensions:!0,removeComments:!0,noImplicitAny:!0,noImplicitReturns:!0,noImplicitOverride:!0,noImplicitThis:!0,noUnusedLocals:!0,noUnusedParameters:!0,strict:!0,strictNullChecks:!0,esModuleInterop:!0,newLine:D.Mj.typescript.NewLineKind.LineFeed,typeRoots:["node_modules/@types"]};D.Mj.typescript.typescriptDefaults.setCompilerOptions(b);var P=n(4905),x=n(36973);class E{constructor(t){this.element=t,this.codeEditor=null,this.openedFile=null,this.changeEvent=null,this.save=new M.v,this.contentChange=new M.v}ngOnChanges(t){(0,C.$)("languageModel")in t&&this.languageModel&&(0,C.$)("content")in t&&(0,w.EN)(this.content)&&this.updateContent()}ngAfterViewInit(){this.createEditor()}saveContent(){this.openedFile&&this.codeEditor&&this.languageModel&&this.save.emit({content:this.openedFile.getValue(),code:this.languageModel.compiledCode(this.codeEditor)})}ngOnDestroy(){this.changeEvent?.dispose(),this.changeEvent=null,this.openedFile?.dispose(),this.openedFile=null,this.codeEditor?.dispose(),this.codeEditor=null}createEditor(){this.codeEditor=D.j6.create(this.element.nativeElement,{theme:"vs-dark",model:this.openedFile,lightbulb:{enabled:!0},minimap:{enabled:!0}}),this.codeEditor.addCommand(D.DC.CtrlCmd|D.VD.KeyS,(()=>{this.saveContent()})),this.changeEvent=this.codeEditor.onDidChangeModelContent((()=>{this.openedFile&&this.languageModel&&this.codeEditor&&this.contentChange.emit({content:this.openedFile.getValue(),code:this.languageModel.compiledCode(this.codeEditor)})}))}updateContent(){this.openedFile?.dispose(),this.openedFile=null,this.languageModel&&!(0,w.fp)(this.content)&&(this.openedFile=D.j6.createModel(this.content,this.languageModel.language,D.Sf.file(`index.${this.languageModel.extension}`)),this.codeEditor?.setModel(this.openedFile))}}E.monacoInit=!0,E.ɵfac=function(t){return new(t||E)(l.Y(P.SB))},E.ɵcmp=i.Xp({type:E,selectors:[["code-editor"]],inputs:{content:"content",languageModel:"languageModel"},outputs:{save:"save",contentChange:"contentChange"},features:[x.T],decls:0,vars:0,template:function(t,e){},styles:["[_nghost-%COMP%]\r\n{\r\n    display: block;\r\n    width: 100%;\r\n    height: 100%;\r\n}"],changeDetection:0});class j{constructor(t,e){this.data=t,this.dialog=e,this.content=null,this.content=t.content}}j.ɵfac=function(t){return new(t||j)(l.Y(r.m),l.Y(_.s))},j.ɵcmp=i.Xp({type:j,selectors:[["code-editor-dialog"]],standalone:!0,features:[d.j],decls:9,vars:3,consts:[[2,"height","calc(75vh - 32px)","width","calc(75vw - 20px)",3,"content","languageModel","save"],["editor",""],[1,"flex-row","flex-end"],["type","button",1,"btn","btn-info",3,"mat-dialog-close"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(t,e){if(1&t){const t=u.E();c.Tg(0,"code-editor",0,1),h.N("save",(function(t){return e.content=t.content})),c.qZ(),c.Tg(2,"div",2)(3,"button",3)(4,"span"),p._(5,"cancel"),c.qZ()(),c.Tg(6,"button",4),h.N("click",(function(){return g.CH(t),m.M(1).saveContent(),g.Kt(e.dialog.close(e.content))})),c.Tg(7,"span"),p._(8,"ok"),c.qZ()()()}2&t&&(v.Q("content",e.data.content)("languageModel",e.data.languageModel),f.x(3),v.Q("mat-dialog-close",null))},dependencies:[a,E,o.I,y.ZT],encapsulation:2,changeDetection:0})},93551:(t,e,n)=>{n.d(e,{M:()=>v});var o=n(49891),i=n(53682),s=n(85478),a=n(60901),r=n(91861),l=n(79440),d=n(68961),u=n(4905),c=n(13691),h=n(55436),p=n(72891),g=n(47083),m=n(36973);class v{constructor(t,e,n){this.changeDetector=t,this.element=e,this.initialized=!1,this.isDragging=!1,this.lastMouseDownPosition={x:0,y:0},this.lastMouseDownNodePosition={x:0,y:0},this.nodePosition={x:0,y:0},this.ɵAllOutputs=[],this.ɵInputs={},this.ɵOutputs={},this.destroySubject=new i.xQ,this.zoomLevel=1,n&&(n.destroy=this.destroySubject),this.element.nativeElement.classList.add("relations-node"),this.updatePosition()}get id(){return this.metadata?.id??""}get allOutputs(){return this.ɵAllOutputs}get inputs(){return this.ɵInputs}get outputs(){return this.ɵOutputs}get destroy(){return this.destroySubject.asObservable()}ngOnChanges(t){(0,o.$)("metadata")in t&&this.metadata&&(this.metadata.nodeMetadata?.coordinates&&(this.nodePosition=this.metadata.nodeMetadata.coordinates,this.updatePosition()),this.metadataSet())}invalidateVisuals(){this.changeDetector.detectChanges(),this.initialized||(this.initialized=!0,this.initEndpoints())}onMouseDown(t){this.isDragging=!0,this.lastMouseDownPosition={x:t.clientX,y:t.clientY},this.lastMouseDownNodePosition={x:this.nodePosition.x,y:this.nodePosition.y},t.stopImmediatePropagation()}onMouseMove(t){this.isDragging&&(this.nodePosition={x:this.lastMouseDownNodePosition.x+1*(t.clientX-this.lastMouseDownPosition.x)/this.zoomLevel,y:this.lastMouseDownNodePosition.y+1*(t.clientY-this.lastMouseDownPosition.y)/this.zoomLevel},this.updatePosition(),t.stopImmediatePropagation(),t.preventDefault(),this.updateRelations())}onMouseUp(t){this.isDragging&&(this.isDragging=!1,t.stopImmediatePropagation(),t.preventDefault())}initEndpoints(){const t=()=>{this.ɵInputs={},this.inputsChildren?.forEach((t=>{t.name&&(this.ɵInputs[t.name]=t)})),Object.freeze(this.ɵInputs)},e=()=>{this.ɵAllOutputs=this.outputsChildren.toArray(),this.ɵOutputs={},this.outputsChildren?.forEach((t=>{t.name&&(this.ɵOutputs[t.name]=t)})),Object.freeze(this.ɵOutputs)};this.inputsChildren?.changes.subscribe((()=>t())),this.outputsChildren?.changes.subscribe((()=>e())),t(),e()}updateRelations(){this.inputsChildren.forEach((t=>{t.updateRelation()})),this.outputsChildren.forEach((t=>{t.updateRelation()}))}updatePosition(){this.element.nativeElement.style.left=`${this.nodePosition.x}px`,this.element.nativeElement.style.top=`${this.nodePosition.y}px`,this.metadata?.nodeMetadata?.coordinates&&(this.metadata.nodeMetadata.coordinates.x=this.nodePosition.x,this.metadata.nodeMetadata.coordinates.y=this.nodePosition.y)}metadataSet(){}}v.ɵfac=function(t){return new(t||v)(l.Y(d.s),l.Y(u.SB),l.Y(r.S7,8))},v.ɵdir=c.lG({type:v,viewQuery:function(t,e){if(1&t&&(h.Gf(a.P,5),h.Gf(s.n,5)),2&t){let t;h.iG(t=h.CR())&&(e.inputsChildren=t),h.iG(t=h.CR())&&(e.outputsChildren=t)}},hostBindings:function(t,e){1&t&&p.N("mousedown",(function(t){return e.onMouseDown(t)}))("mousemove",(function(t){return e.onMouseMove(t)}),!1,g.Jf)("mouseup",(function(t){return e.onMouseUp(t)}),!1,g.Jf)},features:[m.T]})},2198:(t,e,n)=>{n.d(e,{S:()=>l});var o=n(79440),i=n(4905),s=n(13691),a=n(48397),r=n(75957);class l{constructor(t,e,n){this._element=t,this._relationManager=e,this._canvas=n,this._isDragging=!1,this._lastMouseDownPosition={x:0,y:0},this.zoomLevel=1,this.parentCoordiantes={x:0,y:0}}get parentId(){return this.parent?.id??""}ngOnInit(){if(!this.parent)throw new Error("Every input or output endpoint must have parent specified")}getCoordinates(){return{x:this.parentCoordiantes.x+this._element.nativeElement.offsetLeft+this._element.nativeElement.offsetWidth/2,y:this.parentCoordiantes.y+this._element.nativeElement.offsetTop+this._element.nativeElement.offsetHeight/2}}}l.ɵfac=function(t){return new(t||l)(o.Y(i.SB),o.Y(a.J),o.Y(r.F))},l.ɵdir=s.lG({type:l,inputs:{name:"name",zoomLevel:"zoomLevel",parentCoordiantes:"parentCoordiantes",parent:"parent"}})},36942:(t,e,n)=>{n.d(e,{e:()=>M});var o=n(27052),i=n(91861),s=n(84773),a=n(80827),r=n(72891),l=n(43870),d=n(6845),u=n(41853),c=n(79440),h=n(13691),p=n(82568),g=n(43086),m=n(15686),v=n(66794),f=n(73301),_=n(21651);function y(t,e){if(1&t){const t=s.E();a.Tg(0,"div",2),r.N("click",(function(){l.CH(t);const e=d.o();return l.Kt(null==e.destroySubject||null==e.destroySubject.destroy?null:e.destroySubject.destroy.next())})),u._(1,"x"),a.qZ()}}class M{constructor(t){this.destroySubject=t}}M.ɵfac=function(t){return new(t||M)(c.Y(i.S7,8))},M.ɵcmp=h.Xp({type:M,selectors:[["relations-node-header"]],standalone:!0,features:[p.j],ngContentSelectors:["*"],decls:3,vars:1,consts:[[1,"header-content"],["class","destroy-icon",3,"click",4,"ngIf"],[1,"destroy-icon",3,"click"]],template:function(t,e){1&t&&(g.F$(),a.Tg(0,"div",0),g.Hs(1),a.qZ(),m.Y(2,y,2,0,"div",1)),2&t&&(v.x(2),f.Q("ngIf",null==e.destroySubject?null:e.destroySubject.destroy))},dependencies:[o.e,_.O],encapsulation:2,changeDetection:0})},60901:(t,e,n)=>{n.d(e,{P:()=>p});var o=n(27052),i=n(2198),s=n(26220),a=n(40362),r=n(43801),l=n(13691),d=n(72891),u=n(47083),c=n(47098),h=n(82568);class p extends i.S{ngOnDestroy(){this._relation&&this._relation.destroy()}addRelation(t){if(this._relation){if(this._relation.start?.x===t.start?.x&&this._relation.start?.y===t.start?.y)return!1;this._relation.destroy()}return this._relation=t,!0}endRelation(t){this.addRelation(t)&&this.updateRelation()}updateRelation(){this._relation&&(this._relation.end=this.getCoordinates(),this._relation.input=this,this._relation.invalidateVisuals())}_onMouseEnter(t){t.buttons===s.t.LEFT&&this._relationManager.setActiveInput(this)}_onMouseLeave(t){t.buttons===s.t.LEFT&&this._relationManager.setActiveInput(null)}_onMouseDown(t){t.stopImmediatePropagation(),t.preventDefault(),this._lastMouseDownPosition={x:t.clientX,y:t.clientY},this._tempRelation=this._relation,this._relation=null,this._isDragging=!0}_onMouseMove(t){this._isDragging&&(t.stopImmediatePropagation(),t.preventDefault(),this._tempRelation&&(this._tempRelation.end={x:this.getCoordinates().x+1*(t.clientX-this._lastMouseDownPosition?.x)/this.zoomLevel,y:this.getCoordinates().y+1*(t.clientY-this._lastMouseDownPosition?.y)/this.zoomLevel},this._tempRelation.invalidateVisuals()))}_onMouseUp(t){this._isDragging&&(this._isDragging=!1,t.stopImmediatePropagation(),t.preventDefault(),this._tempRelation?.invalidateVisuals(a.r))}}p.ɵfac=function(){let t;return function(e){return(t||(t=r.n5(p)))(e||p)}}(),p.ɵcmp=l.Xp({type:p,selectors:[["relation-node-input"]],hostBindings:function(t,e){1&t&&d.N("mouseenter",(function(t){return e._onMouseEnter(t)}))("mouseleave",(function(t){return e._onMouseLeave(t)}))("mousedown",(function(t){return e._onMouseDown(t)}))("mousemove",(function(t){return e._onMouseMove(t)}),!1,u.Jf)("mouseup",(function(t){return e._onMouseUp(t)}),!1,u.Jf)},standalone:!0,features:[c.q,h.j],decls:0,vars:0,template:function(t,e){},dependencies:[o.e],styles:["[_nghost-%COMP%]\n{\n    display: block;\n    width: 1.45em;\n    height: 1.45em;\n    border-width: .5em;\n    border-style: solid;\n    border-radius: 50%;\n    background-color: white;\n    cursor: crosshair;\n}"],changeDetection:0})},85478:(t,e,n)=>{n.d(e,{n:()=>h});var o=n(27052),i=n(2198),s=n(40362),a=n(43801),r=n(13691),l=n(72891),d=n(47083),u=n(47098),c=n(82568);class h extends i.S{constructor(){super(...arguments),this._relations=[]}get relations(){return this._relations}ngOnDestroy(){if(this._relations){const t=[...this._relations];for(const e of t)e.destroy()}}startRelation(){const t=this._canvas.createRelation();return t.start=this.getCoordinates(),t.output=this,t.destroying.subscribe((()=>{const e=this._relations.indexOf(t);e>=0&&this._relations.splice(e,1)})),this._relations.push(t),t}updateRelation(){if(this._relations)for(const t of this._relations)t.start=this.getCoordinates(),t.invalidateVisuals()}_onMouseDown(t){t.stopImmediatePropagation(),t.preventDefault(),this._isDragging=!0,this._lastMouseDownPosition={x:t.clientX,y:t.clientY},this._relation=this.startRelation()}_onMouseMove(t){this._isDragging&&(t.stopImmediatePropagation(),t.preventDefault(),this._relation&&(this._relation.end={x:this.getCoordinates().x+1*(t.clientX-this._lastMouseDownPosition.x)/this.zoomLevel,y:this.getCoordinates().y+1*(t.clientY-this._lastMouseDownPosition.y)/this.zoomLevel},this._relation.invalidateVisuals()))}_onMouseUp(t){this._isDragging&&(this._isDragging=!1,t.stopImmediatePropagation(),t.preventDefault(),this._relation?.invalidateVisuals(s.r))}}h.ɵfac=function(){let t;return function(e){return(t||(t=a.n5(h)))(e||h)}}(),h.ɵcmp=r.Xp({type:h,selectors:[["relation-node-output"]],hostBindings:function(t,e){1&t&&l.N("mousedown",(function(t){return e._onMouseDown(t)}))("mousemove",(function(t){return e._onMouseMove(t)}),!1,d.Jf)("mouseup",(function(t){return e._onMouseUp(t)}),!1,d.Jf)},standalone:!0,features:[u.q,c.j],decls:0,vars:0,template:function(t,e){},dependencies:[o.e],styles:["[_nghost-%COMP%]\n{\n    display: block;\n    width: 1.45em;\n    height: 1.45em;\n    border-width: .5em;\n    border-style: solid;\n    border-radius: 50%;\n    background-color: white;\n    cursor: crosshair;\n}"],changeDetection:0})},69784:(t,e,n)=>{n.d(e,{d:()=>o});const o=new(n(53136).y)("handlebars","hbs",(t=>t.getModel()?.getValue()??""))},53136:(t,e,n)=>{n.d(e,{y:()=>o});class o{constructor(t,e,n){this.language=t,this.extension=e,this.compiledCode=n}}}}]);
//# sourceMappingURL=3627.chunk.3c172271d2ef221872f1.js.map