"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[1969],{11172:(t,e,n)=>{n.r(e),n.d(e,{SyncValuesRelationsEditorMetadata:()=>it});var o=n(27052),i=n(48659),a=n(71791),s=n(25626),r=n(93551),l=n(52580),c=n(60901),d=n(85478),u=n(57466),h=n(43939),p=n(64297);class g{constructor(t){this.triggerSync=!1,this.idleTimeout=0,u.Rl.bind(this)(t)}}var m=n(70625),v=n(18830),f=n(9249),y=n(79440),b=n(77842),x=n(82568),N=n(76405),S=n(41853),w=n(66794),_=n(73301),P=n(49280),z=n(77470),M=n(27635),L=n(80943);class R{constructor(t){this.control=new m.NI,this.control.setValue(t)}}R.ɵfac=function(t){return new(t||R)(y.Y(f.m))},R.ɵcmp=b.Xp({type:R,selectors:[["configure-sync-property"]],standalone:!0,features:[x.j],decls:11,vars:3,consts:[[1,"dynamic-form-group","dynamic-margin-bottom-extra-small"],[1,"dynamic-control-label","dynamic-text-uppercase"],["type","text",1,"dynamic-form-control",3,"formControl"],[1,"dynamic-flex-row","dynamic-flex-end"],["type","button",1,"dynamic-btn","dynamic-btn-info","dynamic-margin-right-extra-small",3,"mat-dialog-close"],["type","button",1,"dynamic-btn","dynamic-btn-primary",3,"mat-dialog-close"]],template:function(t,e){1&t&&(N.Tg(0,"div",0)(1,"label",1),S._(2,"name"),N.qZ(),N._U(3,"input",2),N.qZ(),N.Tg(4,"div",3)(5,"button",4)(6,"span"),S._(7,"cancel"),N.qZ()(),N.Tg(8,"button",5)(9,"span"),S._(10,"ok"),N.qZ()()()),2&t&&(w.x(3),_.Q("formControl",e.control),w.x(2),_.Q("mat-dialog-close",null),w.x(3),_.Q("mat-dialog-close",e.control.value))},dependencies:[i.U,P.Fj,z.JJ,M.oH,v.I,L.ZT],encapsulation:2,changeDetection:0});var C=n(84773),O=n(4477),D=n(72891),k=n(43870),T=n(6845),Y=n(6427),B=n(68961),Z=n(4905),q=n(73379),E=n(47098),Q=n(15686),F=n(47826),U=n(15750),I=n(67406),G=n(12311),V=n(21651),j=n(24881),$=n(17790),A=n(71696),J=n(86170),H=n(66163);function X(t,e,n,o,i,a,s){try{var r=t[a](s),l=r.value}catch(t){return void n(t)}r.done?e(l):Promise.resolve(l).then(o,i)}function K(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function s(t){X(a,o,i,s,r,"next",t)}function r(t){X(a,o,i,s,r,"throw",t)}s(void 0)}))}}function W(t,e){1&t&&(N.Tg(0,"div",2)(1,"label",3),S._(2,"idle timeout"),N.qZ(),N._U(3,"input",14),N.qZ())}function tt(t,e){if(1&t){const t=C.E();O.yn(0),N.Tg(1,"div",15),N._U(2,"relation-node-input",16),N.Tg(3,"div"),S._(4),N.qZ(),N.Tg(5,"button",17),D.N("click",(function(e){const n=k.CH(t).index,o=T.o();return e.preventDefault(),e.stopPropagation(),k.Kt(o.configureSyncProperty(n))})),N._U(6,"span",18),N.qZ(),N.Tg(7,"button",7),D.N("click",(function(e){const n=k.CH(t).index,o=T.o();return e.preventDefault(),e.stopPropagation(),k.Kt(o.removeProperty(n))})),N._U(8,"span",19),N.qZ()(),O.BQ()}if(2&t){const t=e.$implicit,n=T.o();w.x(2),_.Q("parentCoordiantes",n.nodePosition)("zoomLevel",n.zoomLevel)("name",t)("parent",n),w.x(2),Y.Oq(t)}}function et(t,e){if(1&t&&(N.Tg(0,"div",15),N._U(1,"relation-node-input",20),N.Tg(2,"div"),S._(3,"trigger"),N.qZ()()),2&t){const t=T.o();w.x(1),_.Q("parentCoordiantes",t.nodePosition)("zoomLevel",t.zoomLevel)("parent",t)}}function nt(t,e){if(1&t&&(O.yn(0),N.Tg(1,"div",21)(2,"div"),S._(3),N.qZ(),N._U(4,"relation-node-output",16),N.qZ(),O.BQ()),2&t){const t=e.$implicit,n=T.o();w.x(3),Y.Oq(t),w.x(1),_.Q("parentCoordiantes",n.nodePosition)("zoomLevel",n.zoomLevel)("name",t)("parent",n)}}class ot extends r.M{constructor(t,e,n,o){super(t,e),this.dialog=n,this.form=o.build(new g(null)),this.form.valueChanges.subscribe((t=>{this.metadata?.relationsOptions&&((0,u.l7)(this.metadata.relationsOptions,t),this.history.getNewState())}))}addProperty(){var t=this;return K((function*(){yield t.configureSyncProperty(t.metadata?.relationsOptions?.syncProperties?.length??0),t.changeDetector.detectChanges()}))()}removeProperty(t){this.metadata?.relationsOptions?.syncProperties&&(this.metadata.relationsOptions.syncProperties.splice(t,1),this.history.getNewState())}configureSyncProperty(t){var e=this;return K((function*(){var n;const o=yield(0,p.n)(e.dialog.open(R,{title:"configure sync property",width:"60vw",data:e.metadata?.relationsOptions?.syncProperties?.[t]??""}).afterClosed());(0,h.EN)(o)&&e.metadata?.relationsOptions&&((n=e.metadata.relationsOptions).syncProperties??(n.syncProperties=[]),e.metadata.relationsOptions.syncProperties[t]=o,e.history.getNewState())}))()}metadataSet(){this.metadata?.relationsOptions&&this.form.patchValue(this.metadata.relationsOptions)}}ot.ɵfac=function(t){return new(t||ot)(y.Y(B.s),y.Y(Z.SB),y.Y(F.J),y.Y(a.p))},ot.ɵcmp=b.Xp({type:ot,selectors:[["sync-values-node"]],standalone:!0,features:[q._([a.p]),E.q,x.j],decls:19,vars:9,consts:[["name","sync values",3,"parent","destroySubject"],[1,"node-content",3,"formGroup"],[1,"dynamic-form-group","dynamic-margin-bottom-extra-small"],[1,"dynamic-control-label","dynamic-text-uppercase"],["formControlName","triggerSync",1,"dynamic-form-control"],[3,"ngValue"],["class","dynamic-form-group dynamic-margin-bottom-extra-small",4,"ngIf"],["type","button",1,"dynamic-btn-icon",3,"click"],[1,"fas","fa-plus"],[1,"inputs-outputs"],[1,"inputs"],[4,"ngFor","ngForOf"],["class","input",4,"ngIf"],[1,"outputs"],["type","text","formControlName","idleTimeout","number","","required","",1,"dynamic-form-control"],[1,"input"],[3,"parentCoordiantes","zoomLevel","name","parent"],["type","button",1,"dynamic-btn-icon","dynamic-margin-horizontal-extra-small",3,"click"],[1,"fas","fa-cog"],[1,"fas","fa-times"],["name","trigger",3,"parentCoordiantes","zoomLevel","parent"],[1,"output"]],template:function(t,e){1&t&&(N._U(0,"relations-node-header",0),N.Tg(1,"div",1)(2,"div",2)(3,"label",3),S._(4,"sync on"),N.qZ(),N.Tg(5,"select",4)(6,"option",5),S._(7,"idle"),N.qZ(),N.Tg(8,"option",5),S._(9,"trigger"),N.qZ()()(),Q.Y(10,W,4,0,"div",6),N.Tg(11,"button",7),D.N("click",(function(t){return t.preventDefault(),t.stopPropagation(),e.addProperty()})),N._U(12,"span",8),N.qZ(),N.Tg(13,"div",9)(14,"div",10),Q.Y(15,tt,9,5,"ng-container",11),Q.Y(16,et,4,3,"div",12),N.qZ(),N.Tg(17,"div",13),Q.Y(18,nt,5,5,"ng-container",11),N.qZ()()()),2&t&&(_.Q("parent",e)("destroySubject",e.destroySubject),w.x(1),_.Q("formGroup",e.form),w.x(5),_.Q("ngValue",!1),w.x(2),_.Q("ngValue",!0),w.x(2),_.Q("ngIf",!(null!=e.metadata&&null!=e.metadata.relationsOptions&&e.metadata.relationsOptions.triggerSync)),w.x(5),_.Q("ngForOf",null==e.metadata||null==e.metadata.relationsOptions?null:e.metadata.relationsOptions.syncProperties),w.x(1),_.Q("ngIf",null==e.metadata||null==e.metadata.relationsOptions?null:e.metadata.relationsOptions.triggerSync),w.x(2),_.Q("ngForOf",null==e.metadata||null==e.metadata.relationsOptions?null:e.metadata.relationsOptions.syncProperties))},dependencies:[o.e,G.sg,V.O,i.U,j.YN,$.Kr,P.Fj,j.EJ,z.JJ,z.JL,A.Q7,J.s,H.u,s.F,U.N,I.L,l.e,c.P,d.n],encapsulation:2,changeDetection:0});class it{constructor(){this.metaInfo={name:"Sync values",description:"Sync values, allowing triggered changes run at once",group:"Data"},this.nodeDefinition=ot,Object.freeze(this)}}},18745:(t,e,n)=>{n.d(e,{F:()=>G});var o=n(4905),i=n(27052),a=n(28232),s=n(23199),r=n(86463),l=n(40362);class c{get destroying(){return this._destroyingSubject.asObservable()}constructor(t,e,n,o,i){this._parentGroup=t,this._relationManager=e,this.history=n,this.start=o,this.end=i,this._destroyingSubject=new r.x,this.output=null,this.input=null,this._path=this._parentGroup.append("path").attr("fill","transparent").attr("stroke","#48B8B8").attr("stroke-width","3px").on("mouseover",(()=>{this.highlight()})).on("mouseout",(()=>{this.cancelHighlight()})),this._lineGenerator=(0,a.jvg)().curve(a.tFB.beta(.75))}destroy(){this._path?.remove(),this._destroyingSubject.next()}highlight(){this._path.attr("stroke-width","5px"),this.input?.highlight(),this.output?.highlight()}cancelHighlight(){this._path.attr("stroke-width","3px"),this.input?.cancelHighlight(),this.output?.cancelHighlight()}invalidateVisuals(t){if(t==l.r){const t=this._relationManager.getActiveInput();this._relationManager.setActiveInput(null),t?t.addRelation(this)?(this.end=t.getCoordinates(),this.input=t,this.history.getNewState()):(this.destroy(),this.start=null,this.end=null,this.input=null,this.output=null,this.history.getNewState()):(this.destroy(),this.start=null,this.end=null,this.input=null,this.output=null)}if(!this.start||!this.end)return;let e;if(this.end.x<=this.start.x){let t=this.start.x-this.end.x;const n=(this.end.y-this.start.y)/10;t<12&&(t=12),t*=1.3,e=[[this.start.x,this.start.y],[this.start.x+40,this.start.y],[this.start.x+t,this.start.y+n],[this.end.x-t,this.start.y+9*n],[this.end.x-40,this.end.y],[this.end.x,this.end.y]]}else{const t=(this.end.x-this.start.x)/3;e=[[this.start.x,this.start.y],[this.start.x+t,this.start.y],[this.end.x-t,this.end.y],[this.end.x,this.end.y]]}this._path.attr("d",this._lineGenerator(e))}}var d,u=n(26220),h=n(47432),p=n(74445),g=n(46480),m=n(14389),v=n(49891),f=n(43939),y=n(91861);!function(t){t[t.ShowNotFound=0]="ShowNotFound",t[t.Ignore=1]="Ignore",t[t.ThrowError=2]="ThrowError"}(d||(d={}));class b{constructor(t){this.missingNodeBehavior=d.ShowNotFound,(0,f.EN)(t)&&(this.missingNodeBehavior=t)}}var x=n(79440),N=n(8215),S=n(77842),w=n(36973),_=n(48397);function P(t,e,n,o,i,a,s){try{var r=t[a](s),l=r.value}catch(t){return void n(t)}r.done?e(l):Promise.resolve(l).then(o,i)}class z{get component(){return this.componentRef?this.componentRef.instance:null}constructor(t,e,n,o,i){this.viewContainerRef=t,this.relationsNodeManager=e,this.loader=n,this.options=o,this.logger=i,this.destroySubscription=null,this.componentRef=null,this.componentMetadata=null,this.zoomLevel=1,this.create=new p.v,this.destroy=new p.v,this.options&&this.options instanceof b||(this.options=new b)}ngOnChanges(t){var e,n=this;return(e=function*(){if((0,v.$)("zoomLevel")in t&&(0,f.EN)(n.zoomLevel)&&!((0,v.$)("componentMetadata")in t)){const e=n.component;if(e){const o=t[(0,v.$)("zoomLevel")];e.zoomLevel=n.zoomLevel;const i={};(0,m.mv)(i,"zoomLevel",o,o.previousValue),e.ngOnChanges(i),e.invalidateVisuals()}}else if(n.logger?.debug("RelationsNodeRendererSADirective: rendering node {@id}",{id:n.componentMetadata?.id}),n.ngOnDestroy(),n.viewContainerRef.clear(),(0,v.$)("componentMetadata")in t&&n.componentMetadata){let t=yield n.loader.loadItem(n.componentMetadata);if(!t)switch(n.logger?.warn("RelationsNodeRendererSADirective: Unable to find relations node type {@type}",{name:n.componentMetadata.name,package:n.componentMetadata.package}),n.options?.missingNodeBehavior){default:if(t=yield n.loader.loadItem({package:"basic-components",name:"notFound"}),!t)return void n.logger?.error("RelationsNodeRendererSADirective: Unable to find not found node!");break;case d.Ignore:return;case d.ThrowError:throw new Error(`RelationsNodeRendererSADirective: Unable to find relations node type Name: ${n.componentMetadata.name} Package: ${n.componentMetadata.package}`)}if(n.componentRef=n.viewContainerRef.createComponent(t.data,{injector:n.viewContainerRef.injector}),n.logger?.debug("RelationsNodeRendererSADirective: node rendered {@id}",{id:n.componentMetadata?.id}),n.component){const t=n.component;n.destroySubscription=t.destroy.subscribe((()=>n.ngOnDestroy())),n.logger?.debug("RelationsNodeRendererSADirective: initializing node with metadata {@id}",{id:n.componentMetadata?.id}),t.metadata=n.componentMetadata,t.zoomLevel=n.zoomLevel;const e={};(0,m.mv)(e,"metadata",n.componentMetadata,null,!0),(0,m.mv)(e,"zoomLevel",n.zoomLevel,null,!0),t.ngOnChanges(e),yield t.initialize(),n.logger?.debug("RelationsNodeRendererSADirective: invalidating node visuals {@id}",{id:n.componentMetadata?.id}),t.invalidateVisuals(),n.componentRef.changeDetectorRef.markForCheck(),n.relationsNodeManager.registerNode(n.component),n.create.next(t)}}},function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function s(t){P(a,o,i,s,r,"next",t)}function r(t){P(a,o,i,s,r,"throw",t)}s(void 0)}))})()}ngOnDestroy(){this.destroySubscription?.unsubscribe(),this.destroySubscription=null,this.componentRef&&(this.logger?.debug("RelationsNodeRendererSADirective: destroying node {@id}",{id:this.componentMetadata?.id}),this.component&&(this.componentMetadata&&this.destroy.next(this.componentMetadata),this.relationsNodeManager.unregisterNode(this.component)),this.componentRef?.destroy(),this.componentRef=null)}}z.ɵfac=function(t){return new(t||z)(x.Y(N.s_),x.Y(_.J),x.Y(y.fI),x.Y(b,8),x.Y(g.bZ,8))},z.ɵdir=S.lG({type:z,selectors:[["","relationsNodeRenderer",""]],inputs:{componentMetadata:["relationsNodeRenderer","componentMetadata"],zoomLevel:"zoomLevel"},outputs:{create:"create",destroy:"destroy"},exportAs:["relationsNodeRenderer"],standalone:!0,features:[w.T]});var M=n(84773),L=n(43870),R=n(4477),C=n(72891),O=n(6845),D=n(66794),k=n(73301),T=n(68961),Y=n(19063),B=n(47083),Z=n(85320),q=n(82568),E=n(76405),Q=n(15686),F=n(12311);const U=["relationsGroup"];function I(t,e){if(1&t){const t=M.E();L.O4(),L.kc(),R.yn(0)(1,4),C.N("destroy",(function(e){L.CH(t);const n=O.o();return L.Kt(n.destroyNode(e))})),R.BQ()()}if(2&t){const t=e.$implicit,n=O.o();D.x(1),k.Q("relationsNodeRenderer",t)("zoomLevel",n.zoomLevel)}}class G{get backgroundSizeStyle(){return`${this.backgroundSize}px ${this.backgroundSize}px`}get _backgroundPositionStyle(){return`${this.canvasPosition.x%this.backgroundSize}px ${this.canvasPosition.y%this.backgroundSize}px`}get boundingBox(){return this.element.nativeElement.getBoundingClientRect()}constructor(t,e,n,o){this.element=t,this.relationManager=e,this._changeDetector=n,this.history=o,this._initSubscriptions=new s.w0,this.backgroundSize=16,this.dragStartPosition={x:0,y:0},this.canvasPosition={x:0,y:0},this.zoomLevel=1,this.isDragging=!1,this.nodeDefinitions=[]}ngOnInit(){this._initSubscriptions.add(this.relationManager.activeNodeChange.subscribe((()=>this.focusNode(this.relationManager.activeNode))))}ngOnDestroy(){this._initSubscriptions.unsubscribe()}focusNode(t){if(!t)return;const e=this.nodeDefinitions?.find((e=>e.id===t));e?.nodeMetadata?.coordinates&&(this.canvasPosition={x:-e?.nodeMetadata?.coordinates.x*this.zoomLevel+this.boundingBox.width/2,y:-e?.nodeMetadata?.coordinates.y*this.zoomLevel+this.boundingBox.height/2},this._changeDetector.detectChanges())}createRelation(){return new c((0,a.Ys)(this.relationsGroup?.nativeElement),this.relationManager,this.history,null,null)}getPositionInCanvas(t){return{x:(t.x-this.boundingBox.left-this.canvasPosition.x)/this.zoomLevel,y:(t.y-this.boundingBox.top-this.canvasPosition.y)/this.zoomLevel}}onMouseDown(t){t.buttons==u.t.LEFT&&(this.dragStartPosition={x:t.clientX-this.canvasPosition.x,y:t.clientY-this.canvasPosition.y},this.isDragging=!0)}onMouseMove(t){this.isDragging&&(this.canvasPosition={x:t.clientX-this.dragStartPosition.x,y:t.clientY-this.dragStartPosition.y})}onMouseUp(t){this.isDragging&&(this.isDragging=!1)}onWheel(t){if(t.deltaY){const e=(0,h.uZ)(this.zoomLevel+.05*(t.deltaY>1?-1:1),.2,2),n=(t.clientX-this.canvasPosition.x-this.boundingBox.left)/this.zoomLevel,o=(t.clientY-this.canvasPosition.y-this.boundingBox.top)/this.zoomLevel;this.canvasPosition.x=t.clientX-this.boundingBox.left-n*e,this.canvasPosition.y=t.clientY-this.boundingBox.top-o*e,this._setZoomLevel(e)}t.preventDefault(),t.stopImmediatePropagation()}destroyNode(t){const e=this.nodeDefinitions.indexOf(t);e<0||(this.nodeDefinitions.splice(e,1),this.history.getNewState())}_setZoomLevel(t){this.zoomLevel=t,this.backgroundSize=16*this.zoomLevel}}G.ɵfac=function(t){return new(t||G)(x.Y(o.SB),x.Y(_.J),x.Y(T.s),x.Y(y.nR))},G.ɵcmp=S.Xp({type:G,selectors:[["relations-canvas"]],viewQuery:function(t,e){if(1&t&&Y.Gf(U,5,o.SB),2&t){let t;Y.iG(t=Y.CR())&&(e.relationsGroup=t.first)}},hostVars:4,hostBindings:function(t,e){1&t&&C.N("mousedown",(function(t){return e.onMouseDown(t)}))("mousemove",(function(t){return e.onMouseMove(t)}))("mouseup",(function(t){return e.onMouseUp(t)}),!1,B.Jf)("wheel",(function(t){return e.onWheel(t)})),2&t&&Z.Ud("background-size",e.backgroundSizeStyle)("background-position",e._backgroundPositionStyle)},inputs:{nodeDefinitions:"nodeDefinitions"},standalone:!0,features:[q.j],decls:5,vars:3,consts:[[1,"flow-area"],[1,"relations-wrapper"],["relationsGroup",""],[4,"ngFor","ngForOf"],[3,"relationsNodeRenderer","zoomLevel","destroy"]],template:function(t,e){1&t&&(E.Tg(0,"div",0),L.O4(),E.Tg(1,"svg",1),E._U(2,"g",null,2),E.qZ(),Q.Y(4,I,2,2,"ng-container",3),E.qZ()),2&t&&(Z.Ud("transform","translate("+e.canvasPosition.x+"px, "+e.canvasPosition.y+"px) scale("+e.zoomLevel+")"),D.x(4),k.Q("ngForOf",e.nodeDefinitions))},dependencies:[i.e,F.sg,z],encapsulation:2,changeDetection:0})},40362:(t,e,n)=>{n.d(e,{r:()=>o});const o="drop"},26220:(t,e,n)=>{var o;n.d(e,{t:()=>o}),function(t){t[t.LEFT=1]="LEFT"}(o||(o={}))},15750:(t,e,n)=>{n.d(e,{N:()=>g});var o=n(65508),i=n(34065),a=n(43939),s=n(79440),r=n(13434),l=n(4905),c=n(77842),d=n(72891),u=n(98171),h=n(73379);const p={provide:i.JU,useExisting:(0,o.Gp)((()=>g)),multi:!0};class g{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=t=>{},this.onTouched=()=>{},this.disabled=!1}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",t)}registerOnChange(t){this.onChange=e=>{(0,a.fp)(e)||""==e?t(null):(e=e.replace(/\s+/g,""),/^[+-]?\d+(?:[,.]\d+)?$/g.test(e)?t(parseFloat(e.replace(",","."))):t(NaN))}}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}}g.ɵfac=function(t){return new(t||g)(s.Y(r.Qs),s.Y(l.SB))},g.ɵdir=c.lG({type:g,selectors:[["input","number","","formControlName",""],["input","number","","formControl",""],["input","number","","ngModel",""]],hostVars:1,hostBindings:function(t,e){1&t&&d.N("change",(function(t){return e.onChange(t.target.value)}))("input",(function(t){return e.onChange(t.target.value)}))("blur",(function(){return e.onTouched()})),2&t&&u.I("disabled",e.disabled)},features:[h._([p])]})},67406:(t,e,n)=>{n.d(e,{L:()=>d});var o=n(65508),i=n(91795),a=n(43939);class s{static number(t){return isNaN(t.value)?{number:!0}:null}static max(t){return e=>!isNaN(e.value)&&(0,a.EN)(e.value)&&(0,a.EN)(t)&&e.value>t?{maxValue:t,actualValue:e.value}:null}static min(t){return e=>!isNaN(e.value)&&(0,a.EN)(e.value)&&(0,a.EN)(t)&&e.value<t?{minValue:t,actualValue:e.value}:null}}var r=n(77842),l=n(73379);const c={provide:i.Cf,useExisting:(0,o.Gp)((()=>d)),multi:!0};class d{validate(t){return s.number(t)}}d.ɵfac=function(t){return new(t||d)},d.ɵdir=r.lG({type:d,selectors:[["input","number","","formControlName",""],["input","number","","formControl",""],["input","number","","ngModel",""]],features:[l._([c])]})}}]);
//# sourceMappingURL=1969.chunk.dc72c4a4db701e1e9bad.js.map