"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[5957],{75957:(t,e,n)=>{n.d(e,{F:()=>U});var i=n(4905),o=n(27052),s=n(9360),a=n(23199),r=n(86463),d=n(40362);class c{constructor(t,e,n,i,o){this._parentGroup=t,this._relationManager=e,this.history=n,this.start=i,this.end=o,this._destroyingSubject=new r.x,this.output=null,this.input=null,this._path=this._parentGroup.append("path").attr("fill","transparent").attr("stroke","#48B8B8").attr("stroke-width","3px").on("mouseover",(()=>{this.highlight()})).on("mouseout",(()=>{this.cancelHighlight()})),this._lineGenerator=(0,s.jvg)().curve(s.tFB.beta(.75))}get destroying(){return this._destroyingSubject.asObservable()}destroy(){this._path?.remove(),this._destroyingSubject.next()}highlight(){this._path.attr("stroke-width","5px"),this.input?.highlight(),this.output?.highlight()}cancelHighlight(){this._path.attr("stroke-width","3px"),this.input?.cancelHighlight(),this.output?.cancelHighlight()}invalidateVisuals(t){if(t==d.r){const t=this._relationManager.getActiveInput();this._relationManager.setActiveInput(null),t?t.addRelation(this)?(this.end=t.getCoordinates(),this.input=t,this.history.getNewState()):(this.destroy(),this.start=null,this.end=null,this.input=null,this.output=null,this.history.getNewState()):(this.destroy(),this.start=null,this.end=null,this.input=null,this.output=null)}if(!this.start||!this.end)return;let e;if(this.end.x<=this.start.x){let t=this.start.x-this.end.x;const n=(this.end.y-this.start.y)/2;t<12&&(t=12),t*=1.3,e=[[this.start.x,this.start.y],[this.start.x+t,this.start.y+n],[this.end.x-t,this.start.y+n],[this.end.x,this.end.y]]}else{const t=(this.end.x-this.start.x)/3;e=[[this.start.x,this.start.y],[this.start.x+t,this.start.y],[this.end.x-t,this.end.y],[this.end.x,this.end.y]]}this._path.attr("d",this._lineGenerator(e))}}var u=n(26220),h=n(47432),l=n(74445),g=n(46480),p=n(14389),v=n(49891),f=n(43939),m=n(91861),y=n(79440),x=n(15783),b=n(13691),_=n(36973),w=n(48397);function N(t,e,n,i,o,s,a){try{var r=t[s](a),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(i,o)}class R{constructor(t,e,n,i){this.viewContainerRef=t,this.relationsNodeManager=e,this.loader=n,this.logger=i,this.destroySubscription=null,this.componentRef=null,this.componentMetadata=null,this.zoomLevel=1,this.create=new l.v,this.destroy=new l.v}get component(){return this.componentRef?this.componentRef.instance:null}ngOnChanges(t){var e,n=this;return(e=function*(){if((0,v.$)("zoomLevel")in t&&(0,f.EN)(n.zoomLevel)&&!((0,v.$)("componentMetadata")in t)){const e=n.component;if(e){const i=t[(0,v.$)("zoomLevel")];e.zoomLevel=n.zoomLevel;const o={};(0,p.mv)(o,"zoomLevel",i,i.previousValue),e.ngOnChanges(o),e.invalidateVisuals()}}else if(n.logger?.debug("RelationsNodeRendererSADirective: rendering node {@id}",{id:n.componentMetadata?.id}),n.ngOnDestroy(),n.viewContainerRef.clear(),(0,v.$)("componentMetadata")in t&&n.componentMetadata){const t=yield n.loader.loadItem(n.componentMetadata);if(!t)return void n.logger?.warn("RelationsNodeRendererSADirective: Unable to find relations node type {@type}",{name:n.componentMetadata.name,package:n.componentMetadata.package});if(n.componentRef=n.viewContainerRef.createComponent(t.data,{injector:n.viewContainerRef.injector}),n.logger?.debug("RelationsNodeRendererSADirective: node rendered {@id}",{id:n.componentMetadata?.id}),n.component){const t=n.component;n.destroySubscription=t.destroy.subscribe((()=>n.ngOnDestroy())),n.logger?.debug("RelationsNodeRendererSADirective: initializing node with metadata {@id}",{id:n.componentMetadata?.id}),t.metadata=n.componentMetadata,t.zoomLevel=n.zoomLevel;const e={};(0,p.mv)(e,"metadata",n.componentMetadata,null,!0),(0,p.mv)(e,"zoomLevel",n.zoomLevel,null,!0),t.ngOnChanges(e),yield t.initialize(),n.logger?.debug("RelationsNodeRendererSADirective: invalidating node visuals {@id}",{id:n.componentMetadata?.id}),t.invalidateVisuals(),n.componentRef.changeDetectorRef.markForCheck(),n.relationsNodeManager.registerNode(n.component),n.create.next(t)}}},function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function a(t){N(s,i,o,a,r,"next",t)}function r(t){N(s,i,o,a,r,"throw",t)}a(void 0)}))})()}ngOnDestroy(){this.destroySubscription?.unsubscribe(),this.destroySubscription=null,this.componentRef&&(this.logger?.debug("RelationsNodeRendererSADirective: destroying node {@id}",{id:this.componentMetadata?.id}),this.component&&(this.componentMetadata&&this.destroy.next(this.componentMetadata),this.relationsNodeManager.unregisterNode(this.component)),this.componentRef?.destroy(),this.componentRef=null)}}R.ɵfac=function(t){return new(t||R)(y.Y(x.s_),y.Y(w.J),y.Y(m.fI),y.Y(g.bZ,8))},R.ɵdir=b.lG({type:R,selectors:[["","relationsNodeRenderer",""]],inputs:{componentMetadata:["relationsNodeRenderer","componentMetadata"],zoomLevel:"zoomLevel"},outputs:{create:"create",destroy:"destroy"},exportAs:["relationsNodeRenderer"],standalone:!0,features:[_.T]});var S=n(84773),I=n(43870),C=n(4477),M=n(72891),k=n(6845),P=n(66794),z=n(73301),L=n(68961),D=n(55436),O=n(47083),Y=n(85320),F=n(82568),E=n(80827),j=n(15686),A=n(12311);const B=["relationsGroup"];function Z(t,e){if(1&t){const t=S.E();I.O4(),I.kc(),C.yn(0)(1,4),M.N("destroy",(function(e){I.CH(t);const n=k.o();return I.Kt(n.destroyNode(e))})),C.BQ()()}if(2&t){const t=e.$implicit,n=k.o();P.x(1),z.Q("relationsNodeRenderer",t)("zoomLevel",n.zoomLevel)}}class U{constructor(t,e,n,i){this.element=t,this.relationManager=e,this._changeDetector=n,this.history=i,this._initSubscriptions=new a.w0,this.backgroundSize=16,this.dragStartPosition={x:0,y:0},this.canvasPosition={x:0,y:0},this.zoomLevel=1,this.isDragging=!1,this.nodeDefinitions=[]}get backgroundSizeStyle(){return`${this.backgroundSize}px ${this.backgroundSize}px`}get _backgroundPositionStyle(){return`${this.canvasPosition.x%this.backgroundSize}px ${this.canvasPosition.y%this.backgroundSize}px`}get boundingBox(){return this.element.nativeElement.getBoundingClientRect()}ngOnInit(){this._initSubscriptions.add(this.relationManager.activeNodeChange.subscribe((()=>this.focusNode(this.relationManager.activeNode))))}ngOnDestroy(){this._initSubscriptions.unsubscribe()}focusNode(t){if(!t)return;const e=this.nodeDefinitions?.find((e=>e.id===t));e?.nodeMetadata?.coordinates&&(this.canvasPosition={x:-e?.nodeMetadata?.coordinates.x*this.zoomLevel+this.boundingBox.width/2,y:-e?.nodeMetadata?.coordinates.y*this.zoomLevel+this.boundingBox.height/2},this._changeDetector.detectChanges())}createRelation(){return new c((0,s.Ys)(this.relationsGroup?.nativeElement),this.relationManager,this.history,null,null)}getPositionInCanvas(t){return{x:(t.x-this.boundingBox.left-this.canvasPosition.x)/this.zoomLevel,y:(t.y-this.boundingBox.top-this.canvasPosition.y)/this.zoomLevel}}onMouseDown(t){t.buttons==u.t.LEFT&&(this.dragStartPosition={x:t.clientX-this.canvasPosition.x,y:t.clientY-this.canvasPosition.y},this.isDragging=!0)}onMouseMove(t){this.isDragging&&(this.canvasPosition={x:t.clientX-this.dragStartPosition.x,y:t.clientY-this.dragStartPosition.y})}onMouseUp(t){this.isDragging&&(this.isDragging=!1)}onWheel(t){if(t.deltaY){const e=(0,h.uZ)(this.zoomLevel+.05*(t.deltaY>1?-1:1),.2,2),n=(t.clientX-this.canvasPosition.x-this.boundingBox.left)/this.zoomLevel,i=(t.clientY-this.canvasPosition.y-this.boundingBox.top)/this.zoomLevel;this.canvasPosition.x=t.clientX-this.boundingBox.left-n*e,this.canvasPosition.y=t.clientY-this.boundingBox.top-i*e,this._setZoomLevel(e)}t.preventDefault(),t.stopImmediatePropagation()}destroyNode(t){const e=this.nodeDefinitions.indexOf(t);e<0||(this.nodeDefinitions.splice(e,1),this.history.getNewState())}_setZoomLevel(t){this.zoomLevel=t,this.backgroundSize=16*this.zoomLevel}}U.ɵfac=function(t){return new(t||U)(y.Y(i.SB),y.Y(w.J),y.Y(L.s),y.Y(m.nR))},U.ɵcmp=b.Xp({type:U,selectors:[["relations-canvas"]],viewQuery:function(t,e){if(1&t&&D.Gf(B,5,i.SB),2&t){let t;D.iG(t=D.CR())&&(e.relationsGroup=t.first)}},hostVars:4,hostBindings:function(t,e){1&t&&M.N("mousedown",(function(t){return e.onMouseDown(t)}))("mousemove",(function(t){return e.onMouseMove(t)}))("mouseup",(function(t){return e.onMouseUp(t)}),!1,O.Jf)("wheel",(function(t){return e.onWheel(t)})),2&t&&Y.Ud("background-size",e.backgroundSizeStyle)("background-position",e._backgroundPositionStyle)},inputs:{nodeDefinitions:"nodeDefinitions"},standalone:!0,features:[F.j],decls:5,vars:3,consts:[[1,"flow-area"],[1,"relations-wrapper"],["relationsGroup",""],[4,"ngFor","ngForOf"],[3,"relationsNodeRenderer","zoomLevel","destroy"]],template:function(t,e){1&t&&(E.Tg(0,"div",0),I.O4(),E.Tg(1,"svg",1),E._U(2,"g",null,2),E.qZ(),j.Y(4,Z,2,2,"ng-container",3),E.qZ()),2&t&&(Y.Ud("transform","translate("+e.canvasPosition.x+"px, "+e.canvasPosition.y+"px) scale("+e.zoomLevel+")"),P.x(4),z.Q("ngForOf",e.nodeDefinitions))},dependencies:[o.e,A.s,R],styles:["[_nghost-%COMP%]\n{\n    background-color: #e5e5f7;\n    opacity: 0.6;\n    background-image: radial-gradient(#444cf7 0.8px, #e5e5f7 0.8px);\n    overflow: hidden;\n}\n\n.flow-area[_ngcontent-%COMP%]\n{\n    height: 100%;\n    position: relative;\n    transform-origin: 0 0;\n}\n\n.relations-wrapper[_ngcontent-%COMP%]\n{\n    width: 100%;\n    height: 100%;\n    overflow: visible;\n}"],changeDetection:0})},40362:(t,e,n)=>{n.d(e,{r:()=>i});const i="drop"},26220:(t,e,n)=>{var i;n.d(e,{t:()=>i}),function(t){t[t.LEFT=1]="LEFT"}(i||(i={}))},53971:(t,e,n)=>{n.d(e,{AL:()=>z,aU:()=>L,md:()=>P,bv:()=>I,YK:()=>M,Ub:()=>F,P_:()=>Y,xt:()=>D,Oq:()=>O,UB:()=>k,I_:()=>C});var i=n(60640),o=n(11776),s=n(86707),a=n(65569),r=n(44677),d=n(12193),c=n(13457),u=n(44055),h=n(46480),l=n(91861),g=n(10439);function p(t,e,n,i,o,s,a){try{var r=t[s](a),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(i,o)}const v=function(){var t,e=(t=function*(t,e){const n=yield(0,g.j)(t,e);if(e?.debug("relationsNodeExtractor: trying to extract dynamic node"),!n)return null;const i=n.data;if(!i)return null;const o=yield i.relationsEditorMetadata;return o?{data:o.nodeDefinition,metaInfo:o.metaInfo}:null},function(){var e=this,n=arguments;return new Promise((function(i,o){var s=t.apply(e,n);function a(t){p(s,i,o,a,r,"next",t)}function r(t){p(s,i,o,a,r,"throw",t)}a(void 0)}))});return function(t,n){return e.apply(this,arguments)}}();function f(t,e,n,i,o,s,a){try{var r=t[s](a),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(i,o)}const m=function(){var t,e=(t=function*(t,e){const n=t;if(e?.debug("componentRelationsNodeExtractor: trying to extract dynamic node"),!n)return null;const i=n.default;if(!i)return null;const o=yield i.relationsEditorMetadata;return o?{data:o.nodeDefinition,metaInfo:o.metaInfo,singleton:!0,displayName:n.displayName}:null},function(){var e=this,n=arguments;return new Promise((function(i,o){var s=t.apply(e,n);function a(t){f(s,i,o,a,r,"next",t)}function r(t){f(s,i,o,a,r,"throw",t)}a(void 0)}))});return function(t,n){return e.apply(this,arguments)}}();var y=n(38327),x=n(54870);class b{constructor(t,e){this._componentsRegister=t,this._logger=e}tryToGet(t){if("static-components"!=t.package)return null;this._logger?.debug("StaticComponentsRelationsNodesProvider: trying to get node {@item}",{name:t.name,package:t.package});const e=this._componentsRegister.getType(t.name);return e?{default:e}:null}}function _(t,e,n,i,o,s,a){try{var r=t[s](a),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(i,o)}b.ɵfac=function(t){return new(t||b)(o.LF(x.w),o.LF(h.bZ,8))},b.ɵprov=y.Yz({token:b,factory:b.ɵfac});class w{constructor(t){this._logger=t}tryToGet(t){var e,i=this;return(e=function*(){try{switch(i._logger?.debug("DefaultDynamicModuleRelationsProvider: trying to get relations types for module {@module}",{moduleName:t.package}),t.package){case"basic-components":return yield n.e(4041).then(n.bind(n,94041));case"material-components":return yield n.e(5342).then(n.bind(n,85342));default:return null}}catch(e){i._logger?.debug("DefaultDynamicModuleRelationsProvider: module {@module} was not found, reason: "+e,{moduleName:t.package})}return null},function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function a(t){_(s,i,o,a,r,"next",t)}function r(t){_(s,i,o,a,r,"throw",t)}a(void 0)}))})()}}w.ɵfac=function(t){return new(t||w)(o.LF(h.bZ,8))},w.ɵprov=y.Yz({token:w,factory:w.ɵfac});class N{constructor(t,e){this._componentsRegister=t,this._logger=e}tryToGet(t){if("static-components"!=t.package)return null;this._logger?.debug("StaticComponentsRelationsTypesProvider: trying to get relations types {@item}",{name:t.name,package:t.package});const e=this._componentsRegister.types;return e?{default:e}:null}}N.ɵfac=function(t){return new(t||N)(o.LF(x.w),o.LF(h.bZ,8))},N.ɵprov=y.Yz({token:N,factory:N.ɵfac});var R=n(48397),S=n(47432);const I={provide:l.n7,useClass:s.o,multi:!0},C={provide:l.n7,useClass:b,multi:!0},M={provide:l.GP,useClass:w,multi:!0},k={provide:l.GP,useClass:N,multi:!0},P={provide:l.yh,useFactory:t=>new a.$([v],t),deps:[[new i.Fi,h.bZ]],multi:!0},z={provide:l.yh,useFactory:t=>new a.$([m],t),deps:[[new i.Fi,h.bZ]],multi:!0},L={provide:l.DZ,useFactory:t=>new a.$([r.L],t),deps:[[new i.Fi,h.bZ]],multi:!0},D={provide:l.Bj,useFactory:()=>new d.S((0,o.f3)(l.GP),(0,o.f3)(l.DZ),S.CQ,(0,o.f3)(h.bZ,{optional:!0})??void 0,!0)},O={provide:l.fI,useFactory:()=>new d.S((0,o.f3)(l.n7),(0,o.f3)(l.yh),S.Zl,(0,o.f3)(h.bZ,{optional:!0})??void 0)},Y={provide:c.Q,useExisting:R.J},F={provide:l.nR,useClass:u.Y}},47432:(t,e,n)=>{n.d(e,{CQ:()=>c,TN:()=>h,Zl:()=>u,hE:()=>l,uZ:()=>d});var i=n(14389),o=n(43939),s=n(53971),a=n(48397),r=n(54870);function d(t,e,n){return Math.min(Math.max(t,e),n)}const c=function(t){return!((0,o.fp)(t?.data)||!Array.isArray(t.data))},u=function(t){return!((0,o.fp)(t?.data)||!(0,o.P9)(t.data)||(0,o.EN)(t.singleton)&&!(0,o.jn)(t.singleton)||(0,o.EN)(t.displayName)&&!(0,o.HD)(t.displayName)||(0,o.EN)(t?.metaInfo)&&!(0,o.wV)(t.metaInfo))};function h(t=["basic-components","material-components"]){return[s.bv,s.YK,s.md,s.AL,s.aU,s.xt,s.Oq,a.J,s.P_,s.Ub,...t.map((t=>(0,i.XW)(t)))]}function l(t,e){return[...h(e),s.I_,s.UB,{provide:r.w,useClass:t},(0,i.XW)("static-components")]}},48397:(t,e,n)=>{n.d(e,{J:()=>s});var i=n(86463),o=n(38327);class s{constructor(){this._nodes={},this._waitingInputRelations={},this._nodesChange=new i.x,this._activeNodeChange=new i.x,this._nodeRegisterChange=new i.x,this._nodeUnregisterChange=new i.x}get nodes(){return this._nodes}get nodesChange(){return this._nodesChange.asObservable()}get activeNode(){return this._activeNode}get activeNodeChange(){return this._activeNodeChange.asObservable()}get nodeRegisterChange(){return this._nodeRegisterChange.asObservable()}get nodeUnregisterChange(){return this._nodeUnregisterChange.asObservable()}setActiveInput(t){this._activeInput=t}getActiveInput(){return this._activeInput}registerNode(t){var e,n;if(this._nodes[t.id]=t,this._nodesChange.next(),this._nodeRegisterChange.next(t),t.metadata?.outputs&&Array.isArray(t.metadata?.outputs))for(const i of t.metadata?.outputs){if(!i.inputs||!Array.isArray(i.inputs))continue;const o=t.outputs[i.outputName];if(o)for(const t of i.inputs){const i=this._nodes[t.id],s=o.startRelation();if(!i){(e=this._waitingInputRelations)[n=t.id]??(e[n]=[]),this._waitingInputRelations[t.id].push({inputName:t.inputName,relation:s});continue}const a=i.inputs[t.inputName];a&&a.endRelation(s)}}if(this._waitingInputRelations[t.id]){const e=this._waitingInputRelations[t.id],n=this._nodes[t.id];if(!n)return;for(const i of e){const e=n.inputs[i.inputName];e&&(e.endRelation(i.relation),delete this._waitingInputRelations[t.id])}}}unregisterNode(t){delete this._nodes[t.id],this._nodesChange.next(),this._nodeUnregisterChange.next(t)}getMetadata(){const t=[],e=Object.keys(this._nodes);for(const n of e){const e=this._nodes[n];if(!e.metadata)continue;const i={id:n,name:e.metadata.name,package:e.metadata.package,displayName:e.metadata.displayName,relationsOptions:e.metadata.relationsOptions,nodeMetadata:e.metadata.nodeMetadata,outputs:[]};if(e.allOutputs){for(const t of e.allOutputs){if(!t.relations)continue;if(!t.name)continue;const e={outputName:t.name,inputs:[]};for(const n of t.relations)n.input?.name&&e.inputs.push({id:n.input.parentId,inputName:n.input.name});i.outputs?.push(e)}t.push(i)}}return t}setActiveNode(t){this._activeNode=t,this._activeNodeChange.next()}}s.ɵfac=function(t){return new(t||s)},s.ɵprov=o.Yz({token:s,factory:s.ɵfac})},54870:(t,e,n)=>{n.d(e,{w:()=>o});var i=n(38327);class o{constructor(){this._definedTypes=this.getDefinedTypes()}get types(){return Object.keys(this._definedTypes)}getType(t){return this._definedTypes[t]??null}}o.ɵfac=function(t){return new(t||o)},o.ɵprov=i.Yz({token:o,factory:o.ɵfac})},10439:(t,e,n)=>{n.d(e,{j:()=>s});var i=n(43939),o=n(89402);const s=(t,e)=>{const n=t;return e?.debug("relationsExportExtractor: trying to extract dynamic relations"),(0,i.EN)(n.relations)&&(0,i.P9)(n.relations)&&(0,o.O)(n.relations)?{data:n.relations}:(0,i.EN)(n.default)&&(0,i.P9)(n.default)&&(0,o.O)(n.default)?{data:n.default}:null}},44055:(t,e,n)=>{n.d(e,{Y:()=>d});var i=n(43939),o=n(86463),s=n(13457),a=n(11776),r=n(38327);class d{constructor(t){this.metadataState=t,this.activeIndex=null,this.saveIndex=null,this.states=[],this.enabled=!0,this.popSubject=new o.x,this.historyChangeSubject=new o.x}get canUndo(){return!(0,i.fp)(this.activeIndex)&&this.activeIndex>0}get canRedo(){return!(0,i.fp)(this.activeIndex)&&this.activeIndex+1<this.states.length}get saved(){return this.activeIndex===this.saveIndex}get pop(){return this.popSubject.asObservable()}get historyChange(){return this.historyChangeSubject.asObservable()}get state(){return(0,i.fp)(this.activeIndex)?null:JSON.parse(this.states[this.activeIndex])}undo(){this.canUndo&&!(0,i.fp)(this.activeIndex)&&(this.activeIndex--,this.popSubject.next(JSON.parse(this.states[this.activeIndex])))}redo(){this.canRedo&&!(0,i.fp)(this.activeIndex)&&(this.activeIndex++,this.popSubject.next(JSON.parse(this.states[this.activeIndex])))}getNewState(){if(!this.enabled)return;this.states.length>=200&&this.states.shift(),(0,i.EN)(this.activeIndex)&&this.activeIndex+1<this.states.length&&this.states.splice(this.activeIndex+1,this.states.length-(this.activeIndex+1));const t=this.metadataState.getMetadata();t&&(this.states.push(JSON.stringify(t)),this.activeIndex=this.states.length-1,this.historyChangeSubject.next())}save(){this.saveIndex=this.activeIndex}setInitialState(t){this.states.push(JSON.stringify(t)),this.activeIndex=this.states.length-1,this.save()}clean(){this.activeIndex=null,this.saveIndex=null,this.states=[]}enable(){this.enabled=!0}disable(){this.enabled=!1}}d.ɵfac=function(t){return new(t||d)(a.LF(s.Q))},d.ɵprov=r.Yz({token:d,factory:d.ɵfac})}}]);
//# sourceMappingURL=5957.chunk.b636a9545b0b978a221e.js.map