"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[8745],{18745:(t,e,n)=>{n.d(e,{F:()=>G});var i=n(4905),o=n(27052),s=n(9360),a=n(23199),r=n(86463),d=n(40362);class c{constructor(t,e,n,i,o){this._parentGroup=t,this._relationManager=e,this.history=n,this.start=i,this.end=o,this._destroyingSubject=new r.x,this.output=null,this.input=null,this._path=this._parentGroup.append("path").attr("fill","transparent").attr("stroke","#48B8B8").attr("stroke-width","3px").on("mouseover",(()=>{this.highlight()})).on("mouseout",(()=>{this.cancelHighlight()})),this._lineGenerator=(0,s.jvg)().curve(s.tFB.beta(.75))}get destroying(){return this._destroyingSubject.asObservable()}destroy(){this._path?.remove(),this._destroyingSubject.next()}highlight(){this._path.attr("stroke-width","5px"),this.input?.highlight(),this.output?.highlight()}cancelHighlight(){this._path.attr("stroke-width","3px"),this.input?.cancelHighlight(),this.output?.cancelHighlight()}invalidateVisuals(t){if(t==d.r){const t=this._relationManager.getActiveInput();this._relationManager.setActiveInput(null),t?t.addRelation(this)?(this.end=t.getCoordinates(),this.input=t,this.history.getNewState()):(this.destroy(),this.start=null,this.end=null,this.input=null,this.output=null,this.history.getNewState()):(this.destroy(),this.start=null,this.end=null,this.input=null,this.output=null)}if(!this.start||!this.end)return;let e;if(this.end.x<=this.start.x){let t=this.start.x-this.end.x;const n=(this.end.y-this.start.y)/10;t<12&&(t=12),t*=1.3,e=[[this.start.x,this.start.y],[this.start.x+40,this.start.y],[this.start.x+t,this.start.y+n],[this.end.x-t,this.start.y+9*n],[this.end.x-40,this.end.y],[this.end.x,this.end.y]]}else{const t=(this.end.x-this.start.x)/3;e=[[this.start.x,this.start.y],[this.start.x+t,this.start.y],[this.end.x-t,this.end.y],[this.end.x,this.end.y]]}this._path.attr("d",this._lineGenerator(e))}}var h,u=n(26220),l=n(47432),p=n(74445),g=n(46480),v=n(14389),f=n(49891),m=n(43939),y=n(91861);!function(t){t[t.ShowNotFound=0]="ShowNotFound",t[t.Ignore=1]="Ignore",t[t.ThrowError=2]="ThrowError"}(h||(h={}));class x{constructor(t){this.missingNodeBehavior=h.ShowNotFound,(0,m.EN)(t)&&(this.missingNodeBehavior=t)}}var b=n(79440),w=n(8215),N=n(77842),_=n(36973),S=n(48397);function R(t,e,n,i,o,s,a){try{var r=t[s](a),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(i,o)}class I{constructor(t,e,n,i,o){this.viewContainerRef=t,this.relationsNodeManager=e,this.loader=n,this.options=i,this.logger=o,this.destroySubscription=null,this.componentRef=null,this.componentMetadata=null,this.zoomLevel=1,this.create=new p.v,this.destroy=new p.v,this.options&&this.options instanceof x||(this.options=new x)}get component(){return this.componentRef?this.componentRef.instance:null}ngOnChanges(t){var e,n=this;return(e=function*(){if((0,f.$)("zoomLevel")in t&&(0,m.EN)(n.zoomLevel)&&!((0,f.$)("componentMetadata")in t)){const e=n.component;if(e){const i=t[(0,f.$)("zoomLevel")];e.zoomLevel=n.zoomLevel;const o={};(0,v.mv)(o,"zoomLevel",i,i.previousValue),e.ngOnChanges(o),e.invalidateVisuals()}}else if(n.logger?.debug("RelationsNodeRendererSADirective: rendering node {@id}",{id:n.componentMetadata?.id}),n.ngOnDestroy(),n.viewContainerRef.clear(),(0,f.$)("componentMetadata")in t&&n.componentMetadata){let t=yield n.loader.loadItem(n.componentMetadata);if(!t)switch(n.logger?.warn("RelationsNodeRendererSADirective: Unable to find relations node type {@type}",{name:n.componentMetadata.name,package:n.componentMetadata.package}),n.options?.missingNodeBehavior){default:if(t=yield n.loader.loadItem({package:"basic-components",name:"notFound"}),!t)return void n.logger?.error("RelationsNodeRendererSADirective: Unable to find not found node!");break;case h.Ignore:return;case h.ThrowError:throw new Error(`RelationsNodeRendererSADirective: Unable to find relations node type Name: ${n.componentMetadata.name} Package: ${n.componentMetadata.package}`)}if(n.componentRef=n.viewContainerRef.createComponent(t.data,{injector:n.viewContainerRef.injector}),n.logger?.debug("RelationsNodeRendererSADirective: node rendered {@id}",{id:n.componentMetadata?.id}),n.component){const t=n.component;n.destroySubscription=t.destroy.subscribe((()=>n.ngOnDestroy())),n.logger?.debug("RelationsNodeRendererSADirective: initializing node with metadata {@id}",{id:n.componentMetadata?.id}),t.metadata=n.componentMetadata,t.zoomLevel=n.zoomLevel;const e={};(0,v.mv)(e,"metadata",n.componentMetadata,null,!0),(0,v.mv)(e,"zoomLevel",n.zoomLevel,null,!0),t.ngOnChanges(e),yield t.initialize(),n.logger?.debug("RelationsNodeRendererSADirective: invalidating node visuals {@id}",{id:n.componentMetadata?.id}),t.invalidateVisuals(),n.componentRef.changeDetectorRef.markForCheck(),n.relationsNodeManager.registerNode(n.component),n.create.next(t)}}},function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function a(t){R(s,i,o,a,r,"next",t)}function r(t){R(s,i,o,a,r,"throw",t)}a(void 0)}))})()}ngOnDestroy(){this.destroySubscription?.unsubscribe(),this.destroySubscription=null,this.componentRef&&(this.logger?.debug("RelationsNodeRendererSADirective: destroying node {@id}",{id:this.componentMetadata?.id}),this.component&&(this.componentMetadata&&this.destroy.next(this.componentMetadata),this.relationsNodeManager.unregisterNode(this.component)),this.componentRef?.destroy(),this.componentRef=null)}}I.ɵfac=function(t){return new(t||I)(b.Y(w.s_),b.Y(S.J),b.Y(y.fI),b.Y(x,8),b.Y(g.bZ,8))},I.ɵdir=N.lG({type:I,selectors:[["","relationsNodeRenderer",""]],inputs:{componentMetadata:["relationsNodeRenderer","componentMetadata"],zoomLevel:"zoomLevel"},outputs:{create:"create",destroy:"destroy"},exportAs:["relationsNodeRenderer"],standalone:!0,features:[_.T]});var C=n(84773),M=n(43870),k=n(4477),z=n(72891),L=n(6845),P=n(66794),D=n(73301),O=n(68961),E=n(55436),F=n(47083),Y=n(85320),A=n(82568),B=n(80827),j=n(15686),U=n(12311);const T=["relationsGroup"];function Z(t,e){if(1&t){const t=C.E();M.O4(),M.kc(),k.yn(0)(1,4),z.N("destroy",(function(e){M.CH(t);const n=L.o();return M.Kt(n.destroyNode(e))})),k.BQ()()}if(2&t){const t=e.$implicit,n=L.o();P.x(1),D.Q("relationsNodeRenderer",t)("zoomLevel",n.zoomLevel)}}class G{constructor(t,e,n,i){this.element=t,this.relationManager=e,this._changeDetector=n,this.history=i,this._initSubscriptions=new a.w0,this.backgroundSize=16,this.dragStartPosition={x:0,y:0},this.canvasPosition={x:0,y:0},this.zoomLevel=1,this.isDragging=!1,this.nodeDefinitions=[]}get backgroundSizeStyle(){return`${this.backgroundSize}px ${this.backgroundSize}px`}get _backgroundPositionStyle(){return`${this.canvasPosition.x%this.backgroundSize}px ${this.canvasPosition.y%this.backgroundSize}px`}get boundingBox(){return this.element.nativeElement.getBoundingClientRect()}ngOnInit(){this._initSubscriptions.add(this.relationManager.activeNodeChange.subscribe((()=>this.focusNode(this.relationManager.activeNode))))}ngOnDestroy(){this._initSubscriptions.unsubscribe()}focusNode(t){if(!t)return;const e=this.nodeDefinitions?.find((e=>e.id===t));e?.nodeMetadata?.coordinates&&(this.canvasPosition={x:-e?.nodeMetadata?.coordinates.x*this.zoomLevel+this.boundingBox.width/2,y:-e?.nodeMetadata?.coordinates.y*this.zoomLevel+this.boundingBox.height/2},this._changeDetector.detectChanges())}createRelation(){return new c((0,s.Ys)(this.relationsGroup?.nativeElement),this.relationManager,this.history,null,null)}getPositionInCanvas(t){return{x:(t.x-this.boundingBox.left-this.canvasPosition.x)/this.zoomLevel,y:(t.y-this.boundingBox.top-this.canvasPosition.y)/this.zoomLevel}}onMouseDown(t){t.buttons==u.t.LEFT&&(this.dragStartPosition={x:t.clientX-this.canvasPosition.x,y:t.clientY-this.canvasPosition.y},this.isDragging=!0)}onMouseMove(t){this.isDragging&&(this.canvasPosition={x:t.clientX-this.dragStartPosition.x,y:t.clientY-this.dragStartPosition.y})}onMouseUp(t){this.isDragging&&(this.isDragging=!1)}onWheel(t){if(t.deltaY){const e=(0,l.uZ)(this.zoomLevel+.05*(t.deltaY>1?-1:1),.2,2),n=(t.clientX-this.canvasPosition.x-this.boundingBox.left)/this.zoomLevel,i=(t.clientY-this.canvasPosition.y-this.boundingBox.top)/this.zoomLevel;this.canvasPosition.x=t.clientX-this.boundingBox.left-n*e,this.canvasPosition.y=t.clientY-this.boundingBox.top-i*e,this._setZoomLevel(e)}t.preventDefault(),t.stopImmediatePropagation()}destroyNode(t){const e=this.nodeDefinitions.indexOf(t);e<0||(this.nodeDefinitions.splice(e,1),this.history.getNewState())}_setZoomLevel(t){this.zoomLevel=t,this.backgroundSize=16*this.zoomLevel}}G.ɵfac=function(t){return new(t||G)(b.Y(i.SB),b.Y(S.J),b.Y(O.s),b.Y(y.nR))},G.ɵcmp=N.Xp({type:G,selectors:[["relations-canvas"]],viewQuery:function(t,e){if(1&t&&E.Gf(T,5,i.SB),2&t){let t;E.iG(t=E.CR())&&(e.relationsGroup=t.first)}},hostVars:4,hostBindings:function(t,e){1&t&&z.N("mousedown",(function(t){return e.onMouseDown(t)}))("mousemove",(function(t){return e.onMouseMove(t)}))("mouseup",(function(t){return e.onMouseUp(t)}),!1,F.Jf)("wheel",(function(t){return e.onWheel(t)})),2&t&&Y.Ud("background-size",e.backgroundSizeStyle)("background-position",e._backgroundPositionStyle)},inputs:{nodeDefinitions:"nodeDefinitions"},standalone:!0,features:[A.j],decls:5,vars:3,consts:[[1,"flow-area"],[1,"relations-wrapper"],["relationsGroup",""],[4,"ngFor","ngForOf"],[3,"relationsNodeRenderer","zoomLevel","destroy"]],template:function(t,e){1&t&&(B.Tg(0,"div",0),M.O4(),B.Tg(1,"svg",1),B._U(2,"g",null,2),B.qZ(),j.Y(4,Z,2,2,"ng-container",3),B.qZ()),2&t&&(Y.Ud("transform","translate("+e.canvasPosition.x+"px, "+e.canvasPosition.y+"px) scale("+e.zoomLevel+")"),P.x(4),D.Q("ngForOf",e.nodeDefinitions))},dependencies:[o.e,U.s,I],encapsulation:2,changeDetection:0})},40362:(t,e,n)=>{n.d(e,{r:()=>i});const i="drop"},26220:(t,e,n)=>{var i;n.d(e,{t:()=>i}),function(t){t[t.LEFT=1]="LEFT"}(i||(i={}))},79763:(t,e,n)=>{n.d(e,{AL:()=>I,aU:()=>C,md:()=>R,Ub:()=>L,P_:()=>z,xt:()=>M,Oq:()=>k,UB:()=>S,I_:()=>_});var i=n(60640),o=n(11776),s=n(65569),a=n(44677),r=n(12193),d=n(13457),c=n(44055),h=n(46480),u=n(91861),l=n(10439);function p(t,e,n,i,o,s,a){try{var r=t[s](a),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(i,o)}const g=function(){var t,e=(t=function*(t,e){const n=yield(0,l.j)(t,e);if(e?.debug("relationsNodeExtractor: trying to extract dynamic node"),!n)return null;const i=n.data;if(!i)return null;const o=yield i.relationsEditorMetadata;return o?{data:o.nodeDefinition,metaInfo:o.metaInfo}:null},function(){var e=this,n=arguments;return new Promise((function(i,o){var s=t.apply(e,n);function a(t){p(s,i,o,a,r,"next",t)}function r(t){p(s,i,o,a,r,"throw",t)}a(void 0)}))});return function(t,n){return e.apply(this,arguments)}}();function v(t,e,n,i,o,s,a){try{var r=t[s](a),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(i,o)}const f=function(){var t,e=(t=function*(t,e){const n=t;if(e?.debug("componentRelationsNodeExtractor: trying to extract dynamic node"),!n)return null;const i=n.default;if(!i)return null;const o=yield i.relationsEditorMetadata;return o?{data:o.nodeDefinition,metaInfo:o.metaInfo,singleton:!0,displayName:n.displayName,scope:n.scope}:null},function(){var e=this,n=arguments;return new Promise((function(i,o){var s=t.apply(e,n);function a(t){v(s,i,o,a,r,"next",t)}function r(t){v(s,i,o,a,r,"throw",t)}a(void 0)}))});return function(t,n){return e.apply(this,arguments)}}();var m=n(38327),y=n(54870);class x{constructor(t,e){this._componentsRegister=t,this._logger=e}tryToGet(t){if("static-components"!=t.package)return null;this._logger?.debug("StaticComponentsRelationsNodesProvider: trying to get node {@item}",{name:t.name,package:t.package});const e=this._componentsRegister.getType(t.name);return e?{default:e}:null}}x.ɵfac=function(t){return new(t||x)(o.LF(y.w),o.LF(h.bZ,8))},x.ɵprov=m.Yz({token:x,factory:x.ɵfac});class b{constructor(t,e){this._componentsRegister=t,this._logger=e}tryToGet(t){if("static-components"!=t.package)return null;this._logger?.debug("StaticComponentsRelationsTypesProvider: trying to get relations types {@item}",{name:t.name,package:t.package});const e=this._componentsRegister.types;return e?{default:e}:null}}b.ɵfac=function(t){return new(t||b)(o.LF(y.w),o.LF(h.bZ,8))},b.ɵprov=m.Yz({token:b,factory:b.ɵfac});var w=n(48397),N=n(47432);const _={provide:u.n7,useClass:x,multi:!0},S={provide:u.GP,useClass:b,multi:!0},R={provide:u.yh,useFactory:t=>new s.$([g],t),deps:[[new i.Fi,h.bZ]],multi:!0},I={provide:u.yh,useFactory:t=>new s.$([f],t),deps:[[new i.Fi,h.bZ]],multi:!0},C={provide:u.DZ,useFactory:t=>new s.$([a.L],t),deps:[[new i.Fi,h.bZ]],multi:!0},M={provide:u.Bj,useFactory:()=>new r.S((0,o.f3)(u.GP),(0,o.f3)(u.DZ),N.CQ,(0,o.f3)(h.bZ,{optional:!0})??void 0,!0)},k={provide:u.fI,useFactory:()=>new r.S((0,o.f3)(u.n7),(0,o.f3)(u.yh),N.Zl,(0,o.f3)(h.bZ,{optional:!0})??void 0)},z={provide:d.Qh,useExisting:w.J},L={provide:u.nR,useClass:c.Y}},47432:(t,e,n)=>{n.d(e,{CQ:()=>h,TN:()=>l,Wg:()=>g,Zl:()=>u,hE:()=>p,uZ:()=>c});var i=n(14389),o=n(43939),s=n(79763),a=n(48397),r=n(77291),d=n(54870);function c(t,e,n){return Math.min(Math.max(t,e),n)}const h=function(t){return!((0,o.fp)(t?.data)||!Array.isArray(t.data))},u=function(t){return!((0,o.fp)(t?.data)||!(0,o.P9)(t.data)||(0,o.EN)(t.singleton)&&!(0,o.jn)(t.singleton)||(0,o.EN)(t.displayName)&&!(0,o.HD)(t.displayName)||(0,o.EN)(t?.metaInfo)&&!(0,o.wV)(t.metaInfo))};function l(){return[s.md,s.AL,s.aU,s.xt,s.Oq,a.J,r.a,s.P_,s.Ub]}function p(t){return[...l(),s.I_,s.UB,{provide:d.w,useClass:t},(0,i.XW)("static-components")]}function g(t){let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);let n="#";for(let t=0;t<3;t++)n+=("00"+(e>>8*t&255).toString(16)).substr(-2);return n}},48397:(t,e,n)=>{n.d(e,{J:()=>s});var i=n(86463),o=n(38327);class s{constructor(){this._nodes={},this._waitingInputRelations={},this._nodesChange=new i.x,this._activeNodeChange=new i.x,this._nodeRegisterChange=new i.x,this._nodeUnregisterChange=new i.x}get nodes(){return this._nodes}get nodesChange(){return this._nodesChange.asObservable()}get activeNode(){return this._activeNode}get activeNodeChange(){return this._activeNodeChange.asObservable()}get nodeRegisterChange(){return this._nodeRegisterChange.asObservable()}get nodeUnregisterChange(){return this._nodeUnregisterChange.asObservable()}setActiveInput(t){this._activeInput=t}getActiveInput(){return this._activeInput}registerNode(t){var e,n;if(this._nodes[t.id]=t,this._nodesChange.next(),this._nodeRegisterChange.next(t),t.metadata?.outputs&&Array.isArray(t.metadata?.outputs))for(const i of t.metadata?.outputs){if(!i.inputs||!Array.isArray(i.inputs))continue;const o=t.outputs[i.outputName];if(o)for(const t of i.inputs){const i=this._nodes[t.id],s=o.startRelation();if(!i){(e=this._waitingInputRelations)[n=t.id]??(e[n]=[]),this._waitingInputRelations[t.id].push({inputName:t.inputName,relation:s});continue}const a=i.inputs[t.inputName];a&&a.endRelation(s)}}if(this._waitingInputRelations[t.id]){const e=this._waitingInputRelations[t.id],n=this._nodes[t.id];if(!n)return;for(const i of e){const e=n.inputs[i.inputName];e&&(e.endRelation(i.relation),delete this._waitingInputRelations[t.id])}}}unregisterNode(t){delete this._nodes[t.id],this._nodesChange.next(),this._nodeUnregisterChange.next(t)}getMetadata(){const t=[],e=Object.keys(this._nodes);for(const n of e){const e=this._nodes[n];if(!e.metadata)continue;const i={id:n,name:e.metadata.name,package:e.metadata.package,displayName:e.metadata.displayName,relationsOptions:e.metadata.relationsOptions,nodeMetadata:e.metadata.nodeMetadata,scope:e.metadata.scope,outputs:[]};if(e.allOutputs){for(const t of e.allOutputs){if(!t.relations)continue;if(!t.name)continue;const e={outputName:t.name,inputs:[]};for(const n of t.relations)n.input?.name&&e.inputs.push({id:n.input.parentId,inputName:n.input.name});i.outputs?.push(e)}t.push(i)}}return t}setActiveNode(t){this._activeNode=t,this._activeNodeChange.next()}}s.ɵfac=function(t){return new(t||s)},s.ɵprov=o.Yz({token:s,factory:s.ɵfac})},77291:(t,e,n)=>{n.d(e,{a:()=>s});var i=n(86463),o=n(38327);class s{constructor(){this.ɵScopes=[],this.scopesChangeSubject=new i.x}get scopes(){return this.ɵScopes}get scopesChange(){return this.scopesChangeSubject.asObservable()}}s.ɵfac=function(t){return new(t||s)},s.ɵprov=o.Yz({token:s,factory:s.ɵfac})},54870:(t,e,n)=>{n.d(e,{w:()=>o});var i=n(38327);class o{constructor(){this._definedTypes=this.getDefinedTypes()}get types(){return Object.keys(this._definedTypes)}getType(t){return this._definedTypes[t]??null}}o.ɵfac=function(t){return new(t||o)},o.ɵprov=i.Yz({token:o,factory:o.ɵfac})},10439:(t,e,n)=>{n.d(e,{j:()=>s});var i=n(43939),o=n(89402);const s=(t,e)=>{const n=t;return e?.debug("relationsExportExtractor: trying to extract dynamic relations"),(0,i.EN)(n.relations)&&(0,i.P9)(n.relations)&&(0,o.O)(n.relations)?{data:n.relations}:(0,i.EN)(n.default)&&(0,i.P9)(n.default)&&(0,o.O)(n.default)?{data:n.default}:null}},44055:(t,e,n)=>{n.d(e,{Y:()=>d});var i=n(43939),o=n(86463),s=n(13457),a=n(11776),r=n(38327);class d{constructor(t){this.metadataState=t,this.activeIndex=null,this.saveIndex=null,this.states=[],this.enabled=!0,this.popSubject=new o.x,this.historyChangeSubject=new o.x}get canUndo(){return!(0,i.fp)(this.activeIndex)&&this.activeIndex>0}get canRedo(){return!(0,i.fp)(this.activeIndex)&&this.activeIndex+1<this.states.length}get saved(){return this.activeIndex===this.saveIndex}get pop(){return this.popSubject.asObservable()}get historyChange(){return this.historyChangeSubject.asObservable()}get state(){return(0,i.fp)(this.activeIndex)?null:JSON.parse(this.states[this.activeIndex])}undo(){this.canUndo&&!(0,i.fp)(this.activeIndex)&&(this.activeIndex--,this.popSubject.next(JSON.parse(this.states[this.activeIndex])))}redo(){this.canRedo&&!(0,i.fp)(this.activeIndex)&&(this.activeIndex++,this.popSubject.next(JSON.parse(this.states[this.activeIndex])))}getNewState(){if(!this.enabled)return;this.states.length>=200&&this.states.shift(),(0,i.EN)(this.activeIndex)&&this.activeIndex+1<this.states.length&&this.states.splice(this.activeIndex+1,this.states.length-(this.activeIndex+1));const t=this.metadataState.getMetadata();t&&(this.states.push(JSON.stringify(t)),this.activeIndex=this.states.length-1,this.historyChangeSubject.next())}save(){this.saveIndex=this.activeIndex}setInitialState(t){this.states.push(JSON.stringify(t)),this.activeIndex=this.states.length-1,this.save()}clean(){this.activeIndex=null,this.saveIndex=null,this.states=[]}enable(){this.enabled=!0}disable(){this.enabled=!1}}d.ɵfac=function(t){return new(t||d)(a.LF(s.Qh))},d.ɵprov=r.Yz({token:d,factory:d.ɵfac})}}]);
//# sourceMappingURL=8745.chunk.68483bdc8aacb863fc0f.js.map