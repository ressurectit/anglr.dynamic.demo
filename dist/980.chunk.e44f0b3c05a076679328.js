"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[980],{19811:(t,e,n)=>{n.r(e),n.d(e,{TransformDataRelationsEditorMetadata:()=>N});var o=n(71309),i=n(80890),a=n(93551),s=n(52580),r=n(60901),d=n(85478),c=n(57466),l=n(58654),h=n(64297),u=n(79440),p=n(68961),g=n(4905),m=n(77842),v=n(47098),f=n(82568),y=n(76405),b=n(41853),x=n(72891),M=n(73301),w=n(66794),D=n(47826);function S(t,e,n,o,i,a,s){try{var r=t[a](s),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(o,i)}l.Mj.typescript.typescriptDefaults.addExtraLib("/**\n * Transforms data to another form of data\n * @param data - Data to be transformed\n */\nexport type TransformData<TData = any, TResult = any> = (data: TData) => TResult;","file:///node_modules/@types/transformData/index.d.ts");class C extends a.M{constructor(t,e,n){super(t,e),this.dialog=n}showCodeEditor(){var t,e=this;return(t=function*(){var t;const n=yield(0,h.n)(e.dialog.open(o.I,{title:"Code editor",width:"75vw",height:"75vh",data:{content:e.metadata?.nodeMetadata?.options?.content??"",languageModel:(0,i.A)("import {TransformData} from 'transformData';\n\n/**\n * Transformer function that performs transformation\n */\nconst transformer: TransformData<any, any> = data =>\n{\n    return data;\n};\n \nexport default transformer;\n")}}).afterClosed());e.metadata?.relationsOptions&&n&&e.metadata.nodeMetadata&&(e.metadata.relationsOptions.code=n.code,(t=e.metadata.nodeMetadata).options??(t.options={content:""}),e.metadata.nodeMetadata.options.content=n.content,e.history.getNewState())},function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function s(t){S(a,o,i,s,r,"next",t)}function r(t){S(a,o,i,s,r,"throw",t)}s(void 0)}))})()}metadataSet(){var t;this.metadata?.relationsOptions&&((t=this.metadata.relationsOptions).id??(t.id=(0,c.Ox)(12)))}}C.ɵfac=function(t){return new(t||C)(u.Y(p.s),u.Y(g.SB),u.Y(D.J))},C.ɵcmp=m.Xp({type:C,selectors:[["transform-data-node"]],standalone:!0,features:[v.q,f.j],decls:16,vars:8,consts:[["name","transform data",3,"parent","destroySubject"],[1,"node-content"],[1,"inputs-outputs"],[1,"inputs"],[1,"input"],["name","data",3,"parentCoordiantes","zoomLevel","parent"],[1,"outputs"],[1,"output"],["name","transformedData",3,"parentCoordiantes","zoomLevel","parent"],["type","button",1,"dynamic-btn","dynamic-btn-primary",3,"click"]],template:function(t,e){1&t&&(y._U(0,"relations-node-header",0),y.Tg(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),y._U(5,"relation-node-input",5),y.Tg(6,"div"),b._(7,"data"),y.qZ()()(),y.Tg(8,"div",6)(9,"div",7)(10,"div"),b._(11,"transformed data"),y.qZ(),y._U(12,"relation-node-output",8),y.qZ()()(),y.Tg(13,"button",9),x.N("click",(function(){return e.showCodeEditor()})),y.Tg(14,"span"),b._(15,"code"),y.qZ()()()),2&t&&(M.Q("parent",e)("destroySubject",e.destroySubject),w.x(5),M.Q("parentCoordiantes",e.nodePosition)("zoomLevel",e.zoomLevel)("parent",e),w.x(7),M.Q("parentCoordiantes",e.nodePosition)("zoomLevel",e.zoomLevel)("parent",e))},dependencies:[s.e,r.P,d.n],encapsulation:2,changeDetection:0});class N{constructor(){this.metaInfo={name:"Transform data",description:"Code that allows data tranformation",group:"Data"},this.nodeDefinition=C,Object.freeze(this)}}},18745:(t,e,n)=>{n.d(e,{F:()=>$});var o=n(4905),i=n(27052),a=n(28232),s=n(23199),r=n(86463),d=n(40362);class c{get destroying(){return this._destroyingSubject.asObservable()}constructor(t,e,n,o,i){this._parentGroup=t,this._relationManager=e,this.history=n,this.start=o,this.end=i,this._destroyingSubject=new r.x,this.output=null,this.input=null,this._path=this._parentGroup.append("path").attr("fill","transparent").attr("stroke","#48B8B8").attr("stroke-width","3px").on("mouseover",(()=>{this.highlight()})).on("mouseout",(()=>{this.cancelHighlight()})),this._lineGenerator=(0,a.jvg)().curve(a.tFB.beta(.75))}destroy(){this._path?.remove(),this._destroyingSubject.next()}highlight(){this._path.attr("stroke-width","5px"),this.input?.highlight(),this.output?.highlight()}cancelHighlight(){this._path.attr("stroke-width","3px"),this.input?.cancelHighlight(),this.output?.cancelHighlight()}invalidateVisuals(t){if(t==d.r){const t=this._relationManager.getActiveInput();this._relationManager.setActiveInput(null),t?t.addRelation(this)?(this.end=t.getCoordinates(),this.input=t,this.history.getNewState()):(this.destroy(),this.start=null,this.end=null,this.input=null,this.output=null,this.history.getNewState()):(this.destroy(),this.start=null,this.end=null,this.input=null,this.output=null)}if(!this.start||!this.end)return;let e;if(this.end.x<=this.start.x){let t=this.start.x-this.end.x;const n=(this.end.y-this.start.y)/10;t<12&&(t=12),t*=1.3,e=[[this.start.x,this.start.y],[this.start.x+40,this.start.y],[this.start.x+t,this.start.y+n],[this.end.x-t,this.start.y+9*n],[this.end.x-40,this.end.y],[this.end.x,this.end.y]]}else{const t=(this.end.x-this.start.x)/3;e=[[this.start.x,this.start.y],[this.start.x+t,this.start.y],[this.end.x-t,this.end.y],[this.end.x,this.end.y]]}this._path.attr("d",this._lineGenerator(e))}}var l,h=n(26220),u=n(47432),p=n(74445),g=n(46480),m=n(14389),v=n(49891),f=n(43939),y=n(91861);!function(t){t[t.ShowNotFound=0]="ShowNotFound",t[t.Ignore=1]="Ignore",t[t.ThrowError=2]="ThrowError"}(l||(l={}));class b{constructor(t){this.missingNodeBehavior=l.ShowNotFound,(0,f.EN)(t)&&(this.missingNodeBehavior=t)}}var x=n(79440),M=n(8215),w=n(77842),D=n(36973),S=n(48397);function C(t,e,n,o,i,a,s){try{var r=t[a](s),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(o,i)}class N{get component(){return this.componentRef?this.componentRef.instance:null}constructor(t,e,n,o,i){this.viewContainerRef=t,this.relationsNodeManager=e,this.loader=n,this.options=o,this.logger=i,this.destroySubscription=null,this.componentRef=null,this.componentMetadata=null,this.zoomLevel=1,this.create=new p.v,this.destroy=new p.v,this.options&&this.options instanceof b||(this.options=new b)}ngOnChanges(t){var e,n=this;return(e=function*(){if((0,v.$)("zoomLevel")in t&&(0,f.EN)(n.zoomLevel)&&!((0,v.$)("componentMetadata")in t)){const e=n.component;if(e){const o=t[(0,v.$)("zoomLevel")];e.zoomLevel=n.zoomLevel;const i={};(0,m.mv)(i,"zoomLevel",o,o.previousValue),e.ngOnChanges(i),e.invalidateVisuals()}}else if(n.logger?.debug("RelationsNodeRendererSADirective: rendering node {@id}",{id:n.componentMetadata?.id}),n.ngOnDestroy(),n.viewContainerRef.clear(),(0,v.$)("componentMetadata")in t&&n.componentMetadata){let t=yield n.loader.loadItem(n.componentMetadata);if(!t)switch(n.logger?.warn("RelationsNodeRendererSADirective: Unable to find relations node type {@type}",{name:n.componentMetadata.name,package:n.componentMetadata.package}),n.options?.missingNodeBehavior){default:if(t=yield n.loader.loadItem({package:"basic-components",name:"notFound"}),!t)return void n.logger?.error("RelationsNodeRendererSADirective: Unable to find not found node!");break;case l.Ignore:return;case l.ThrowError:throw new Error(`RelationsNodeRendererSADirective: Unable to find relations node type Name: ${n.componentMetadata.name} Package: ${n.componentMetadata.package}`)}if(n.componentRef=n.viewContainerRef.createComponent(t.data,{injector:n.viewContainerRef.injector}),n.logger?.debug("RelationsNodeRendererSADirective: node rendered {@id}",{id:n.componentMetadata?.id}),n.component){const t=n.component;n.destroySubscription=t.destroy.subscribe((()=>n.ngOnDestroy())),n.logger?.debug("RelationsNodeRendererSADirective: initializing node with metadata {@id}",{id:n.componentMetadata?.id}),t.metadata=n.componentMetadata,t.zoomLevel=n.zoomLevel;const e={};(0,m.mv)(e,"metadata",n.componentMetadata,null,!0),(0,m.mv)(e,"zoomLevel",n.zoomLevel,null,!0),t.ngOnChanges(e),yield t.initialize(),n.logger?.debug("RelationsNodeRendererSADirective: invalidating node visuals {@id}",{id:n.componentMetadata?.id}),t.invalidateVisuals(),n.componentRef.changeDetectorRef.markForCheck(),n.relationsNodeManager.registerNode(n.component),n.create.next(t)}}},function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function s(t){C(a,o,i,s,r,"next",t)}function r(t){C(a,o,i,s,r,"throw",t)}s(void 0)}))})()}ngOnDestroy(){this.destroySubscription?.unsubscribe(),this.destroySubscription=null,this.componentRef&&(this.logger?.debug("RelationsNodeRendererSADirective: destroying node {@id}",{id:this.componentMetadata?.id}),this.component&&(this.componentMetadata&&this.destroy.next(this.componentMetadata),this.relationsNodeManager.unregisterNode(this.component)),this.componentRef?.destroy(),this.componentRef=null)}}N.ɵfac=function(t){return new(t||N)(x.Y(M.s_),x.Y(S.J),x.Y(y.fI),x.Y(b,8),x.Y(g.bZ,8))},N.ɵdir=w.lG({type:N,selectors:[["","relationsNodeRenderer",""]],inputs:{componentMetadata:["relationsNodeRenderer","componentMetadata"],zoomLevel:"zoomLevel"},outputs:{create:"create",destroy:"destroy"},exportAs:["relationsNodeRenderer"],standalone:!0,features:[D.T]});var z=n(84773),R=n(43870),k=n(4477),L=n(72891),E=n(6845),P=n(66794),_=n(73301),T=n(68961),j=n(19063),F=n(47083),O=n(85320),Y=n(82568),B=n(76405),I=n(15686),A=n(12311);const U=["relationsGroup"];function Z(t,e){if(1&t){const t=z.E();R.O4(),R.kc(),k.yn(0)(1,4),L.N("destroy",(function(e){R.CH(t);const n=E.o();return R.Kt(n.destroyNode(e))})),k.BQ()()}if(2&t){const t=e.$implicit,n=E.o();P.x(1),_.Q("relationsNodeRenderer",t)("zoomLevel",n.zoomLevel)}}class ${get backgroundSizeStyle(){return`${this.backgroundSize}px ${this.backgroundSize}px`}get _backgroundPositionStyle(){return`${this.canvasPosition.x%this.backgroundSize}px ${this.canvasPosition.y%this.backgroundSize}px`}get boundingBox(){return this.element.nativeElement.getBoundingClientRect()}constructor(t,e,n,o){this.element=t,this.relationManager=e,this._changeDetector=n,this.history=o,this._initSubscriptions=new s.w0,this.backgroundSize=16,this.dragStartPosition={x:0,y:0},this.canvasPosition={x:0,y:0},this.zoomLevel=1,this.isDragging=!1,this.nodeDefinitions=[]}ngOnInit(){this._initSubscriptions.add(this.relationManager.activeNodeChange.subscribe((()=>this.focusNode(this.relationManager.activeNode))))}ngOnDestroy(){this._initSubscriptions.unsubscribe()}focusNode(t){if(!t)return;const e=this.nodeDefinitions?.find((e=>e.id===t));e?.nodeMetadata?.coordinates&&(this.canvasPosition={x:-e?.nodeMetadata?.coordinates.x*this.zoomLevel+this.boundingBox.width/2,y:-e?.nodeMetadata?.coordinates.y*this.zoomLevel+this.boundingBox.height/2},this._changeDetector.detectChanges())}createRelation(){return new c((0,a.Ys)(this.relationsGroup?.nativeElement),this.relationManager,this.history,null,null)}getPositionInCanvas(t){return{x:(t.x-this.boundingBox.left-this.canvasPosition.x)/this.zoomLevel,y:(t.y-this.boundingBox.top-this.canvasPosition.y)/this.zoomLevel}}onMouseDown(t){t.buttons==h.t.LEFT&&(this.dragStartPosition={x:t.clientX-this.canvasPosition.x,y:t.clientY-this.canvasPosition.y},this.isDragging=!0)}onMouseMove(t){this.isDragging&&(this.canvasPosition={x:t.clientX-this.dragStartPosition.x,y:t.clientY-this.dragStartPosition.y})}onMouseUp(t){this.isDragging&&(this.isDragging=!1)}onWheel(t){if(t.deltaY){const e=(0,u.uZ)(this.zoomLevel+.05*(t.deltaY>1?-1:1),.2,2),n=(t.clientX-this.canvasPosition.x-this.boundingBox.left)/this.zoomLevel,o=(t.clientY-this.canvasPosition.y-this.boundingBox.top)/this.zoomLevel;this.canvasPosition.x=t.clientX-this.boundingBox.left-n*e,this.canvasPosition.y=t.clientY-this.boundingBox.top-o*e,this._setZoomLevel(e)}t.preventDefault(),t.stopImmediatePropagation()}destroyNode(t){const e=this.nodeDefinitions.indexOf(t);e<0||(this.nodeDefinitions.splice(e,1),this.history.getNewState())}_setZoomLevel(t){this.zoomLevel=t,this.backgroundSize=16*this.zoomLevel}}$.ɵfac=function(t){return new(t||$)(x.Y(o.SB),x.Y(S.J),x.Y(T.s),x.Y(y.nR))},$.ɵcmp=w.Xp({type:$,selectors:[["relations-canvas"]],viewQuery:function(t,e){if(1&t&&j.Gf(U,5,o.SB),2&t){let t;j.iG(t=j.CR())&&(e.relationsGroup=t.first)}},hostVars:4,hostBindings:function(t,e){1&t&&L.N("mousedown",(function(t){return e.onMouseDown(t)}))("mousemove",(function(t){return e.onMouseMove(t)}))("mouseup",(function(t){return e.onMouseUp(t)}),!1,F.Jf)("wheel",(function(t){return e.onWheel(t)})),2&t&&O.Ud("background-size",e.backgroundSizeStyle)("background-position",e._backgroundPositionStyle)},inputs:{nodeDefinitions:"nodeDefinitions"},standalone:!0,features:[Y.j],decls:5,vars:3,consts:[[1,"flow-area"],[1,"relations-wrapper"],["relationsGroup",""],[4,"ngFor","ngForOf"],[3,"relationsNodeRenderer","zoomLevel","destroy"]],template:function(t,e){1&t&&(B.Tg(0,"div",0),R.O4(),B.Tg(1,"svg",1),B._U(2,"g",null,2),B.qZ(),I.Y(4,Z,2,2,"ng-container",3),B.qZ()),2&t&&(O.Ud("transform","translate("+e.canvasPosition.x+"px, "+e.canvasPosition.y+"px) scale("+e.zoomLevel+")"),P.x(4),_.Q("ngForOf",e.nodeDefinitions))},dependencies:[i.e,A.sg,N],encapsulation:2,changeDetection:0})},40362:(t,e,n)=>{n.d(e,{r:()=>o});const o="drop"},26220:(t,e,n)=>{var o;n.d(e,{t:()=>o}),function(t){t[t.LEFT=1]="LEFT"}(o||(o={}))},71309:(t,e,n)=>{n.d(e,{I:()=>z});var o=n(9249),i=n(79440),a=n(77842),s=n(84773),r=n(76405),d=n(72891),c=n(41853),l=n(43870),h=n(11282),u=n(73301),p=n(66794),g=n(31750),m=n(80943),v=n(74445),f=n(49891),y=n(43939),b=n(58654);(0,n(52266).y)((t=>{(0,y.fp)(t.ngDynamicMonacoPath)&&(t.ngDynamicMonacoPath="dist")})),self.MonacoEnvironment={getWorkerUrl:function(t,e){return"json"===e?"dist/json.worker.js":"css"===e||"scss"===e||"less"===e?"dist/css.worker.js":"html"===e||"handlebars"==e?"dist/html.worker.js":"typescript"===e||"javascript"===e?"dist/ts.worker.js":"dist/editor.worker.js"}};const x={target:b.Mj.typescript.ScriptTarget.ES2020,module:b.Mj.typescript.ModuleKind.CommonJS,moduleResolution:b.Mj.typescript.ModuleResolutionKind.NodeJs,allowNonTsExtensions:!0,removeComments:!0,noEmitOnError:!0,noImplicitAny:!0,noImplicitReturns:!0,noImplicitOverride:!0,noImplicitThis:!0,noUnusedLocals:!0,noUnusedParameters:!0,strict:!0,strictNullChecks:!0,esModuleInterop:!0,newLine:b.Mj.typescript.NewLineKind.LineFeed,typeRoots:["node_modules/@types"]};b.Mj.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1,noSyntaxValidation:!1}),b.Mj.typescript.typescriptDefaults.setCompilerOptions(x);var M=n(4905),w=n(36973);function D(t,e,n,o,i,a,s){try{var r=t[a](s),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(o,i)}function S(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function s(t){D(a,o,i,s,r,"next",t)}function r(t){D(a,o,i,s,r,"throw",t)}s(void 0)}))}}class C{constructor(t){this.element=t,this.codeEditor=null,this.openedFile=null,this.changeEvent=null,this.save=new v.v,this.contentChange=new v.v}ngOnChanges(t){(0,f.$)("languageModel")in t&&this.languageModel&&(0,f.$)("content")in t&&(0,y.EN)(this.content)&&this.updateContent()}ngAfterViewInit(){this.createEditor()}saveContent(){var t=this;return S((function*(){t.openedFile&&t.codeEditor&&t.languageModel&&t.save.emit({content:t.openedFile.getValue(),code:yield t.languageModel.compiledCode(t.codeEditor)})}))()}ngOnDestroy(){this.changeEvent?.dispose(),this.changeEvent=null,this.openedFile?.dispose(),this.openedFile=null,this.codeEditor?.dispose(),this.codeEditor=null}createEditor(){var t=this;this.codeEditor=b.j6.create(this.element.nativeElement,{theme:"vs-dark",model:this.openedFile,lightbulb:{enabled:!0},bracketPairColorization:{enabled:!0},minimap:{enabled:!0}}),this.codeEditor.addCommand(b.DC.CtrlCmd|b.VD.KeyS,(()=>{this.saveContent()})),this.changeEvent=this.codeEditor.onDidChangeModelContent(S((function*(){t.openedFile&&t.languageModel&&t.codeEditor&&t.contentChange.emit({content:t.openedFile.getValue(),code:yield t.languageModel.compiledCode(t.codeEditor)})})))}updateContent(){this.openedFile?.dispose(),this.openedFile=null,this.languageModel&&!(0,y.fp)(this.content)&&(this.openedFile=b.j6.createModel((this.content||this.languageModel.initialData)??"",this.languageModel.language,b.Sf.file(`file:///index.${this.languageModel.extension}`)),this.codeEditor?.setModel(this.openedFile))}}function N(t,e,n,o,i,a,s){try{var r=t[a](s),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(o,i)}C.monacoInit=!0,C.ɵfac=function(t){return new(t||C)(i.Y(M.SB))},C.ɵcmp=a.Xp({type:C,selectors:[["code-editor"]],inputs:{content:"content",languageModel:"languageModel"},outputs:{save:"save",contentChange:"contentChange"},features:[w.T],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0});class z{constructor(t,e){this.data=t,this.dialog=e,this.editorContent=null}saveAndClose(t){var e,n=this;return(e=function*(){yield t.saveContent(),n.dialog.close(n.editorContent)},function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function s(t){N(a,o,i,s,r,"next",t)}function r(t){N(a,o,i,s,r,"throw",t)}s(void 0)}))})()}}z.ɵfac=function(t){return new(t||z)(i.Y(o.m),i.Y(g.s))},z.ɵcmp=a.Xp({type:z,selectors:[["code-editor-dialog"]],decls:9,vars:3,consts:[[2,"height","calc(70vh - 46px)","width","calc(75vw - 20px)",3,"content","languageModel","save"],["editor",""],[1,"dynamic-flex-row","dynamic-flex-end","dynamic-margin-top-extra-small"],["type","button","type","button",1,"dynamic-btn","dynamic-btn-info","dynamic-margin-right-extra-small",3,"mat-dialog-close"],["type","button","type","button",1,"dynamic-btn","dynamic-btn-primary",3,"click"]],template:function(t,e){if(1&t){const t=s.E();r.Tg(0,"code-editor",0,1),d.N("save",(function(t){return e.editorContent=t})),r.qZ(),r.Tg(2,"div",2)(3,"button",3)(4,"span"),c._(5,"cancel"),r.qZ()(),r.Tg(6,"button",4),d.N("click",(function(){l.CH(t);const n=h.M(1);return l.Kt(e.saveAndClose(n))})),r.Tg(7,"span"),c._(8,"ok"),r.qZ()()()}2&t&&(u.Q("content",e.data.content)("languageModel",e.data.languageModel),p.x(3),u.Q("mat-dialog-close",null))},dependencies:[m.ZT,C],encapsulation:2,changeDetection:0})},53136:(t,e,n)=>{n.d(e,{y:()=>o});class o{constructor(t,e,n,o){this.language=t,this.extension=e,this.compiledCode=n,this.initialData=o}}},80890:(t,e,n)=>{n.d(e,{A:()=>s});var o=n(58654),i=n(53136);function a(t,e,n,o,i,a,s){try{var r=t[a](s),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(o,i)}const s=t=>new i.y("typescript","ts",function(){var t,e=(t=function*(t){const e=t.getModel()?.uri;if(!e)return"";const n=yield o.Mj.typescript.getTypeScriptWorker(),i=yield n(e);return(yield i.getEmitOutput(e.toString())).outputFiles[0].text},function(){var e=this,n=arguments;return new Promise((function(o,i){var s=t.apply(e,n);function r(t){a(s,o,i,r,d,"next",t)}function d(t){a(s,o,i,r,d,"throw",t)}r(void 0)}))});return function(t){return e.apply(this,arguments)}}(),t)}}]);
//# sourceMappingURL=980.chunk.e44f0b3c05a076679328.js.map