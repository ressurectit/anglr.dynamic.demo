"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[5957],{75957:(t,e,n)=>{n.d(e,{F:()=>U});var o=n(4905),i=n(27052),s=n(9360),a=n(53682),r=n(40362);class u{constructor(t,e,n,o){this._parentGroup=t,this._relationManager=e,this.start=n,this.end=o,this._destroyingSubject=new a.xQ,this.output=null,this.input=null,this._path=this._parentGroup.append("path").attr("fill","transparent").attr("stroke","#48B8B8").attr("stroke-width","3px"),this._lineGenerator=(0,s.jvg)().curve(s.tFB.beta(.75))}get destroying(){return this._destroyingSubject.asObservable()}destroy(){this._path?.remove(),this._destroyingSubject.next()}invalidateVisuals(t){if(t==r.r){const t=this._relationManager.getActiveInput();this._relationManager.setActiveInput(null),t&&t.addRelation(this)?(this.end=t.getCoordinates(),this.input=t):(this.destroy(),this.start=null,this.end=null,this.input=null,this.output=null)}if(!this.start||!this.end)return;let e;if(this.end.x<=this.start.x){let t=this.start.x-this.end.x;const n=(this.end.y-this.start.y)/2;t<12&&(t=12),t*=1.3,e=[[this.start.x,this.start.y],[this.start.x+t,this.start.y+n],[this.end.x-t,this.start.y+n],[this.end.x,this.end.y]]}else{const t=(this.end.x-this.start.x)/3;e=[[this.start.x,this.start.y],[this.start.x+t,this.start.y],[this.end.x-t,this.end.y],[this.end.x,this.end.y]]}this._path.attr("d",this._lineGenerator(e))}}var d=n(26220),c=n(47432),l=n(74445),p=n(46480),h=n(14389),f=n(49891),g=n(43939),m=n(91861),v=n(79440),y=n(15783),w=n(13691),_=n(36973),R=n(48397);function x(t,e,n,o,i,s,a){try{var r=t[s](a),u=r.value}catch(t){return void n(t)}r.done?e(u):Promise.resolve(u).then(o,i)}class M{constructor(t,e,n,o){this.viewContainerRef=t,this.relationsNodeManager=e,this.loader=n,this.logger=o,this.destroySubscription=null,this.componentRef=null,this.componentMetadata=null,this.zoomLevel=1,this.create=new l.v,this.destroy=new l.v}get component(){return this.componentRef?this.componentRef.instance:null}ngOnChanges(t){var e,n=this;return(e=function*(){if((0,f.$)("zoomLevel")in t&&(0,g.EN)(n.zoomLevel)&&!((0,f.$)("componentMetadata")in t)){const e=n.component;if(e){const o=t[(0,f.$)("zoomLevel")];e.zoomLevel=n.zoomLevel;const i={};(0,h.m)(i,"zoomLevel",o,o.previousValue),e.ngOnChanges(i),e.invalidateVisuals()}}else if(n.logger?.debug("RelationsNodeRendererSADirective: rendering node {@id}",{id:n.componentMetadata?.id}),n.ngOnDestroy(),n.viewContainerRef.clear(),(0,f.$)("componentMetadata")in t&&n.componentMetadata){const t=yield n.loader.loadItem(n.componentMetadata);if(!t)return void n.logger?.warn("RelationsNodeRendererSADirective: Unable to find relations node type {@type}",{name:n.componentMetadata.name,package:n.componentMetadata.package});if(n.componentRef=n.viewContainerRef.createComponent(t.data,{injector:n.viewContainerRef.injector}),n.logger?.debug("RelationsNodeRendererSADirective: node rendered {@id}",{id:n.componentMetadata?.id}),n.component){const t=n.component;n.destroySubscription=t.destroy.subscribe((()=>n.ngOnDestroy())),n.logger?.debug("RelationsNodeRendererSADirective: initializing node with metadata {@id}",{id:n.componentMetadata?.id}),t.metadata=n.componentMetadata,t.zoomLevel=n.zoomLevel;const e={};(0,h.m)(e,"metadata",n.componentMetadata,null,!0),(0,h.m)(e,"zoomLevel",n.zoomLevel,null,!0),t.ngOnChanges(e),n.logger?.debug("RelationsNodeRendererSADirective: invalidating node visuals {@id}",{id:n.componentMetadata?.id}),t.invalidateVisuals(),n.componentRef.changeDetectorRef.markForCheck(),n.relationsNodeManager.registerNode(n.component),n.create.next(t)}}},function(){var t=this,n=arguments;return new Promise((function(o,i){var s=e.apply(t,n);function a(t){x(s,o,i,a,r,"next",t)}function r(t){x(s,o,i,a,r,"throw",t)}a(void 0)}))})()}ngOnDestroy(){this.destroySubscription?.unsubscribe(),this.destroySubscription=null,this.componentRef&&(this.logger?.debug("RelationsNodeRendererSADirective: destroying node {@id}",{id:this.componentMetadata?.id}),this.component&&(this.componentMetadata&&this.destroy.next(this.componentMetadata),this.relationsNodeManager.unregisterNode(this.component)),this.componentRef?.destroy(),this.componentRef=null)}}M.ɵfac=function(t){return new(t||M)(v.Y(y.s_),v.Y(R.J),v.Y(m.fI),v.Y(p.bZ,8))},M.ɵdir=w.lG({type:M,selectors:[["","relationsNodeRenderer",""]],inputs:{componentMetadata:["relationsNodeRenderer","componentMetadata"],zoomLevel:"zoomLevel"},outputs:{create:"create",destroy:"destroy"},exportAs:["relationsNodeRenderer"],standalone:!0,features:[_.T]});var b=n(84773),P=n(43870),D=n(4477),N=n(72891),O=n(6845),S=n(66794),L=n(73301),E=n(55436),k=n(47083),z=n(85320),A=n(82568),I=n(80827),T=n(15686),C=n(12311);const F=["relationsGroup"];function Y(t,e){if(1&t){const t=b.E();P.O4(),P.kc(),D.yn(0)(1,4),N.N("destroy",(function(e){P.CH(t);const n=O.o();return P.Kt(n.destroyNode(e))})),D.BQ()()}if(2&t){const t=e.$implicit,n=O.o();S.x(1),L.Q("relationsNodeRenderer",t)("zoomLevel",n.zoomLevel)}}class U{constructor(t){this.relationManager=t,this.backgroundSize=16,this.lastMouseDownPosition={x:0,y:0},this.lastMouseUpPosition={x:0,y:0},this.canvasPosition={x:0,y:0},this.zoomLevel=1,this.isDragging=!1,this.nodeDefinitions=[]}get backgroundSizeStyle(){return`${this.backgroundSize}px ${this.backgroundSize}px`}get _backgroundPositionStyle(){return`${this.canvasPosition.x%this.backgroundSize}px ${this.canvasPosition.y%this.backgroundSize}px`}createRelation(){return new u((0,s.Ys)(this.relationsGroup?.nativeElement),this.relationManager,null,null)}onMouseDown(t){t.buttons==d.t.LEFT&&(this.lastMouseDownPosition={x:t.clientX,y:t.clientY},this.isDragging=!0)}onMouseMove(t){this.isDragging&&(this.canvasPosition={x:this.lastMouseUpPosition.x+t.clientX-this.lastMouseDownPosition.x,y:this.lastMouseUpPosition.y+t.clientY-this.lastMouseDownPosition.y})}onMouseUp(t){this.isDragging&&(this.isDragging=!1,this.lastMouseUpPosition={x:this.lastMouseUpPosition.x+t.clientX-this.lastMouseDownPosition.x,y:this.lastMouseUpPosition.y+t.clientY-this.lastMouseDownPosition.y})}onWheel(t){if(t.deltaY){const e=(0,c.uZ)(this.zoomLevel+.05*(t.deltaY>1?-1:1),.2,2);this.canvasPosition={x:this.canvasPosition.x/this.zoomLevel*e,y:this.canvasPosition.y/this.zoomLevel*e},this.zoomLevel=e,this.lastMouseUpPosition={x:this.canvasPosition.x,y:this.canvasPosition.y},this.backgroundSize=16*this.zoomLevel}t.preventDefault(),t.stopImmediatePropagation()}destroyNode(t){const e=this.nodeDefinitions.indexOf(t);e<0||this.nodeDefinitions.splice(e,1)}}U.ɵfac=function(t){return new(t||U)(v.Y(R.J))},U.ɵcmp=w.Xp({type:U,selectors:[["relations-canvas"]],viewQuery:function(t,e){if(1&t&&E.Gf(F,5,o.SB),2&t){let t;E.iG(t=E.CR())&&(e.relationsGroup=t.first)}},hostVars:4,hostBindings:function(t,e){1&t&&N.N("mousedown",(function(t){return e.onMouseDown(t)}))("mousemove",(function(t){return e.onMouseMove(t)}))("mouseup",(function(t){return e.onMouseUp(t)}),!1,k.Jf)("wheel",(function(t){return e.onWheel(t)})),2&t&&z.Ud("background-size",e.backgroundSizeStyle)("background-position",e._backgroundPositionStyle)},inputs:{nodeDefinitions:"nodeDefinitions"},standalone:!0,features:[A.j],decls:5,vars:3,consts:[[1,"flow-area"],[1,"relations-wrapper"],["relationsGroup",""],[4,"ngFor","ngForOf"],[3,"relationsNodeRenderer","zoomLevel","destroy"]],template:function(t,e){1&t&&(I.Tg(0,"div",0),P.O4(),I.Tg(1,"svg",1),I._U(2,"g",null,2),I.qZ(),T.Y(4,Y,2,2,"ng-container",3),I.qZ()),2&t&&(z.Ud("transform","translate("+e.canvasPosition.x+"px, "+e.canvasPosition.y+"px) scale("+e.zoomLevel+")"),S.x(4),L.Q("ngForOf",e.nodeDefinitions))},dependencies:[i.e,C.s,M],styles:["[_nghost-%COMP%]\n{\n    background-color: #e5e5f7;\n    opacity: 0.6;\n    background-image: radial-gradient(#444cf7 0.8px, #e5e5f7 0.8px);\n    overflow: hidden;\n}\n\n.relations-wrapper[_ngcontent-%COMP%]\n{\n    width: 100%;\n    height: 100%;\n    overflow: visible;\n}"],changeDetection:0})},40362:(t,e,n)=>{n.d(e,{r:()=>o});const o="drop"},26220:(t,e,n)=>{var o;n.d(e,{t:()=>o}),function(t){t[t.LEFT=1]="LEFT"}(o||(o={}))},53971:(t,e,n)=>{n.d(e,{g7:()=>b,AL:()=>S,aU:()=>L,md:()=>O,YK:()=>D,xt:()=>E,Oq:()=>k,UB:()=>N,I_:()=>P});var o=n(60640),i=n(11776),s=n(51509),a=n(65569),r=n(44677),u=n(12193),d=n(46480),c=n(91861),l=n(10439),p=n(87606);function h(t,e,n,o,i,s,a){try{var r=t[s](a),u=r.value}catch(t){return void n(t)}r.done?e(u):Promise.resolve(u).then(o,i)}const f=function(){var t,e=(t=function*(t,e){const n=yield(0,p.K)((0,l.j)(t,e));if(e?.debug("relationsNodeExtractor: trying to extract dynamic node"),!n)return null;const o=n.data;if(!o)return null;const i=yield o.relationsEditorMetadata;return i?{data:i.nodeDefinition,metaInfo:i.metaInfo}:null},function(){var e=this,n=arguments;return new Promise((function(o,i){var s=t.apply(e,n);function a(t){h(s,o,i,a,r,"next",t)}function r(t){h(s,o,i,a,r,"throw",t)}a(void 0)}))});return function(t,n){return e.apply(this,arguments)}}();function g(t,e,n,o,i,s,a){try{var r=t[s](a),u=r.value}catch(t){return void n(t)}r.done?e(u):Promise.resolve(u).then(o,i)}const m=function(){var t,e=(t=function*(t,e){const n=t;if(e?.debug("componentRelationsNodeExtractor: trying to extract dynamic node"),!n)return null;const o=n.default;if(!o)return null;const i=yield o.relationsEditorMetadata;return i?{data:i.nodeDefinition,metaInfo:i.metaInfo,singleton:!0}:null},function(){var e=this,n=arguments;return new Promise((function(o,i){var s=t.apply(e,n);function a(t){g(s,o,i,a,r,"next",t)}function r(t){g(s,o,i,a,r,"throw",t)}a(void 0)}))});return function(t,n){return e.apply(this,arguments)}}();var v=n(38327),y=n(54870);class w{constructor(t,e){this._componentsRegister=t,this._logger=e}tryToGet(t){if("static-components"!=t.package)return null;this._logger?.debug("StaticComponentsRelationsNodesProvider: trying to get node {@item}",{name:t.name,package:t.package});const e=this._componentsRegister.getType(t.name);return e?{default:e}:null}}function _(t,e,n,o,i,s,a){try{var r=t[s](a),u=r.value}catch(t){return void n(t)}r.done?e(u):Promise.resolve(u).then(o,i)}w.ɵfac=function(t){return new(t||w)(i.LF(y.w),i.LF(d.bZ,8))},w.ɵprov=v.Yz({token:w,factory:w.ɵfac});class R{constructor(t){this._logger=t}tryToGet(t){var e,o=this;return(e=function*(){try{switch(o._logger?.debug("DefaultDynamicModuleRelationsProvider: trying to get relations types for module {@module}",{moduleName:t.package}),t.package){case"basic-components":return yield n.e(4041).then(n.bind(n,94041));case"material-components":return yield n.e(5342).then(n.bind(n,85342));default:return null}}catch(e){o._logger?.debug("DefaultDynamicModuleRelationsProvider: module {@module} was not found, reason: "+e,{moduleName:t.package})}return null},function(){var t=this,n=arguments;return new Promise((function(o,i){var s=e.apply(t,n);function a(t){_(s,o,i,a,r,"next",t)}function r(t){_(s,o,i,a,r,"throw",t)}a(void 0)}))})()}}R.ɵfac=function(t){return new(t||R)(i.LF(d.bZ,8))},R.ɵprov=v.Yz({token:R,factory:R.ɵfac});class x{constructor(t,e){this._componentsRegister=t,this._logger=e}tryToGet(t){if("static-components"!=t.package)return null;this._logger?.debug("StaticComponentsRelationsTypesProvider: trying to get relations types {@item}",{name:t.name,package:t.package});const e=this._componentsRegister.types;return e?{default:e}:null}}x.ɵfac=function(t){return new(t||x)(i.LF(y.w),i.LF(d.bZ,8))},x.ɵprov=v.Yz({token:x,factory:x.ɵfac});var M=n(47432);const b={provide:c.n7,useClass:s.c,multi:!0},P={provide:c.n7,useClass:w,multi:!0},D={provide:c.GP,useClass:R,multi:!0},N={provide:c.GP,useClass:x,multi:!0},O={provide:c.yh,useFactory:t=>new a.$([f],t),deps:[[new o.Fi,d.bZ]],multi:!0},S={provide:c.yh,useFactory:t=>new a.$([m],t),deps:[[new o.Fi,d.bZ]],multi:!0},L={provide:c.DZ,useFactory:t=>new a.$([r.L],t),deps:[[new o.Fi,d.bZ]],multi:!0},E={provide:c.Bj,useFactory:()=>new u.S((0,i.f3)(c.GP),(0,i.f3)(c.DZ),M.CQ,(0,i.f3)(d.bZ,{optional:!0})??void 0,!0)},k={provide:c.fI,useFactory:()=>new u.S((0,i.f3)(c.n7),(0,i.f3)(c.yh),M.Zl,(0,i.f3)(d.bZ,{optional:!0})??void 0)}},91861:(t,e,n)=>{n.d(e,{Bj:()=>a,DZ:()=>i,GP:()=>s,dK:()=>c,fI:()=>d,n7:()=>u,yh:()=>r});var o=n(40296);const i=new o.O("RELATIONS_MODULE_TYPES_DATA_EXTRACTORS"),s=new o.O("RELATIONS_MODULE_TYPES_PROVIDERS"),a=new o.O("RELATIONS_MODULE_TYPES_LOADER"),r=new o.O("RELATIONS_NODES_DATA_EXTRACTORS"),u=new o.O("RELATIONS_NODES_PROVIDERS"),d=new o.O("RELATIONS_NODES_LOADER"),c=new o.O("REFRESH_PALETTE_OBSERVABLES")},47432:(t,e,n)=>{n.d(e,{CQ:()=>u,TN:()=>c,Zl:()=>d,hE:()=>l,uZ:()=>r});var o=n(43939),i=n(53971),s=n(48397),a=n(54870);function r(t,e,n){return Math.min(Math.max(t,e),n)}const u=function(t){return!((0,o.fp)(t?.data)||!Array.isArray(t.data))},d=function(t){return!((0,o.fp)(t?.data)||!(0,o.P9)(t.data)||(0,o.EN)(t.singleton)&&!(0,o.jn)(t.singleton)||(0,o.EN)(t?.metaInfo)&&!(0,o.wV)(t.metaInfo))};function c(){return[i.g7,i.YK,i.md,i.AL,i.aU,i.xt,i.Oq,s.J]}function l(t){return[...c(),i.I_,i.UB,{provide:a.w,useClass:t}]}},48397:(t,e,n)=>{n.d(e,{J:()=>i});var o=n(38327);class i{constructor(){this._nodes={},this._waitingInputRelations={}}setActiveInput(t){this._activeInput=t}getActiveInput(){return this._activeInput}registerNode(t){var e,n;if(this._nodes[t.id]=t,t.metadata?.outputs&&Array.isArray(t.metadata?.outputs))for(const o of t.metadata?.outputs){if(!o.inputs||!Array.isArray(o.inputs))continue;const i=t.outputs[o.outputName];if(i)for(const t of o.inputs){const o=this._nodes[t.id],s=i.startRelation();if(!o){(e=this._waitingInputRelations)[n=t.id]??(e[n]=[]),this._waitingInputRelations[t.id].push({inputName:t.inputName,relation:s});continue}const a=o.inputs[t.inputName];a&&a.endRelation(s)}}if(this._waitingInputRelations[t.id]){const e=this._waitingInputRelations[t.id],n=this._nodes[t.id];if(!n)return;for(const o of e){const e=n.inputs[o.inputName];e&&(e.endRelation(o.relation),delete this._waitingInputRelations[t.id])}}}unregisterNode(t){delete this._nodes[t.id]}getMetadata(){const t=[],e=Object.keys(this._nodes);for(const n of e){const e=this._nodes[n];if(!e.metadata)continue;const o={id:n,name:e.metadata.name,package:e.metadata.package,displayName:e.metadata.displayName,relationsOptions:e.metadata.relationsOptions,nodeMetadata:e.metadata.nodeMetadata,outputs:[]};if(e.allOutputs){for(const t of e.allOutputs){if(!t.relations)continue;if(!t.name)continue;const e={outputName:t.name,inputs:[]};for(const n of t.relations)n.input?.name&&e.inputs.push({id:n.input.parentId,inputName:n.input.name});o.outputs?.push(e)}t.push(o)}}return t}}i.ɵfac=function(t){return new(t||i)},i.ɵprov=o.Yz({token:i,factory:i.ɵfac})},54870:(t,e,n)=>{n.d(e,{w:()=>i});var o=n(38327);class i{constructor(){this._definedTypes=this.getDefinedTypes()}get types(){return Object.keys(this._definedTypes)}getType(t){return this._definedTypes[t]??null}}i.ɵfac=function(t){return new(t||i)},i.ɵprov=o.Yz({token:i,factory:i.ɵfac})},10439:(t,e,n)=>{n.d(e,{j:()=>s});var o=n(43939),i=n(89402);const s=(t,e)=>{const n=t;return e?.debug("relationsExportExtractor: trying to extract dynamic relations"),(0,o.EN)(n.relations)&&(0,o.P9)(n.relations)&&(0,i.O)(n.relations)?{data:n.relations}:(0,o.EN)(n.default)&&(0,o.P9)(n.default)&&(0,i.O)(n.default)?{data:n.default}:null}},44677:(t,e,n)=>{n.d(e,{L:()=>i});var o=n(43939);const i=(t,e)=>{const n=t;return e?.debug("defaultExportExtractor: trying to extract default dynamic data"),(0,o.EN)(n.default)?{data:n.default}:null}}}]);
//# sourceMappingURL=5957.chunk.7268fabdd3a525216a03.js.map