"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[3292],{6258:(e,t,a)=>{a.d(t,{E:()=>E});var s=a(2032),n=a(27052),i=a(989),o=a(46480),r=a(57466),c=a(45069),d=a(38223),l=a(91861),g=a(13691);class p{transform(e,t,a){return{metadata:{id:a?t:`${e.itemSource.name}-${t}`,displayName:void 0,package:e.itemSource.package,name:e.itemSource.name,relationsOptions:(0,r.l7)(!0,{},e.metadata.metaInfo?.defaultOptions),outputs:[],nodeMetadata:{coordinates:{x:0,y:0},options:null}}}}}p.ɵfac=function(e){return new(e||p)},p.ɵpipe=g.Yj({name:"toRelationsDragData",type:p,pure:!0,standalone:!0});var u=a(80827),m=a(41853),h=a(6845),f=a(66794),k=a(6427),v=a(84773),b=a(72891),y=a(43870),P=a(65589),x=a(15686),_=a(73301),D=a(4477),O=a(79440),w=a(68961),I=a(82568),C=a(17505),S=a(48397),T=a(12311),M=a(21651),L=a(32434),N=a(99055),F=a(23208);function q(e,t,a,s,n,i,o){try{var r=e[i](o),c=r.value}catch(e){return void a(e)}r.done?t(c):Promise.resolve(c).then(s,n)}function Y(e){return function(){var t=this,a=arguments;return new Promise((function(s,n){var i=e.apply(t,a);function o(e){q(i,s,n,o,r,"next",e)}function r(e){q(i,s,n,o,r,"throw",e)}o(void 0)}))}}function A(e,t){if(1&e&&(u.Tg(0,"div",8),m._(1),u.qZ()),2&e){const e=h.o().$implicit;f.x(1),k.Oq(null==e.metadata.metaInfo?null:e.metadata.metaInfo.description)}}function Z(e,t){if(1&e){const e=v.E();u.Tg(0,"div",4)(1,"div",5),b.N("cdkDragDropped",(function(){y.CH(e);const t=h.o(2);return y.Kt(t.generateNewId())})),P.AL(2,"toRelationsDragData"),u.Tg(3,"div",6),m._(4),u.qZ(),x.Y(5,A,2,1,"div",7),u.qZ()()}if(2&e){const e=t.$implicit,a=h.o(2);let s;_.Q("cdkDropListConnectedTo",a.canvasDropList),f.x(1),_.Q("cdkDragData",P.Dn(2,4,e,e.metadata.singleton?e.metadata.displayName||e.itemSource.name:a.newCompnentId,e.metadata.singleton)),f.x(3),k.Oq(e.metadata.singleton?e.metadata.displayName||e.itemSource.name:null!==(s=null==e.metadata.metaInfo?null:e.metadata.metaInfo.name)&&void 0!==s?s:e.itemSource.name),f.x(1),_.Q("ngIf",null==e.metadata.metaInfo?null:e.metadata.metaInfo.description)}}function Q(e,t){if(1&e&&(D.yn(0),u.Tg(1,"div",2),m._(2),u.qZ(),x.Y(3,Z,6,8,"div",3),D.BQ()),2&e){const e=t.$implicit;f.x(2),k.hi("",e.key," "),f.x(1),_.Q("ngForOf",e.value)}}class E{constructor(e,t,a,s,n,i,o){this._moduleTypesLoader=e,this._nodesLoader=t,this._changeDetector=a,this.packageManager=s,this._metadataManager=n,this._refreshObservables=i,this._logger=o,this.initSubscriptions=new d.w,this.allItems=[],this.syncPromise=Promise.resolve(),this.groupedItems={},this.newCompnentId=(0,r.Ox)(16),this.isDragOverPalette=!1}ngOnInit(){var e=this;return Y((function*(){if(e._refreshObservables&&Array.isArray(e._refreshObservables))for(const t of e._refreshObservables)e.initSubscriptions.add(t.subscribe((()=>e.loadNodes())));e.initSubscriptions.add(e.packageManager.usedPackagesChange.subscribe((()=>e.loadNodes()))),yield e.loadNodes()}))()}ngOnDestroy(){this.initSubscriptions.unsubscribe()}loadNodes(){var e=this;return Y((function*(){var t;let a;yield e.syncPromise,e.syncPromise=new Promise((e=>a=e)),e.allItems=[],e.groupedItems={};for(const t of e.packageManager.usedPackages){const a=(yield e._moduleTypesLoader.loadItem({package:t,name:"types"}))?.data??[];for(const s of a){const a={package:t,name:s},n=yield e._nodesLoader.loadItem(a);n?e.allItems.push({itemSource:a,metadata:n}):e._logger?.warn("NodesPaletteSAComponent: Failed to obtain layout editor metadata {@source}",a)}}e.groupedItems[""]=[];for(const a of e.allItems){const s=a.metadata.metaInfo?.group??"";(t=e.groupedItems)[s]??(t[s]=[]),e.groupedItems[s].push(a)}e._changeDetector.detectChanges(),a?.()}))()}generateNewId(){this.newCompnentId=(0,r.Ox)(16)}}E.ɵfac=function(e){return new(e||E)(O.Y(l.Bj),O.Y(l.fI),O.Y(w.s),O.Y(C.L),O.Y(S.J),O.Y(l.dK,8),O.Y(o.bZ,8))},E.ɵcmp=g.Xp({type:E,selectors:[["nodes-palette"]],inputs:{canvasDropList:"canvasDropList"},standalone:!0,features:[I.j],decls:3,vars:3,consts:[[1,"flex-column"],[4,"ngFor","ngForOf"],[1,"text-spread","text-small-caps","margin-left-extra-small","margin-horizontal-small","bold"],["cdkDropList","","cdkDropListSortingDisabled","","class","palette-droplist",3,"cdkDropListConnectedTo",4,"ngFor","ngForOf"],["cdkDropList","","cdkDropListSortingDisabled","",1,"palette-droplist",3,"cdkDropListConnectedTo"],["cdkDrag","",1,"editor-component","mat-elevation-z2",3,"cdkDragData","cdkDragDropped"],[1,"editor-component-name"],["class","editor-component-description",4,"ngIf"],[1,"editor-component-description"]],template:function(e,t){1&e&&(u.Tg(0,"div",0),x.Y(1,Q,4,2,"ng-container",1),P.AL(2,"keyvalue"),u.qZ()),2&e&&(f.x(1),_.Q("ngForOf",P.lc(2,1,t.groupedItems)))},dependencies:[n.e,T.s,M.O,L.N,i._,N.W,F.Z,p],styles:["[_nghost-%COMP%]\n{\n    display: flex;\n}\n\n.editor-component[_ngcontent-%COMP%]\n{\n    margin: 2px 10px;\n    padding: 4px 8px;\n\n    border-radius: 6px;\n    border: 1px solid #F0F0F0;\n    background-color: #FAFAFA;\n}\n\n.editor-component-name[_ngcontent-%COMP%]\n{\n    font-weight: 500;\n}\n\n.editor-component-description[_ngcontent-%COMP%]\n{\n    margin-left: 4px;\n    margin-top: 2px;\n    font-size: .8em;\n}\n\n.palette-droplist[_ngcontent-%COMP%]   layout-editor-drag-placeholder[_ngcontent-%COMP%]\n{\n    display: none;\n}"],changeDetection:0}),(0,s.gn)([(0,c.C)(10),(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[]),(0,s.w6)("design:returntype",Promise)],E.prototype,"loadNodes",null)},36159:(e,t,a)=>{a.d(t,{Y:()=>I});var s=a(11776),n=a(989),i=a(39969),o=a(56454),r=a(22804),c=a(44155),d=a(49891),l=a(38223),g=a(6258),p=a(75957),u=a(91861),m=a(79440),h=a(68961),f=a(13691),k=a(73379),v=a(36973),b=a(82568),y=a(80827),P=a(72891),x=a(11282),_=a(66794),D=a(73301),O=a(99055),w=a(6535);class I{constructor(e,t,a){this.hotkeys=e,this.history=t,this.changeDetector=a,this.initSubscriptions=new l.w,this.metadata=[],e.init()}ngOnInit(){this.initSubscriptions.add(this.history.pop.subscribe((e=>{this.metadata=e,this.changeDetector.detectChanges()})))}ngOnChanges(e){(0,d.$)("metadata")in e&&(this.history.clean(),this.metadata&&this.history.setInitialState(this.metadata))}ngOnDestroy(){this.initSubscriptions.unsubscribe(),this.hotkeys.destroy()}addNode(e){const t=e.container.element.nativeElement.getBoundingClientRect();e.item.data.metadata.nodeMetadata?.coordinates&&(e.item.data.metadata.nodeMetadata.coordinates.x=e.dropPoint.x-t.x,e.item.data.metadata.nodeMetadata.coordinates.y=e.dropPoint.y-t.y),this.metadata=[...this.metadata,e.item.data.metadata],this.history.getNewState()}}I.ɵfac=function(e){return new(e||I)(m.Y(o.z),m.Y(u.nR),m.Y(h.s))},I.ɵcmp=f.Xp({type:I,selectors:[["relations-editor"]],inputs:{metadata:"metadata"},standalone:!0,features:[k._([{provide:o.z,useFactory:(e,t)=>new o.z(e,(0,s.f3)(u.nR),t),deps:[i.H,r.I]}]),v.T,b.j],decls:6,vars:2,consts:[[1,"flex-row","flex-1"],[1,"overflow-vertical-scroll","thin-scrollbar"],[2,"width","250px",3,"canvasDropList"],["cdkDropList","",1,"flex-1",3,"nodeDefinitions","cdkDropListDropped"],["dropList","cdkDropList"]],template:function(e,t){if(1&e&&(y.Tg(0,"div",0)(1,"div",1),y._U(2,"package-manager")(3,"nodes-palette",2),y.qZ(),y.Tg(4,"relations-canvas",3,4),P.N("cdkDropListDropped",(function(e){return t.addNode(e)})),y.qZ()()),2&e){const e=x.M(5);_.x(3),D.Q("canvasDropList",e),_.x(1),D.Q("nodeDefinitions",t.metadata)}},dependencies:[g.E,p.F,n._,O.W,c.F,w.X],styles:["[_nghost-%COMP%]{display: flex;}"],changeDetection:0})},89402:(e,t,a)=>{function s(e){return!!e.__ɵɵRelationsComponent}function n(){return function(e){return e.__ɵɵRelationsComponent=!0,e}}a.d(t,{H:()=>n,O:()=>s})},6535:(e,t,a)=>{a.d(t,{X:()=>O});var s=a(80827),n=a(41853),i=a(73301),o=a(66794),r=a(6427),c=a(84773),d=a(72891),l=a(43870),g=a(6845),p=a(15686),u=a(11282),m=a(79440),h=a(13691),f=a(85320),k=a(17505),v=a(12311),b=a(21651),y=a(24881),P=a(17790);function x(e,t){if(1&e&&(s.Tg(0,"option",11),n._(1),s.qZ()),2&e){const e=t.$implicit;i.Q("value",e),o.x(1),r.Oq(e)}}function _(e,t){if(1&e){const e=c.E();s.Tg(0,"div",12)(1,"div",13),n._(2),s.qZ(),s.Tg(3,"button",14),d.N("click",(function(){const t=l.CH(e).$implicit,a=g.o(2);return l.Kt(a.removePackage(t))})),s._U(4,"span",15),s.qZ()()}if(2&e){const e=t.$implicit;o.x(2),r.Oq(e)}}function D(e,t){if(1&e){const e=c.E();s.Tg(0,"div")(1,"div",0)(2,"select",5,6),p.Y(4,x,2,2,"option",7),s.qZ(),s.Tg(5,"button",8),d.N("click",(function(){l.CH(e);const t=u.M(3),a=g.o();return l.Kt(a.addPackage(a.availablePackages[t.selectedIndex]))})),s._U(6,"span",9),s.qZ()(),p.Y(7,_,5,1,"div",10),s.qZ()}if(2&e){const e=g.o();o.x(4),i.Q("ngForOf",e.availablePackages),o.x(3),i.Q("ngForOf",e.usedPackages)}}class O{constructor(e){this.packageManager=e,this.detailVisible=!1,this.usedPackages=[],this.availablePackages=[]}ngOnInit(){this.usedPackages=this.packageManager.usedPackages,this.updatedAvailablePackages()}addPackage(e){e&&(this.usedPackages=[...this.usedPackages,e],this.updatedAvailablePackages(),this.packageManager.setUsedPackages(this.usedPackages))}removePackage(e){this.usedPackages=this.usedPackages.filter((t=>t!=e)),this.updatedAvailablePackages(),this.packageManager.setUsedPackages(this.usedPackages)}updatedAvailablePackages(){this.availablePackages=this.packageManager.packages.filter((e=>!this.usedPackages.find((t=>t==e))))}}O.ɵfac=function(e){return new(e||O)(m.Y(k.L))},O.ɵcmp=h.Xp({type:O,selectors:[["package-manager"]],decls:6,vars:5,consts:[[1,"flex-row"],[1,"btn-icon","margin-right-extra-small",3,"click"],[1,"fas"],[1,"pm-header"],[4,"ngIf"],[1,"form-control","flex-1"],["avPkgs",""],[3,"value",4,"ngFor","ngForOf"],["type","button",1,"btn-icon","margin-left-extra-small",3,"click"],[1,"fas","fa-plus"],["class","flex-row align-items-center margin-top-small",4,"ngFor","ngForOf"],[3,"value"],[1,"flex-row","align-items-center","margin-top-small"],[1,"flex-1"],[1,"btn-icon","margin-left-extra-small",3,"click"],[1,"fas","fa-times"]],template:function(e,t){1&e&&(s.Tg(0,"div",0)(1,"button",1),d.N("click",(function(){return t.detailVisible=!t.detailVisible})),s._U(2,"span",2),s.qZ(),s.Tg(3,"div",3),n._(4,"packages"),s.qZ()(),p.Y(5,D,8,2,"div",4)),2&e&&(o.x(2),f.ek("fa-plus",!t.detailVisible)("fa-minus",t.detailVisible),o.x(3),i.Q("ngIf",t.detailVisible))},dependencies:[v.s,b.O,y.YN,P.Kr],styles:["[_nghost-%COMP%]\n{\n    display: flex;\n    flex-direction: column;\n    padding: 8px 10px;\n    border-bottom: 1px solid #aaa;\n}\n\n.pm-header[_ngcontent-%COMP%]\n{\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}"],changeDetection:0})},44155:(e,t,a)=>{a.d(t,{F:()=>r});var s=a(27052),n=a(68624),i=a(13691),o=a(38327);class r{}r.ɵfac=function(e){return new(e||r)},r.ɵmod=i.oA({type:r}),r.ɵinj=o.cJ({imports:[s.e,n.U]})},56454:(e,t,a)=>{a.d(t,{z:()=>n});var s=a(98084);class n{constructor(e,t,a){this.hotkeys=e,this.historyManager=t,this.metadataStorage=a}destroy(){this.hotkeys.destroy()}init(){this.hotkeys.hotkeys.add(new s.q("ctrl+s",(()=>(this.metadataStorage.saveMetadata(),!1)),["INPUT","TEXTAREA"],"Saves current state of editor")),this.hotkeys.hotkeys.add(new s.q("ctrl+z",(()=>(this.historyManager.undo(),!1)),["INPUT","TEXTAREA"],"Undo current state of editor")),this.hotkeys.hotkeys.add(new s.q("ctrl+y",(()=>(this.historyManager.redo(),!1)),["INPUT","TEXTAREA"],"Redo current state of editor"))}}},17505:(e,t,a)=>{a.d(t,{L:()=>c});var s=a(11776),n=a(46480),i=a(38223),o=a(53682),r=a(13457);class c{constructor(e){this.storageName=e,this._usedPackages=[],this.initSubscriptions=new i.w,this.usedPackagesSubject=new o.xQ,this.packagesChangeSubject=new o.xQ,this.store=(0,s.f3)(n.T0),this.packageSources=(0,s.f3)(r.B),this.usedPackages=this.store.get(e)??[];for(const e of this.packageSources)this.initSubscriptions.add(e.packagesChange.subscribe((()=>this.packagesChangeSubject.next())))}get packagesChange(){return this.packagesChangeSubject.asObservable()}get packages(){const e=[];for(const t of this.packageSources)e.push(...t.packages);return e}get usedPackages(){return this._usedPackages}set usedPackages(e){this._usedPackages=e}get usedPackagesChange(){return this.usedPackagesSubject.asObservable()}setUsedPackages(e){this._usedPackages!=e&&(this._usedPackages=e,this.store.set(this.storageName,e),this.usedPackagesSubject.next())}refresh(){for(const e of this.packageSources)e.refresh()}destroy(){this.initSubscriptions.unsubscribe()}}}}]);
//# sourceMappingURL=3292.chunk.746140809eae4e2489a9.js.map