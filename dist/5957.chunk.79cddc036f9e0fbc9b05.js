"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[5957],{75957:(t,e,n)=>{n.d(e,{F:()=>B});var i=n(4905),o=n(27052),s=n(9360),a=n(86463),r=n(40362);class d{constructor(t,e,n,i,o){this._parentGroup=t,this._relationManager=e,this.history=n,this.start=i,this.end=o,this._destroyingSubject=new a.x,this.output=null,this.input=null,this._path=this._parentGroup.append("path").attr("fill","transparent").attr("stroke","#48B8B8").attr("stroke-width","3px"),this._lineGenerator=(0,s.jvg)().curve(s.tFB.beta(.75))}get destroying(){return this._destroyingSubject.asObservable()}destroy(){this._path?.remove(),this._destroyingSubject.next()}invalidateVisuals(t){if(t==r.r){const t=this._relationManager.getActiveInput();this._relationManager.setActiveInput(null),t?t.addRelation(this)?(this.end=t.getCoordinates(),this.input=t,this.history.getNewState()):(this.destroy(),this.start=null,this.end=null,this.input=null,this.output=null,this.history.getNewState()):(this.destroy(),this.start=null,this.end=null,this.input=null,this.output=null)}if(!this.start||!this.end)return;let e;if(this.end.x<=this.start.x){let t=this.start.x-this.end.x;const n=(this.end.y-this.start.y)/2;t<12&&(t=12),t*=1.3,e=[[this.start.x,this.start.y],[this.start.x+t,this.start.y+n],[this.end.x-t,this.start.y+n],[this.end.x,this.end.y]]}else{const t=(this.end.x-this.start.x)/3;e=[[this.start.x,this.start.y],[this.start.x+t,this.start.y],[this.end.x-t,this.end.y],[this.end.x,this.end.y]]}this._path.attr("d",this._lineGenerator(e))}}var c=n(26220),u=n(47432),l=n(74445),h=n(46480),p=n(14389),g=n(49891),f=n(43939),v=n(91861),m=n(79440),y=n(15783),x=n(13691),b=n(36973),w=n(48397);function N(t,e,n,i,o,s,a){try{var r=t[s](a),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(i,o)}class _{constructor(t,e,n,i){this.viewContainerRef=t,this.relationsNodeManager=e,this.loader=n,this.logger=i,this.destroySubscription=null,this.componentRef=null,this.componentMetadata=null,this.zoomLevel=1,this.create=new l.v,this.destroy=new l.v}get component(){return this.componentRef?this.componentRef.instance:null}ngOnChanges(t){var e,n=this;return(e=function*(){if((0,g.$)("zoomLevel")in t&&(0,f.EN)(n.zoomLevel)&&!((0,g.$)("componentMetadata")in t)){const e=n.component;if(e){const i=t[(0,g.$)("zoomLevel")];e.zoomLevel=n.zoomLevel;const o={};(0,p.m)(o,"zoomLevel",i,i.previousValue),e.ngOnChanges(o),e.invalidateVisuals()}}else if(n.logger?.debug("RelationsNodeRendererSADirective: rendering node {@id}",{id:n.componentMetadata?.id}),n.ngOnDestroy(),n.viewContainerRef.clear(),(0,g.$)("componentMetadata")in t&&n.componentMetadata){const t=yield n.loader.loadItem(n.componentMetadata);if(!t)return void n.logger?.warn("RelationsNodeRendererSADirective: Unable to find relations node type {@type}",{name:n.componentMetadata.name,package:n.componentMetadata.package});if(n.componentRef=n.viewContainerRef.createComponent(t.data,{injector:n.viewContainerRef.injector}),n.logger?.debug("RelationsNodeRendererSADirective: node rendered {@id}",{id:n.componentMetadata?.id}),n.component){const t=n.component;n.destroySubscription=t.destroy.subscribe((()=>n.ngOnDestroy())),n.logger?.debug("RelationsNodeRendererSADirective: initializing node with metadata {@id}",{id:n.componentMetadata?.id}),t.metadata=n.componentMetadata,t.zoomLevel=n.zoomLevel;const e={};(0,p.m)(e,"metadata",n.componentMetadata,null,!0),(0,p.m)(e,"zoomLevel",n.zoomLevel,null,!0),t.ngOnChanges(e),n.logger?.debug("RelationsNodeRendererSADirective: invalidating node visuals {@id}",{id:n.componentMetadata?.id}),t.invalidateVisuals(),n.componentRef.changeDetectorRef.markForCheck(),n.relationsNodeManager.registerNode(n.component),n.create.next(t)}}},function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function a(t){N(s,i,o,a,r,"next",t)}function r(t){N(s,i,o,a,r,"throw",t)}a(void 0)}))})()}ngOnDestroy(){this.destroySubscription?.unsubscribe(),this.destroySubscription=null,this.componentRef&&(this.logger?.debug("RelationsNodeRendererSADirective: destroying node {@id}",{id:this.componentMetadata?.id}),this.component&&(this.componentMetadata&&this.destroy.next(this.componentMetadata),this.relationsNodeManager.unregisterNode(this.component)),this.componentRef?.destroy(),this.componentRef=null)}}_.ɵfac=function(t){return new(t||_)(m.Y(y.s_),m.Y(w.J),m.Y(v.fI),m.Y(h.bZ,8))},_.ɵdir=x.lG({type:_,selectors:[["","relationsNodeRenderer",""]],inputs:{componentMetadata:["relationsNodeRenderer","componentMetadata"],zoomLevel:"zoomLevel"},outputs:{create:"create",destroy:"destroy"},exportAs:["relationsNodeRenderer"],standalone:!0,features:[b.T]});var R=n(84773),S=n(43870),I=n(4477),M=n(72891),P=n(6845),k=n(66794),z=n(73301),L=n(55436),D=n(47083),C=n(85320),O=n(82568),Y=n(80827),F=n(15686),E=n(12311);const j=["relationsGroup"];function A(t,e){if(1&t){const t=R.E();S.O4(),S.kc(),I.yn(0)(1,4),M.N("destroy",(function(e){S.CH(t);const n=P.o();return S.Kt(n.destroyNode(e))})),I.BQ()()}if(2&t){const t=e.$implicit,n=P.o();k.x(1),z.Q("relationsNodeRenderer",t)("zoomLevel",n.zoomLevel)}}class B{constructor(t,e,n){this.element=t,this.relationManager=e,this.history=n,this.backgroundSize=16,this.dragStartPosition={x:0,y:0},this.canvasPosition={x:0,y:0},this.zoomLevel=1,this.isDragging=!1,this.nodeDefinitions=[]}get backgroundSizeStyle(){return`${this.backgroundSize}px ${this.backgroundSize}px`}get _backgroundPositionStyle(){return`${this.canvasPosition.x%this.backgroundSize}px ${this.canvasPosition.y%this.backgroundSize}px`}get boundingBox(){return this.element.nativeElement.getBoundingClientRect()}createRelation(){return new d((0,s.Ys)(this.relationsGroup?.nativeElement),this.relationManager,this.history,null,null)}getPositionInCanvas(t){return{x:(t.x-this.boundingBox.left-this.canvasPosition.x)/this.zoomLevel,y:(t.y-this.boundingBox.top-this.canvasPosition.y)/this.zoomLevel}}onMouseDown(t){t.buttons==c.t.LEFT&&(this.dragStartPosition={x:t.clientX-this.canvasPosition.x,y:t.clientY-this.canvasPosition.y},this.isDragging=!0)}onMouseMove(t){this.isDragging&&(this.canvasPosition={x:t.clientX-this.dragStartPosition.x,y:t.clientY-this.dragStartPosition.y})}onMouseUp(t){this.isDragging&&(this.isDragging=!1)}onWheel(t){if(t.deltaY){const e=(0,u.uZ)(this.zoomLevel+.05*(t.deltaY>1?-1:1),.2,2),n=(t.clientX-this.canvasPosition.x-this.boundingBox.left)/this.zoomLevel,i=(t.clientY-this.canvasPosition.y-this.boundingBox.top)/this.zoomLevel;this.canvasPosition.x=t.clientX-this.boundingBox.left-n*e,this.canvasPosition.y=t.clientY-this.boundingBox.top-i*e,this.zoomLevel=e,this.backgroundSize=16*this.zoomLevel}t.preventDefault(),t.stopImmediatePropagation()}destroyNode(t){const e=this.nodeDefinitions.indexOf(t);e<0||(this.nodeDefinitions.splice(e,1),this.history.getNewState())}}B.ɵfac=function(t){return new(t||B)(m.Y(i.SB),m.Y(w.J),m.Y(v.nR))},B.ɵcmp=x.Xp({type:B,selectors:[["relations-canvas"]],viewQuery:function(t,e){if(1&t&&L.Gf(j,5,i.SB),2&t){let t;L.iG(t=L.CR())&&(e.relationsGroup=t.first)}},hostVars:4,hostBindings:function(t,e){1&t&&M.N("mousedown",(function(t){return e.onMouseDown(t)}))("mousemove",(function(t){return e.onMouseMove(t)}))("mouseup",(function(t){return e.onMouseUp(t)}),!1,D.Jf)("wheel",(function(t){return e.onWheel(t)})),2&t&&C.Ud("background-size",e.backgroundSizeStyle)("background-position",e._backgroundPositionStyle)},inputs:{nodeDefinitions:"nodeDefinitions"},standalone:!0,features:[O.j],decls:5,vars:3,consts:[[1,"flow-area"],[1,"relations-wrapper"],["relationsGroup",""],[4,"ngFor","ngForOf"],[3,"relationsNodeRenderer","zoomLevel","destroy"]],template:function(t,e){1&t&&(Y.Tg(0,"div",0),S.O4(),Y.Tg(1,"svg",1),Y._U(2,"g",null,2),Y.qZ(),F.Y(4,A,2,2,"ng-container",3),Y.qZ()),2&t&&(C.Ud("transform","translate("+e.canvasPosition.x+"px, "+e.canvasPosition.y+"px) scale("+e.zoomLevel+")"),k.x(4),z.Q("ngForOf",e.nodeDefinitions))},dependencies:[o.e,E.s,_],styles:["[_nghost-%COMP%]\n{\n    background-color: #e5e5f7;\n    opacity: 0.6;\n    background-image: radial-gradient(#444cf7 0.8px, #e5e5f7 0.8px);\n    overflow: hidden;\n}\n\n.flow-area[_ngcontent-%COMP%]\n{\n    height: 100%;\n    position: relative;\n    transform-origin: 0 0;\n}\n\n.relations-wrapper[_ngcontent-%COMP%]\n{\n    width: 100%;\n    height: 100%;\n    overflow: visible;\n}"],changeDetection:0})},40362:(t,e,n)=>{n.d(e,{r:()=>i});const i="drop"},26220:(t,e,n)=>{var i;n.d(e,{t:()=>i}),function(t){t[t.LEFT=1]="LEFT"}(i||(i={}))},53971:(t,e,n)=>{n.d(e,{AL:()=>L,aU:()=>D,md:()=>z,bv:()=>I,YK:()=>P,Ub:()=>F,P_:()=>Y,xt:()=>C,Oq:()=>O,UB:()=>k,I_:()=>M});var i=n(60640),o=n(11776),s=n(86707),a=n(65569),r=n(44677),d=n(12193),c=n(13457),u=n(44055),l=n(46480),h=n(91861),p=n(10439);function g(t,e,n,i,o,s,a){try{var r=t[s](a),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(i,o)}const f=function(){var t,e=(t=function*(t,e){const n=yield(0,p.j)(t,e);if(e?.debug("relationsNodeExtractor: trying to extract dynamic node"),!n)return null;const i=n.data;if(!i)return null;const o=yield i.relationsEditorMetadata;return o?{data:o.nodeDefinition,metaInfo:o.metaInfo}:null},function(){var e=this,n=arguments;return new Promise((function(i,o){var s=t.apply(e,n);function a(t){g(s,i,o,a,r,"next",t)}function r(t){g(s,i,o,a,r,"throw",t)}a(void 0)}))});return function(t,n){return e.apply(this,arguments)}}();function v(t,e,n,i,o,s,a){try{var r=t[s](a),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(i,o)}const m=function(){var t,e=(t=function*(t,e){const n=t;if(e?.debug("componentRelationsNodeExtractor: trying to extract dynamic node"),!n)return null;const i=n.default;if(!i)return null;const o=yield i.relationsEditorMetadata;return o?{data:o.nodeDefinition,metaInfo:o.metaInfo,singleton:!0,displayName:n.displayName}:null},function(){var e=this,n=arguments;return new Promise((function(i,o){var s=t.apply(e,n);function a(t){v(s,i,o,a,r,"next",t)}function r(t){v(s,i,o,a,r,"throw",t)}a(void 0)}))});return function(t,n){return e.apply(this,arguments)}}();var y=n(38327),x=n(54870);class b{constructor(t,e){this._componentsRegister=t,this._logger=e}tryToGet(t){if("static-components"!=t.package)return null;this._logger?.debug("StaticComponentsRelationsNodesProvider: trying to get node {@item}",{name:t.name,package:t.package});const e=this._componentsRegister.getType(t.name);return e?{default:e}:null}}function w(t,e,n,i,o,s,a){try{var r=t[s](a),d=r.value}catch(t){return void n(t)}r.done?e(d):Promise.resolve(d).then(i,o)}b.ɵfac=function(t){return new(t||b)(o.LF(x.w),o.LF(l.bZ,8))},b.ɵprov=y.Yz({token:b,factory:b.ɵfac});class N{constructor(t){this._logger=t}tryToGet(t){var e,i=this;return(e=function*(){try{switch(i._logger?.debug("DefaultDynamicModuleRelationsProvider: trying to get relations types for module {@module}",{moduleName:t.package}),t.package){case"basic-components":return yield n.e(4041).then(n.bind(n,94041));case"material-components":return yield n.e(5342).then(n.bind(n,85342));default:return null}}catch(e){i._logger?.debug("DefaultDynamicModuleRelationsProvider: module {@module} was not found, reason: "+e,{moduleName:t.package})}return null},function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function a(t){w(s,i,o,a,r,"next",t)}function r(t){w(s,i,o,a,r,"throw",t)}a(void 0)}))})()}}N.ɵfac=function(t){return new(t||N)(o.LF(l.bZ,8))},N.ɵprov=y.Yz({token:N,factory:N.ɵfac});class _{constructor(t,e){this._componentsRegister=t,this._logger=e}tryToGet(t){if("static-components"!=t.package)return null;this._logger?.debug("StaticComponentsRelationsTypesProvider: trying to get relations types {@item}",{name:t.name,package:t.package});const e=this._componentsRegister.types;return e?{default:e}:null}}_.ɵfac=function(t){return new(t||_)(o.LF(x.w),o.LF(l.bZ,8))},_.ɵprov=y.Yz({token:_,factory:_.ɵfac});var R=n(48397),S=n(47432);const I={provide:h.n7,useClass:s.o,multi:!0},M={provide:h.n7,useClass:b,multi:!0},P={provide:h.GP,useClass:N,multi:!0},k={provide:h.GP,useClass:_,multi:!0},z={provide:h.yh,useFactory:t=>new a.$([f],t),deps:[[new i.Fi,l.bZ]],multi:!0},L={provide:h.yh,useFactory:t=>new a.$([m],t),deps:[[new i.Fi,l.bZ]],multi:!0},D={provide:h.DZ,useFactory:t=>new a.$([r.L],t),deps:[[new i.Fi,l.bZ]],multi:!0},C={provide:h.Bj,useFactory:()=>new d.S((0,o.f3)(h.GP),(0,o.f3)(h.DZ),S.CQ,(0,o.f3)(l.bZ,{optional:!0})??void 0,!0)},O={provide:h.fI,useFactory:()=>new d.S((0,o.f3)(h.n7),(0,o.f3)(h.yh),S.Zl,(0,o.f3)(l.bZ,{optional:!0})??void 0)},Y={provide:c.Q,useExisting:R.J},F={provide:h.nR,useClass:u.Y}},47432:(t,e,n)=>{n.d(e,{CQ:()=>c,TN:()=>l,Zl:()=>u,hE:()=>h,uZ:()=>d});var i=n(14389),o=n(43939),s=n(53971),a=n(48397),r=n(54870);function d(t,e,n){return Math.min(Math.max(t,e),n)}const c=function(t){return!((0,o.fp)(t?.data)||!Array.isArray(t.data))},u=function(t){return!((0,o.fp)(t?.data)||!(0,o.P9)(t.data)||(0,o.EN)(t.singleton)&&!(0,o.jn)(t.singleton)||(0,o.EN)(t.displayName)&&!(0,o.HD)(t.displayName)||(0,o.EN)(t?.metaInfo)&&!(0,o.wV)(t.metaInfo))};function l(t=["basic-components","material-components"]){return[s.bv,s.YK,s.md,s.AL,s.aU,s.xt,s.Oq,a.J,s.P_,s.Ub,...t.map((t=>(0,i.X)(t)))]}function h(t,e){return[...l(e),s.I_,s.UB,{provide:r.w,useClass:t},(0,i.X)("static-components")]}},48397:(t,e,n)=>{n.d(e,{J:()=>o});var i=n(38327);class o{constructor(){this._nodes={},this._waitingInputRelations={}}setActiveInput(t){this._activeInput=t}getActiveInput(){return this._activeInput}registerNode(t){var e,n;if(this._nodes[t.id]=t,t.metadata?.outputs&&Array.isArray(t.metadata?.outputs))for(const i of t.metadata?.outputs){if(!i.inputs||!Array.isArray(i.inputs))continue;const o=t.outputs[i.outputName];if(o)for(const t of i.inputs){const i=this._nodes[t.id],s=o.startRelation();if(!i){(e=this._waitingInputRelations)[n=t.id]??(e[n]=[]),this._waitingInputRelations[t.id].push({inputName:t.inputName,relation:s});continue}const a=i.inputs[t.inputName];a&&a.endRelation(s)}}if(this._waitingInputRelations[t.id]){const e=this._waitingInputRelations[t.id],n=this._nodes[t.id];if(!n)return;for(const i of e){const e=n.inputs[i.inputName];e&&(e.endRelation(i.relation),delete this._waitingInputRelations[t.id])}}}unregisterNode(t){delete this._nodes[t.id]}getMetadata(){const t=[],e=Object.keys(this._nodes);for(const n of e){const e=this._nodes[n];if(!e.metadata)continue;const i={id:n,name:e.metadata.name,package:e.metadata.package,displayName:e.metadata.displayName,relationsOptions:e.metadata.relationsOptions,nodeMetadata:e.metadata.nodeMetadata,outputs:[]};if(e.allOutputs){for(const t of e.allOutputs){if(!t.relations)continue;if(!t.name)continue;const e={outputName:t.name,inputs:[]};for(const n of t.relations)n.input?.name&&e.inputs.push({id:n.input.parentId,inputName:n.input.name});i.outputs?.push(e)}t.push(i)}}return t}}o.ɵfac=function(t){return new(t||o)},o.ɵprov=i.Yz({token:o,factory:o.ɵfac})},54870:(t,e,n)=>{n.d(e,{w:()=>o});var i=n(38327);class o{constructor(){this._definedTypes=this.getDefinedTypes()}get types(){return Object.keys(this._definedTypes)}getType(t){return this._definedTypes[t]??null}}o.ɵfac=function(t){return new(t||o)},o.ɵprov=i.Yz({token:o,factory:o.ɵfac})},10439:(t,e,n)=>{n.d(e,{j:()=>s});var i=n(43939),o=n(89402);const s=(t,e)=>{const n=t;return e?.debug("relationsExportExtractor: trying to extract dynamic relations"),(0,i.EN)(n.relations)&&(0,i.P9)(n.relations)&&(0,o.O)(n.relations)?{data:n.relations}:(0,i.EN)(n.default)&&(0,i.P9)(n.default)&&(0,o.O)(n.default)?{data:n.default}:null}},44055:(t,e,n)=>{n.d(e,{Y:()=>d});var i=n(43939),o=n(86463),s=n(13457),a=n(11776),r=n(38327);class d{constructor(t){this.metadataState=t,this.activeIndex=null,this.saveIndex=null,this.states=[],this.enabled=!0,this.popSubject=new o.x,this.historyChangeSubject=new o.x}get canUndo(){return!(0,i.fp)(this.activeIndex)&&this.activeIndex>0}get canRedo(){return!(0,i.fp)(this.activeIndex)&&this.activeIndex+1<this.states.length}get saved(){return this.activeIndex===this.saveIndex}get pop(){return this.popSubject.asObservable()}get historyChange(){return this.historyChangeSubject.asObservable()}get state(){return(0,i.fp)(this.activeIndex)?null:JSON.parse(this.states[this.activeIndex])}undo(){this.canUndo&&!(0,i.fp)(this.activeIndex)&&(this.activeIndex--,this.popSubject.next(JSON.parse(this.states[this.activeIndex])))}redo(){this.canRedo&&!(0,i.fp)(this.activeIndex)&&(this.activeIndex++,this.popSubject.next(JSON.parse(this.states[this.activeIndex])))}getNewState(){if(!this.enabled)return;this.states.length>=200&&this.states.shift(),(0,i.EN)(this.activeIndex)&&this.activeIndex+1<this.states.length&&this.states.splice(this.activeIndex+1,this.states.length-(this.activeIndex+1));const t=this.metadataState.getMetadata();t&&(this.states.push(JSON.stringify(t)),this.activeIndex=this.states.length-1,this.historyChangeSubject.next())}save(){this.saveIndex=this.activeIndex}setInitialState(t){this.states.push(JSON.stringify(t)),this.activeIndex=this.states.length-1,this.save()}clean(){this.activeIndex=null,this.saveIndex=null,this.states=[]}enable(){this.enabled=!0}disable(){this.enabled=!1}}d.ɵfac=function(t){return new(t||d)(a.LF(s.Q))},d.ɵprov=r.Yz({token:d,factory:d.ɵfac})}}]);
//# sourceMappingURL=5957.chunk.79cddc036f9e0fbc9b05.js.map